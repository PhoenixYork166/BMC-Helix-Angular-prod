{"version":3,"file":"document-selection-step.component.js","sourceRoot":"","sources":["../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/external-record-wizard/document-selection-step/document-selection-step.component.ts","../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/external-record-wizard/document-selection-step/document-selection-step.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, OnDestroy, OnInit, TemplateRef, ViewChild } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { head, isEqual } from 'lodash';\nimport { combineLatest, Observable, of, ReplaySubject } from 'rxjs';\nimport { distinctUntilChanged, filter, map, shareReplay, skip, takeUntil } from 'rxjs/operators';\nimport { IRecordDefinition, RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { IDataPageResult } from '@helix/platform/shared/api';\nimport { RxWizardModalComponent } from '@helix/platform/shared/components';\nimport { IRowDataItem } from '@helix/platform/view/api';\nimport {\n  IRecordGridColumn,\n  IRecordGridConfig,\n  RecordGridComponent,\n  RowSelectionMode\n} from '@helix/platform/view/components';\nimport { IRequestDefinition } from '@helix/platform/web-api/api';\nimport { AX_BUNDLE_DETAILS } from '../../bundle-details/bundle-details.constant';\nimport { RxExternalDataService } from '../../../services/external-data/external-data.service';\nimport { IExternalRecordWizardContext } from '../external-record-wizard.types';\n\n@Component({\n  selector: 'ax-document-selection-wizard-step',\n  templateUrl: 'document-selection-step.component.html',\n  styleUrls: ['./document-selection-step.component.scss']\n})\nexport class DocumentSelectionStepComponent implements OnInit, OnDestroy {\n  @Input()\n  context: IExternalRecordWizardContext;\n\n  @ViewChild(RecordGridComponent, { static: true })\n  recordGrid: RecordGridComponent;\n\n  @ViewChild('documentNameCellTemplate', { static: true })\n  documentNameCellTemplate: TemplateRef<any>;\n\n  recordGridConfig$: Observable<IRecordGridConfig>;\n  sectionLabel: string;\n\n  private destroyed$: ReplaySubject<boolean> = new ReplaySubject(1);\n\n  constructor(\n    private rxExternalDataService: RxExternalDataService,\n    private rxWizardModalComponent: RxWizardModalComponent,\n    private translateService: TranslateService\n  ) {}\n\n  ngOnInit(): void {\n    this.sectionLabel = this.translateService.instant(\n      'com.bmc.arsys.rx.innovation-studio.external-record-wizard.document-selection.label'\n    );\n\n    const gridColumns: IRecordGridColumn[] = [\n      {\n        fieldId: AX_BUNDLE_DETAILS.definitionGridColumns.name.fieldId,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.name.label'),\n        cellTemplate: this.documentNameCellTemplate\n      }\n    ];\n\n    const gridRecordDefinition: IRecordDefinition = {\n      fieldDefinitions: [\n        {\n          id: AX_BUNDLE_DETAILS.definitionGridColumns.name.fieldId,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        }\n      ]\n    };\n\n    this.recordGridConfig$ = of({\n      columns: gridColumns,\n      emptyStateLabelText: this.translateService.instant(\n        'com.bmc.arsys.rx.innovation-studio.external-record-wizard.document-selection.grid.empty-state.label'\n      ),\n      enableRowSelection: RowSelectionMode.Single,\n      enableFiltering: false,\n      recordIdField: AX_BUNDLE_DETAILS.definitionGridColumns.name.fieldId,\n      styles: 'flex-fill',\n      useExternalFiltering: false,\n      getRecordDefinition: () => of(gridRecordDefinition),\n      getData: (): Observable<IDataPageResult> =>\n        this.context.webApi\n          ? this.rxExternalDataService.getWebApiDocuments(this.getWebApiRequests())\n          : of({\n              totalSize: 0,\n              data: []\n            })\n    });\n\n    this.recordGrid.rowSelectionChanged\n      .pipe(skip(2), takeUntil(this.destroyed$))\n      .subscribe((selectedRows: IRowDataItem[]) => {\n        this.rxWizardModalComponent.api.updateContext({\n          document: head(selectedRows) || null\n        });\n      });\n\n    const documentSelectionStepContext$ = this.rxWizardModalComponent.context$.pipe(\n      shareReplay(1),\n      takeUntil(this.destroyed$)\n    );\n\n    documentSelectionStepContext$\n      .pipe(\n        map((stepContext: IExternalRecordWizardContext) => stepContext.webApi),\n        distinctUntilChanged(isEqual),\n        skip(1)\n      )\n      .subscribe(() => {\n        this.rxWizardModalComponent.api.updateContext({ document: null });\n        this.recordGrid.api.refresh().subscribe();\n      });\n\n    const isCurrentStep$ = combineLatest([\n      this.rxWizardModalComponent.steps$,\n      this.rxWizardModalComponent.tabIndex$\n    ]).pipe(\n      map(([steps, tabIndex]) => steps[tabIndex].id === 'document-selection'),\n      takeUntil(this.destroyed$)\n    );\n\n    const changedDocument$ = documentSelectionStepContext$.pipe(\n      map((stepContext: IExternalRecordWizardContext) => stepContext.document),\n      distinctUntilChanged(isEqual)\n    );\n\n    combineLatest([isCurrentStep$, changedDocument$])\n      .pipe(\n        filter(([isCurrentStep, changedDocument]) => isCurrentStep),\n        distinctUntilChanged(isEqual)\n      )\n      .subscribe(([isCurrentStep, changedDocument]) => {\n        if (changedDocument) {\n          this.rxWizardModalComponent.api.enableNextButton();\n        } else {\n          this.rxWizardModalComponent.api.disableNextButton();\n        }\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroyed$.next();\n    this.destroyed$.complete();\n  }\n\n  private getWebApiRequests(): { [key: string]: string } {\n    return this.context.webApi.requestDefinitions.reduce((result, requestDefinition: IRequestDefinition) => {\n      if (requestDefinition.body && !result[requestDefinition.body]) {\n        result[requestDefinition.body] = requestDefinition.body;\n      }\n\n      if (requestDefinition.output && !result[requestDefinition.output]) {\n        result[requestDefinition.output] = requestDefinition.output;\n      }\n\n      return result;\n    }, {});\n  }\n}\n","<adapt-rx-control-label [label]=\"sectionLabel\" [showRequiredLabel]=\"true\"></adapt-rx-control-label>\n\n<rx-record-grid [config]=\"recordGridConfig$\"></rx-record-grid>\n\n<ng-template #documentNameCellTemplate let-dataItem=\"dataItem\" let-column=\"column\">\n  {{ dataItem[column.field] | rxDefinitionNamePipe }}\n</ng-template>\n"]}