{"version":3,"file":"rule-definition-tab.component.js","sourceRoot":"","sources":["../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/rule-definition-tab/rule-definition-tab.component.ts","../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/rule-definition-tab/rule-definition-tab.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, OnInit, TemplateRef, ViewChild } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { IRecordDefinition, RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport {\n  RxRuleDefinitionDataPageService,\n  RxRuleDefinitionService,\n  RxRuleTriggerEventPipe\n} from '@helix/platform/rule/api';\nimport {\n  IBundleDescriptor,\n  IDataPageResult,\n  IDefinition,\n  RX_APPLICATION,\n  RX_BUNDLE,\n  RX_OVERLAY,\n  RxBundleCacheService,\n  RxCommandFactoryService,\n  RxDefinitionNameService,\n  RxGlobalCacheService,\n  RxOverlayService\n} from '@helix/platform/shared/api';\nimport { RenameDefinitionModalComponent } from '@helix/platform/shared/components';\nimport { RX_MODAL, RxModalService } from '@helix/platform/ui-kit';\nimport { IRowDataItem } from '@helix/platform/view/api';\nimport { IRecordGridColumn } from '@helix/platform/view/components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { assign, map as _map, noop, some } from 'lodash';\nimport { BehaviorSubject, forkJoin, from, Observable, of } from 'rxjs';\nimport { filter, finalize, map, switchMap, take, tap } from 'rxjs/operators';\nimport { IRenameAction } from '../bundle-definitions/bundle-definitions.types';\nimport { AX_BUNDLE_DETAILS } from '../bundle-details/bundle-details.constant';\nimport { IDefinitionActionConfig } from '../bundle-details/bundle-details.types';\nimport { RxCopyDefinitionService } from '../copy-definition/copy-definition.service';\nimport { DefinitionTabComponent } from '../definition-tab/definition-tab.component';\nimport { AX_RULE_DEFINITION_TAB } from './rule-definition-tab.contant';\nimport { CopyDefinitionType } from '../copy-definition/copy-definition.types';\n\n@Component({\n  selector: 'ax-rule-definition-tab',\n  templateUrl: './rule-definition-tab.component.html',\n  providers: [RxRuleTriggerEventPipe]\n})\nexport class RuleDefinitionTabComponent implements OnInit {\n  @Input()\n  bundleDescriptor: IBundleDescriptor;\n\n  @ViewChild(DefinitionTabComponent, { static: true })\n  definitionTabComponent: DefinitionTabComponent;\n\n  @ViewChild('definitionNameCellTemplate', { static: true })\n  definitionNameCellTemplate: TemplateRef<any>;\n\n  private rowSelectionChanged$ = new BehaviorSubject<IRowDataItem[]>([]);\n  private areNewDefinitionsAllowed;\n\n  definitionActions$ = this.rowSelectionChanged$.pipe(map((selectedRows) => this.getDefinitionActions(selectedRows)));\n\n  definitions$: Observable<IDataPageResult> = forkJoin([\n    this.rxBundleCacheService.bundleId$.pipe(\n      take(1),\n      switchMap((bundleId: string) => this.rxGlobalCacheService.getBundleDescriptor(bundleId))\n    ),\n    this.rxRuleDefinitionDataPageService.get({\n      params: {\n        propertySelection: [\n          AX_BUNDLE_DETAILS.definitionGridColumns.name.fieldId,\n          AX_RULE_DEFINITION_TAB.definitionGridColumns.recordDefinitionNames.fieldId,\n          AX_RULE_DEFINITION_TAB.definitionGridColumns.triggerEvent.fieldId,\n          AX_BUNDLE_DETAILS.definitionGridColumns.lastUpdateTime.fieldId,\n          AX_BUNDLE_DETAILS.definitionGridColumns.lastChangedBy.fieldId,\n          AX_BUNDLE_DETAILS.definitionGridColumns.isEnabled.fieldId,\n          AX_BUNDLE_DETAILS.definitionGridColumns.scope.fieldId,\n          AX_BUNDLE_DETAILS.definitionGridColumns.customizationPerspective.fieldId,\n          'overlayGroupId'\n        ]\n      }\n    })\n  ]).pipe(\n    map(([bundleDescriptor, dataPage]) => {\n      dataPage.data = _map(dataPage.data, (definition) => {\n        if (definition.scope === RX_BUNDLE.definitionScopeTypes.bundle) {\n          definition.scope = bundleDescriptor.isApplication\n            ? RX_BUNDLE.definitionScopeNames.application\n            : RX_BUNDLE.definitionScopeNames.library;\n        } else {\n          definition.scope = RX_BUNDLE.definitionScopeNames.public;\n        }\n\n        return assign(definition, {\n          primaryRecordDefinition:\n            this.rxDefinitionNameService.getDisplayName(definition.recordDefinitionNames[0]) ||\n            this.translateService.instant('com.bmc.arsys.rx.client.common.not-applicable.label'),\n          executionOrder: definition.triggerEvent.executionOrder,\n          triggerEvent: this.rxRuleTriggerEventPipe.transform(definition.triggerEvent)\n        });\n      });\n\n      return dataPage;\n    })\n  );\n\n  gridColumns: IRecordGridColumn[] = [];\n  isActionInProgress = false;\n  recordDefinition: Partial<IRecordDefinition>;\n\n  constructor(\n    private router: Router,\n    private rxRuleTriggerEventPipe: RxRuleTriggerEventPipe,\n    private rxRuleDefinitionService: RxRuleDefinitionService,\n    private rxOverlayService: RxOverlayService,\n    private rxRuleDefinitionDataPageService: RxRuleDefinitionDataPageService,\n    private rxModalService: RxModalService,\n    private translateService: TranslateService,\n    private rxCommandFactoryService: RxCommandFactoryService,\n    private rxBundleCacheService: RxBundleCacheService,\n    private rxGlobalCacheService: RxGlobalCacheService,\n    private rxCopyDefinitionService: RxCopyDefinitionService,\n    private rxDefinitionNameService: RxDefinitionNameService\n  ) {}\n\n  private getDefinitionActions(selectedRows: IRowDataItem[]): IDefinitionActionConfig[] {\n    const isBundleEditable = this.rxOverlayService.isBundleEditable(this.rxBundleCacheService.bundleId);\n\n    return [\n      {\n        id: AX_BUNDLE_DETAILS.standardDefinitionActionNames.new,\n        isDisabled: !this.areNewDefinitionsAllowed\n      },\n      {\n        id: AX_BUNDLE_DETAILS.standardDefinitionActionNames.rename,\n        isDisabled:\n          !isBundleEditable ||\n          !(\n            selectedRows.length === 1 &&\n            this.rxOverlayService.isCustomizationEnabled('allowOverlay', selectedRows[0] as IDefinition)\n          )\n      },\n      {\n        id: AX_BUNDLE_DETAILS.standardDefinitionActionNames.revertCustomization,\n        isDisabled:\n          !isBundleEditable ||\n          selectedRows.length === 0 ||\n          some(\n            selectedRows,\n            (selectedRow) =>\n              selectedRow.customizationPerspective !== RX_OVERLAY.customizationPerspective.customizedInThisOverlayGroup\n          )\n      },\n      {\n        id: AX_BUNDLE_DETAILS.standardDefinitionActionNames.copy,\n        isDisabled: !this.areNewDefinitionsAllowed || selectedRows.length !== 1\n      },\n      {\n        id: AX_BUNDLE_DETAILS.standardDefinitionActionNames.delete,\n        isDisabled:\n          !isBundleEditable ||\n          selectedRows.length === 0 ||\n          some(\n            selectedRows,\n            (selectedRow) =>\n              selectedRow.customizationPerspective !== RX_OVERLAY.customizationPerspective.createdInThisOverlayGroup\n          )\n      }\n    ];\n  }\n\n  ngOnInit() {\n    this.areNewDefinitionsAllowed = this.rxOverlayService.areNewDefinitionsAllowedSync(this.bundleDescriptor);\n\n    this.gridColumns = [\n      AX_BUNDLE_DETAILS.definitionGridColumns.name,\n      {\n        title: AX_RULE_DEFINITION_TAB.definitionGridColumns.primaryRecordDefinition.titleKey,\n        fieldId: AX_RULE_DEFINITION_TAB.definitionGridColumns.primaryRecordDefinition.fieldId\n      },\n      {\n        title: AX_RULE_DEFINITION_TAB.definitionGridColumns.triggerEvent.titleKey,\n        fieldId: AX_RULE_DEFINITION_TAB.definitionGridColumns.triggerEvent.fieldId\n      },\n      {\n        title: AX_RULE_DEFINITION_TAB.definitionGridColumns.executionOrder.titleKey,\n        fieldId: AX_RULE_DEFINITION_TAB.definitionGridColumns.executionOrder.fieldId\n      },\n      AX_BUNDLE_DETAILS.definitionGridColumns.lastUpdateTime,\n      AX_BUNDLE_DETAILS.definitionGridColumns.lastChangedBy,\n      AX_BUNDLE_DETAILS.definitionGridColumns.isEnabled,\n      AX_BUNDLE_DETAILS.definitionGridColumns.scope,\n      AX_BUNDLE_DETAILS.definitionGridColumns.customizationPerspective\n    ];\n\n    const fieldDefinitions = [\n      {\n        id: AX_BUNDLE_DETAILS.definitionGridColumns.name.fieldId,\n        resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n      },\n      {\n        id: AX_RULE_DEFINITION_TAB.definitionGridColumns.primaryRecordDefinition.fieldId,\n        resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n      },\n      {\n        id: AX_RULE_DEFINITION_TAB.definitionGridColumns.executionOrder.fieldId,\n        resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n      },\n      {\n        id: AX_RULE_DEFINITION_TAB.definitionGridColumns.triggerEvent.fieldId,\n        resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n      },\n      {\n        id: AX_BUNDLE_DETAILS.definitionGridColumns.lastUpdateTime.fieldId,\n        resourceType: RX_RECORD_DEFINITION.resourceTypes.dateTime\n      },\n      {\n        id: AX_BUNDLE_DETAILS.definitionGridColumns.lastChangedBy.fieldId,\n        resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n      },\n      {\n        id: AX_BUNDLE_DETAILS.definitionGridColumns.isEnabled.fieldId,\n        resourceType: RX_RECORD_DEFINITION.resourceTypes.boolean\n      },\n      {\n        id: AX_BUNDLE_DETAILS.definitionGridColumns.scope.fieldId,\n        resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n      },\n      {\n        id: AX_BUNDLE_DETAILS.definitionGridColumns.customizationPerspective.fieldId,\n        resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n      }\n    ];\n\n    const fieldDefinitionsById = fieldDefinitions.reduce((result, fieldDefinition) => {\n      result[fieldDefinition.id] = fieldDefinition;\n\n      return result;\n    }, {});\n\n    this.recordDefinition = {\n      fieldDefinitions,\n      fieldDefinitionsById\n    };\n  }\n\n  onRenameDefinition({ selectedRow, definitionNames }: IRenameAction): void {\n    const definitionType: string = this.translateService.instant('com.bmc.arsys.rx.client.definition-type.rule.label');\n\n    from(\n      this.rxModalService\n        .openModal({\n          title: this.translateService.instant('com.bmc.arsys.rx.client.rename-definition-modal.title', {\n            definitionType: definitionType.toLowerCase()\n          }),\n          size: 'sm',\n          content: RenameDefinitionModalComponent,\n          data: {\n            definitionName: selectedRow.name,\n            infoText: this.translateService.instant('com.bmc.arsys.rx.client.rename-definition-modal.info.message'),\n            fieldLabel: this.translateService.instant(\n              'com.bmc.arsys.rx.client.rename-definition-modal.definition-name.label',\n              { definitionType }\n            ),\n            validationErrorText: this.translateService.instant(\n              'com.bmc.arsys.rx.client.rename-definition-modal.name-validation.message',\n              { definitionType }\n            ),\n            definitionType,\n            definitionNames\n          }\n        })\n        .catch(noop)\n    )\n      .pipe(\n        filter<string>(Boolean),\n        tap(() => {\n          this.isActionInProgress = true;\n        }),\n        switchMap((newRuleDefinitionName) =>\n          this.rxRuleDefinitionService.rename(selectedRow.name, newRuleDefinitionName)\n        ),\n        finalize(() => {\n          this.isActionInProgress = false;\n        }),\n        switchMap(() => this.definitionTabComponent.recordGrid.api.refresh())\n      )\n      .subscribe();\n  }\n\n  onCopyDefinition(row: IRowDataItem): void {\n    this.rxCopyDefinitionService.openCopyDefinitionComponentModal(row, CopyDefinitionType.Rule).catch(noop);\n  }\n\n  onDeleteDefinition(selectedRows: IRowDataItem[]): void {\n    const definitionNames = selectedRows.map((definition) => definition.name);\n\n    from(\n      this.rxModalService.confirm({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n        modalStyle: RX_MODAL.modalStyles.warning,\n        message: this.definitionTabComponent.getDeleteSelectedDefinitionMessage()\n      })\n    )\n      .pipe(\n        tap((result: boolean) => {\n          this.isActionInProgress = result;\n        }),\n        switchMap((response) =>\n          response\n            ? this.rxCommandFactoryService\n                .forResourceType(AX_RULE_DEFINITION_TAB.deleteRuleResource)\n                .execute({\n                  definitionNames\n                })\n                .pipe(\n                  tap(() => {\n                    this.isActionInProgress = false;\n                  }),\n                  switchMap(() => this.definitionTabComponent.recordGrid.api.refresh())\n                )\n            : of({})\n        ),\n        finalize(() => {\n          this.isActionInProgress = false;\n        })\n      )\n      .subscribe();\n  }\n\n  onRevertCustomization(selectedRows: IRowDataItem[]): void {\n    from(\n      this.rxModalService.confirm({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n        modalStyle: RX_MODAL.modalStyles.warning,\n        message: this.translateService.instant(\n          'com.bmc.arsys.rx.innovation-studio.revert-customization.confirmation.message'\n        )\n      })\n    )\n      .pipe(\n        tap(() => {\n          this.isActionInProgress = true;\n        }),\n        switchMap((response) =>\n          response\n            ? forkJoin(\n                selectedRows.map((definition: IRowDataItem) =>\n                  this.rxRuleDefinitionService.revertCustomization(definition.name)\n                )\n              ).pipe(\n                tap(() => {\n                  this.isActionInProgress = false;\n                }),\n                switchMap(() => this.definitionTabComponent.recordGrid.api.refresh())\n              )\n            : of({})\n        ),\n        finalize(() => {\n          this.isActionInProgress = false;\n        })\n      )\n      .subscribe();\n  }\n\n  onAddDefinition(): void {\n    this.router.navigate([RX_APPLICATION.innovationStudioBundleId, 'rule', 'new', this.rxBundleCacheService.bundleId]);\n  }\n\n  onRowSelectionChanged(selectedRows: IRowDataItem[]): void {\n    this.rowSelectionChanged$.next(selectedRows);\n  }\n}\n","<ax-definition-tab\n  [definitionActions]=\"definitionActions$ | async\"\n  [gridColumns]=\"gridColumns\"\n  [recordDefinition]=\"recordDefinition\"\n  [definitions$]=\"definitions$\"\n  [isActionInProgress]=\"isActionInProgress\"\n  [definitionType]=\"'rule'\"\n  (addDefinition)=\"onAddDefinition()\"\n  (rowSelectionChanged)=\"onRowSelectionChanged($event)\"\n  (renameDefinition)=\"onRenameDefinition($event)\"\n  (copyDefinition)=\"onCopyDefinition($event)\"\n  (deleteDefinition)=\"onDeleteDefinition($event)\"\n  (revertCustomization)=\"onRevertCustomization($event)\"\n></ax-definition-tab>\n"]}