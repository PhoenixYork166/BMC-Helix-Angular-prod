{"version":3,"file":"copy-definition.component.js","sourceRoot":"","sources":["../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/copy-definition/copy-definition.component.ts","../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/copy-definition/copy-definition.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, ViewChild } from '@angular/core';\nimport { ActiveModalRef, DismissReasons } from '@bmc-ux/adapt-angular';\nimport {\n  IBundleDescriptor,\n  RX_APPLICATION,\n  RX_RESOURCE_URLS,\n  RxDefinitionNameService,\n  RxGlobalCacheService,\n  RxNotificationService,\n  RxOverlayService\n} from '@helix/platform/shared/api';\nimport { castArray } from 'lodash';\nimport { finalize, map, startWith, tap } from 'rxjs/operators';\nimport { copyDefinitionTypeMap, ICopyConfig, RX_COPY_DEFINITION } from './copy-definition.types';\nimport { Router } from '@angular/router';\nimport { TranslateService } from '@ngx-translate/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { NgForm } from '@angular/forms';\n\n@Component({\n  selector: 'ax-copy-definition',\n  templateUrl: './copy-definition.component.html'\n})\nexport class CopyDefinitionComponent extends RxModalClass {\n  @ViewChild('selectBundleForm')\n  selectBundleForm: NgForm;\n\n  targetBundle: IBundleDescriptor[] = [];\n  config: ICopyConfig;\n  definitionDisplayName: string;\n  autoFocusTargetBundleField = true;\n  bundles$: Observable<IBundleDescriptor[]>;\n\n  constructor(\n    private activeModalRef: ActiveModalRef,\n    private rxOverlayService: RxOverlayService,\n    private rxGlobalCacheService: RxGlobalCacheService,\n    private rxNotificationService: RxNotificationService,\n    private router: Router,\n    private translateService: TranslateService,\n    private rxDefinitionNameService: RxDefinitionNameService,\n    private httpClient: HttpClient,\n    protected injector: Injector\n  ) {\n    super(activeModalRef, injector);\n\n    this.config = this.activeModalRef.getData();\n    this.definitionDisplayName = this.rxDefinitionNameService.getDisplayName(this.config.definitionName);\n\n    this.bundles$ = this.rxGlobalCacheService.getBundleDescriptors().pipe(\n      startWith([]),\n      map((bundleDescriptors: IBundleDescriptor[]) =>\n        bundleDescriptors\n          .filter(\n            (bundleDescriptor) =>\n              ![\n                RX_APPLICATION.settingsBundleId,\n                RX_APPLICATION.standardlib,\n                RX_APPLICATION.innovationStudioBundleId,\n                RX_APPLICATION.platformBundleId\n              ].includes(bundleDescriptor.id) && this.rxOverlayService.areNewDefinitionsAllowedSync(bundleDescriptor)\n          )\n          .sort((bundle, bundleToCompare) => bundle.friendlyName.localeCompare(bundleToCompare.friendlyName))\n      ),\n      tap((bundleDescriptors: IBundleDescriptor[]) => {\n        const sourceBundleDescriptor = bundleDescriptors.find(\n          (bundle) => bundle.id === this.rxDefinitionNameService.getBundleId(this.config.definitionName)\n        );\n\n        if (sourceBundleDescriptor) {\n          this.targetBundle = castArray(sourceBundleDescriptor);\n          this.autoFocusTargetBundleField = false;\n        }\n      })\n    );\n  }\n\n  isDirty(): boolean {\n    return this.selectBundleForm.dirty;\n  }\n\n  optionFormatter(bundleDescriptor: IBundleDescriptor): string {\n    return bundleDescriptor.friendlyName;\n  }\n\n  copyDefinition(): void {\n    const targetDefinitionName = this.rxDefinitionNameService.getDefinitionName(\n      this.targetBundle[0].id,\n      this.definitionDisplayName\n    );\n\n    this.allowDismiss = false;\n\n    this.httpClient\n      .post(RX_RESOURCE_URLS.command, {\n        resourceType: RX_COPY_DEFINITION.resourceType,\n        type: copyDefinitionTypeMap[this.config.definitionType],\n        srcName: this.config.definitionName,\n        destName: targetDefinitionName\n      })\n      .pipe(\n        finalize(() => {\n          this.allowDismiss = true;\n        })\n      )\n      .subscribe(() => {\n        this.rxNotificationService.addSuccessMessage(\n          this.translateService.instant('com.bmc.arsys.rx.innovation-studio.definition-copied.message')\n        );\n\n        this.activeModalRef.close();\n\n        this.router.navigate([\n          RX_APPLICATION.innovationStudioBundleId,\n          this.config.definitionType,\n          this.config.editFragment || 'edit',\n          targetDefinitionName\n        ]);\n      });\n  }\n\n  cancel(): void {\n    this.activeModalRef.dismiss(DismissReasons.CLOSE_BTN);\n  }\n}\n","<div class=\"modal-header\">\n  <h5 class=\"modal-title\">\n    {{ 'com.bmc.arsys.rx.innovation-studio.copy-definition.label' | translate }}\n  </h5>\n  <button\n    class=\"close dp-close\"\n    data-dismiss=\"modal\"\n    type=\"button\"\n    rx-id=\"x-button\"\n    [disabled]=\"!allowDismiss\"\n    (click)=\"cancel()\"\n  ></button>\n</div>\n\n<div class=\"modal-body\">\n  <form #selectBundleForm=\"ngForm\">\n    <adapt-rx-select\n      [autofocus]=\"autoFocusTargetBundleField\"\n      rx-id=\"application-name\"\n      required\n      name=\"targetBundle\"\n      [(ngModel)]=\"targetBundle\"\n      [options]=\"bundles$ | async\"\n      [optionFormatter]=\"optionFormatter\"\n      [disabled]=\"!allowDismiss\"\n      label=\"{{ 'com.bmc.arsys.rx.innovation-studio.copy-definition.target-application.label' | translate }}\"\n      class=\"mb-3\"\n    >\n    </adapt-rx-select>\n    <adapt-rx-textfield\n      [autofocus]=\"!autoFocusTargetBundleField\"\n      rx-id=\"definition-name\"\n      class=\"mb-6\"\n      label=\"{{ 'com.bmc.arsys.rx.innovation-studio.definition-name.label' | translate }}\"\n      name=\"definition\"\n      required\n      [(ngModel)]=\"definitionDisplayName\"\n      [disabled]=\"!allowDismiss\"\n    >\n    </adapt-rx-textfield>\n  </form>\n</div>\n\n<div class=\"modal-footer d-flex w-100\">\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"primary\"\n    [adaptInlineLoader]=\"!allowDismiss\"\n    (click)=\"copyDefinition()\"\n    [disabled]=\"selectBundleForm.pristine || selectBundleForm.invalid || !allowDismiss\"\n    rx-id=\"ok-button\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.copy.label' | translate }}\n  </button>\n\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"secondary\"\n    [disabled]=\"!allowDismiss\"\n    (click)=\"cancel()\"\n    rx-id=\"cancel-button\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n  </button>\n</div>\n"]}