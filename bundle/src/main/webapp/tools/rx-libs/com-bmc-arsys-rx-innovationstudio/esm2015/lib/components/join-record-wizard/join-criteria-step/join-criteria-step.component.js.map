{"version":3,"file":"join-criteria-step.component.js","sourceRoot":"","sources":["../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/join-record-wizard/join-criteria-step/join-criteria-step.component.ts","../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/join-record-wizard/join-criteria-step/join-criteria-step.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, OnDestroy, OnInit } from '@angular/core';\nimport { RxRecordDefinitionCacheService } from '@helix/platform/record/api';\nimport { ExpressionOperatorGroup, ExpressionOperatorRowsByGroup } from '@helix/platform/shared/api';\nimport {\n  IExpressionEditorPropertyChange,\n  IExpressionFormControlOptions,\n  RxExpressionEditorService,\n  RxWizardModalComponent\n} from '@helix/platform/shared/components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { combineLatest, Observable, ReplaySubject } from 'rxjs';\nimport { distinctUntilChanged, filter, map, pluck, switchMap, take, tap } from 'rxjs/operators';\nimport { JoinCriteriaExpressionConfigurator } from './join-criteria-expression-configurator';\n\n@Component({\n  selector: 'ax-join-criteria-step',\n  templateUrl: 'join-criteria-step.component.html'\n})\nexport class JoinCriteriaStepComponent implements OnInit, OnDestroy {\n  expressionOptions$: Observable<IExpressionFormControlOptions>;\n  isExpressionFormControlVisible = false;\n\n  private destroyed$ = new ReplaySubject<boolean>(1);\n  private expressionConfigurator: JoinCriteriaExpressionConfigurator;\n\n  private expressionFormControlLabel = this.translateService.instant(\n    'com.bmc.arsys.rx.innovation-studio.join-record-wizard.join-criteria.on-statement.label'\n  );\n\n  private expressionFormControlTooltip = this.translateService.instant(\n    'com.bmc.arsys.rx.innovation-studio.join-record-wizard.join-criteria.on-statement.tooltip'\n  );\n\n  constructor(\n    private injector: Injector,\n    private translateService: TranslateService,\n    private rxExpressionEditorService: RxExpressionEditorService,\n    public rxWizardModalComponent: RxWizardModalComponent,\n    private rxRecordDefinitionCacheService: RxRecordDefinitionCacheService\n  ) {}\n\n  ngOnInit() {\n    const primaryRecordDefinition$ = this.rxWizardModalComponent.context$.pipe(\n      pluck('primaryRecordDefinitionName'),\n      distinctUntilChanged(),\n      filter<string>(Boolean),\n      switchMap((primaryRecordDefinitionName) =>\n        this.rxRecordDefinitionCacheService.getRecordDefinition(primaryRecordDefinitionName)\n      )\n    );\n\n    const secondaryRecordDefinition$ = this.rxWizardModalComponent.context$.pipe(\n      pluck('secondaryRecordDefinitionName'),\n      distinctUntilChanged(),\n      filter<string>(Boolean),\n      switchMap((secondaryRecordDefinitionName) =>\n        this.rxRecordDefinitionCacheService.getRecordDefinition(secondaryRecordDefinitionName)\n      )\n    );\n\n    this.expressionOptions$ = combineLatest([primaryRecordDefinition$, secondaryRecordDefinition$]).pipe(\n      tap(() => {\n        this.isExpressionFormControlVisible = false;\n\n        setTimeout(() => {\n          this.isExpressionFormControlVisible = true;\n        });\n      }),\n      map(([primaryRecordDefinition, secondaryRecordDefinition]) => {\n        this.expressionConfigurator = new JoinCriteriaExpressionConfigurator(\n          primaryRecordDefinition,\n          secondaryRecordDefinition,\n          this.injector\n        );\n\n        this.expressionConfigurator.configureForProperty({\n          propertyPath: 'joinCriteria',\n          operators: ExpressionOperatorRowsByGroup.get(ExpressionOperatorGroup.All)\n        });\n\n        return {\n          dataDictionary$: this.expressionConfigurator.getDataDictionary('joinCriteria'),\n          label: this.expressionFormControlLabel,\n          tooltip: {\n            iconName: 'question_circle_o',\n            content: this.expressionFormControlTooltip\n          },\n          operators: this.expressionConfigurator.getOperators('joinCriteria')\n        };\n      })\n    );\n  }\n\n  openEditor(): void {\n    this.rxWizardModalComponent.context$\n      .pipe(\n        pluck('joinCriteria'),\n        take(1),\n        switchMap((joinCriteria) =>\n          this.rxExpressionEditorService.openEditor({\n            property: {\n              value: joinCriteria,\n              path: 'joinCriteria',\n              label: this.translateService.instant(\n                'com.bmc.arsys.rx.innovation-studio.join-record-wizard.join-criteria.on-statement.label'\n              )\n            },\n            expressionConfigurator: this.expressionConfigurator,\n            legend: [\n              {\n                label: this.translateService.instant('com.bmc.arsys.rx.client.expression-editor.legend.field.label'),\n                icon: 'd-icon-field_text'\n              }\n            ]\n          })\n        )\n      )\n      .subscribe((expression: IExpressionEditorPropertyChange) => {\n        this.rxWizardModalComponent.api.updateContext({ joinCriteria: expression.value });\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroyed$.next();\n    this.destroyed$.complete();\n  }\n}\n","<p>\n  {{ 'com.bmc.arsys.rx.innovation-studio.join-record-wizard.join-criteria.info' | translate }}\n</p>\n\n<div *ngIf=\"expressionOptions$ | async as expressionOptions\">\n  <ng-container *ngIf=\"isExpressionFormControlVisible\">\n    <rx-expression-form-control\n      [ngModel]=\"(rxWizardModalComponent.context$ | async).joinCriteria\"\n      (events)=\"openEditor()\"\n      [options]=\"expressionOptions\"\n    ></rx-expression-form-control>\n  </ng-container>\n</div>\n"]}