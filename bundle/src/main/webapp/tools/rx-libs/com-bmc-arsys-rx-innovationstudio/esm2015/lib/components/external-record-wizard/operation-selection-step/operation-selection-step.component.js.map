{"version":3,"file":"operation-selection-step.component.js","sourceRoot":"","sources":["../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/external-record-wizard/operation-selection-step/operation-selection-step.component.ts","../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/external-record-wizard/operation-selection-step/operation-selection-step.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, Input } from '@angular/core';\nimport { FormControl, Validators } from '@angular/forms';\nimport { TranslateService } from '@ngx-translate/core';\nimport { includes, isEqual } from 'lodash';\nimport { ReplaySubject } from 'rxjs';\nimport { distinctUntilChanged, map, shareReplay, takeUntil } from 'rxjs/operators';\nimport { RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { RxDefinitionNameService } from '@helix/platform/shared/api';\nimport { RxWizardModalComponent } from '@helix/platform/shared/components';\nimport { IDocumentDefinition } from '@helix/platform/document/api';\nimport { IRequestDefinition } from '@helix/platform/web-api/api';\nimport { IExternalRecordWizardContext, IWebApiRequestOperation } from '../external-record-wizard.types';\n\n@Component({\n  selector: 'ax-operation-selection-step',\n  templateUrl: 'operation-selection-step.component.html'\n})\nexport class OperationSelectionStepComponent implements OnInit {\n  @Input()\n  context: IExternalRecordWizardContext;\n\n  availableOperationTypes = ['GET'];\n  availableRequests: RxSelectOption[];\n  operationTypeFormControl: FormControl = new FormControl('GET', null);\n  operationTypeLabel: string;\n  webApiRequestLabel: string;\n  webApiRequestNameFormControl: FormControl = new FormControl([], Validators.required);\n\n  private destroyed$ = new ReplaySubject<boolean>(1);\n\n  optionFormatter = (option: RxSelectOption): string => this.rxDefinitionNameService.getDisplayName(option.displayValue);\n\n  constructor(\n    private rxDefinitionNameService: RxDefinitionNameService,\n    private rxWizardModalComponent: RxWizardModalComponent,\n    private translateService: TranslateService\n  ) {}\n\n  ngOnInit() {\n    this.operationTypeLabel = this.translateService.instant(\n      'com.bmc.arsys.rx.innovation-studio.external-record-wizard.operation-selection.operation-type.section.label'\n    );\n    this.webApiRequestLabel = this.translateService.instant(\n      'com.bmc.arsys.rx.innovation-studio.external-record-wizard.operation-selection.web-api-request.section.label'\n    );\n\n    const operationSelectionStepContext$ = this.rxWizardModalComponent.context$.pipe(\n      shareReplay(1),\n      takeUntil(this.destroyed$)\n    );\n\n    operationSelectionStepContext$\n      .pipe(\n        map((stepContext: IExternalRecordWizardContext) => stepContext.document),\n        distinctUntilChanged(isEqual)\n      )\n      .subscribe((document: IDocumentDefinition) => {\n        this.webApiRequestNameFormControl.setValue([]);\n\n        this.availableRequests = document\n          ? this.context.webApi.requestDefinitions.reduce((result, request: IRequestDefinition) => {\n            if (includes(this.availableOperationTypes, request.method) && request.output === document.name) {\n              result.push({\n                webRequestGuid: request.guid,\n                displayValue: request.name,\n                method: request.method\n              });\n            }\n\n            return result;\n          }, [])\n          : [];\n      });\n\n    operationSelectionStepContext$\n      .pipe(\n        map((stepContext: IExternalRecordWizardContext) => stepContext.operations),\n        distinctUntilChanged(isEqual)\n      )\n      .subscribe((operations: IWebApiRequestOperation[]) => {\n        if (operations) {\n          this.rxWizardModalComponent.api.enableFinishButton();\n        } else {\n          this.rxWizardModalComponent.api.disableFinishButton();\n        }\n      });\n\n    this.webApiRequestNameFormControl.valueChanges\n      .pipe(takeUntil(this.destroyed$))\n      .subscribe((selectedWebApiRequest: RxSelectOption[]) => {\n        this.rxWizardModalComponent.api.updateContext({\n          operations: selectedWebApiRequest.length\n            ? selectedWebApiRequest.map((request: RxSelectOption) => ({\n              webRequestGuid: request.webRequestGuid,\n              operation: request.method\n            }))\n            : null\n        });\n      });\n  }\n}\n","<div class=\"row\">\n  <div class=\"col-2\">\n    <adapt-rx-control-label [label]=\"operationTypeLabel\"></adapt-rx-control-label>\n  </div>\n  <div class=\"col-10\">\n    <adapt-rx-control-label [label]=\"webApiRequestLabel\" [showRequiredLabel]=\"true\"></adapt-rx-control-label>\n  </div>\n</div>\n<div class=\"row\">\n  <div class=\"col-2\">\n    <adapt-rx-radiobutton-group [formControl]=\"operationTypeFormControl\">\n      <adapt-rx-radiobutton *ngFor=\"let item of availableOperationTypes\" [value]=\"item\" [label]=\"item\">\n      </adapt-rx-radiobutton>\n    </adapt-rx-radiobutton-group>\n  </div>\n  <div class=\"col-10\">\n    <adapt-rx-select\n      [options]=\"availableRequests\"\n      [required]=\"true\"\n      [formControl]=\"webApiRequestNameFormControl\"\n      [optionFormatter]=\"optionFormatter\"\n    ></adapt-rx-select>\n  </div>\n</div>\n"]}