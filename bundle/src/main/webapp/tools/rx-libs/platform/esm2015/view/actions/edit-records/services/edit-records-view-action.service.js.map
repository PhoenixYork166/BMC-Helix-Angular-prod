{"version":3,"file":"edit-records-view-action.service.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/view/actions/edit-records/services/edit-records-view-action.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { RxDefinitionNameService, RxLogService } from '@helix/platform/shared/api';\nimport { RxError } from '@helix/platform/utils';\nimport { IRxRecordGridApi, IViewActionService, RxViewActionUtilsService } from '@helix/platform/view/api';\nimport { RxRecordGridUtilsService } from '@helix/platform/view/components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { isEmpty, isFunction, isNil } from 'lodash';\nimport { EMPTY, from, Observable, throwError } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport { RX_OPEN_VIEW } from '../../open-view/open-view-action.constant';\nimport { RxOpenViewActionService } from '../../open-view/open-view-action.service';\nimport { IEditRecordsViewActionParams } from '../interfaces/edit-records-view-action-params.interface';\nimport { RxEditRecordsDataService } from './edit-records-data.service';\nimport { RxEditRecordsViewBuilder } from './edit-records-view-builder.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RxEditRecordsViewActionService implements IViewActionService<IEditRecordsViewActionParams, never> {\n  constructor(\n    private rxEditRecordsViewBuilder: RxEditRecordsViewBuilder,\n    private rxEditRecordsDataService: RxEditRecordsDataService,\n    private rxLogService: RxLogService,\n    private rxRecordGridUtilsService: RxRecordGridUtilsService,\n    private translateService: TranslateService,\n    private rxDefinitionNameService: RxDefinitionNameService,\n    private openViewAction: RxOpenViewActionService,\n    private rxViewActionUtilsService: RxViewActionUtilsService\n  ) {}\n\n  execute(params: IEditRecordsViewActionParams): Observable<never> {\n    let { recordDefinitionName } = params;\n\n    if (isNil(params.records)) {\n      return throwError(new RxError('rxEditRecordsAction: no records to edit.'));\n    }\n\n    if (isEmpty(recordDefinitionName) && isFunction((<IRxRecordGridApi>params.records).getRecordDefinitionName)) {\n      recordDefinitionName = (<IRxRecordGridApi>params.records).getRecordDefinitionName();\n    }\n\n    if (recordDefinitionName) {\n      const recordIds = this.rxViewActionUtilsService.extractRecordIds(params.records);\n\n      if (recordIds.length) {\n        return from(this.rxRecordGridUtilsService.getColumnDescriptors(recordDefinitionName, params.records)).pipe(\n          switchMap((columnDescriptors) => {\n            const localizedViewTitle = this.translateService.instant(\n              'com.bmc.arsys.rx.client.view-actions.edit-records.view.title',\n              { recordDefinitionName: this.rxDefinitionNameService.getDisplayName(recordDefinitionName) }\n            );\n\n            const localizedViewNotification = this.translateService.instant(\n              'com.bmc.arsys.rx.client.view-actions.edit-records.view.notification'\n            );\n\n            return this.openViewAction\n              .execute({\n                presentation: {\n                  modalSize: RX_OPEN_VIEW.modalSize.Large,\n                  title: localizedViewTitle,\n                  notification: localizedViewNotification,\n                  type: RX_OPEN_VIEW.type.DockedRightModal\n                },\n                viewDefinitionName: this.rxEditRecordsViewBuilder.getViewDefinition(\n                  recordDefinitionName,\n                  columnDescriptors\n                ),\n                viewParams: null\n              })\n              .pipe(\n                switchMap((viewOutput) =>\n                  viewOutput && viewOutput.recordInstance\n                    ? this.rxEditRecordsDataService\n                        .runAction(recordIds, viewOutput.recordInstance)\n                        .pipe(\n                          switchMap(() =>\n                            isFunction((<IRxRecordGridApi>params.records).refresh)\n                              ? (<IRxRecordGridApi>params.records).refresh()\n                              : EMPTY\n                          )\n                        )\n                    : EMPTY\n                )\n              );\n          })\n        );\n      } else {\n        this.rxLogService.debug('rxEditRecordsAction: no records to edit.');\n      }\n    } else {\n      this.rxLogService.error('rxEditRecordsAction: Record Definition Name is not defined.');\n    }\n\n    return EMPTY;\n  }\n}\n"]}