{"version":3,"file":"search-filters-editor.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/search-filters/search-filters-editor/search-filters-editor.component.ts","../../../../../../../../libs/platform/admin/components/search-filters/search-filters-editor/search-filters-editor.component.html"],"names":[],"mappings":"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","sourcesContent":["import { ChangeDetectionStrategy, Component, Injector, OnInit } from '@angular/core';\nimport { DismissReasons, DockedPanelContext } from '@bmc-ux/adapt-angular';\nimport { RxSearchFiltersService } from '../search-filters.service';\nimport { RxModalClass, RxModalService, RX_MODAL } from '@helix/platform/ui-kit';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport { AdaptValidators } from '@bmc-ux/adapt-angular';\nimport { Observable } from 'rxjs';\nimport { debounceTime, distinctUntilChanged, map, shareReplay, tap, withLatestFrom } from 'rxjs/operators';\nimport { RxNotificationService } from '@helix/platform/shared/api';\nimport { TranslateService } from '@ngx-translate/core';\nimport { ISearchFilter } from '../search-filter.interface';\n\n@Component({\n  selector: 'rx-search-filters-editor',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './search-filters-editor.component.html'\n})\nexport class SearchFiltersEditorComponent extends RxModalClass implements OnInit {\n  constructor(\n    private rxSearchFiltersService: RxSearchFiltersService,\n    public dockedPanelContext: DockedPanelContext,\n    protected injector: Injector,\n    private rxNotificationService: RxNotificationService,\n    private translateService: TranslateService,\n    private rxModalService: RxModalService\n  ) {\n    super(dockedPanelContext, injector);\n  }\n\n  public readonly tagsOperators: string[] = ['OR', 'AND'];\n  private isEditMode = Boolean(this.dockedPanelContext.getData());\n  private tags$ = this.rxSearchFiltersService.getTags().pipe(shareReplay(1));\n\n  ngOnInit() {\n    if (this.isEditMode) {\n      this.searchFilterEditorFormGroup.setValue({\n        name: this.dockedPanelContext.getData().name,\n        tagsOperator: [this.dockedPanelContext.getData().tagsOperator],\n        tags: this.dockedPanelContext.getData().tags\n      });\n    }\n  }\n\n  searchFilterEditorFormGroup = new FormGroup({\n    name: new FormControl('', AdaptValidators.required()),\n    tagsOperator: new FormControl([], AdaptValidators.required()),\n    tags: new FormControl([], AdaptValidators.required())\n  });\n\n  tagSuggestions = (text$: Observable<string>) =>\n    text$.pipe(\n      debounceTime(200),\n      distinctUntilChanged(),\n      withLatestFrom(this.tags$),\n      map(([term, tags]) => tags.filter((tag) => tag.startsWith(term)))\n    );\n\n  save(): void {\n    const { id } = this.dockedPanelContext.getData() || {};\n    const [tagsOperator] = this.searchFilterEditorFormGroup.value.tagsOperator;\n\n    const filter: ISearchFilter = {\n      id,\n      ...this.searchFilterEditorFormGroup.getRawValue(),\n      tagsOperator\n    };\n\n    const operation = this.isEditMode\n      ? this.rxSearchFiltersService.updateSearchFilter(filter)\n      : this.rxSearchFiltersService.createSearchFilter(filter);\n\n    operation.subscribe(() => {\n      this.close();\n      this.rxNotificationService.addSuccessMessage(\n        this.translateService.instant('com.bmc.arsys.rx.client.common.saved-successfully.message')\n      );\n    });\n  }\n\n  close(): void {\n    this.dockedPanelContext.close(DismissReasons.CLOSE_BTN);\n  }\n\n  cancel(): void {\n    if (this.searchFilterEditorFormGroup.dirty) {\n      this.rxModalService\n        .confirm({\n          title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n          modalStyle: RX_MODAL.modalStyles.warning,\n          message: this.translateService.instant('com.bmc.arsys.rx.client.common.unsaved-data.message')\n        })\n        .then((result: boolean) => {\n          if (result) {\n            this.close();\n          }\n        });\n    } else {\n      this.close();\n    }\n  }\n}\n","<div class=\"dp-body\">\n  <form [formGroup]=\"searchFilterEditorFormGroup\">\n    <div class=\"form-group\">\n      <adapt-rx-textfield\n        [formControlName]=\"'name'\"\n        [label]=\"'com.bmc.arsys.rx.client.admin.search-filters-editor.form-control.name.label' | translate\"\n      ></adapt-rx-textfield>\n    </div>\n\n    <div class=\"form-group\">\n      <adapt-rx-select\n        [formControlName]=\"'tagsOperator'\"\n        [options]=\"tagsOperators\"\n        [label]=\"'com.bmc.arsys.rx.client.admin.search-filters-editor.form-control.relationship.label' | translate\"\n        required\n      ></adapt-rx-select>\n    </div>\n\n    <div class=\"form-group\">\n      <adapt-tag-field\n        [formControlName]=\"'tags'\"\n        required\n        [suppressManual]=\"true\"\n        [label]=\"'com.bmc.arsys.rx.client.admin.search-filters-editor.form-control.tags.label' | translate\"\n        placeholder=\"\"\n        [search]=\"tagSuggestions\"\n        [openDropdownOnFocus]=\"true\"\n      ></adapt-tag-field>\n    </div>\n  </form>\n</div>\n\n<div class=\"dp-footer\">\n  <button\n    class=\"btn btn-primary mr-2\"\n    (click)=\"save()\"\n    [disabled]=\"this.searchFilterEditorFormGroup.invalid || !this.searchFilterEditorFormGroup.dirty\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n\n  <button class=\"btn btn-secondary\" (click)=\"cancel()\">\n    {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n  </button>\n</div>\n"]}