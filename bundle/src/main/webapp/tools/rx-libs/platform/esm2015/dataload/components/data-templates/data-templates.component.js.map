{"version":3,"file":"data-templates.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/dataload/components/data-templates/data-templates.component.ts","../../../../../../../libs/platform/dataload/components/data-templates/data-templates.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, HostBinding, OnInit, ViewChild } from '@angular/core';\nimport { forkJoin, Observable, of } from 'rxjs';\nimport {\n  IRecordGridColumn,\n  IRecordGridConfig,\n  RecordGridComponent,\n  RowSelectionMode\n} from '@helix/platform/view/components';\nimport { DL_DATA_TEMPLATES } from './data-templates.constant';\nimport { IRowDataItem } from '@helix/platform/view/api';\nimport { IRecordDefinition, RX_RECORD_DEFINITION, RxRecordInstanceService } from '@helix/platform/record/api';\nimport { map, noop } from 'lodash';\nimport { RX_MODAL, RxModalService } from '@helix/platform/ui-kit';\nimport { TranslateService } from '@ngx-translate/core';\nimport { DataTemplateEditorComponent } from './data-template-editor/data-template-editor.component';\nimport { RxNotificationService } from '@helix/platform/shared/api';\n\n@Component({\n  selector: 'dl-data-templates',\n  templateUrl: './data-templates.component.html',\n  styleUrls: ['./data-templates.component.scss']\n})\nexport class DataTemplatesComponent implements OnInit {\n  @HostBinding('class')\n  hostClass = 'd-flex mh-100 flex-column';\n\n  gridConfig$: Observable<IRecordGridConfig>;\n  showDeprecated = false;\n\n  @ViewChild('grid')\n  grid: RecordGridComponent;\n\n  constructor(\n    private rxNotificationService: RxNotificationService,\n    private rxModalService: RxModalService,\n    private translateService: TranslateService,\n    private rxRecordInstanceService: RxRecordInstanceService\n  ) {}\n\n  ngOnInit(): void {\n    this.gridConfig$ = of({\n      guid: 'dl-templates-grid',\n      actionButtons: [\n        {\n          label: this.translateService.instant('com.bmc.arsys.rx.client.common.delete.label'),\n          style: 'tertiary',\n          icon: 'trash',\n          actions: [\n            {\n              name: () => {\n                this.deleteSelectedDataTemplate();\n              }\n            }\n          ]\n        }\n      ],\n      recordDefinitionName: DL_DATA_TEMPLATES.recordDefinitionName,\n      enableRowSelection: RowSelectionMode.Multiple,\n      columns: this.getColumns(),\n      getRecordDefinition: () => of(this.getRecordDefinition()),\n      styles: 'flex-fill'\n    });\n  }\n\n  private deleteSelectedDataTemplate(): void {\n    this.rxModalService\n      .confirm({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n        modalStyle: RX_MODAL.modalStyles.default,\n        message: this.translateService.instant(\n          'com.bmc.arsys.rx.client.dataload.templates.template-delete-warning.message'\n        )\n      })\n      .then((result: boolean) => {\n        if (result) {\n          const deleteDataRequests$: Observable<any>[] = map(this.grid.api.getSelectedRows(), (row: IRowDataItem) =>\n            this.rxRecordInstanceService.delete(\n              DL_DATA_TEMPLATES.recordDefinitionName,\n              row[RX_RECORD_DEFINITION.coreFieldIds.id]\n            )\n          );\n\n          forkJoin(deleteDataRequests$).subscribe(() => {\n            this.rxNotificationService.addSuccessMessage(\n              this.translateService.instant(\n                'com.bmc.arsys.rx.client.dataload.templates.template-delete-success.message'\n              )\n            );\n\n            this.grid.api.refresh().subscribe();\n          });\n        }\n      });\n  }\n\n  private getColumns(): IRecordGridColumn[] {\n    return [\n      {\n        fieldId: String(DL_DATA_TEMPLATES.fields.templateName),\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.name.label'),\n        clickable: true,\n        actions: [\n          {\n            name: (previousAction: any, selectedRow: IRowDataItem) => {\n              this.editDataTemplate(selectedRow);\n            }\n          }\n        ]\n      },\n      {\n        fieldId: String(DL_DATA_TEMPLATES.fields.bundleFriendlyName),\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.application.label')\n      },\n      {\n        fieldId: String(DL_DATA_TEMPLATES.fields.dataloadTemplateDescription),\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.description.label')\n      },\n      {\n        fieldId: String(DL_DATA_TEMPLATES.fields.dataLoadTemplateVersion),\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.version.label')\n      },\n      {\n        fieldId: String(DL_DATA_TEMPLATES.fields.template),\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.download.label'),\n        sortable: false,\n        filterable: false,\n        clickable: true,\n        actions: [\n          {\n            name: (previousAction: any, row: IRowDataItem) => {\n              this.rxRecordInstanceService.downloadAttachment(\n                DL_DATA_TEMPLATES.recordDefinitionName,\n                DL_DATA_TEMPLATES.fields.template,\n                row[RX_RECORD_DEFINITION.coreFieldIds.id],\n                row[DL_DATA_TEMPLATES.fields.template]\n              );\n            }\n          }\n        ]\n      },\n      {\n        fieldId: String(DL_DATA_TEMPLATES.fields.isActive),\n        title: this.translateService.instant('com.bmc.arsys.rx.client.dataload.templates.is-active-template.label'),\n        visible: false\n      },\n      {\n        fieldId: String(RX_RECORD_DEFINITION.coreFieldIds.id),\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.id.label'),\n        visible: false\n      }\n    ];\n  }\n\n  private editDataTemplate(selectedRow: IRowDataItem) {\n    this.openDockedPanel(true, selectedRow[RX_RECORD_DEFINITION.coreFieldIds.id]);\n  }\n\n  createDataTemplate() {\n    this.openDockedPanel(false);\n  }\n\n  private openDockedPanel(isEditMode: boolean, templateRecordInstanceId?: string): Promise<any> {\n    return this.rxModalService\n      .openDockedPanel({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.template.label'),\n        content: DataTemplateEditorComponent,\n        data: {\n          isEditMode,\n          templateRecordInstanceId\n        }\n      })\n      .then(() => {\n        this.grid.api.refresh().subscribe();\n      })\n      .catch(noop);\n  }\n\n  private getRecordDefinition(): IRecordDefinition {\n    return {\n      fieldDefinitions: [\n        {\n          id: DL_DATA_TEMPLATES.fields.templateName,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: DL_DATA_TEMPLATES.fields.bundleFriendlyName,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: DL_DATA_TEMPLATES.fields.isActive,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.selection,\n          optionNamesById: {\n            1: this.translateService.instant('com.bmc.arsys.rx.client.common.yes.label'),\n            0: this.translateService.instant('com.bmc.arsys.rx.client.common.no.label')\n          }\n        },\n        {\n          id: DL_DATA_TEMPLATES.fields.dataloadTemplateDescription,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: DL_DATA_TEMPLATES.fields.dataLoadTemplateVersion,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: DL_DATA_TEMPLATES.fields.template,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: RX_RECORD_DEFINITION.coreFieldIds.id,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        }\n      ]\n    };\n  }\n}\n","<button\n  adapt-button\n  type=\"button\"\n  btn-type=\"tertiary\"\n  class=\"d-icon-plus_circle px-0 align-self-start\"\n  rx-id=\"new-template-button\"\n  (click)=\"createDataTemplate()\"\n>\n  {{ 'com.bmc.arsys.rx.client.dataload.templates.new-template.label' | translate }}\n</button>\n\n<rx-record-grid #grid [config]=\"gridConfig$\"></rx-record-grid>\n"]}