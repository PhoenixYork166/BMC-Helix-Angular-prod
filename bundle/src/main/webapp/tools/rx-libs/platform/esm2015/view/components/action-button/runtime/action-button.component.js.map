{"version":3,"file":"action-button.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/view/components/action-button/runtime/action-button.component.ts","../../../../../../../../libs/platform/view/components/action-button/runtime/action-button.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, HostBinding, Input, OnInit } from '@angular/core';\nimport { RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { RxLogService, RxNotificationService } from '@helix/platform/shared/api';\nimport { RxViewComponentType } from '@helix/platform/view/api';\n\nimport { BaseViewComponent, IViewComponentSetProperty, RuntimeViewModelApi } from '@helix/platform/view/runtime';\nimport { TranslateService } from '@ngx-translate/core';\nimport { find, includes } from 'lodash';\nimport { Observable, throwError } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { RxActionButtonService } from '../action-button.service';\nimport { ActionButtonIconAlignment } from '../action-button.types';\n\nimport { IActionButtonConfig, IActionButtonState } from './action-button.types';\n\n@Component({\n  selector: 'rx-action-button',\n  templateUrl: './action-button.component.html',\n  styleUrls: ['./action-button.component.scss']\n})\nexport class ActionButtonComponent extends BaseViewComponent implements OnInit, IViewComponentSetProperty {\n  api = {\n    click: this.click.bind(this),\n    setProperty: this.setProperty.bind(this)\n  };\n\n  state: IActionButtonState = {};\n\n  isActionInProgress = false;\n  isDisabled = false;\n  buttonType = '';\n\n  @Input()\n  guid: string;\n\n  @Input()\n  config: Observable<IActionButtonConfig>;\n\n  @Input()\n  runtimeViewModelApi: RuntimeViewModelApi;\n\n  @HostBinding('class')\n  get hostClass(): string {\n    const state = this.state;\n    const className = `${RxViewComponentType.ActionButton}_${state.style}`;\n\n    return state.styles ? `${className} ${state.styles}` : className;\n  }\n\n  constructor(\n    private rxLogService: RxLogService,\n    private translateService: TranslateService,\n    private rxNotificationService: RxNotificationService,\n    private rxActionButtonService: RxActionButtonService\n  ) {\n    super();\n  }\n\n  ngOnInit(): void {\n    this.notifyPropertyChanged('api', this.api);\n\n    this.config.pipe(takeUntil(this.destroyed$)).subscribe((config) => {\n      Object.assign(this.state, config);\n\n      if (config.labelKey) {\n        this.state.buttonLabel = this.translateService.instant(config.labelKey);\n      } else {\n        this.state.buttonLabel = config.label;\n      }\n\n      this.state.icon = '';\n      this.state.cls = config.cls || '';\n\n      if (config.iconCls || config.icon) {\n        const icon = config.iconCls || config.icon;\n        const iconAlignment = ((config.label || config.labelKey) && config.iconAlignment) || 'left';\n\n        this.state.icon = this.rxActionButtonService.getIconCssClass(icon, iconAlignment as ActionButtonIconAlignment);\n      }\n\n      if (config.iconCls && config.icon) {\n        this.rxLogService.warning('iconCls option is specified, icon will be ignored.');\n      }\n\n      if (!config.cls) {\n        this.buttonType = this.rxActionButtonService.getButtonType(this.state.style);\n      }\n\n      if (config.cls && config.style) {\n        this.rxLogService.warning('cls option is specified, style will be ignored.');\n      }\n\n      this.validateRecordDefinitionName();\n      this.isHidden = this.isHiddenFunc();\n      this.isDisabled = this.isDisabledFunc();\n    });\n  }\n\n  // api\n  click(): Promise<void> {\n    if (!this.isDisabled) {\n      this.isActionInProgress = true;\n      this.isDisabled = true;\n\n      return this\n        .triggerViewActions()\n        .then((res) => {\n          this.isActionInProgress = false;\n          this.isDisabled = this.isDisabledFunc();\n        })\n        .catch((err) => {\n          this.isActionInProgress = false;\n          this.isDisabled = this.isDisabledFunc();\n        });\n    }\n  }\n\n  isDisabledFunc(): boolean {\n    return (\n      Boolean(this.state.disabled) ||\n      this.isActionInProgress ||\n      (this.state.recordInstance &&\n        this.state.fieldId &&\n        this.state.recordInstance.recordDefinitionName === this.state.recordDefinitionName &&\n        find(this.state.recordInstance.fieldInstances, { id: Number(this.state.fieldId) }) &&\n        find(this.state.recordInstance.fieldInstances, { id: Number(this.state.fieldId) }).permissionType ===\n          RX_RECORD_DEFINITION.fieldPermissionTypes.view)\n    );\n  }\n\n  isHiddenFunc(): boolean {\n    return (this.isHidden =\n      Boolean(this.state.hidden) ||\n      (this.state.recordInstance &&\n        (this.state.recordInstance.recordDefinitionName !== this.state.recordDefinitionName ||\n          (this.state.fieldId &&\n            !find(this.state.recordInstance.fieldInstances, { id: Number(this.state.fieldId) })))));\n  }\n\n  setProperty(propertyPath: string, value: any): void | Observable<never> {\n    if (includes(['hidden', 'disabled'], propertyPath)) {\n      this.state[propertyPath] = value;\n\n      this.notifyPropertyChanged(propertyPath, this.state[propertyPath]);\n    } else {\n      return throwError(`Action Button: property ${propertyPath} is not settable.`);\n    }\n  }\n\n  private validateRecordDefinitionName(): void {\n    if (\n      this.state.recordInstance &&\n      this.state.recordInstance.recordDefinitionName !== this.state.recordDefinitionName\n    ) {\n      const buttonName = this.translateService.instant(\n        'com.bmc.arsys.rx.client.view-components.action-button.component-name.label',\n        {\n          label: this.state.label\n        }\n      );\n\n      const errorMessage = this.translateService.instant(\n        'com.bmc.arsys.rx.client.view-components.action-button.configuration-error.message',\n        {\n          componentName: buttonName\n        }\n      );\n\n      this.rxNotificationService.addErrorMessage(errorMessage);\n    }\n  }\n}\n","<button\n  adapt-button\n  type=\"button\"\n  class=\"mw-100 rx-ellipsis\"\n  *ngIf=\"!isHidden\"\n  [btn-type]=\"buttonType\"\n  [ngClass]=\"[state.icon, state.cls]\"\n  [disabled]=\"isDisabled\"\n  [size]=\"state.size\"\n  (click)=\"api.click($event)\"\n>\n  <span>{{ state.buttonLabel }}</span>\n</button>\n"]}