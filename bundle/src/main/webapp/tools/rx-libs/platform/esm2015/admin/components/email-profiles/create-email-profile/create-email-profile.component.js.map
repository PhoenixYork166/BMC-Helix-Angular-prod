{"version":3,"file":"create-email-profile.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/email-profiles/create-email-profile/create-email-profile.component.ts","../../../../../../../../libs/platform/admin/components/email-profiles/create-email-profile/create-email-profile.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, OnDestroy, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { DismissReasons, DockedPanelContext, RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { RX_RECORD_DEFINITION, RxRecordInstanceDataPageService } from '@helix/platform/record/api';\nimport { IBundleDescriptor, RX_APPLICATION, RxGlobalCacheService } from '@helix/platform/shared/api';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { filter, includes, reject } from 'lodash';\nimport { forkJoin, Subscription } from 'rxjs';\nimport { RX_EMAIL_PROFILES } from '../email-profiles.constant';\nimport { IEmailProfile } from '../email-profiles.interfaces';\n\n@Component({\n  selector: 'rx-create-email-profile',\n  templateUrl: './create-email-profile.component.html'\n})\nexport class CreateEmailProfileComponent extends RxModalClass implements OnInit, OnDestroy {\n  emailProfile: IEmailProfile;\n  createEmailProfileFormGroup: FormGroup;\n  mailboxFunctions = RX_EMAIL_PROFILES.mailbox.mailboxFunctions;\n  bundleOptions: RxSelectOption[] = [];\n  mailboxOptions: RxSelectOption[] = [];\n  availableMailboxOptions: RxSelectOption[] = [];\n  validDefinitionNameRegex = RX_RECORD_DEFINITION.validDefinitionNameRegex;\n\n  private subscription = new Subscription();\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private rxGlobalCacheService: RxGlobalCacheService,\n    private rxRecordInstanceDataPageService: RxRecordInstanceDataPageService,\n    private dockedPanelContext: DockedPanelContext,\n    protected injector: Injector\n  ) {\n    super(dockedPanelContext, injector);\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n    this.emailProfile = this.dockedPanelContext.getData().profile;\n\n    this.createEmailProfileFormGroup = this.formBuilder.group({\n      profileName: '',\n      mailboxFunction: this.mailboxFunctions.incoming.value,\n      mailbox: [],\n      application: []\n    });\n\n    forkJoin({\n      bundleDescriptors: this.rxGlobalCacheService.getBundleDescriptors(),\n      mailboxes: this.rxRecordInstanceDataPageService.post({\n        params: {\n          recorddefinition: RX_EMAIL_PROFILES.mailbox.recordDefinitionName,\n          queryExpression: RX_EMAIL_PROFILES.mailbox.queryExpression\n        }\n      })\n    }).subscribe((result) => {\n      this.bundleOptions = reject(result.bundleDescriptors, (bundleDescriptor: IBundleDescriptor) => {\n        return includes(\n          [RX_APPLICATION.innovationStudioBundleId, RX_APPLICATION.platformBundleId],\n          bundleDescriptor.id\n        );\n      }).sort((a: IBundleDescriptor, b: IBundleDescriptor) => a.friendlyName.localeCompare(b.friendlyName));\n\n      this.availableMailboxOptions = result.mailboxes.data;\n\n      if (this.emailProfile) {\n        this.createEmailProfileFormGroup.controls.mailboxFunction.disable();\n        this.loadEmailProfileData();\n      } else {\n        this.filterMailboxes(this.mailboxFunctions.incoming.value);\n      }\n\n      this.subscription = this.createEmailProfileFormGroup\n        .get('mailboxFunction')\n        .valueChanges.subscribe((mailboxFunctionName) => {\n          this.createEmailProfileFormGroup.controls.mailbox.setValue([]);\n          this.filterMailboxes(mailboxFunctionName);\n        });\n    });\n  }\n\n  isDirty(): boolean {\n    return this.createEmailProfileFormGroup.dirty;\n  }\n\n  ngOnDestroy(): void {\n    this.subscription.unsubscribe();\n  }\n\n  private filterMailboxes(mailBoxFunctionName: string): void {\n    this.mailboxOptions = filter(this.availableMailboxOptions, (mailbox: RxSelectOption) => {\n      return mailbox[RX_EMAIL_PROFILES.mailbox.fieldIds.mailboxFunction] === parseInt(mailBoxFunctionName, 10);\n    });\n  }\n\n  private loadEmailProfileData(): void {\n    let selectedMailboxType = '';\n\n    if (this.emailProfile.mailboxType === RX_EMAIL_PROFILES.mailbox.mailboxFunctions.incoming.id) {\n      selectedMailboxType = this.mailboxFunctions.incoming.value;\n    } else if (this.emailProfile.mailboxType === RX_EMAIL_PROFILES.mailbox.mailboxFunctions.outgoing.id) {\n      selectedMailboxType = this.mailboxFunctions.outgoing.value;\n    }\n\n    this.filterMailboxes(selectedMailboxType);\n\n    const selectedApplication: RxSelectOption = this.bundleOptions.find(\n      (bundle) => bundle.id === this.emailProfile.application\n    );\n\n    const selectedMailbox: RxSelectOption = this.availableMailboxOptions.find(\n      (mailbox) => mailbox[RX_RECORD_DEFINITION.coreFieldIds.id] === this.emailProfile.mailbox\n    );\n\n    this.createEmailProfileFormGroup.patchValue({\n      profileName: this.emailProfile.profileName,\n      mailboxFunction: selectedMailboxType,\n      mailbox: selectedMailbox ? [selectedMailbox] : [],\n      application: selectedApplication ? [selectedApplication] : []\n    });\n  }\n\n  bundleNameFormatter(bundleOption: RxSelectOption): string {\n    return bundleOption.friendlyName;\n  }\n\n  mailboxNameFormatter(mailboxOption: RxSelectOption): string {\n    return mailboxOption[RX_EMAIL_PROFILES.mailbox.fieldIds.mailboxName.id];\n  }\n\n  save(): void {\n    this.dockedPanelContext.close(this.createEmailProfileFormGroup.getRawValue());\n  }\n\n  cancel(): void {\n    this.dockedPanelContext.dismiss(DismissReasons.CLOSE_BTN);\n  }\n}\n","<div class=\"dp-body\">\n  <form [formGroup]=\"createEmailProfileFormGroup\">\n    <adapt-rx-textfield\n      class=\"d-block form-group\"\n      rx-id=\"profile-name\"\n      formControlName=\"profileName\"\n      label=\"{{ 'com.bmc.arsys.rx.client.admin.create-email-profile.profile-name.label' | translate }}\"\n      required\n      maxlength=\"254\"\n      [pattern]=\"validDefinitionNameRegex\"\n    ></adapt-rx-textfield>\n\n    <adapt-rx-radiobutton-group\n      class=\"d-block form-group\"\n      rx-id=\"mailbox-function\"\n      label=\"{{ 'com.bmc.arsys.rx.client.admin.create-email-profile.mailbox-function.label' | translate }}\"\n      required\n      [formControl]=\"createEmailProfileFormGroup.controls.mailboxFunction\"\n    >\n      <adapt-rx-radiobutton\n        class=\"mb-0 mt-0 radio-inline\"\n        *ngFor=\"let mailboxFunction of mailboxFunctions | keyvalue\"\n        [value]=\"mailboxFunction.value.value\"\n        [label]=\"mailboxFunction.value.label | translate\"\n      ></adapt-rx-radiobutton>\n    </adapt-rx-radiobutton-group>\n\n    <adapt-rx-select\n      class=\"d-block form-group\"\n      formControlName=\"mailbox\"\n      label=\"{{ 'com.bmc.arsys.rx.client.admin.create-email-profile.mailbox.label' | translate }}\"\n      rx-id=\"mailbox\"\n      required\n      [options]=\"mailboxOptions\"\n      [optionFormatter]=\"mailboxNameFormatter\"\n    ></adapt-rx-select>\n\n    <adapt-rx-select\n      class=\"d-block form-group\"\n      emptyOption=\"true\"\n      formControlName=\"application\"\n      label=\"{{ 'com.bmc.arsys.rx.client.admin.create-email-profile.application.label' | translate }}\"\n      rx-id=\"application\"\n      [options]=\"bundleOptions\"\n      [optionFormatter]=\"bundleNameFormatter\"\n    ></adapt-rx-select>\n  </form>\n</div>\n\n<div class=\"dp-footer\">\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"primary\"\n    class=\"mr-2\"\n    rx-id=\"save-button\"\n    [disabled]=\"createEmailProfileFormGroup.invalid || createEmailProfileFormGroup.pristine\"\n    (click)=\"save()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n  <button adapt-button type=\"button\" btn-type=\"secondary\" rx-id=\"close-button\" class=\"mr-2\" (click)=\"cancel()\">\n    {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n  </button>\n</div>\n"]}