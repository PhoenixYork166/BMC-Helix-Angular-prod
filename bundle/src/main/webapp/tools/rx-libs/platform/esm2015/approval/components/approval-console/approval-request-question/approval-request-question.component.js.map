{"version":3,"file":"approval-request-question.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/approval/components/approval-console/approval-request-question/approval-request-question.component.ts","../../../../../../../../libs/platform/approval/components/approval-console/approval-request-question/approval-request-question.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector } from '@angular/core';\nimport { IRxSelectWithPaginationOption, IRxSelectWithPaginationOptionsPage } from '@helix/platform/shared/components';\nimport { Observable } from 'rxjs';\nimport { RxApprovalConsoleService } from '../approval-console.service';\nimport { ActiveModalRef, DismissReasons, FileObj } from '@bmc-ux/adapt-angular';\nimport { IApprovalRequest } from '../approval-console.types';\nimport { TranslateService } from '@ngx-translate/core';\nimport { RxNotificationService } from '@helix/platform/shared/api';\nimport { finalize } from 'rxjs/operators';\nimport { RxModalClass } from '@helix/platform/ui-kit';\n\n@Component({\n  selector: 'rx-approval-request-question',\n  templateUrl: './approval-request-question.component.html'\n})\nexport class ApprovalRequestQuestionComponent extends RxModalClass {\n  selectedUser: IRxSelectWithPaginationOption[] = [];\n  userLoaderFunc = this.getApprovalUsers.bind(this);\n  question: string;\n  attachment: FileObj[] = [];\n\n  constructor(\n    private rxApprovalConsoleService: RxApprovalConsoleService,\n    private rxNotificationService: RxNotificationService,\n    private translateService: TranslateService,\n    private activeModalRef: ActiveModalRef,\n    protected injector: Injector\n  ) {\n    super(activeModalRef, injector);\n  }\n\n  isDirty(): boolean {\n    return !!(this.question || this.attachment[0]?.data || this.selectedUser[0]?.value);\n  }\n\n  saveQuestion() {\n    this.allowDismiss = false;\n\n    const formData = new FormData();\n    const request: IApprovalRequest = this.activeModalRef.getData().selectedRequest;\n\n    formData.append('to', this.selectedUser[0].value);\n    formData.append('question', this.question);\n    formData.append('application', request.application);\n    formData.append('applicationRequestId', request.resolvedDisplayValues.request);\n    formData.append('signatureID', request.signatureID);\n\n    if (this.attachment[0]?.data) {\n      formData.append('attachment', this.attachment[0].data, this.attachment[0].data.name);\n    }\n\n    this.rxApprovalConsoleService\n      .saveQuestion(formData, 'question')\n      .pipe(\n        finalize(() => {\n          this.allowDismiss = true;\n        })\n      )\n      .subscribe(() => {\n        this.rxNotificationService.addSuccessMessage(\n          this.translateService.instant('com.bmc.arsys.rx.client.approval.console.questions.question-added.message')\n        );\n\n        this.activeModalRef.close(true);\n      });\n  }\n\n  cancel(): void {\n    this.activeModalRef.dismiss(DismissReasons.CLOSE_BTN);\n  }\n\n  private getApprovalUsers(\n    startIndex: number,\n    pageSize: number,\n    searchQuery: string\n  ): Observable<IRxSelectWithPaginationOptionsPage> {\n    return this.rxApprovalConsoleService.getApprovalUsers(startIndex, pageSize, searchQuery);\n  }\n\n  optionFormatter(option: IRxSelectWithPaginationOption): string {\n    return `${option.value} ${option.displayValue}`;\n  }\n}\n","<div class=\"modal-header\">\n  <h5 class=\"modal-title\">\n    {{ 'com.bmc.arsys.rx.client.approval.console.questions.new.label' | translate }}\n  </h5>\n\n  <button\n    class=\"close dp-close\"\n    type=\"button\"\n    rx-id=\"x-button\"\n    [disabled]=\"!allowDismiss\"\n    (click)=\"cancel()\"\n  ></button>\n</div>\n\n<div class=\"modal-body\">\n  <rx-select-with-pagination\n    label=\"{{ 'com.bmc.arsys.rx.client.common.send-to.label' | translate }}\"\n    class=\"form-group d-block\"\n    [(ngModel)]=\"selectedUser\"\n    [optionLoader]=\"userLoaderFunc\"\n    [required]=\"true\"\n    [template]=\"optionTemplate\"\n    [optionFormatter]=\"optionFormatter\"\n  ></rx-select-with-pagination>\n\n  <adapt-rx-textarea\n    label=\"{{ 'com.bmc.arsys.rx.client.common.question.label' | translate }}\"\n    class=\"d-block form-group\"\n    [(ngModel)]=\"question\"\n    [required]=\"true\"\n    [autofocus]=\"true\"\n    rows=\"2\"\n  ></adapt-rx-textarea>\n\n  <adapt-rx-uploader\n    adaptRequired\n    [(ngModel)]=\"attachment\"\n    [enableDnD]=\"true\"\n    [showMaxSizeRestriction]=\"false\"\n    label=\"{{ 'com.bmc.arsys.rx.client.common.attachment.label' | translate }}\"\n  >\n  </adapt-rx-uploader>\n</div>\n\n<div class=\"modal-footer\">\n  <button\n    adapt-button\n    class=\"mr-2\"\n    btn-type=\"primary\"\n    type=\"button\"\n    rx-id=\"save-button\"\n    [disabled]=\"!selectedUser.length || !question || !allowDismiss\"\n    [adaptInlineLoader]=\"!allowDismiss\"\n    (click)=\"saveQuestion()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"secondary\"\n    rx-id=\"cancel-button\"\n    (click)=\"cancel()\"\n    [disabled]=\"!allowDismiss\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n  </button>\n</div>\n\n<ng-template #optionTemplate let-option>\n  <strong>{{ option.displayValue }}</strong>\n\n  <div class=\"text-secondary\">\n    {{ option.value }}\n  </div>\n</ng-template>\n"]}