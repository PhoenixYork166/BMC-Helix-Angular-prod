{"version":3,"file":"application-configurator.service.js","sourceRoot":"","sources":["../../../../../../../libs/platform/shared/api/application/application-configurator.service.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AAC7D,OAAO,EAAE,QAAQ,EAAE,MAAM,iBAAiB,CAAC;AAC3C,OAAO,EAAE,aAAa,EAAE,MAAM,EAAE,MAAM,iBAAiB,CAAC;AACxD,OAAO,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,gBAAgB,CAAC;AAC9C,OAAO,EAAE,GAAG,EAAE,MAAM,QAAQ,CAAC;AAE7B,OAAO,EAAE,uBAAuB,EAAE,iBAAiB,EAAE,MAAM,uBAAuB,CAAC;AACnF,OAAO,EAAE,cAAc,EAAE,MAAM,uBAAuB,CAAC;AACvD,OAAO,EAAE,uBAAuB,EAAE,MAAM,4CAA4C,CAAC;AACrF,OAAO,EAAE,oBAAoB,EAAE,MAAM,iCAAiC,CAAC;;;;;;AAKvE,MAAM,OAAO,gCAAgC;IAC3C,YACE,QAAkB,EACV,uBAAgD,EAChD,oBAA0C,EACxB,QAAa,EAC/B,MAAc,EACd,iBAAoC,EACpC,uBAAgD;QALhD,4BAAuB,GAAvB,uBAAuB,CAAyB;QAChD,yBAAoB,GAApB,oBAAoB,CAAsB;QACxB,aAAQ,GAAR,QAAQ,CAAK;QAC/B,WAAM,GAAN,MAAM,CAAQ;QACd,sBAAiB,GAAjB,iBAAiB,CAAmB;QACpC,4BAAuB,GAAvB,uBAAuB,CAAyB;QAExD,cAAc,CAAC,QAAQ,GAAG,QAAQ,CAAC;IACrC,CAAC;IAED,SAAS;QACP,IAAI,CAAC,aAAa,EAAE,CAAC;QAErB,IAAI,CAAC,oBAAoB,CAAC,cAAc;aACrC,IAAI,CAAC,MAAM,CAAS,OAAO,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;aACtC,SAAS,CAAC,CAAC,aAAa,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,QAAQ,EAAE,aAAa,CAAC,CAAC,CAAC;QAErG,IAAI,CAAC,uBAAuB,CAAC,oBAAoB,CAAC,SAAS,CAAC,GAAG,EAAE;YAC/D,IAAI,CAAC,uBAAuB,CAAC,0BAA0B,CAAC,KAAK,CAAC,CAAC;QACjE,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,YAAY,aAAa,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG,EAAE;YACxF,IAAI,CAAC,iBAAiB,CAAC,cAAc,EAAE,CAAC;YAExC,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,uBAAuB,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;gBAC9E,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,IAAI,CAAC,uBAAuB,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;aACrF;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,gGAAgG;IACxF,aAAa;QACnB,MAAM,iBAAiB,GAAG,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAEpE,QAAQ,CAAC,MAAM,CAAC,GAAG,GAAG,UACpB,IAAY,EACZ,gBAA2F;YAE3F,IAAI,OAAO,gBAAgB,KAAK,QAAQ,EAAE;gBACxC,iBAAiB,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAC;aAC3C;iBAAM;gBACL,MAAM,2BAA2B,GAAG,UAAU,MAAuB;oBACnE,MAAM,mBAAmB,GAAG,gBAAgB,CAAC,MAAM,CAAC,CAAC;oBAErD,IAAI,IAAI,KAAK,MAAM,EAAE;wBACnB,MAAM,gBAAgB,GAAG,mBAAmB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,EAAE,KAAK,QAAQ,CAAC,CAAC;wBAE3F,GAAG,CAAC,gBAAgB,EAAE,+BAA+B,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;qBACrE;oBAED,OAAO,mBAAmB,CAAC;gBAC7B,CAAC,CAAC;gBAEF,iBAAiB,CAAC,IAAI,EAAE,2BAA2B,CAAC,CAAC;aACtD;QACH,CAAC,CAAC;IACJ,CAAC;;6HA3DU,gCAAgC,qHAKjC,QAAQ;iIALP,gCAAgC,cAF/B,MAAM;2FAEP,gCAAgC;kBAH5C,UAAU;mBAAC;oBACV,UAAU,EAAE,MAAM;iBACnB;;0BAMI,MAAM;2BAAC,QAAQ","sourcesContent":["import { Inject, Injectable, Injector } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { filter, take } from 'rxjs/operators';\nimport { get } from 'lodash';\n\nimport { AdaptDockedPanelService, AdaptModalService } from '@bmc-ux/adapt-angular';\nimport { RxRootInjector } from './root-injector.class';\nimport { RxUpgradeTrackerService } from '../upgrade-tracker/upgrade-tracker.service';\nimport { RxGlobalCacheService } from '../caching/global-cache.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RxApplicationConfiguratorService {\n  constructor(\n    injector: Injector,\n    private rxUpgradeTrackerService: RxUpgradeTrackerService,\n    private rxGlobalCacheService: RxGlobalCacheService,\n    @Inject(DOCUMENT) private document: any,\n    private router: Router,\n    private adaptModalService: AdaptModalService,\n    private adaptDockedPanelService: AdaptDockedPanelService\n  ) {\n    RxRootInjector.injector = injector;\n  }\n\n  configure(): void {\n    this.patchCkEditor();\n\n    this.rxGlobalCacheService.applicationId$\n      .pipe(filter<string>(Boolean), take(1))\n      .subscribe((applicationId) => this.document.body.parentNode.setAttribute('rx-app', applicationId));\n\n    this.rxUpgradeTrackerService.isUpgradeInProgress$.subscribe(() => {\n      this.rxUpgradeTrackerService.displayUpgradeNotification(false);\n    });\n\n    this.router.events.pipe(filter((event) => event instanceof NavigationEnd)).subscribe(() => {\n      this.adaptModalService.closeAllModals();\n\n      for (let i = this.adaptDockedPanelService.openedPanels.length - 1; i >= 0; i--) {\n        this.adaptDockedPanelService.close(this.adaptDockedPanelService.openedPanels[i].id);\n      }\n    });\n  }\n\n  // monkey patch CKEDITOR.dialog.add method to remove 'popup' option from Link -> Target dropdown\n  private patchCkEditor(): void {\n    const ckEditorDialogAdd = CKEDITOR.dialog.add.bind(CKEDITOR.dialog);\n\n    CKEDITOR.dialog.add = function (\n      name: string,\n      dialogDefinition: string | ((editor: CKEDITOR.editor) => CKEDITOR.dialog.IDialogDefinition)\n    ) {\n      if (typeof dialogDefinition === 'string') {\n        ckEditorDialogAdd(name, dialogDefinition);\n      } else {\n        const patchedDialogDefinitionFunc = function (editor: CKEDITOR.editor): CKEDITOR.dialog.IDialogDefinition {\n          const dialogDefinitionObj = dialogDefinition(editor);\n\n          if (name === 'link') {\n            const linkTargetConfig = dialogDefinitionObj.contents.find((item) => item.id === 'target');\n\n            get(linkTargetConfig, 'elements[0].children[0].items').splice(2, 1);\n          }\n\n          return dialogDefinitionObj;\n        };\n\n        ckEditorDialogAdd(name, patchedDialogDefinitionFunc);\n      }\n    };\n  }\n}\n"]}