{"version":3,"file":"close-duplicate-issues.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/application-issues/close-duplicate-issues/close-duplicate-issues.component.ts","../../../../../../../../libs/platform/admin/components/application-issues/close-duplicate-issues/close-duplicate-issues.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\nimport { RX_ISSUES } from '../application-issues.constant';\nimport { IRecordGridColumn, IRecordGridConfig, RecordGridComponent } from '@helix/platform/view/components';\nimport { RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { Observable, of } from 'rxjs';\nimport { AdaptDockedPanelService, DockedPanelContext } from '@bmc-ux/adapt-angular';\nimport { head, map } from 'lodash';\nimport { RxCommandFactoryService, RxNotificationService } from '@helix/platform/shared/api';\nimport { ColumnConfig, RowDataItem } from '@bmc-ux/adapt-table';\nimport { IssueDetailsComponent } from '../issue-details/issue-details.component';\nimport { IRowDataItem } from '@helix/platform/view/api';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'rx-close-duplicate-issues',\n  templateUrl: './close-duplicate-issues.component.html'\n})\nexport class CloseDuplicateIssuesComponent implements OnInit {\n  @ViewChild('submittedIssuesGrid', { static: true })\n  submittedIssuesGrid: RecordGridComponent;\n\n  selectedIssuesData: RowDataItem[];\n  submittedIssuesGridConfiguration$: Observable<IRecordGridConfig>;\n  selectedIssuesGridColumns: ColumnConfig[] = [\n    {\n      field: `${RX_ISSUES.issuesRecordFieldIds.applicationName}`,\n      header: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.application-name.title')\n    },\n    {\n      field: `${RX_ISSUES.issuesRecordFieldIds.errorNumber}`,\n      header: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.error-number.title')\n    },\n    {\n      field: `${RX_ISSUES.issuesRecordFieldIds.errorMessage}`,\n      header: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.error-message.title'),\n      sortable: false\n    }\n  ];\n\n  constructor(\n    private adaptDockedPanelService: AdaptDockedPanelService,\n    private dockedPanelContext: DockedPanelContext,\n    private rxCommandFactoryService: RxCommandFactoryService,\n    private rxNotificationService: RxNotificationService,\n    private translateService: TranslateService\n  ) {}\n\n  ngOnInit(): void {\n    this.selectedIssuesData = this.dockedPanelContext.getData();\n    this.submittedIssuesGridConfiguration();\n  }\n\n  private getSubmittedIssuesGridColumns(): IRecordGridColumn[] {\n    return [\n      {\n        fieldId: `${RX_ISSUES.issuesRecordFieldIds.applicationName}`,\n        index: 0,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.application-name.title')\n      },\n      {\n        fieldId: `${RX_ISSUES.issuesRecordFieldIds.errorNumber}`,\n        index: 1,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.error-number.title'),\n        clickable: true,\n        actions: [\n          {\n            name: (previousActionResult: any, lastActionRow: IRowDataItem) => this.showIssueDetails(lastActionRow)\n          }\n        ]\n      },\n      {\n        fieldId: `${RX_ISSUES.issuesRecordFieldIds.errorMessage}`,\n        index: 2,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.error-message.title')\n      },\n      {\n        fieldId: `${RX_RECORD_DEFINITION.coreFieldIds.createdDate}`,\n        index: 3,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.reported-date.title')\n      },\n      {\n        fieldId: `${RX_ISSUES.issuesRecordFieldIds.caseId}`,\n        index: 4,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.case-id.title')\n      }\n    ];\n  }\n\n  private submittedIssuesGridConfiguration(): void {\n    this.submittedIssuesGridConfiguration$ = of({\n      recordDefinitionName: RX_ISSUES.issuesRecordDefinitionName,\n      columns: this.getSubmittedIssuesGridColumns(),\n      filterExpression: `'${RX_RECORD_DEFINITION.coreFieldIds.status}' = \"${RX_ISSUES.statusOptionValues.submitted}\"`,\n      styles: 'flex-fill'\n    });\n  }\n\n  cancel(): void {\n    this.dockedPanelContext.close('');\n  }\n\n  closeSelectedIssues(): void {\n    const selection = head(this.submittedIssuesGrid.api.getSelectedRows());\n\n    this.rxCommandFactoryService\n      .forResourceType('com.bmc.arsys.rx.application.support.command.UpdateIssuesAsDuplicateCommand')\n      .execute({\n        recordId: selection[RX_RECORD_DEFINITION.coreFieldIds.id],\n        recordIds: map(this.dockedPanelContext.getData(), (record) => record[RX_RECORD_DEFINITION.coreFieldIds.id])\n      })\n      .subscribe(() => {\n        this.rxNotificationService.addSuccessMessage(\n          this.translateService.instant(RX_ISSUES.notificationMessages.duplicateIssuesClosed)\n        );\n        this.dockedPanelContext.close('close');\n      });\n  }\n\n  isCloseSelectedIssuesButtonDisabled(): boolean {\n    return this.submittedIssuesGrid.api.getSelectedRows().length === 0;\n  }\n\n  private showIssueDetails(rowData: RowDataItem): void {\n    this.adaptDockedPanelService.open({\n      title: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.issue-details.title'),\n      content: IssueDetailsComponent,\n      size: 'lg',\n      data: rowData\n    });\n  }\n}\n","<div class=\"dp-body d-flex flex-column\">\n  <div class=\"row\">\n    <div class=\"col-12\">\n      <h5 class=\"mt-0\">\n        {{ 'com.bmc.arsys.rx.client.admin.application-issues.selected-issues.title' | translate }}\n      </h5>\n      <adapt-table\n        rx-id=\"selected-issues-grid\"\n        [columns]=\"selectedIssuesGridColumns\"\n        [bordered]=\"true\"\n        [sortable]=\"true\"\n        [value]=\"selectedIssuesData\"\n      >\n      </adapt-table>\n    </div>\n  </div>\n  <div class=\"row flex-fill\">\n    <div class=\"col-12 d-flex flex-column\">\n      <h5>\n        {{ 'com.bmc.arsys.rx.client.admin.application-issues.duplicates.title' | translate }}\n      </h5>\n      <rx-record-grid\n        class=\"flex-fill\"\n        rx-id=\"submitted-issues-grid\"\n        #submittedIssuesGrid\n        [config]=\"submittedIssuesGridConfiguration$\"\n      ></rx-record-grid>\n    </div>\n  </div>\n</div>\n<div class=\"dp-footer\">\n  <button\n    rx-id=\"close-selected-issues-button\"\n    adapt-button\n    btn-type=\"primary\"\n    class=\"mr-2\"\n    [disabled]=\"isCloseSelectedIssuesButtonDisabled()\"\n    (click)=\"closeSelectedIssues()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.admin.application-issues.close-selected.label' | translate }}\n  </button>\n  <button adapt-button btn-type=\"secondary\" rx-id=\"cancel-button\" class=\"mr-2\" (click)=\"cancel()\">\n    {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n  </button>\n</div>\n"]}