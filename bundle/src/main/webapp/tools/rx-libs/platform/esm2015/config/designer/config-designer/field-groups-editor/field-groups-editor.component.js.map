{"version":3,"file":"field-groups-editor.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/config/designer/config-designer/field-groups-editor/field-groups-editor.component.ts","../../../../../../../../libs/platform/config/designer/config-designer/field-groups-editor/field-groups-editor.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, OnInit } from '@angular/core';\nimport {\n  ActiveModalRef,\n  DismissReasons,\n  ListBuilderTextsModel,\n  RxListBuilderItem,\n  RxSelectOption\n} from '@bmc-ux/adapt-angular';\nimport { RxNotificationService } from '@helix/platform/shared/api';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { TranslateService } from '@ngx-translate/core';\nimport { chain, some, trim } from 'lodash';\nimport { FieldGroupsEditorStore } from './field-groups-editor.store';\nimport { ReplaySubject } from 'rxjs';\nimport { filter, take } from 'rxjs/operators';\nimport { IFieldState } from './field-groups-editor.types';\nimport { IConfigFieldDefinitionModel } from '../../config-designer.types';\n\n@Component({\n  selector: 'rx-field-groups-editor',\n  templateUrl: './field-groups-editor.component.html',\n  styleUrls: ['./field-groups-editor.component.scss'],\n  providers: [FieldGroupsEditorStore]\n})\nexport class FieldGroupsEditorComponent extends RxModalClass implements OnInit {\n  private destroyed$: ReplaySubject<boolean> = new ReplaySubject(1);\n\n  listBuilderTexts: ListBuilderTextsModel = {\n    searchPlaceholder: this.translateService.instant(\n      'com.bmc.arsys.rx.client.config-designer.field-groups-list.placeholder'\n    )\n  };\n\n  private duplicateGroupMsg = this.translateService.instant(\n    'com.bmc.arsys.rx.client.designer.validation.duplicate-value.message'\n  );\n\n  itemValidation = (itemName: string, items: RxListBuilderItem[], isEdit: boolean): string =>\n    some(items, (item: RxListBuilderItem) => trim(item.name) === trim(itemName)) ? this.duplicateGroupMsg : null;\n\n  readonly vm$ = this.fieldGroupsEditorStore.vm$;\n\n  constructor(\n    private readonly fieldGroupsEditorStore: FieldGroupsEditorStore,\n    private readonly translateService: TranslateService,\n    private readonly rxNotificationService: RxNotificationService,\n    private readonly activeModalRef: ActiveModalRef,\n    injector: Injector\n  ) {\n    super(activeModalRef, injector);\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n\n    this.fieldGroupsEditorStore.isDirty$.pipe(filter(Boolean), take(1)).subscribe(() => {\n      this.markAsDirty();\n    });\n\n    const fields: IFieldState[] = this.activeModalRef.getData().fields.map((field: IConfigFieldDefinitionModel) => ({\n      guid: field.guid,\n      name: field.id,\n      groupName: field.localeList[0].fieldGrouping,\n      fieldOrder: field.fieldOrder,\n      checked: false\n    }));\n\n    const groups: RxListBuilderItem[] = chain(fields)\n      .map((field, index) => ({ name: field.groupName, id: index, guid: field.guid }))\n      .filter((group) => !!group.name)\n      .uniqBy('name')\n      .sort((a, b) => a.name.localeCompare(b.name))\n      .value();\n\n    this.fieldGroupsEditorStore.patchState({ fields, groups });\n  }\n\n  onGroupChange(groups: RxListBuilderItem[]): void {\n    this.fieldGroupsEditorStore.selectGroup(groups.find((field) => field.selected)?.name);\n  }\n\n  onGroupAdd(addedGroup: RxListBuilderItem, groups: RxListBuilderItem[]): void {\n    groups.forEach((group) => {\n      group.selected = group === addedGroup;\n    });\n  }\n\n  onGroupRemove(removedGroup: RxListBuilderItem): void {\n    this.fieldGroupsEditorStore.removeGroup(removedGroup.name);\n  }\n\n  onGroupRename([oldGroup, newGroup]: RxListBuilderItem[]): void {\n    this.fieldGroupsEditorStore.renameGroup({ oldName: oldGroup.name, newName: newGroup.name });\n  }\n\n  onAvailableFieldsChange(checkedFields: RxSelectOption[], availableFields: RxSelectOption[]): void {\n    availableFields.forEach((field: RxSelectOption) => {\n      if (some(checkedFields, { guid: field.guid })) {\n        this.fieldGroupsEditorStore.checkField(field.guid);\n      } else {\n        this.fieldGroupsEditorStore.uncheckField(field.guid);\n      }\n    });\n  }\n\n  onSelectedFieldsChange(fields): void {\n    fields.forEach((field) => {\n      if (field.selected) {\n        this.fieldGroupsEditorStore.checkField(field.guid);\n      } else {\n        this.fieldGroupsEditorStore.uncheckField(field.guid);\n      }\n    });\n\n    this.fieldGroupsEditorStore.sortSelectedFields(fields.map((field) => field.guid));\n  }\n\n  onDragEnd(): void {\n    this.fieldGroupsEditorStore.markDirty();\n  }\n\n  moveToSelected(): void {\n    this.fieldGroupsEditorStore.assignCheckedFields();\n  }\n\n  moveToAvailable(): void {\n    this.fieldGroupsEditorStore.unassignCheckedFields();\n  }\n\n  onFieldRemove(removedField): void {\n    this.fieldGroupsEditorStore.removeField(removedField.guid);\n  }\n\n  alphabeticSort(a: RxListBuilderItem, b: RxListBuilderItem): number {\n    return a.name.localeCompare(b.name);\n  }\n\n  optionFormatter(field: RxSelectOption): string {\n    return field.name;\n  }\n\n  saveFieldGroups(): void {\n    this.fieldGroupsEditorStore.fields$.pipe(take(1)).subscribe((fields) => {\n      this.activeModalRef.close({ fields });\n    });\n  }\n\n  cancel(): void {\n    this.activeModalRef.dismiss(DismissReasons.CLOSE_BTN);\n  }\n\n  ngOnDestroy(): void {\n    this.destroyed$.next(true);\n    this.destroyed$.complete();\n  }\n}\n","<ng-container *ngIf=\"vm$ | async as vm\">\n  <div class=\"designer-modal-body modal-body d-flex mh-100 flex-column\">\n    <div class=\"d-flex h-100 flex-fill\">\n      <adapt-rx-list-builder\n        class=\"flex-grow-1 mr-3\"\n        [ngModel]=\"vm.groups\"\n        selectionMode=\"single\"\n        (listItemAdd)=\"onGroupAdd($event, vm.groups)\"\n        (listItemRemove)=\"onGroupRemove($event)\"\n        (listItemUpdate)=\"onGroupRename($event)\"\n        (ngModelChange)=\"onGroupChange($event)\"\n        [customSort]=\"alphabeticSort\"\n        [hideListAreaLabel]=\"true\"\n        [texts]=\"listBuilderTexts\"\n        [itemValidation]=\"itemValidation\"\n        label=\"{{ 'com.bmc.arsys.rx.client.config-designer.field-groups.label' | translate }}\"\n        rx-id=\"field-groups-list\"\n      ></adapt-rx-list-builder>\n\n      <adapt-rx-select\n        class=\"flex-grow-1 h-100 d-flex flex-column\"\n        popupMaxHeight=\"100%\"\n        [options]=\"vm.availableFields\"\n        [ngModel]=\"vm.checkedAvailableFields\"\n        [deselectAllButton]=\"true\"\n        [selectAllButton]=\"true\"\n        [enableFilter]=\"true\"\n        [inline]=\"true\"\n        label=\"{{ 'com.bmc.arsys.rx.client.config-designer.available-fields.label' | translate }}\"\n        [multiple]=\"true\"\n        [singleSelectStyle]=\"'marker'\"\n        [optionFormatter]=\"optionFormatter\"\n        (ngModelChange)=\"onAvailableFieldsChange($event, vm.availableFields)\"\n        rx-id=\"available-fields-list\"\n      ></adapt-rx-select>\n\n      <div class=\"mx-2 d-flex flex-column\">\n        <button\n          type=\"button\"\n          adapt-button\n          class=\"d-icon-right-angle_right mt-auto mb-2\"\n          btn-type=\"secondary\"\n          (click)=\"moveToSelected()\"\n          [disabled]=\"!vm.checkedAvailableFields.length\"\n          rx-id=\"move-to-selected-button\"\n        ></button>\n\n        <button\n          type=\"button\"\n          adapt-button\n          class=\"d-icon-right-angle_left mb-auto\"\n          btn-type=\"secondary\"\n          (click)=\"moveToAvailable()\"\n          [disabled]=\"!vm.checkedSelectedFields.length\"\n          rx-id=\"move-to-available-button\"\n        ></button>\n      </div>\n\n      <adapt-rx-list-builder\n        class=\"flex-grow-1\"\n        [ngModel]=\"vm.selectedFields\"\n        selectionMode=\"multiple\"\n        (listItemRemove)=\"onFieldRemove($event)\"\n        [hideSearchField]=\"true\"\n        [hideListAreaLabel]=\"true\"\n        [hideEdit]=\"true\"\n        (ngModelChange)=\"onSelectedFieldsChange($event)\"\n        (dragend)=\"onDragEnd()\"\n        label=\"{{ 'com.bmc.arsys.rx.client.config-designer.selected-fields.label' | translate }}\"\n        rx-id=\"selected-fields-list\"\n      ></adapt-rx-list-builder>\n    </div>\n  </div>\n\n  <div class=\"modal-footer\">\n    <button\n      type=\"button\"\n      adapt-button\n      btn-type=\"primary\"\n      rx-id=\"save-field-groups-button\"\n      (click)=\"saveFieldGroups()\"\n      [disabled]=\"!vm.isDirty\"\n    >\n      {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n    </button>\n\n    <button type=\"button\" adapt-button btn-type=\"secondary\" rx-id=\"cancel-button\" (click)=\"cancel()\">\n      {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n    </button>\n  </div>\n</ng-container>\n"]}