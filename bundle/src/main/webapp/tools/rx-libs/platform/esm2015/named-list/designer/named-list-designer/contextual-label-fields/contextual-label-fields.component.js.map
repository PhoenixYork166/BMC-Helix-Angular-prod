{"version":3,"file":"contextual-label-fields.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/named-list/designer/named-list-designer/contextual-label-fields/contextual-label-fields.component.ts","../../../../../../../../libs/platform/named-list/designer/named-list-designer/contextual-label-fields/contextual-label-fields.component.html"],"names":[],"mappings":"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","sourcesContent":["import { ChangeDetectionStrategy, Component, Input, OnChanges, OnInit, SimpleChanges } from '@angular/core';\nimport { NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { TranslateService } from '@ngx-translate/core';\nimport { cloneDeep, isNil, noop, without } from 'lodash';\nimport { BehaviorSubject } from 'rxjs';\nimport { RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { IFormFocusable } from '@helix/platform/shared/api';\nimport { RxModalService } from '@helix/platform/ui-kit';\nimport { ValueAccessor } from '@helix/platform/shared/components';\nimport { INamedListField } from '@helix/platform/named-list/api';\nimport { IContextualLabelFieldsEditorConfig } from '../../named-list-designer.types';\nimport { ContextualLabelFieldsEditorModalComponent } from './contextual-label-fields-editor/contextual-label-fields-editor-modal.component';\n\ninterface IViewModel {\n  fieldNames: string[];\n  isEditorDisabled: boolean;\n  isFieldRemovable: boolean;\n}\n\n@Component({\n  selector: 'rx-contextual-label-fields',\n  templateUrl: './contextual-label-fields.component.html',\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: ContextualLabelFieldsComponent,\n      multi: true\n    }\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextualLabelFieldsComponent\n  extends ValueAccessor<INamedListField[]>\n  implements IFormFocusable, OnChanges, OnInit\n{\n  @Input()\n  options: {\n    options: RxSelectOption[];\n  };\n\n  private vmSubject = new BehaviorSubject<IViewModel>({\n    fieldNames: [],\n    isEditorDisabled: true,\n    isFieldRemovable: false\n  });\n\n  vm$ = this.vmSubject.asObservable();\n\n  constructor(private rxModalService: RxModalService, private translateService: TranslateService) {\n    super();\n  }\n\n  ngOnInit() {\n    this.value ??= [];\n    this.updateViewValues();\n  }\n\n  focus(data: { fieldIndex: number }): void {\n    this.openContextualLabelFieldsEditor(data.fieldIndex);\n  }\n\n  onWriteValue(value: INamedListField[]): void {\n    if (!isNil(value)) {\n      this.updateViewValues();\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    this.updateViewValues();\n  }\n\n  private updateViewValues(): void {\n    const fieldNames = this.value.map(\n      (field: INamedListField) => this.options.options.find(({ id }) => id === field.id)?.name ?? ''\n    );\n\n    this.vmSubject.next({\n      fieldNames,\n      isEditorDisabled: this.isDisabled && !fieldNames.length,\n      isFieldRemovable: !this.isDisabled\n    });\n  }\n\n  openContextualLabelFieldsEditor(activeFieldIndex?: number): void {\n    this.rxModalService\n      .openModal({\n        title: this.translateService.instant(\n          'com.bmc.arsys.rx.client.named-list-designer.contextual-label-fields.edit-fields.label'\n        ),\n        data: {\n          contextualLabelFields: this.value ? cloneDeep(this.value) : [],\n          options: this.options.options,\n          isReadOnly: this.isDisabled,\n          activeFieldIndex\n        } as IContextualLabelFieldsEditorConfig,\n        content: ContextualLabelFieldsEditorModalComponent,\n        testID: 'edit-contextual-label-fields'\n      })\n      .then((contextualLabelFields: INamedListField[]) => {\n        this.value = contextualLabelFields;\n      })\n      .catch(noop);\n  }\n\n  editContextualLabelField(activeFieldIndex: number): void {\n    this.openContextualLabelFieldsEditor(activeFieldIndex);\n  }\n\n  removeContextualLabelField(activeFieldIndex: number): void {\n    this.value = without(this.value, this.value[activeFieldIndex]);\n  }\n}\n","<ng-container *ngIf=\"vm$ | async as vm\">\n  <div class=\"pb-1\">\n    <adapt-button\n      btn-type=\"tertiary\"\n      rx-id=\"open-contextual-label-fields-editor-link\"\n      class=\"d-icon-plus_circle p-0\"\n      (click)=\"openContextualLabelFieldsEditor()\"\n      [disabled]=\"vm.isEditorDisabled\"\n    >\n      {{ 'com.bmc.arsys.rx.client.named-list-designer.contextual-label-fields.edit-fields.label' | translate }}\n    </adapt-button>\n    <adapt-icon\n      name=\"question_circle_o\"\n      class=\"ml-2\"\n      placement=\"right\"\n      maxWidth=\"400\"\n      [adaptPopover]=\"\n        'com.bmc.arsys.rx.client.named-list-designer.contextual-label-fields.edit-fields.tooltip' | translate\n      \"\n    ></adapt-icon>\n  </div>\n\n  <span *ngIf=\"!vm.fieldNames.length\" class=\"text-tertiary\" rx-id=\"contextual-label-empty-state\">{{\n    'com.bmc.arsys.rx.client.named-list-designer.contextual-label-fields.empty-state.message' | translate\n  }}</span>\n\n  <div *ngIf=\"vm.fieldNames.length\" rx-id=\"contextual-label-fields\">\n    <div\n      *ngFor=\"let fieldName of vm.fieldNames; let index = index\"\n      class=\"d-flex border rounded px-2 mb-1 align-items-center\"\n    >\n      <strong class=\"flex-grow-1\">{{ fieldName }}</strong>\n      <adapt-button\n        btn-type=\"tertiary\"\n        class=\"d-icon-right-pencil p-1\"\n        rx-id=\"edit-button\"\n        (click)=\"editContextualLabelField(index)\"\n      ></adapt-button>\n      <adapt-button\n        btn-type=\"tertiary\"\n        class=\"d-icon-right-cross_adapt p-1\"\n        rx-id=\"remove-button\"\n        *ngIf=\"vm.isFieldRemovable\"\n        (click)=\"removeContextualLabelField(index)\"\n      ></adapt-button>\n    </div>\n  </div>\n</ng-container>\n"]}