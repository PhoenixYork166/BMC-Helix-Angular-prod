{"version":3,"file":"designer-canvas.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/shared/components/designer-canvas/designer-canvas.component.ts","../../../../../../../libs/platform/shared/components/designer-canvas/designer-canvas.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  AfterViewInit,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  OnInit,\n  Output,\n  SimpleChanges\n} from '@angular/core';\nimport { CdkDragDrop } from '@angular/cdk/drag-drop/drag-events';\n\nimport { RxCommandManagerService } from '@helix/platform/shared/api';\n\nimport { IDesignerCanvasConfiguration } from './designer-canvas.interfaces';\nimport { RX_DESIGNER_CANVAS } from './designer-canvas.constant';\n\ndeclare var joint: any;\n\n@Component({\n  selector: 'rx-designer-canvas',\n  templateUrl: './designer-canvas.component.html',\n  styleUrls: ['./designer-canvas.component.scss']\n})\nexport class RxDesignerCanvasComponent implements OnInit, AfterViewInit, OnChanges {\n  @Input()\n  configuration: IDesignerCanvasConfiguration;\n\n  // TODO-VS: update types\n  @Input()\n  graph: any;\n\n  // TODO-VS: update types\n  @Input()\n  droppedElement: CdkDragDrop<any>;\n\n  @Output()\n  elementSelected = new EventEmitter<string>();\n\n  private commandManager: any;\n  private paper: any;\n  private paperScroller: any;\n\n  constructor(private elementRef: ElementRef, private rxCommandManagerService: RxCommandManagerService) {}\n\n  ngOnInit(): void {\n    this.commandManager = new joint.dia.CommandManager({\n      graph: this.graph,\n      cmdBeforeAdd: (cmdName, cell, graph, options) => {\n        return this.commandManager.enabled && !options?.ignoreCommandManager;\n      }\n    });\n\n    this.rxCommandManagerService.set(this.commandManager);\n\n    this.paper = new joint.dia.Paper({\n      defaultLink: new joint.shapes.bpmn.Flow(), // TODO-VS: update defaultLink configuration\n      embeddingMode: true,\n      gridSize: 5,\n      height: RX_DESIGNER_CANVAS.paperOptions.height,\n      interactive: this.configuration.interactive,\n      model: this.graph,\n      width: RX_DESIGNER_CANVAS.paperOptions.width,\n\n      restrictTranslate: function (elementView) {\n        // TODO-VS: implement restrictTranslate logic\n\n        return false;\n      },\n\n      validateEmbedding: function (childView, parentView) {\n        // TODO-VS: implement validateEmbedding logic\n\n        return true;\n      }\n    });\n\n    this.paper.drawBackground({\n      color: RX_DESIGNER_CANVAS.paperOptions.backgroundColor,\n      image: RX_DESIGNER_CANVAS.paperOptions.backgroundImage,\n      repeat: 'repeat',\n      position: {\n        x: -1,\n        y: -1\n      }\n    });\n\n    this.paperScroller = new joint.ui.PaperScroller({\n      autoResizePaper: true,\n      cursor: 'grab',\n      padding: 32,\n      paper: this.paper\n    });\n\n    this.paper.on('blank:pointerdown', (evt) => {\n      this.paperScroller.startPanning(evt);\n\n      this.elementSelected.emit(null);\n    });\n\n    this.paper.on('cell:pointerup', (cellView, evt) => {\n      if (cellView) {\n        this.elementSelected.emit(cellView.model.prop('elementModel/guid'));\n      }\n    });\n\n    if (this.configuration.interactive) {\n      this.commandManager.enable = () => {\n        this.commandManager.enabled = true;\n      };\n\n      this.commandManager.disable = () => {\n        this.commandManager.enabled = false;\n      };\n\n      this.commandManager.enable();\n\n      this.paper.on('cell:expand:begin cell:collapse:begin', () => {\n        this.commandManager.disable();\n      });\n\n      this.paper.on('cell:expand:done cell:collapse:done', (cellView) => {\n        if (!cellView.model.get('inCallActivity')) {\n          this.commandManager.enable();\n        }\n      });\n    }\n\n    this.paperScroller.render();\n  }\n\n  ngAfterViewInit(): void {\n    this.elementRef.nativeElement.appendChild(this.paperScroller.el);\n    this.paperScroller.center();\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes.droppedElement?.currentValue) {\n      this.addElementToCanvas(changes.droppedElement.currentValue);\n    }\n  }\n\n  hasRedo(): boolean {\n    return this.commandManager.hasRedo();\n  }\n\n  hasUndo(): boolean {\n    return this.commandManager.hasUndo();\n  }\n\n  onClearCanvas(): void {\n    // TODO-VS: add clear logic\n  }\n\n  onCopy(): void {\n    // TODO-VS: add copy logic\n  }\n\n  onCut(): void {\n    // TODO-VS: add cut logic\n  }\n\n  onExportToPng(): void {\n    // TODO-VS: add export logic\n  }\n\n  onPaste(): void {\n    // TODO-VS: add paste logic\n  }\n\n  onPrint(): void {\n    // TODO-VS: add print logic\n  }\n\n  onRedo(): void {\n    this.commandManager.redo();\n  }\n\n  onUndo(): void {\n    this.commandManager.undo();\n  }\n\n  onZoomIn(): void {\n    // TODO-VS: add zoom in logic\n  }\n\n  onZoomOut(): void {\n    // TODO-VS: add zoom out logic\n  }\n\n  // TODO-VS: update types\n  private addElementToCanvas(dropData: CdkDragDrop<any>): void {\n    const paperDropArea = this.getCanvasDropArea(this.paper.$el);\n    const localPoint = this.paper.clientToLocalPoint({ x: dropData.dropPoint.x, y: dropData.dropPoint.y });\n\n    if (this.canDrop(paperDropArea, localPoint)) {\n      const elementService = this.configuration.elementRegistry.get(dropData.item.data.value.type).elementService;\n\n      const droppedElementShape = elementService.getShape({\n        position: localPoint,\n        ...dropData.item.data.value\n      });\n\n      this.graph.addCell(droppedElementShape);\n\n      setTimeout(() => {\n        this.elementSelected.emit(droppedElementShape.prop('elementModel/guid'));\n      });\n    }\n  }\n\n  // TODO-VS: update types\n  private canDrop(paperDropArea: any, localPoint: any): boolean {\n    return (\n      localPoint.x > paperDropArea.x.start &&\n      localPoint.x < paperDropArea.x.end &&\n      localPoint.y > paperDropArea.y.start &&\n      localPoint.y < paperDropArea.y.end\n    );\n  }\n\n  // TODO-VS: update types\n  private getCanvasDropArea(el: any): any {\n    const offset = el.offset();\n    const innerWidth = el.innerWidth();\n    const innerHeight = el.innerHeight();\n\n    return {\n      x: {\n        start: offset.left,\n        end: offset.left + innerWidth\n      },\n      y: {\n        start: offset.top,\n        end: offset.top + innerHeight\n      }\n    };\n  }\n}\n","<div *ngIf=\"configuration.showToolbar\" class=\"rx-designer-toolbar\">\n  <!-- TODO-VS: Add custom actions -->\n\n  <button\n    *ngIf=\"configuration.interactive\"\n    class=\"d-icon-undo\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.undo.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"undo-button\"\n    [disabled]=\"!hasUndo()\"\n    (click)=\"onUndo()\"\n  ></button>\n\n  <button\n    *ngIf=\"configuration.interactive\"\n    class=\"d-icon-redo\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.redo.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"redo-button\"\n    [disabled]=\"!hasRedo()\"\n    (click)=\"onRedo()\"\n  ></button>\n\n  <button\n    *ngIf=\"!configuration.isReadOnly && configuration.enableMultiSelection\"\n    class=\"d-icon-scissors\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.cut.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"cut-button\"\n    (click)=\"onCut()\"\n  ></button>\n\n  <button\n    *ngIf=\"!configuration.isReadOnly && configuration.enableMultiSelection\"\n    class=\"d-icon-files_copy_o\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.copy.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"copy-button\"\n    (click)=\"onCopy()\"\n  ></button>\n\n  <button\n    *ngIf=\"!configuration.isReadOnly && configuration.enableMultiSelection\"\n    class=\"d-icon-files_text\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.paste.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"paste-button\"\n    (click)=\"onPaste()\"\n  ></button>\n\n  <button\n    class=\"d-icon-search_plus\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.zoom-in.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"zoom-in-button\"\n    (click)=\"onZoomIn()\"\n  ></button>\n\n  <button\n    class=\"d-icon-search_minus\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.zoom-out.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"zoom-out-button\"\n    (click)=\"onZoomOut()\"\n  ></button>\n\n  <button\n    class=\"d-icon-printer\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.print.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"print-button\"\n    (click)=\"onPrint()\"\n  ></button>\n\n  <button\n    *ngIf=\"configuration.interactive\"\n    class=\"d-icon-cross_square\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.clear-canvas.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"clear-canvas-button\"\n    (click)=\"onClearCanvas()\"\n  ></button>\n\n  <button\n    class=\"d-icon-file_arrow_png_o\"\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    size=\"large\"\n    adaptTooltip=\"{{ 'com.bmc.arsys.rx.client.common.export-to-png.label' | translate }}\"\n    placement=\"bottom\"\n    rx-id=\"export-to-png-button\"\n    (click)=\"onExportToPng()\"\n  ></button>\n\n  <!-- TODO-VS: Add grid size slider, snaplines checkbox and custom actions -->\n</div>\n"]}