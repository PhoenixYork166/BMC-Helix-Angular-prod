{"version":3,"file":"tab-panel.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/view/components/tab-panel/runtime/tab-panel.component.ts","../../../../../../../../libs/platform/view/components/tab-panel/runtime/tab-panel.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport {\n  BaseViewComponent,\n  IViewComponentSetProperty,\n  RuntimeViewCanvasItemComponent\n} from '@helix/platform/view/runtime';\nimport { distinctUntilChanged, pluck, skip, takeUntil, tap } from 'rxjs/operators';\nimport {\n  ITabPanelApi,\n  ITabPanelChildComponentData,\n  ITabPanelComponentData,\n  ITabPanelConfig,\n  ITabPanelState\n} from './tab-panel.types';\nimport { every, findIndex, get, isNil, isNull } from 'lodash';\nimport { RX_VIEW_DEFINITION } from '@helix/platform/view/api';\nimport { Observable, throwError } from 'rxjs';\n\n@Component({\n  selector: 'rx-tab-panel',\n  templateUrl: './tab-panel.component.html'\n})\nexport class RxTabPanelComponent extends BaseViewComponent implements OnInit, IViewComponentSetProperty {\n  childLayouts: ITabPanelChildComponentData[] = [];\n\n  state: ITabPanelState = {\n    activeTabIndex: null\n  };\n\n  api: ITabPanelApi = {\n    setProperty: this.setProperty.bind(this)\n  };\n\n  constructor(private runtimeCanvasItemComponent: RuntimeViewCanvasItemComponent) {\n    super();\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n\n    this.notifyPropertyChanged('api', this.api);\n\n    this.config.pipe(takeUntil(this.destroyed$)).subscribe((config: ITabPanelConfig) => {\n      this.state = { ...this.state, ...config };\n      this.isHidden = Boolean(this.state.hidden);\n    });\n\n    this.childLayouts = get(\n      this.runtimeCanvasItemComponent.getChildren(RX_VIEW_DEFINITION.defaultOutletName),\n      '[0].children'\n    );\n\n    this.childLayouts.forEach((childLayout) => {\n      childLayout.state = {\n        enableLazyLoading: false,\n        label: '',\n        isRendered: false,\n        hidden: 0\n      };\n\n      childLayout.config\n        .pipe(\n          tap((childLayoutConfig) => {\n            childLayout.state = { ...childLayout.state, ...childLayoutConfig };\n          }),\n          pluck('hidden'),\n          distinctUntilChanged(),\n          skip(1),\n          takeUntil(this.destroyed$)\n        )\n        .subscribe(() => {\n          this.ensureActiveTabIsSet();\n        });\n    });\n\n    this.trySetFirstVisibleTab();\n  }\n\n  setProperty(propertyPath: string, propertyValue: any): void | Observable<never> {\n    if (propertyPath === 'hidden') {\n      this.state.hidden = propertyValue;\n      this.notifyPropertyChanged(propertyPath, propertyValue);\n    } else if (propertyPath === 'activeTabIndex') {\n      this.setActiveTabIndex(parseInt(propertyValue, 10));\n    } else {\n      return throwError(`Tab panel: property ${propertyPath} is not settable.`);\n    }\n  }\n\n  trackByForTabs(index: number, item: ITabPanelChildComponentData): string {\n    return item.guid;\n  }\n\n  canRenderContentForTab(tab: ITabPanelChildComponentData): boolean {\n    return !tab.state.enableLazyLoading || tab.state.isRendered;\n  }\n\n  private getAllTabsData(): ITabPanelComponentData[] {\n    let adaptTabsetIndex = 0;\n\n    return this.childLayouts.map((tab): ITabPanelComponentData => {\n      return {\n        adaptTabsetIndex: this.isHiddenTab(tab) ? null : adaptTabsetIndex++,\n        tab\n      };\n    });\n  }\n\n  isHiddenTab(tab: ITabPanelChildComponentData): boolean {\n    return Boolean(tab.state.hidden);\n  }\n\n  getActiveTabIndexForAdaptTabset() {\n    return isNull(this.state.activeTabIndex) ? 0 : this.getAllTabsData()[this.state.activeTabIndex].adaptTabsetIndex;\n  }\n\n  onActiveTabChanged(adaptTabsetIndex: number): void {\n    const activeTabIndexForAllTabs = findIndex(\n      this.getAllTabsData(),\n      (tab) => tab.adaptTabsetIndex === adaptTabsetIndex\n    );\n\n    this.activateTab(activeTabIndexForAllTabs);\n  }\n\n  private setActiveTabIndex(index: number): void {\n    const tab = this.childLayouts[index];\n\n    if (tab && !this.isHiddenTab(tab)) {\n      this.activateTab(index);\n    }\n  }\n\n  private activateTab(index: number | null): void {\n    this.state.activeTabIndex = index;\n\n    if (!isNil(index)) {\n      this.childLayouts[index].state.isRendered = true;\n    }\n\n    this.notifyPropertyChanged('activeTabIndex', index);\n  }\n\n  private ensureActiveTabIsSet(): void {\n    const allTabs = this.childLayouts;\n    const isAllTabsHidden = every(allTabs, (tab) => this.isHiddenTab(tab));\n\n    if (isAllTabsHidden) {\n      this.activateTab(null);\n    } else if (!isNull(this.state.activeTabIndex) && this.isHiddenTab(allTabs[this.state.activeTabIndex])) {\n      this.trySetFirstVisibleTab();\n    } else if (isNull(this.state.activeTabIndex)) {\n      this.trySetFirstVisibleTab();\n    }\n  }\n\n  private trySetFirstVisibleTab() {\n    const firstVisibleTab = findIndex(this.childLayouts, (tab) => !this.isHiddenTab(tab));\n\n    if (firstVisibleTab !== -1) {\n      this.activateTab(firstVisibleTab);\n    }\n  }\n}\n","<adapt-tabset\n  *ngIf=\"!isHidden\"\n  [fullHeight]=\"true\"\n  (tab-active-changed)=\"onActiveTabChanged($event.index)\"\n  [tab-active]=\"getActiveTabIndexForAdaptTabset()\"\n>\n  <ng-template ngFor let-tab [ngForOf]=\"childLayouts\" [ngForTrackBy]=\"trackByForTabs\" let-index=\"index\">\n    <adapt-tab-panel [adapt-tab-title]=\"tab.state.label\" *ngIf=\"!isHiddenTab(tab)\">\n      <rx-runtime-view-canvas-item *ngIf=\"canRenderContentForTab(tab)\" [layout]=\"tab\"> </rx-runtime-view-canvas-item>\n    </adapt-tab-panel>\n\n    <!-- Hidden tab should have instance for using API  -->\n    <rx-runtime-view-canvas-item *ngIf=\"isHiddenTab(tab) && canRenderContentForTab(tab)\" [layout]=\"tab\">\n    </rx-runtime-view-canvas-item>\n  </ng-template>\n</adapt-tabset>\n"]}