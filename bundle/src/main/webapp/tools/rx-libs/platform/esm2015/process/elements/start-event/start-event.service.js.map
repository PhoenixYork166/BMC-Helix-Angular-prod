{"version":3,"file":"start-event.service.js","sourceRoot":"","sources":["../../../../../../../libs/platform/process/elements/start-event/start-event.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { Observable, of } from 'rxjs';\nimport { isEmpty, some } from 'lodash';\n\nimport { IValidationIssue, ValidationIssueType } from '@helix/platform/ui-kit';\nimport { RxStringService } from '@helix/platform/utils';\nimport {\n  IDataDictionaryBranch,\n  IDesignerElementService,\n  IFormBuilderConfig,\n  IPlainObject\n} from '@helix/platform/shared/api';\nimport {\n  ITextareaFormControlOptions,\n  ITextFormControlOptions,\n  TextareaFormControlComponent,\n  TextFormControlComponent\n} from '@helix/platform/shared/components';\nimport { IProcessFlowElementDefinition, RX_PROCESS_DEFINITION } from '@helix/platform/process/api';\n\nimport { IStartEventModel } from './start-event.interfaces';\n\ndeclare var joint: any;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RxStartEventService implements IDesignerElementService<IProcessFlowElementDefinition, IStartEventModel> {\n  constructor(private rxStringService: RxStringService, private translateService: TranslateService) {}\n\n  getDefinitionFromModel(model: IStartEventModel): Partial<IProcessFlowElementDefinition> {\n    return {\n      description: model.description,\n      guid: model.guid,\n      name: model.name,\n      resourceType: model.resourceType\n    };\n  }\n\n  // TODO-VS: add position and size inspector groups\n  getInspectorConfig(): IFormBuilderConfig {\n    return [\n      {\n        label: this.translateService.instant('com.bmc.arsys.rx.client.common.general-items.label'),\n        controls: [\n          {\n            name: 'label',\n            component: TextFormControlComponent,\n            options: {\n              label: this.translateService.instant('com.bmc.arsys.rx.client.common.label.label')\n            } as ITextFormControlOptions\n          },\n          {\n            name: 'description',\n            component: TextareaFormControlComponent,\n            options: {\n              label: this.translateService.instant('com.bmc.arsys.rx.client.common.description.label'),\n              rows: 3\n            } as ITextareaFormControlOptions\n          },\n          {\n            name: 'guid',\n            component: TextFormControlComponent,\n            isDisabled: true,\n            options: {\n              label: this.translateService.instant('com.bmc.arsys.rx.client.common.id.label')\n            } as ITextareaFormControlOptions\n          }\n        ]\n      }\n    ];\n  }\n\n  getModelFromDefinition(definition?: IProcessFlowElementDefinition): IStartEventModel {\n    let elementModel = {\n      description: '',\n      guid: null,\n      label: '',\n      name: RX_PROCESS_DEFINITION.processElementDisplayNames.startEvent,\n      resourceType: RX_PROCESS_DEFINITION.processElementResourceTypes.startEvent,\n      type: RX_PROCESS_DEFINITION.processElementTypes.startEvent\n    };\n\n    if (definition) {\n      elementModel = {\n        ...elementModel,\n        description: definition.description,\n        guid: definition.guid,\n        label: definition.name,\n        name: definition.name,\n        resourceType: definition.resourceType\n      };\n    }\n\n    return elementModel;\n  }\n\n  getShape(options: IPlainObject): any {\n    return new joint.shapes.rx.StartEvent({\n      elementModel: this.getModelFromDefinition(),\n      position: options.position\n    });\n  }\n\n  setCommonDataDictionaryBranch(guid: string, dataDictionaryBranch: Observable<IDataDictionaryBranch>): void {}\n\n  validate(model: IStartEventModel, availableCells: any): Observable<IValidationIssue[]> {\n    const validationIssues: IValidationIssue[] = [];\n\n    const inboundLinks = availableCells.filter((cell) => cell.prop('targetNode') === model.guid);\n\n    if (!isEmpty(inboundLinks)) {\n      validationIssues.push({\n        type: ValidationIssueType.Error,\n        description: this.translateService.instant(\n          'com.bmc.arsys.rx.client.process-designer.elements.start-event.validation.inbound-sequence-flow.message'\n        ),\n        data: {\n          guid: model.guid,\n          inspectorTabIndex: 1\n        }\n      });\n    }\n\n    const outboundLinks = availableCells.filter((cell) => cell.prop('sourceNode') === model.guid);\n\n    if (outboundLinks.length != 1) {\n      validationIssues.push({\n        type: ValidationIssueType.Warning,\n        description: this.translateService.instant(\n          'com.bmc.arsys.rx.client.process-designer.elements.start-event.validation.single-outbound-sequence-flow.message'\n        ),\n        data: {\n          guid: model.guid,\n          inspectorTabIndex: 1\n        }\n      });\n    }\n\n    if (this.rxStringService.isEmptySafe(model.label)) {\n      if (some(availableCells, (cell) => cell.prop('label') === model.label)) {\n        validationIssues.push({\n          type: ValidationIssueType.Error,\n          description: this.translateService.instant(\n            'com.bmc.arsys.rx.client.designer.validation.must-be-unique.message',\n            {\n              propertyName: this.translateService.instant('com.bmc.arsys.rx.client.common.label.label')\n            }\n          ),\n          data: {\n            guid: model.guid,\n            inspectorTabIndex: 1,\n            propertyName: 'label'\n          }\n        });\n      }\n    }\n\n    return of(validationIssues);\n  }\n}\n"]}