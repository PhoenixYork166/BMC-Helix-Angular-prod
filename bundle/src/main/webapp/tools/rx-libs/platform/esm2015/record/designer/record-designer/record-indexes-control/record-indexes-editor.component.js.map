{"version":3,"file":"record-indexes-editor.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/record/designer/record-designer/record-indexes-control/record-indexes-editor.component.ts","../../../../../../../../libs/platform/record/designer/record-designer/record-indexes-control/record-indexes-editor.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  Injector,\n  OnInit,\n  QueryList,\n  ViewChildren\n} from '@angular/core';\nimport { ActiveModalRef, AdaptAccordionTabComponent, DismissReasons, RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { RecordIndexesEditorStore } from './record-indexes-editor.store';\nimport { RxGuidService } from '@helix/platform/utils';\nimport { filter, take } from 'rxjs/operators';\nimport { IFieldState, IIndexEditorState, IIndexesEditorOptions, IIndexState } from './record-indexes-control.types';\nimport { map } from 'lodash';\nimport { IIndexDefinitionModel } from '../../record-designer.types';\nimport { Observable } from 'rxjs';\n\n@Component({\n  selector: 'rx-record-indexes-editor',\n  templateUrl: './record-indexes-editor.component.html',\n  styleUrls: ['./record-indexes-editor.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [RecordIndexesEditorStore]\n})\nexport class RecordIndexesEditorComponent extends RxModalClass implements OnInit, AfterViewInit {\n  @ViewChildren(AdaptAccordionTabComponent, { read: ElementRef })\n  private accordionTabEls: QueryList<ElementRef>;\n\n  isReadOnly = this.activeModalRef.getData().isReadOnly;\n  indexesEditorOptions: IIndexesEditorOptions = this.activeModalRef.getData();\n  vm$: Observable<IIndexEditorState> = this.recordIndexesEditorStore.vm$;\n\n  constructor(\n    private recordIndexesEditorStore: RecordIndexesEditorStore,\n    private rxGuidService: RxGuidService,\n    private activeModalRef: ActiveModalRef,\n    protected injector: Injector\n  ) {\n    super(activeModalRef, injector);\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n\n    this.recordIndexesEditorStore.isDirty$.pipe(filter(Boolean), take(1)).subscribe(() => {\n      this.markAsDirty();\n    });\n\n    this.recordIndexesEditorStore.initialize(this.indexesEditorOptions);\n  }\n\n  ngAfterViewInit(): void {\n    this.accordionTabEls.get(this.indexesEditorOptions.indexToEditIndex)?.nativeElement.scrollIntoView({\n      block: 'nearest'\n    });\n  }\n\n  cancel(): void {\n    this.activeModalRef.dismiss(DismissReasons.CLOSE_BTN);\n  }\n\n  addIndex(): void {\n    this.recordIndexesEditorStore.addIndex({\n      guid: this.rxGuidService.generate(),\n      indexName: null,\n      unique: false,\n      ignoreBlankValues: false,\n      indexFieldIds: [],\n      availableFields: this.indexesEditorOptions.fields\n        .filter((field) => !field.isNewField)\n        .map((field) => ({ ...field, fieldOrder: null }))\n        .sort((a, b) => a.name.localeCompare(b.name)),\n      checkedAvailableFields: [],\n      selectedFields: [],\n      isOpen: true,\n      isAutomaticIndex: false,\n      isMoveToAvailableButtonEnabled: false\n    } as IIndexState);\n  }\n\n  updateIndexUniqueValue(index: IIndexState, unique: boolean): void {\n    this.recordIndexesEditorStore.updateIndex({ ...index, unique });\n  }\n\n  updateIndexIgnoreBlankValue(index: IIndexState, ignoreBlankValues: boolean): void {\n    this.recordIndexesEditorStore.updateIndex({ ...index, ignoreBlankValues });\n  }\n\n  removeIndex(guid: string): void {\n    this.recordIndexesEditorStore.removeIndex(guid);\n  }\n\n  moveToSelected(index: IIndexState): void {\n    this.recordIndexesEditorStore.assignCheckedFields(index);\n  }\n\n  moveToAvailable(index: IIndexState): void {\n    this.recordIndexesEditorStore.unassignCheckedFields(index);\n  }\n\n  onAvailableFieldsChange(checkedFields: IFieldState[], index: IIndexState) {\n    this.recordIndexesEditorStore.checkAvailableFields({ indexGuid: index.guid, checkedFields });\n  }\n\n  onSelectedFieldsChange(fields: IFieldState[], index: IIndexState): void {\n    fields.forEach((field) => {\n      this.recordIndexesEditorStore.toggleSelectedFieldChecked({ indexGuid: index.guid, indexField: field });\n    });\n\n    this.recordIndexesEditorStore.sortSelectedFields({ indexGuid: index.guid, fields });\n  }\n\n  onDragEnd(): void {\n    this.recordIndexesEditorStore.markDirty();\n  }\n\n  onFieldRemove(removedField: IFieldState, index: IIndexState): void {\n    this.recordIndexesEditorStore.removeField({ indexGuid: index.guid, field: removedField });\n  }\n\n  save(): void {\n    this.recordIndexesEditorStore.indexes$.pipe(take(1)).subscribe((indexes: IIndexState[]) => {\n      this.activeModalRef.close(\n        indexes.map(\n          (index) =>\n            ({\n              isAutomaticIndex: index.isAutomaticIndex,\n              indexName: index.indexName,\n              unique: index.unique,\n              ignoreBlankValues: index.ignoreBlankValues,\n              indexFieldIds: map(index.selectedFields, 'id')\n            } as IIndexDefinitionModel)\n        )\n      );\n    });\n  }\n\n  expandAll(): void {\n    this.recordIndexesEditorStore.expandAll();\n  }\n\n  collapseAll(): void {\n    this.recordIndexesEditorStore.collapseAll();\n  }\n\n  trackByIndex($index: number): number {\n    return $index;\n  }\n\n  optionFormatter(field: RxSelectOption): string {\n    return field.name;\n  }\n}\n","<ng-container *ngIf=\"vm$ | async as vm\">\n  <div class=\"designer-modal-body modal-body d-flex mh-100 flex-column\">\n    <adapt-alert\n      class=\"flex-shrink-0\"\n      [config]=\"{\n        content: 'com.bmc.arsys.rx.client.record-designer.indexes.information' | translate,\n        variant: 'info',\n        type: 'inline'\n      }\"\n    ></adapt-alert>\n\n    <div class=\"text-right btn-group\">\n      <button\n        type=\"button\"\n        adapt-button\n        btn-type=\"tertiary\"\n        rx-id=\"add-index-button\"\n        class=\"d-icon-left-plus_circle float-left px-0\"\n        (click)=\"addIndex()\"\n        *ngIf=\"!isReadOnly\"\n      >\n        {{ 'com.bmc.arsys.rx.client.record-designer.indexes.add-index.label' | translate }}\n      </button>\n\n      <button\n        type=\"button\"\n        adapt-button\n        btn-type=\"tertiary\"\n        rx-id=\"expand-button\"\n        (click)=\"expandAll()\"\n        class=\"ml-auto\"\n      >\n        {{ 'com.bmc.arsys.rx.client.common.expand-all.label' | translate }}\n      </button>\n\n      <button\n        type=\"button\"\n        adapt-button\n        btn-type=\"tertiary\"\n        rx-id=\"collapse-button\"\n        class=\"pr-0\"\n        (click)=\"collapseAll()\"\n      >\n        {{ 'com.bmc.arsys.rx.client.common.collapse-all.label' | translate }}\n      </button>\n    </div>\n\n    <div class=\"designer-modal-accordion-wrapper\">\n      <adapt-accordion\n        [multiselect]=\"true\"\n        class=\"d-block\"\n        *ngFor=\"let index of vm.indexes; let $index = index; trackBy: trackByIndex\"\n      >\n        <div class=\"designer-modal-accordion-content\">\n          <adapt-accordion-tab\n            class=\"d-block\"\n            [isOpen]=\"index.isOpen\"\n            (open)=\"index.isOpen = true\"\n            (close)=\"index.isOpen = false\"\n          >\n            <div class=\"card-title-text w-100\">\n              <div class=\"designer-modal-card-title-content\">\n                <div class=\"left-header-block pl-0\">\n                  <div class=\"rx-ellipsis\" [title]=\"index.indexName\" rx-id=\"card-title\">\n                    <span *ngIf=\"!index.isAutomaticIndex\">\n                      {{\n                        index.indexName || 'com.bmc.arsys.rx.client.record-designer.indexes.new-index.label' | translate\n                      }}\n                    </span>\n                    <span *ngIf=\"index.isAutomaticIndex\">{{\n                      'com.bmc.arsys.rx.client.record-designer.indexes.automatic-index.label'\n                        | translate: { indexName: index.indexName }\n                    }}</span>\n                  </div>\n                </div>\n\n                <div class=\"right-header-block\">\n                  <button\n                    class=\"d-icon-left-cross_adapt py-0 pr-3 btn btn-sm\"\n                    adapt-button\n                    size=\"small\"\n                    type=\"button\"\n                    (click)=\"$event.stopPropagation(); removeIndex(index.guid)\"\n                    *ngIf=\"!isReadOnly && !index.isAutomaticIndex\"\n                    rx-id=\"remove-index-button\"\n                  >\n                    {{ 'com.bmc.arsys.rx.client.common.remove.label' | translate }}\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <adapt-rx-checkbox\n              [ngModel]=\"index.unique\"\n              (ngModelChange)=\"updateIndexUniqueValue(index, $event)\"\n              [disabled]=\"isReadOnly || index.isAutomaticIndex\"\n              label=\"{{ 'com.bmc.arsys.rx.client.record-designer.indexes.unique-index-checkbox.label' | translate }}\"\n            >\n            </adapt-rx-checkbox>\n\n            <adapt-rx-checkbox\n              [(ngModel)]=\"index.ignoreBlankValues\"\n              (ngModelChange)=\"updateIndexIgnoreBlankValue(index, $event)\"\n              [disabled]=\"isReadOnly || index.isAutomaticIndex\"\n              label=\"{{ 'com.bmc.arsys.rx.client.record-designer.indexes.ignore-blank-values.label' | translate }}\"\n              [tooltip]=\"{\n                iconName: 'question_circle_o',\n                content: 'com.bmc.arsys.rx.client.record-designer.indexes.ignore-blank-values.tooltip' | translate,\n                placement: 'top',\n                popoverMode: true\n              }\"\n            >\n            </adapt-rx-checkbox>\n\n            <div class=\"d-flex flex-fill\">\n              <adapt-rx-select\n                class=\"flex-grow-1 d-flex flex-column\"\n                popupMaxHeight=\"100%\"\n                [options]=\"index.availableFields\"\n                [ngModel]=\"index.checkedAvailableFields\"\n                [disabled]=\"isReadOnly || index.isAutomaticIndex\"\n                [deselectAllButton]=\"true\"\n                [selectAllButton]=\"true\"\n                [enableFilter]=\"true\"\n                [inline]=\"true\"\n                label=\"{{ 'com.bmc.arsys.rx.client.record-designer.indexes.available-fields.label' | translate }}\"\n                [multiple]=\"true\"\n                [singleSelectStyle]=\"'marker'\"\n                [optionFormatter]=\"optionFormatter\"\n                (ngModelChange)=\"onAvailableFieldsChange($event, index)\"\n                rx-id=\"available-field-list\"\n              ></adapt-rx-select>\n\n              <div class=\"mx-2 d-flex flex-column\">\n                <button\n                  type=\"button\"\n                  adapt-button\n                  class=\"d-icon-right-angle_right mt-auto mb-2\"\n                  btn-type=\"secondary\"\n                  (click)=\"moveToSelected(index)\"\n                  [disabled]=\"!index.checkedAvailableFields.length || index.isAutomaticIndex\"\n                  rx-id=\"move-to-selected-button\"\n                ></button>\n\n                <button\n                  type=\"button\"\n                  adapt-button\n                  class=\"d-icon-right-angle_left mb-auto\"\n                  btn-type=\"secondary\"\n                  (click)=\"moveToAvailable(index)\"\n                  [disabled]=\"!index.isMoveToAvailableButtonEnabled || index.isAutomaticIndex\"\n                  rx-id=\"move-to-available-button\"\n                ></button>\n              </div>\n\n              <adapt-rx-list-builder\n                class=\"flex-grow-1\"\n                [ngModel]=\"index.selectedFields\"\n                selectionMode=\"multiple\"\n                (ngModelChange)=\"onSelectedFieldsChange($event, index)\"\n                (listItemRemove)=\"onFieldRemove($event, index)\"\n                [disabled]=\"isReadOnly || index.isAutomaticIndex\"\n                [hideSearchField]=\"true\"\n                [hideEdit]=\"true\"\n                (dragend)=\"onDragEnd()\"\n                [tooltip]=\"{\n                  iconName: 'question_circle_o',\n                  content: 'com.bmc.arsys.rx.client.record-designer.indexes.selected-fields.tooltip' | translate,\n                  placement: 'top',\n                  popoverMode: true\n                }\"\n                label=\"{{ 'com.bmc.arsys.rx.client.record-designer.indexes.selected-fields.label' | translate }}\"\n                rx-id=\"selected-field-list\"\n              ></adapt-rx-list-builder>\n            </div>\n          </adapt-accordion-tab>\n        </div>\n      </adapt-accordion>\n    </div>\n  </div>\n\n  <div class=\"modal-footer\">\n    <div *ngIf=\"!isReadOnly\">\n      <button\n        class=\"mr-2\"\n        type=\"button\"\n        adapt-button\n        btn-type=\"primary\"\n        rx-id=\"save-button\"\n        (click)=\"save()\"\n        [disabled]=\"!vm.isDirty\"\n      >\n        {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n      </button>\n\n      <button type=\"button\" adapt-button btn-type=\"secondary\" rx-id=\"cancel-button\" (click)=\"cancel()\">\n        {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n      </button>\n    </div>\n\n    <div *ngIf=\"isReadOnly\">\n      <button type=\"button\" adapt-button btn-type=\"secondary\" rx-id=\"close-button\" (click)=\"cancel()\">\n        {{ 'com.bmc.arsys.rx.client.common.close.label' | translate }}\n      </button>\n    </div>\n  </div>\n</ng-container>\n"]}