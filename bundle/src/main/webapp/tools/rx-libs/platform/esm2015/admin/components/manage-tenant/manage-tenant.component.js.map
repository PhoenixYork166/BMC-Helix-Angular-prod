{"version":3,"file":"manage-tenant.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/admin/components/manage-tenant/manage-tenant.component.ts","../../../../../../../libs/platform/admin/components/manage-tenant/manage-tenant.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\nimport { IRecordDefinition, RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { DataPage, IDataPageResult, RxDataPageFactoryService, RxNotificationService } from '@helix/platform/shared/api';\nimport { RX_MODAL, RxModalService } from '@helix/platform/ui-kit';\nimport { IRowDataItem } from '@helix/platform/view/api';\nimport {\n  IRecordGridConfig,\n  IRecordGridDataPageParams,\n  RecordGridComponent,\n  RowSelectionMode\n} from '@helix/platform/view/components';\nimport { noop, omit } from 'lodash';\nimport { Observable, of } from 'rxjs';\nimport { RxTenantService } from './manage-tenant.service';\nimport { ITenant, TenantFields } from './manage-tenant.types';\nimport { TenantEditorComponent } from './tenant-editor/tenant-editor.component';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'rx-admin-manage-tenant',\n  templateUrl: './manage-tenant.component.html'\n})\nexport class ManageTenantAdminComponent implements OnInit {\n  @ViewChild('manageTenantGrid', { static: true })\n  manageTenantGrid: RecordGridComponent;\n\n  manageTenantGridConfig: Observable<IRecordGridConfig>;\n\n  private dataPage: DataPage;\n\n  constructor(\n    private rxDataPageService: RxDataPageFactoryService,\n    private rxTenantService: RxTenantService,\n    private rxModalService: RxModalService,\n    private rxNotificationService: RxNotificationService,\n    private translateService: TranslateService\n  ) {\n    this.dataPage = this.rxDataPageService.withType('com.bmc.arsys.rx.application.tenant.datapage.TenantDataPageQuery');\n  }\n\n  ngOnInit(): void {\n    this.manageTenantGridConfig = of({\n      actionButtons: [\n        {\n          label: this.translateService.instant('com.bmc.arsys.rx.client.common.delete.label'),\n          style: 'tertiary',\n          icon: 'trash',\n          actions: [\n            {\n              name: () => this.deleteTenant()\n            }\n          ]\n        }\n      ],\n      recordIdField: 'name',\n      enableRowSelection: RowSelectionMode.Single,\n      enableFiltering: false,\n      getData: (queryParams: IRecordGridDataPageParams) => this.getData(queryParams),\n      getRecordDefinition: () => of(this.getRecordDefinition()),\n      columns: [\n        {\n          index: 0,\n          title: this.translateService.instant('com.bmc.arsys.rx.client.admin.manage-tenant.tenant.label'),\n          fieldId: TenantFields.Name,\n          clickable: true,\n          sortable: false,\n          actions: [\n            {\n              name: (previousActionResult: any, lastActionRow: IRowDataItem) => this.editTenant(lastActionRow)\n            }\n          ]\n        },\n        {\n          index: 1,\n          title: this.translateService.instant(\n            'com.bmc.arsys.rx.client.admin.manage-tenant.tenant-editor.domain-identifier.label'\n          ),\n          fieldId: TenantFields.DomainIdentifier,\n          sortable: false\n        },\n        {\n          index: 2,\n          title: this.translateService.instant(\n            'com.bmc.arsys.rx.client.admin.manage-tenant.tenant-editor.virtual-host-name.label'\n          ),\n          fieldId: TenantFields.VirtualHostname,\n          sortable: false\n        }\n      ],\n      styles: 'flex-fill'\n    });\n  }\n\n  private getData = (queryParams: IRecordGridDataPageParams): Observable<IDataPageResult> =>\n    this.dataPage.get({ params: omit(queryParams, ['searchText', 'recorddefinition']) });\n\n  private getRecordDefinition(): IRecordDefinition {\n    return {\n      fieldDefinitions: [\n        {\n          id: TenantFields.Name,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: TenantFields.DomainIdentifier,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: TenantFields.VirtualHostname,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        }\n      ]\n    };\n  }\n\n  private refreshManageTenantGrid(): void {\n    this.manageTenantGrid.api.refresh().subscribe();\n  }\n\n  addTenant(): void {\n    const tenantCount = this.manageTenantGrid.adaptTableConfig.data.length;\n\n    if (tenantCount > 0) {\n      this.rxNotificationService.addErrorMessage(\n        this.translateService.instant('com.bmc.arsys.rx.client.admin.manage-tenant.tenant-already-exists.message')\n      );\n    } else {\n      this.openDockedPanel();\n    }\n  }\n\n  private editTenant(selectedTenant: IRowDataItem): void {\n    const selectedTenantName = selectedTenant[TenantFields.Name];\n\n    this.rxTenantService.getTenant(selectedTenantName).subscribe((tenant) => {\n      this.openDockedPanel(tenant);\n    });\n  }\n\n  private openDockedPanel(tenant?: ITenant): void {\n    this.rxModalService\n      .openDockedPanel({\n        title: tenant\n          ? this.translateService.instant('com.bmc.arsys.rx.client.admin.manage-tenant.edit-tenant.label')\n          : this.translateService.instant('com.bmc.arsys.rx.client.admin.manage-tenant.new-tenant.label'),\n        content: TenantEditorComponent,\n        size: 'lg',\n        data: {\n          tenant\n        }\n      })\n      .then(() => {\n        this.refreshManageTenantGrid();\n      })\n      .catch(noop);\n  }\n\n  private deleteTenant(): void {\n    this.rxModalService\n      .confirm({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n        modalStyle: RX_MODAL.modalStyles.warning,\n        message: this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.manage-tenant.delete-confirmation.message'\n        )\n      })\n      .then((result: boolean) => {\n        if (result) {\n          const selectedTenantDefinition = this.manageTenantGrid.api.getFirstSelectedRow();\n\n          this.rxTenantService.deleteTenant(selectedTenantDefinition.name).subscribe(() => {\n            this.rxNotificationService.addSuccessMessage(\n              this.translateService.instant('com.bmc.arsys.rx.client.admin.manage-tenant.tenant-deleted.message')\n            );\n            this.refreshManageTenantGrid();\n          });\n        }\n      });\n  }\n}\n","<rx-admin-settings\n  header=\"{{ 'com.bmc.arsys.rx.client.admin.manage-tenant.tenant-activation.header.title' | translate }}\"\n>\n  <button\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    class=\"d-icon-plus_circle align-self-start\"\n    rx-id=\"new-button\"\n    (click)=\"addTenant()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.new.label' | translate }}\n  </button>\n\n  <rx-record-grid rx-id=\"manage-tenant-grid\" #manageTenantGrid [config]=\"manageTenantGridConfig\"></rx-record-grid>\n</rx-admin-settings>\n"]}