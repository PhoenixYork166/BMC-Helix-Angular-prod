{"version":3,"file":"record-designer-model.reducer.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/record/designer/record-designer/+state/record-designer-model.reducer.ts"],"names":[],"mappings":"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","sourcesContent":["import { ArchiveType, AssociationSelectionType } from '@helix/platform/record/api';\nimport { createReducer, on } from '@ngrx/store';\nimport { chain, isNull, isUndefined } from 'lodash';\nimport { IRecordDefinitionModel, IRecordFieldDefinitionModel } from '../../record-designer.types';\nimport { RX_RECORD_DESIGNER } from '../record-designer.constant';\nimport * as RecordDesignerActions from './record-designer.actions';\nimport { IRecordDesignerModel } from './record-designer.types';\n\nconst initialDefinitionModel: IRecordDefinitionModel = {\n  isArchivingEnabled: false,\n  archiveDescription: null,\n  ageQualifierFieldId: null,\n  ageQualifierInDays: null,\n  archiveRecordDefinitionName: null,\n  archiveType: ArchiveType.None,\n  includeAttachments: null,\n  archiveDataCriteria: null,\n  associationsToFollowForArchive: {\n    selectionType: AssociationSelectionType.FollowParent,\n    specificAssociationNames: []\n  },\n  isAuditingEnabled: false,\n  auditRecordDefinitionName: null,\n  auditDataCriteria: null,\n  associatedAuditFieldsByAssociationName: {},\n  customizationOptions: {\n    allowOverlay: false,\n    allowFieldsOverlay: false,\n    allowIndexesOverlay: false,\n    allowOtherPropertiesOverlay: false,\n    allowPermissionsOverlay: false,\n    fields: [],\n    scope: null\n  },\n  recordInheritanceSelector: {\n    inheritanceOptions: {\n      isSharedInstanceStorage: false,\n      isAbstract: false,\n      isFinal: false\n    },\n    inheritanceDescriptor: {\n      inheritingFrom: null,\n      isInheritingRules: false,\n      isInheritingFieldPermissions: false,\n      isInheritingAssociations: false,\n      isInheritingFieldAuditOptions: false\n    },\n    isInheritingCoreFields: false,\n    inheritedFieldDefinitions: []\n  },\n  recordSearchFields: [],\n  overlayOperation: null,\n  weightedRelevancyTitle: undefined,\n  weightedRelevancyKeywords: undefined,\n  weightedRelevancyEnvironment: undefined,\n  fields: [],\n  indexDefinitions: []\n};\n\nexport const initialState: IRecordDesignerModel = {\n  bundleId: null,\n  definitionName: null,\n  selectedFieldGuid: null,\n  inspectorTabIndex: 0,\n  isDesignMode: true,\n  definitionModel: initialDefinitionModel,\n  definitionModelFromDefinition: initialDefinitionModel,\n  isDirty: false,\n  savedDefinitionName: null\n};\n\nconst reducer = createReducer(\n  initialState,\n\n  on(RecordDesignerActions.init, (state: IRecordDesignerModel, { payload }) => ({\n    ...initialState,\n    bundleId: payload.bundleId,\n    definitionName: payload.definitionName\n  })),\n\n  on(RecordDesignerActions.initDefinitionModel, (state: IRecordDesignerModel, { definitionModelFromDefinition }) => ({\n    ...state,\n    definitionModelFromDefinition,\n    definitionModel: definitionModelFromDefinition\n  })),\n\n  on(\n    RecordDesignerActions.updateDefinitionModelFromDesigner,\n    (state: IRecordDesignerModel, { definitionModelFromDesigner }) => {\n      const updatedDefinitionModel = {\n        ...state.definitionModel,\n        ...definitionModelFromDesigner\n      };\n\n      const inheritedFieldDefinitions = updatedDefinitionModel.recordInheritanceSelector.inheritanceDescriptor\n        ? updatedDefinitionModel.recordInheritanceSelector.inheritedFieldDefinitions\n        : [];\n\n      return {\n        ...state,\n        definitionModel: {\n          ...updatedDefinitionModel,\n          includeAttachments:\n            updatedDefinitionModel.archiveType === RX_RECORD_DESIGNER.archiving.types.deleteSourceRecord.id,\n          fields: chain(updatedDefinitionModel.fields)\n            .differenceBy(inheritedFieldDefinitions, 'id')\n            .concat(inheritedFieldDefinitions)\n            .map((field: IRecordFieldDefinitionModel) => {\n              const searchField = updatedDefinitionModel.recordSearchFields.find(\n                (searchField) => searchField.id === field.id\n              );\n\n              const searchDefinition = searchField\n                ? searchField.searchDefinition\n                : isUndefined(field.searchDefinition)\n                ? undefined\n                : null;\n\n              const customizationOptionField =\n                updatedDefinitionModel.customizationOptions.allowFieldsOverlay &&\n                updatedDefinitionModel.customizationOptions.fields.find(\n                  (customizationOptionsField) => customizationOptionsField.id === field.id\n                );\n\n              return {\n                ...field,\n                searchDefinition,\n                allowOtherPropertiesOverlay: customizationOptionField\n                  ? customizationOptionField.allowOtherPropertiesOverlay\n                  : field.allowOtherPropertiesOverlay,\n                allowPermissionsOverlay: customizationOptionField\n                  ? customizationOptionField.allowPermissionsOverlay\n                  : field.allowPermissionsOverlay,\n                isInherited: field.isCoreField\n                  ? Boolean(updatedDefinitionModel.recordInheritanceSelector.isInheritingCoreFields)\n                  : field.isInherited\n              };\n            })\n            .orderBy('id')\n            .value()\n        }\n      };\n    }\n  ),\n\n  on(RecordDesignerActions.updateSelectedFieldModel, (state: IRecordDesignerModel, { selectedFieldModel }) => {\n    return {\n      ...state,\n      definitionModel: {\n        ...state.definitionModel,\n        fields: state.definitionModel.fields.map((field) => {\n          return field.guid === selectedFieldModel.guid\n            ? { ...selectedFieldModel, copy: selectedFieldModel.audit ? true : selectedFieldModel.copy }\n            : field;\n        })\n      }\n    };\n  }),\n\n  on(RecordDesignerActions.clearSearchFields, (state: IRecordDesignerModel) => ({\n    ...state,\n    definitionModel: {\n      ...state.definitionModel,\n      recordSearchFields: [],\n      fields: state.definitionModel.fields.map((field) => {\n        return {\n          ...field,\n          searchDefinition: isUndefined(field.searchDefinition) ? undefined : null\n        };\n      })\n    }\n  })),\n\n  on(RecordDesignerActions.toggleDesignMode, (state: IRecordDesignerModel) => ({\n    ...state,\n    isDesignMode: !state.isDesignMode\n  })),\n\n  on(RecordDesignerActions.markDesignerPristine, (state: IRecordDesignerModel) => ({\n    ...state,\n    isDirty: false\n  })),\n\n  on(RecordDesignerActions.markDesignerDirty, (state: IRecordDesignerModel) => ({\n    ...state,\n    isDirty: true\n  })),\n\n  on(RecordDesignerActions.setInspectorTabIndex, (state: IRecordDesignerModel, { inspectorTabIndex }) => ({\n    ...state,\n    inspectorTabIndex\n  })),\n\n  on(RecordDesignerActions.setSelectedFieldGuid, (state: IRecordDesignerModel, { guid }) => ({\n    ...state,\n    selectedFieldGuid: guid,\n    inspectorTabIndex: guid && !isNull(state.inspectorTabIndex) ? 1 : state.inspectorTabIndex\n  })),\n\n  on(RecordDesignerActions.clearSelectedFieldGuid, (state: IRecordDesignerModel) => ({\n    ...state,\n    selectedFieldGuid: null,\n    inspectorTabIndex: !isNull(state.inspectorTabIndex) ? 0 : state.inspectorTabIndex\n  })),\n\n  on(RecordDesignerActions.addFieldModel, (state: IRecordDesignerModel, { newFieldModel }) => ({\n    ...state,\n    definitionModel: { ...state.definitionModel, fields: [...state.definitionModel.fields, { ...newFieldModel }] }\n  })),\n\n  on(RecordDesignerActions.addNewFieldModels, (state: IRecordDesignerModel, { newFieldModels }) => ({\n    ...state,\n    definitionModel: { ...state.definitionModel, fields: [...state.definitionModel.fields, ...newFieldModels] },\n    isDirty: true\n  })),\n\n  on(RecordDesignerActions.deleteSelectedFieldSuccess, (state: IRecordDesignerModel) => ({\n    ...state,\n    definitionModel: {\n      ...state.definitionModel,\n      fields: state.definitionModel.fields.filter((field) => field.guid !== state.selectedFieldGuid)\n    }\n  })),\n\n  on(RecordDesignerActions.saveDefinitionSuccess, (state: IRecordDesignerModel, { savedDefinitionName }) => ({\n    ...state,\n    savedDefinitionName\n  })),\n\n  on(RecordDesignerActions.destroy, (state: IRecordDesignerModel) => ({\n    ...initialState\n  }))\n);\n\nexport function recordDesignerModelReducer(state, action) {\n  return reducer(state, action);\n}\n"]}