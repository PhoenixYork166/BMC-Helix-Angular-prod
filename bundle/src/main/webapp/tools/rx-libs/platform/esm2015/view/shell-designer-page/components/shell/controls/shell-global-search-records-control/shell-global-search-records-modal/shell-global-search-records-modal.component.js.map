{"version":3,"file":"shell-global-search-records-modal.component.js","sourceRoot":"","sources":["../../../../../../../../../../../libs/platform/view/shell-designer-page/components/shell/controls/shell-global-search-records-control/shell-global-search-records-modal/shell-global-search-records-modal.component.ts","../../../../../../../../../../../libs/platform/view/shell-designer-page/components/shell/controls/shell-global-search-records-control/shell-global-search-records-modal/shell-global-search-records-modal.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  AfterViewInit,\n  Component,\n  ElementRef,\n  Injector,\n  OnInit,\n  QueryList,\n  ViewChild,\n  ViewChildren\n} from '@angular/core';\nimport { NgForm } from '@angular/forms';\nimport { ActiveModalRef, AdaptAccordionTabComponent, DismissReasons, TreeWrap } from '@bmc-ux/adapt-angular';\nimport {\n  IShellGlobalSearchRecordItem,\n  IShellGlobalSearchRecordsModalConfig,\n  IShellGlobalSearchSelectedItem\n} from './shell-global-search-records-modal.types';\nimport { RxRecordDefinitionDataPageService } from '@helix/platform/record/api';\nimport { IDataPageResult, RxDefinitionNameService } from '@helix/platform/shared/api';\nimport { CdkDragDrop } from '@angular/cdk/drag-drop/drag-events';\nimport { IDefinitionPickerComponentOptions, RxDefinitionPickerType } from '@helix/platform/shared/components';\nimport { IShellGlobalSearchRecord } from '../../../shell-design.types';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { TreeNode } from 'primeng/api/treenode';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { findIndex } from 'lodash';\n\n@Component({\n  selector: 'rx-shell-global-search-records-modal',\n  templateUrl: './shell-global-search-records-modal.component.html',\n  styleUrls: ['./shell-global-search-records-modal.component.scss']\n})\nexport class RxShellGlobalSearchRecordsModalComponent extends RxModalClass implements OnInit, AfterViewInit {\n  @ViewChildren(AdaptAccordionTabComponent, { read: ElementRef })\n  private accordionTabEls: QueryList<ElementRef>;\n\n  @ViewChild('selectedRecordsForm', { read: NgForm, static: true })\n  selectedRecordsForm: NgForm;\n\n  config: IShellGlobalSearchRecordsModalConfig = this.activeModalRef.getData();\n  availableRecordDefinitionItems: IShellGlobalSearchRecordItem[];\n  filteredRecordDefinitionItems: TreeNode<IShellGlobalSearchRecordItem>[] = [];\n  selectedRecords: IShellGlobalSearchSelectedItem[];\n  treeWrap: TreeWrap = TreeWrap.WrapAll;\n  DismissReasons = DismissReasons;\n\n  definitionPickerOptions: IDefinitionPickerComponentOptions = {\n    label: 'Display view when clicked',\n    definitionType: RxDefinitionPickerType.View,\n    required: true\n  };\n\n  constructor(\n    public activeModalRef: ActiveModalRef,\n    private recordDefinitionDataPageService: RxRecordDefinitionDataPageService,\n    private definitionNameService: RxDefinitionNameService,\n    protected injector: Injector\n  ) {\n    super(activeModalRef, injector);\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n\n    this.selectedRecords = this.config.selectedRecords.map((record) => ({\n      ...record,\n      isOpen: record.name === this.config.recordToEdit?.name\n    }));\n\n    this.getRecordDefinitions().subscribe((records) => {\n      this.availableRecordDefinitionItems = records;\n      this.updateFilteredItems();\n    });\n  }\n\n  updateFilteredItems(): void {\n    this.filteredRecordDefinitionItems = this.availableRecordDefinitionItems\n      .filter((item) => !this.selectedRecords.find((record) => record.name === item.name))\n      .map((item) => ({\n        data: item,\n        label: item.definitionName\n      }));\n  }\n\n  addRecord(recordItem: IShellGlobalSearchRecordItem): void {\n    this.markAsDirty();\n    this.selectedRecords.push({ ...recordItem, isOpen: true, view: null });\n    this.updateFilteredItems();\n\n    setTimeout(() => {\n      this.accordionTabEls.last.nativeElement.scrollIntoView({\n        block: 'nearest'\n      });\n    });\n  }\n\n  toggleOpen(expandAll: boolean): void {\n    this.selectedRecords.forEach((record) => (record.isOpen = expandAll));\n  }\n\n  onSelectedRecordsListDrop(event: CdkDragDrop<IShellGlobalSearchRecordItem>): void {\n    this.addRecord(event.item.data);\n  }\n\n  removeRecord(record: IShellGlobalSearchSelectedItem): void {\n    this.markAsDirty();\n\n    this.selectedRecords = this.selectedRecords.filter((item) => item.name !== record.name);\n\n    this.updateFilteredItems();\n  }\n\n  onSave(): void {\n    const result: IShellGlobalSearchRecord[] = this.selectedRecords.map((record) => ({\n      name: record.name,\n      view: record.view,\n      definitionName: record.definitionName\n    }));\n\n    this.activeModalRef.close(result);\n  }\n\n  private getRecordDefinitions(): Observable<IShellGlobalSearchRecordItem[]> {\n    return this.recordDefinitionDataPageService\n      .get({\n        params: {\n          propertySelection: 'name',\n          excludeCustomRecordDefinitions: true\n        }\n      })\n      .pipe(\n        map((result: IDataPageResult) =>\n          result.data.map((record) => ({\n            name: record.name,\n            definitionName: this.definitionNameService.getDisplayName(record.name)\n          }))\n        )\n      );\n  }\n\n  ngAfterViewInit(): void {\n    const selectedRecordIndex = findIndex(this.selectedRecords, 'isOpen');\n\n    if (selectedRecordIndex !== -1) {\n      this.accordionTabEls.toArray()[selectedRecordIndex].nativeElement.scrollIntoView({\n        block: 'nearest'\n      });\n    }\n  }\n}\n","<div class=\"designer-modal-body modal-body d-flex mh-100\">\n  <div class=\"row flex-grow-1 w-100\">\n    <div *ngIf=\"!config.isReadOnly\" class=\"col-4 border-right d-flex flex-column mh-100\">\n      <div class=\"d-flex align-items-start justify-content-between\">\n        <h4 class=\"mt-2\">\n          {{ 'com.bmc.arsys.rx.client.shell.shell-global-search-records.available-records.title' | translate }}\n        </h4>\n      </div>\n\n      <div class=\"rx-card card flex-grow-1 mt-2\">\n        <div class=\"card-block\">\n          <div\n            *ngIf=\"filteredRecordDefinitionItems.length\"\n            cdkDropList\n            cdkDropListSortingDisabled\n            [cdkDropListConnectedTo]=\"['selected-record-items']\"\n          >\n            <adapt-tree\n              [value]=\"filteredRecordDefinitionItems\"\n              filter=\"true\"\n              [wrap]=\"treeWrap\"\n            >\n              <ng-template let-record adaptTreeNodeTemplate>\n                <div\n                  *ngIf=\"record.data\"\n                  class=\"rx-tree-draggable-node\"\n                  cdkDrag\n                  [cdkDragData]=\"record.data\"\n                >\n                  <div (dblclick)=\"addRecord(record.data)\">\n                    <button\n                      type=\"button\"\n                      class=\"rx-button-unstyled d-icon-plus_circle\"\n                      (click)=\"addRecord(record.data)\"\n                    ></button>\n\n                    <span class=\"rx-tree-node-label ml-3\">{{ record.data.definitionName }}</span>\n                  </div>\n                </div>\n              </ng-template>\n            </adapt-tree>\n          </div>\n\n          <div *ngIf=\"!filteredRecordDefinitionItems.length\"\n               class=\"d-flex justify-content-center h-100 align-items-center mt-2\">\n            <adapt-empty-state\n              class=\"w-100\"\n              label=\"{{ 'com.bmc.arsys.rx.client.shell.shell-global-search-records.available-records.empty-state.message' | translate }}\"\n              type=\"search\"\n            ></adapt-empty-state>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"d-flex flex-column mh-100 {{ config.isReadOnly ? 'col' : 'col-8' }}\">\n      <div class=\"d-flex align-items-start justify-content-between\">\n        <h4 class=\"mt-2\">\n          {{ 'com.bmc.arsys.rx.client.shell.shell-global-search-records.record-included-in-search-results.title' | translate }}\n        </h4>\n\n        <div *ngIf=\"selectedRecords.length\" class=\"btn-group\">\n          <button\n            adapt-button\n            btn-type=\"tertiary\"\n            type=\"button\"\n            rx-id=\"expand-all-button\"\n            (click)=\"toggleOpen(true)\"\n          >\n            {{ 'com.bmc.arsys.rx.client.common.expand-all.label' | translate }}\n          </button>\n\n          <button\n            adapt-button\n            btn-type=\"tertiary\"\n            type=\"button\"\n            rx-id=\"collapse-all-button\"\n            (click)=\"toggleOpen(false)\"\n          >\n            {{ 'com.bmc.arsys.rx.client.common.collapse-all.label' | translate }}\n          </button>\n        </div>\n      </div>\n\n      <div\n        id=\"selected-record-items\"\n        class=\"designer-modal-accordion-wrapper\"\n        cdkDropList\n        (cdkDropListDropped)=\"onSelectedRecordsListDrop($event)\"\n      >\n        <adapt-accordion [multiselect]=\"true\">\n          <form #selectedRecordsForm=\"ngForm\">\n            <div\n              *ngFor=\"\n              let record of selectedRecords;\n              let index = index;\n              let first = first;\n              let last = last;\n            \"\n              class=\"designer-modal-accordion-content\"\n              cdkDrag\n              cdkDragLockAxis=\"y\"\n              [cdkDragDisabled]=\"true\"\n            >\n              <adapt-accordion-tab\n                class=\"d-block\"\n                [isOpen]=\"record.isOpen\"\n                (open)=\"record.isOpen = true\"\n                (close)=\"record.isOpen = false\"\n              >\n                <div class=\"card-title-text w-100\">\n                  <div class=\"designer-modal-card-title-content\">\n                    <div class=\"left-header-block pl-0\">\n                      <div class=\"rx-ellipsis\" [title]=\"record.definitionName\" rx-id=\"card-title\">\n                        {{ record.definitionName }}\n                      </div>\n                    </div>\n\n                    <div *ngIf=\"!config.isReadOnly\" class=\"right-header-block\">\n                      <button\n                        class=\"d-icon-left-cross_adapt p-1 pr-4 ml-3\"\n                        adapt-button\n                        size=\"small\"\n                        type=\"button\"\n                        (click)=\"$event.stopPropagation(); removeRecord(record)\"\n                        rx-id=\"remove-button\"\n                      >\n                        {{ 'com.bmc.arsys.rx.client.common.remove.label' | translate }}\n                      </button>\n                    </div>\n                  </div>\n                </div>\n\n                <rx-definition-picker\n                  class=\"d-block w-50\"\n                  [name]=\"'selectedRecordName-' + index\"\n                  required=\"true\"\n                  [isDisabled]=\"config.isReadOnly\"\n                  [options]=\"definitionPickerOptions\"\n                  [(ngModel)]=\"record.view\"\n                  (ngModelChange)=\"markAsDirty()\"\n                ></rx-definition-picker>\n              </adapt-accordion-tab>\n            </div>\n          </form>\n        </adapt-accordion>\n      </div>\n\n      <div *ngIf=\"!selectedRecords.length\" class=\"d-flex justify-content-center h-100 align-items-center mt-2\">\n        <adapt-empty-state\n          class=\"w-100\"\n          label=\"{{ 'com.bmc.arsys.rx.client.shell.shell-global-search-records.record-included-in-search-results.empty-state.message' | translate }}\"\n          type=\"config\"\n        ></adapt-empty-state>\n      </div>\n    </div>\n  </div>\n</div>\n\n<div class=\"modal-footer\">\n  <button\n    *ngIf=\"!config.isReadOnly\"\n    adapt-button\n    btn-type=\"primary\"\n    type=\"button\"\n    rx-id=\"save-button\"\n    [disabled]=\"selectedRecordsForm.form.invalid || !isDirty()\"\n    (click)=\"onSave()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n\n  <button\n    adapt-button\n    btn-type=\"secondary\"\n    type=\"button\"\n    rx-id=\"cancel-button\"\n    (click)=\"activeModalRef.dismiss(DismissReasons.CLOSE_BTN)\"\n  >\n    {{ config.isReadOnly ? ('com.bmc.arsys.rx.client.common.close.label' | translate) : ('com.bmc.arsys.rx.client.common.cancel.label' | translate) }}\n  </button>\n</div>\n"]}