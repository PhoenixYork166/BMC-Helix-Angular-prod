{"version":3,"file":"web-api-mapping.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/connection-mapping/web-api-mapping/web-api-mapping.component.ts","../../../../../../../../libs/platform/admin/components/connection-mapping/web-api-mapping/web-api-mapping.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { RxRecordInstanceDataPageService } from '@helix/platform/record/api';\nimport { IDataPageParams, IDataPageResult, IPlainObject, RxGlobalCacheService } from '@helix/platform/shared/api';\nimport { find, get, uniqBy, values } from 'lodash';\nimport { forkJoin, Observable, Subscription } from 'rxjs';\nimport { RX_CONNECTION_MAPPING } from '../common/connection-mapping.constant';\n\n@Component({\n  selector: 'rx-web-api-mapping',\n  templateUrl: './web-api-mapping.component.html'\n})\nexport class WebApiMappingAdminComponent implements OnInit {\n  mappingSelectOptions: RxSelectOption[] = [];\n  selectedMapping: RxSelectOption;\n  mappingList: IPlainObject[];\n  configurationList: IPlainObject[];\n  busy: Subscription;\n\n  constructor(\n    private rxGlobalCacheService: RxGlobalCacheService,\n    private rxRecordInstanceDataPageService: RxRecordInstanceDataPageService\n  ) {}\n\n  ngOnInit() {\n    this.busy = forkJoin([\n      this.getRecordInstanceDataPage({\n        recorddefinition: RX_CONNECTION_MAPPING.aliasMapping.recordDefinitionName,\n        queryExpression: `'${RX_CONNECTION_MAPPING.aliasMapping.fields.aliasType}'!=\"email\"`,\n        propertySelection: values(RX_CONNECTION_MAPPING.aliasMapping.fields).join()\n      }),\n      this.rxGlobalCacheService.getBundleDescriptors()\n    ]).subscribe(([dataPage, bundleDescriptors]) => {\n      this.mappingSelectOptions = uniqBy(dataPage.data, RX_CONNECTION_MAPPING.aliasMapping.fields.applicationId)\n        .map((mapping: { [fieldId: number]: string }) => ({\n          ...mapping,\n          friendlyName: find(bundleDescriptors, {\n            id: mapping[RX_CONNECTION_MAPPING.aliasMapping.fields.applicationId]\n          }).friendlyName\n        }))\n        .sort((a, b) => a.friendlyName.localeCompare(b.friendlyName));\n    });\n  }\n\n  optionFormatter(application: RxSelectOption): string {\n    return application.friendlyName;\n  }\n\n  private getRecordInstanceDataPage(params: IDataPageParams): Observable<IDataPageResult> {\n    return this.rxRecordInstanceDataPageService.post({ params });\n  }\n\n  onApplicationChange(selectedApplication: RxSelectOption): void {\n    const applicationId = get(selectedApplication, `0.${RX_CONNECTION_MAPPING.aliasMapping.fields.applicationId}`);\n\n    if (applicationId) {\n      forkJoin({\n        configurationList: this.getRecordInstanceDataPage({\n          recorddefinition: RX_CONNECTION_MAPPING.webRequest.recordDefinitionName,\n          propertySelection: values(RX_CONNECTION_MAPPING.webRequest.fields).join()\n        }),\n        applicationMappingList: this.getRecordInstanceDataPage({\n          recorddefinition: RX_CONNECTION_MAPPING.aliasMapping.recordDefinitionName,\n          propertySelection: values(RX_CONNECTION_MAPPING.aliasMapping.fields).join(),\n          queryExpression:\n            `(('${RX_CONNECTION_MAPPING.aliasMapping.fields.applicationId}'=\"${applicationId}\" AND ` +\n            `'${RX_CONNECTION_MAPPING.aliasMapping.fields.aliasType}'=\"${RX_CONNECTION_MAPPING.aliasTypes.webRequest}\"))`\n        })\n      }).subscribe((result) => {\n        this.configurationList = result.configurationList.data;\n        this.mappingList = result.applicationMappingList.data;\n      });\n    }\n  }\n}\n","<rx-admin-settings\n  header=\"{{ 'com.bmc.arsys.rx.client.admin.web-api-mapping.header.title' | translate }}\"\n  [busy]=\"busy\"\n>\n  <div class=\"row\">\n    <adapt-rx-select\n      class=\"col-md-6 form-group\"\n      rx-id=\"application\"\n      label=\"{{ 'com.bmc.arsys.rx.client.common.application.label' | translate }}\"\n      [ngModel]=\"selectedMapping\"\n      [options]=\"mappingSelectOptions\"\n      [optionFormatter]=\"optionFormatter\"\n      (ngModelChange)=\"onApplicationChange($event)\"\n    ></adapt-rx-select>\n  </div>\n\n  <rx-connection-mapping\n    *ngFor=\"let mapping of mappingList\"\n    [configurations]=\"configurationList\"\n    [aliasMapping]=\"mapping\"\n    aliasType=\"webRequest\"\n  >\n  </rx-connection-mapping>\n</rx-admin-settings>\n"]}