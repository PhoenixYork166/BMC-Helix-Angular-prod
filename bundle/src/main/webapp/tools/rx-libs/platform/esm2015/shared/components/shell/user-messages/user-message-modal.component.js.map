{"version":3,"file":"user-message-modal.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/shared/components/shell/user-messages/user-message-modal.component.ts","../../../../../../../../libs/platform/shared/components/shell/user-messages/user-message-modal.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, ElementRef, OnDestroy, OnInit, Renderer2, ViewChild } from '@angular/core';\nimport { RX_USER_MESSAGE } from './user-message.constants';\nimport { ActiveModalRef } from '@bmc-ux/adapt-angular';\nimport { RxUserMessageService } from './user-message.service';\nimport { IRxMessage } from './user-message.interfaces';\nimport { Subscription } from 'rxjs';\nimport { get } from 'lodash';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'rx-user-message-modal',\n  templateUrl: './user-message-modal.component.html',\n  styleUrls: ['./user-message-modal.component.scss', './user-messages.scss']\n})\nexport class RxUserMessageModalComponent implements OnInit, OnDestroy {\n  @ViewChild('scrollableNotifications', { static: true }) scrollableNotifications: ElementRef;\n\n  private messageSubscription: Subscription;\n  loadingInProgress = false;\n  RX_USER_MESSAGE = RX_USER_MESSAGE;\n\n  messages = {\n    active: {\n      type: '',\n      count: 0,\n      list: [] as IRxMessage[],\n      queryExpr: '',\n      loadingInProgress: false\n    },\n    dismissed: {\n      type: '',\n      count: 0,\n      list: [] as IRxMessage[],\n      queryExpr: '',\n      loadingInProgress: false\n    }\n  };\n\n  constructor(\n    public context: ActiveModalRef,\n    private rxUserMessageService: RxUserMessageService,\n    private translateService: TranslateService,\n    private renderer: Renderer2\n  ) {}\n\n  ngOnInit(): void {\n    this.rxUserMessageService.getMessages(RX_USER_MESSAGE.messageTypes.dismissed).subscribe(() => {\n      this.messages = this.rxUserMessageService.userMessageModel.messages;\n    });\n\n    this.messageSubscription = this.rxUserMessageService.messageFetched$.subscribe(() => {\n      const scrollPosition = this.scrollableNotifications\n        ? this.renderer.selectRootElement(this.scrollableNotifications.nativeElement).scrollTop\n        : null;\n\n      if (!scrollPosition || this.loadingInProgress) {\n        this.loadingInProgress = false;\n        this.messages = this.rxUserMessageService.userMessageModel.messages;\n      }\n    });\n  }\n\n  getMoreMessages(messageType: string, event): void {\n    this.loadingInProgress = true;\n    this.rxUserMessageService.getMessages(messageType, true).subscribe();\n    event.stopPropagation();\n  }\n\n  dismissMessage(message: IRxMessage): void {\n    this.rxUserMessageService.dismissNotification(message);\n  }\n\n  getContentTitleText(key: string, count: number): string {\n    let contentTitleText;\n\n    switch (key) {\n      case RX_USER_MESSAGE.messageTypes.active:\n        contentTitleText = 'com.bmc.arsys.rx.client.shell.notification.active.label';\n        break;\n      case RX_USER_MESSAGE.messageTypes.dismissed:\n        contentTitleText = 'com.bmc.arsys.rx.client.shell.notification.dismissed.label';\n        break;\n    }\n\n    return this.translateService.instant(contentTitleText, { count });\n  }\n\n  closeModal() {\n    this.context.close(true);\n  }\n\n  ngOnDestroy(): void {\n    this.messageSubscription.unsubscribe();\n  }\n}\n","<div class=\"modal-header\">\n  <h5 class=\"modal-title\">{{ RX_USER_MESSAGE.title | translate }}</h5>\n  <button class=\"close dp-close\" type=\"button\" (click)=\"context.close(false)\" rx-id=\"x-button\"></button>\n</div>\n\n<div class=\"modal-body\">\n  <div class=\"rx-container\">\n    <div class=\"active-messages\" *ngIf=\"messages.active.count || messages.dismissed.count\" #scrollableNotifications>\n      <div *ngFor=\"let messagesType of messages | keyvalue\">\n        <div class=\"content-title\">\n          {{ getContentTitleText(messagesType.key, messagesType.value.count) }}\n        </div>\n\n        <div *ngIf=\"!messagesType.value.count\" class=\"empty-holder\" [ngSwitch]=\"messagesType.key\">\n          <span *ngSwitchCase=\"RX_USER_MESSAGE.messageTypes.active\">{{\n            'com.bmc.arsys.rx.client.shell.notification.active.noNotifications.label' | translate\n          }}</span>\n          <span *ngSwitchCase=\"RX_USER_MESSAGE.messageTypes.dismissed\">{{\n            'com.bmc.arsys.rx.client.shell.notification.dismissed.noNotifications.label' | translate\n          }}</span>\n        </div>\n\n        <div *ngIf=\"messagesType.value.count\">\n          <div\n            class=\"item\"\n            *ngFor=\"let message of messagesType.value.list\"\n            [ngClass]=\"{ 'item-dismiss': message.dismissInProgress }\"\n          >\n            <div class=\"item-content-section\">\n              <div class=\"item-content-inner-section d-flex align-items-center flex-wrap\">\n                <div class=\"item-icon-section d-icon-bell_o\"></div>\n                <div class=\"item-content-subject font-weight-bold\">{{ message['20000'] }}</div>\n                <div class=\"item-dismiss-section ml-auto\" *ngIf=\"messagesType.key === RX_USER_MESSAGE.messageTypes.active\">\n                  <button\n                    *ngIf=\"!message.dismissInProgress\"\n                    [attr.aria-label]=\"RX_USER_MESSAGE.dismissMessage | translate\"\n                    (click)=\"dismissMessage(message)\"\n                    class=\"close\"\n                    rx-id=\"x-button\"\n                    type=\"button\"\n                  ></button>\n\n                  <div class=\"item-dismiss-preloader\">\n                    <div class=\"d-preloader d-icon-circle_25_o\" *ngIf=\"message.dismissInProgress\"></div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"item-content-text text-break\" [innerHTML]=\"message['20001']\"></div>\n              <div class=\"item-content-date\">\n                {{ message['6'] | date: 'medium' }}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div\n          class=\"content-load-more\"\n          *ngIf=\"loadingInProgress || messagesType.value.count > messagesType.value.list.length\"\n        >\n          <button\n            type=\"button\"\n            *ngIf=\"!loadingInProgress\"\n            adapt-button\n            btn-type=\"tertiary\"\n            size=\"small\"\n            (click)=\"getMoreMessages(messagesType.key, $event)\"\n            rx-id=\"show-more\"\n          >\n            {{ RX_USER_MESSAGE.loadMore | translate }}\n          </button>\n\n          <div class=\"d-preloader d-icon-circle_25_o\" *ngIf=\"loadingInProgress\"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"empty-holder\" *ngIf=\"messages.active.count === 0 && messages.dismissed.count === 0\">\n    {{ RX_USER_MESSAGE.noActiveMessage | translate }}\n  </div>\n</div>\n\n<div class=\"modal-footer\">\n  <adapt-button btn-type=\"primary\" (click)=\"closeModal()\">\n    {{ 'com.bmc.arsys.rx.client.common.close.label' | translate }}\n  </adapt-button>\n</div>\n"]}