{"version":3,"file":"rsso-oauth-configuration.service.js","sourceRoot":"","sources":["../../../../../../../libs/platform/admin/components/rsso-oauth/rsso-oauth-configuration.service.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAE3C,OAAO,EAAE,GAAG,EAAE,MAAM,gBAAgB,CAAC;AACrC,OAAO,EAEL,uBAAuB,EACvB,+BAA+B,EAC/B,oBAAoB,EACpB,6BAA6B,EAC9B,MAAM,4BAA4B,CAAC;AACpC,OAAO,EAAE,aAAa,EAAE,MAAM,uBAAuB,CAAC;;;AAQtD,MAAM,OAAO,+BAA+B;IAC1C,YACU,uBAAgD,EAChD,6BAA4D,EAC5D,+BAAgE;QAFhE,4BAAuB,GAAvB,uBAAuB,CAAyB;QAChD,kCAA6B,GAA7B,6BAA6B,CAA+B;QAC5D,oCAA+B,GAA/B,+BAA+B,CAAiC;IACvE,CAAC;IAEJ,UAAU;QACR,OAAO,IAAI,CAAC,+BAA+B;aACxC,IAAI,CAAC;YACJ,MAAM,EAAE;gBACN,gBAAgB,EAAE,aAAa,CAAC,oBAAoB;gBACpD,eAAe,EAAE,KAAK,oBAAoB,CAAC,YAAY,CAAC,WAAW,MAAM,aAAa,CAAC,6BAA6B,IAAI;gBACxH,iBAAiB,EAAE,CAAC,oBAAoB,CAAC,YAAY,CAAC,EAAE,EAAE,aAAa,CAAC,QAAQ,CAAC,aAAa,CAAC;aAChG;SACF,CAAC;aACD,IAAI,CACH,GAAG,CAAC,CAAC,QAAyB,EAAE,EAAE;YAChC,OAAO,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,iBAAiC,EAAE,EAAE;gBAC7D,OAAO,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,UAAU,GAAG;oBACrD,OAAO,EAAE,EAAE,EAAE,GAAG,EAAE,KAAK,EAAE,iBAAiB,CAAC,GAAG,CAAC,EAAkC,CAAC;gBACpF,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CACH,CAAC;IACN,CAAC;IAED,wBAAwB,CAAC,cAA8B;QACrD,IAAI,cAAc,CAAC,EAAE,EAAE;YACrB,OAAO,IAAI,CAAC,6BAA6B,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;SACnE;aAAM;YACL,OAAO,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;SAC5D;IACH,CAAC;IAED,uBAAuB,CAAC,gBAAwB;QAC9C,IAAI,gBAAgB,EAAE;YACpB,OAAO,IAAI,CAAC,uBAAuB,CAAC,GAAG,CAAC,aAAa,CAAC,oBAAoB,EAAE,gBAAgB,CAAC,CAAC;SAC/F;aAAM;YACL,OAAO,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAAC;SAChF;IACH,CAAC;;4HAzCU,+BAA+B;gIAA/B,+BAA+B,cAF9B,MAAM;2FAEP,+BAA+B;kBAH3C,UAAU;mBAAC;oBACV,UAAU,EAAE,MAAM;iBACnB","sourcesContent":["import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport {\n  RecordInstance,\n  RxRecordInstanceService,\n  RxRecordInstanceDataPageService,\n  RX_RECORD_DEFINITION,\n  RxRecordInstanceUpdateService\n} from '@helix/platform/record/api';\nimport { RX_RSSO_OAUTH } from './rsso-oauth.constant';\nimport { IDataPageResult } from '@helix/platform/shared/api';\nimport { KeyValueObject } from '@bmc-ux/adapt-angular';\nimport { RssoOAuthConfiguration, IRssoOAuthConfigurationField } from './rsso-oauth.types';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RxRssoOAuthConfigurationService {\n  constructor(\n    private rxRecordInstanceService: RxRecordInstanceService,\n    private rxRecordInstanceUpdateService: RxRecordInstanceUpdateService,\n    private rxRecordInstanceDataPageService: RxRecordInstanceDataPageService\n  ) {}\n\n  getConfigs(): Observable<RssoOAuthConfiguration[]> {\n    return this.rxRecordInstanceDataPageService\n      .post({\n        params: {\n          recorddefinition: RX_RSSO_OAUTH.recordDefinitionName,\n          queryExpression: `('${RX_RECORD_DEFINITION.coreFieldIds.description}'=\"${RX_RSSO_OAUTH.oAuthConfigurationDescription}\")`,\n          propertySelection: [RX_RECORD_DEFINITION.coreFieldIds.id, RX_RSSO_OAUTH.fieldIds.oAuthProvider]\n        }\n      })\n      .pipe(\n        map((response: IDataPageResult) => {\n          return response.data.map((rssoConfiguration: KeyValueObject) => {\n            return Object.keys(rssoConfiguration).map(function (key) {\n              return { id: key, value: rssoConfiguration[key] } as IRssoOAuthConfigurationField;\n            });\n          });\n        })\n      );\n  }\n\n  saveConfigRecordInstance(recordInstance: RecordInstance): Observable<any> {\n    if (recordInstance.id) {\n      return this.rxRecordInstanceUpdateService.execute(recordInstance);\n    } else {\n      return this.rxRecordInstanceService.create(recordInstance);\n    }\n  }\n\n  getConfigRecordInstance(recordInstanceId: string): Observable<RecordInstance> {\n    if (recordInstanceId) {\n      return this.rxRecordInstanceService.get(RX_RSSO_OAUTH.recordDefinitionName, recordInstanceId);\n    } else {\n      return this.rxRecordInstanceService.getNew(RX_RSSO_OAUTH.recordDefinitionName);\n    }\n  }\n}\n"]}