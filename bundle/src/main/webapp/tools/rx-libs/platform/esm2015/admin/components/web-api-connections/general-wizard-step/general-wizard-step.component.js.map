{"version":3,"file":"general-wizard-step.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/web-api-connections/general-wizard-step/general-wizard-step.component.ts","../../../../../../../../libs/platform/admin/components/web-api-connections/general-wizard-step/general-wizard-step.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { find, isEqual, cloneDeep } from 'lodash';\nimport { take } from 'rxjs/operators';\n\nimport { RxWizardModalComponent } from '@helix/platform/shared/components';\nimport { RX_WEB_API_CONNECTIONS } from '../web-api-connections.constant';\nimport { IAuthTypeDetails } from '../web-api-connections.interfaces';\n\n@Component({\n  selector: 'rx-general-wizard-step',\n  templateUrl: './general-wizard-step.component.html'\n})\nexport class GeneralWizardStepComponent implements OnInit {\n  context$ = this.rxWizardModalComponent.context$;\n  savedAuthTypeCode: RxSelectOption;\n  savedAuthTypeDetails: IAuthTypeDetails;\n\n  constructor(private rxWizardModalComponent: RxWizardModalComponent) {}\n\n  ngOnInit(): void {\n    this.context$.pipe(take(1)).subscribe((context) => {\n      if (context.isEditMode) {\n        this.rxWizardModalComponent.api.enableNextButton();\n        this.savedAuthTypeCode = context.webApiConnection.authTypeCode;\n        this.savedAuthTypeDetails = context.webApiConnection.authTypeDetails;\n      }\n    });\n  }\n\n  onSelectionChange(selection: RxSelectOption): void {\n    this.context$.pipe(take(1)).subscribe((context) => {\n      if (selection['fieldName'] === 'authTypeCode') {\n        const authTypeId = selection['selection'][0].id;\n        const newWizardSteps = cloneDeep(context.wizardSteps);\n\n        newWizardSteps[1].fields = find(RX_WEB_API_CONNECTIONS.authTypeFields, { id: authTypeId }).fields;\n\n        this.rxWizardModalComponent.api.updateContext({\n          wizardSteps: newWizardSteps\n        });\n\n        if (this.savedAuthTypeCode && isEqual(selection['selection'][0], this.savedAuthTypeCode[0])) {\n          this.rxWizardModalComponent.api.updateContext({\n            webApiConnection: this.savedAuthTypeDetails\n          });\n        } else {\n          const newWebApiConnection = cloneDeep(context.webApiConnection);\n\n          newWebApiConnection.authTypeDetails = {\n            username: '',\n            credentials: '',\n            httpHeaders: [],\n            queryParams: [],\n            tokenFetchMechanism: 0,\n            additionalFormParams: [],\n            grantType: [RX_WEB_API_CONNECTIONS.grantTypeOptions[0]]\n          };\n\n          this.rxWizardModalComponent.api.updateContext({\n            webApiConnection: newWebApiConnection\n          });\n        }\n      }\n    });\n  }\n\n  onFormStatusChange(): void {\n    this.rxWizardModalComponent.context$.pipe(take(1)).subscribe((context) => {\n      if (context.wizardSteps[0].isValid) {\n        this.rxWizardModalComponent.api.enableNextButton();\n\n        if (context.wizardSteps[0].isDirty && context.isEditMode) {\n          this.rxWizardModalComponent.api.enableFinishButton();\n        }\n      } else {\n        this.rxWizardModalComponent.api.disableNextButton();\n      }\n\n      if (context.wizardSteps[0].isDirty) {\n        this.rxWizardModalComponent.api.markDirty();\n      }\n    });\n  }\n}\n","<ng-container *ngIf=\"context$ | async as context\">\n  <rx-web-api-connection-wizard-step-fields\n    [step]=\"context.wizardSteps[0]\"\n    [stepDetails]=\"context.webApiConnection\"\n    (selectionChange)=\"onSelectionChange($event)\"\n    (formStatusChange)=\"onFormStatusChange()\"\n    [webApiConnection]=\"context.webApiConnection\"\n  >\n  </rx-web-api-connection-wizard-step-fields>\n</ng-container>\n"]}