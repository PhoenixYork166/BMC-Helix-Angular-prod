{"version":3,"file":"string-with-type-ahead-filter.component.js","sourceRoot":"","sources":["../../../../../../../../../../libs/platform/view/components/record-grid/common/components/string-with-type-ahead-filter/string-with-type-ahead-filter.component.ts","../../../../../../../../../../libs/platform/view/components/record-grid/common/components/string-with-type-ahead-filter/string-with-type-ahead-filter.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, OnInit } from '@angular/core';\nimport { AdaptFilterControlsComponent, AdvancedFilterOption } from '@bmc-ux/adapt-angular';\nimport {\n  INamedListDefinition,\n  INamedListOption,\n  INamedListOptionPage,\n  RxNamedListDefinitionService,\n  RxNamedListService,\n  NamedListTypeAheadOption\n} from '@helix/platform/named-list/api';\nimport { RxFeatureService } from '@helix/platform/shared/api';\nimport { Observable, of, OperatorFunction } from 'rxjs';\nimport { debounceTime, distinctUntilChanged, finalize, map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { RX_RECORD_GRID } from '../../../record-grid.constant';\nimport { RxRecordGridAdvancedFilterValue } from '../../types/record-grid-advanced-filter-value.class';\nimport { IRecordGridColumnNamedFilterOption } from '../../types/record-grid.types';\n\n@Component({\n  selector: 'rx-string-with-type-ahead-filter',\n  templateUrl: './string-with-type-ahead-filter.component.html',\n  styleUrls: ['./string-with-type-ahead-filter.component.scss']\n})\nexport class RxStringWithTypeAheadFilterComponent implements OnInit {\n  @Input()\n  filterOption: AdvancedFilterOption;\n\n  @Input()\n  filterControlsComponent: AdaptFilterControlsComponent;\n\n  @Input()\n  set filterValue(values: RxRecordGridAdvancedFilterValue<INamedListOption[]>) {\n    this._filterValue = values;\n    this.selectedValues = values?.filterValue || [];\n  }\n\n  get filterValue(): RxRecordGridAdvancedFilterValue<INamedListOption[]> {\n    return this._filterValue;\n  }\n\n  @Input()\n  namedFilterOptions: IRecordGridColumnNamedFilterOption[] = [];\n\n  selectedValues: INamedListOption[] = [];\n  isSearchInProgress = false;\n  typeaheadKeystrokeCount: number;\n  private namedListDefinition$: Observable<INamedListDefinition>;\n  private _filterValue: RxRecordGridAdvancedFilterValue<INamedListOption[]>;\n\n  search: OperatorFunction<string, INamedListOption[]> = (text$: Observable<string>) =>\n    text$.pipe(\n      debounceTime(250),\n      distinctUntilChanged(),\n      tap(() => {\n        this.isSearchInProgress = true;\n      }),\n      switchMap((term) => this.getSelectOptions(term)),\n      finalize(() => {\n        this.isSearchInProgress = false;\n      })\n    );\n\n  constructor(\n    private rxNamedListService: RxNamedListService,\n    private rxNamedListDefinitionService: RxNamedListDefinitionService,\n    private rxFeatureService: RxFeatureService\n  ) {}\n\n  ngOnInit(): void {\n    this.namedListDefinition$ = this.rxNamedListDefinitionService\n      .get(this.filterOption.data.namedListDefinition)\n      .pipe(shareReplay(1));\n\n    this.typeaheadKeystrokeCount =\n      this.filterOption.data.typeaheadKeystrokeCount ?? RX_RECORD_GRID.defaultTypeaheadKeystrokeCount;\n  }\n\n  onValueChange(selectedValues: NamedListTypeAheadOption[]): void {\n    this.filterControlsComponent.onFilterOptionModelChange(\n      new RxRecordGridAdvancedFilterValue(\n        selectedValues.map(\n          (selectedValue: NamedListTypeAheadOption): INamedListOption =>\n            this.rxNamedListService.isNamedListOption(selectedValue)\n              ? (selectedValue as INamedListOption)\n              : ({ displayValue: undefined, value: selectedValue, title: '', contextualFields: [] } as INamedListOption)\n        ),\n        this.filterValue?.namedOptions\n      )\n    );\n  }\n\n  private getSelectOptions(term: string): Observable<INamedListOption[]> {\n    return term.length >= this.typeaheadKeystrokeCount\n      ? this.namedListDefinition$.pipe(\n          switchMap((namedListDefinition: INamedListDefinition) =>\n            this.rxNamedListService\n              .getOptionPageByLabelOrValue(namedListDefinition, term, this.filterOption.data.additionalQueryCriteria)\n              .pipe(map((optionPage: INamedListOptionPage): INamedListOption[] => optionPage.options))\n          )\n        )\n      : of([]);\n  }\n}\n","<rx-named-filter-options-list\n  *ngIf=\"namedFilterOptions?.length\"\n  [namedFilterOptions]=\"namedFilterOptions\"\n  [filterOption]=\"filterOption\"\n  [filterValue]=\"filterValue\"\n  [filterControlsComponent]=\"filterControlsComponent\"\n></rx-named-filter-options-list>\n\n<div style=\"position: relative\">\n  <adapt-tag-field\n    [search]=\"search\"\n    [ngModel]=\"selectedValues\"\n    (ngModelChange)=\"onValueChange($event)\"\n    [replaceModelOnWrite]=\"true\"\n    [selectItemTemplate]=\"selectItemTemplate\"\n    [tagTemplate]=\"tagTemplate\"\n    [openDropdownOnFocus]=\"typeaheadKeystrokeCount === 0\"\n    [placeholder]=\"'com.bmc.arsys.rx.client.view-components.record-grid.filters.typeahead.placeholder' | translate\"\n  ></adapt-tag-field>\n  <div *ngIf=\"isSearchInProgress\" class=\"position-absolute text-info inline-loader\">\n    <div class=\"d-icon-circle_75_o animated infinite spin-360 transition-out slow\"></div>\n  </div>\n</div>\n\n<ng-template #tagTemplate let-tag=\"tag\">\n  {{ tag.displayValue ?? tag.value }}\n</ng-template>\n\n<ng-template #selectItemTemplate let-result=\"result\">\n  {{ result.displayValue ?? result.value }}\n\n  <div\n    *ngIf=\"result.contextualFields\"\n    class=\"text-secondary selection-item-contextual-fields text-truncate\"\n    [title]=\"result.title\"\n  >\n    <span class=\"breadcrumb-item active\" *ngFor=\"let contextualFieldValue of result.contextualFields\">\n      <small> {{ contextualFieldValue }} </small>\n    </span>\n  </div>\n</ng-template>\n"]}