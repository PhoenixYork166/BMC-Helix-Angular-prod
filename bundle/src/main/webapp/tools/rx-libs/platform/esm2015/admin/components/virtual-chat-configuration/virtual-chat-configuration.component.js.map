{"version":3,"file":"virtual-chat-configuration.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/admin/components/virtual-chat-configuration/virtual-chat-configuration.component.ts","../../../../../../../libs/platform/admin/components/virtual-chat-configuration/virtual-chat-configuration.component.html"],"names":[],"mappings":"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","sourcesContent":["import { HttpErrorResponse } from '@angular/common/http';\nimport { Component, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport {\n  IAdminComponentSetting,\n  IAdminComponentSettings,\n  RxAdminSettingsService,\n  RxLiveAgentSettingsService,\n  RxNotificationService,\n  RX_APPLICATION\n} from '@helix/platform/shared/api';\nimport { ConnectionTestStatus, RxModalService, RX_MODAL } from '@helix/platform/ui-kit';\nimport { BaseViewComponent } from '@helix/platform/view/runtime';\nimport { TranslateService } from '@ngx-translate/core';\nimport { find, get, isEmpty, map, values } from 'lodash';\nimport { forkJoin, Observable, Subscription, throwError } from 'rxjs';\nimport { catchError, switchMap, tap } from 'rxjs/operators';\nimport { RxCognitiveServiceService } from '../cognitive-service/cognitive-service.service';\nimport { RX_VIRTUAL_CHAT_CONFIGURATION } from './virtual-chat-configuration.constant';\n\n@Component({\n  selector: 'rx-admin-virtual-chat-configuration',\n  templateUrl: './virtual-chat-configuration.component.html',\n  styleUrls: ['./virtual-chat-configuration.component.scss']\n})\nexport class VirtualChatConfigurationAdminComponent extends BaseViewComponent implements OnInit {\n  busy: Subscription;\n  virtualChatConfigurationForm: FormGroup;\n  virtualChatAdditionalSettingsForm: FormGroup;\n  connectionTestStatus: ConnectionTestStatus = ConnectionTestStatus.Invalid;\n  private isNewVirtualChatSetting = false;\n  private isNewVirtualChatAdditionalSetting = false;\n  private virtualChatComponentSettingsValues: IAdminComponentSetting[] = [];\n  private additionalSettingsComponentSettingsValues: IAdminComponentSetting[] = [];\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private rxAdminSettingsService: RxAdminSettingsService,\n    private rxNotificationService: RxNotificationService,\n    private rxModalService: RxModalService,\n    private rxCognitiveServiceService: RxCognitiveServiceService,\n    private rxLiveAgentSettingsService: RxLiveAgentSettingsService,\n    private translateService: TranslateService\n  ) {\n    super();\n  }\n\n  ngOnInit(): void {\n    this.notifyPropertyChanged('api', {\n      isDirty: () => this.virtualChatConfigurationForm.dirty || this.virtualChatAdditionalSettingsForm.dirty\n    });\n\n    this.virtualChatConfigurationForm = this.formBuilder.group({\n      virtualChatUrl: '',\n      username: '',\n      password: '',\n      systemServerUrl: ''\n    });\n\n    this.virtualChatAdditionalSettingsForm = this.formBuilder.group({\n      administratorKey: '',\n      company: ''\n    });\n\n    this.busy = forkJoin({\n      virtualChatComponentSettings: this.getVirtualChatComponentSettings(),\n      additionalSettingsComponentSettings: this.getAdditionalSettingsComponentSettings()\n    }).subscribe((response) => {\n      this.isNewVirtualChatSetting = !get(response.virtualChatComponentSettings, 'values', []).length;\n      this.isNewVirtualChatAdditionalSetting = !get(response.additionalSettingsComponentSettings, 'values', []).length;\n\n      if (this.isNewVirtualChatSetting) {\n        this.virtualChatComponentSettingsValues = map(\n          values(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChat.settingNames),\n          (settingName: string) => ({\n            assigneeGroupPermission: null,\n            componentName: RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatConfigName,\n            settingId: null,\n            settingName: settingName,\n            settingValue: null,\n            ownerKeyValue1: null\n          })\n        );\n      } else {\n        this.virtualChatComponentSettingsValues = response.virtualChatComponentSettings.values;\n      }\n\n      if (this.isNewVirtualChatAdditionalSetting) {\n        this.additionalSettingsComponentSettingsValues = map(\n          values(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatAdditionalSetting.settingNames),\n          (settingName: string) => ({\n            assigneeGroupPermission: null,\n            componentName: RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatAdditionalSettingsName,\n            ownerKeyValue1: null,\n            settingId: null,\n            settingName: settingName,\n            settingValue: null\n          })\n        );\n      } else {\n        this.additionalSettingsComponentSettingsValues = response.additionalSettingsComponentSettings.values;\n      }\n\n      this.virtualChatConfigurationForm.patchValue({\n        virtualChatUrl: this.getValueFromVirtualSetting(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChat.settingNames.url),\n        username: this.getValueFromVirtualSetting(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChat.settingNames.userName),\n        password: this.getValueFromVirtualSetting(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChat.settingNames.password),\n        systemServerUrl: this.getValueFromVirtualSetting(\n          RX_VIRTUAL_CHAT_CONFIGURATION.virtualChat.settingNames.arServerUrl\n        )\n      });\n\n      this.virtualChatAdditionalSettingsForm.patchValue({\n        administratorKey: this.getValueFromAdditionalSetting(\n          RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatAdditionalSetting.settingNames.adminKey\n        ),\n        company: this.getValueFromAdditionalSetting(\n          RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatAdditionalSetting.settingNames.company\n        )\n      });\n    });\n\n    this.virtualChatConfigurationForm.valueChanges.subscribe(() => {\n      this.connectionTestStatus =\n        this.virtualChatConfigurationForm.pristine || this.virtualChatConfigurationForm.invalid\n          ? ConnectionTestStatus.Invalid\n          : ConnectionTestStatus.Unknown;\n    });\n  }\n\n  private getVirtualChatComponentSettings(): Observable<IAdminComponentSettings> {\n    return this.rxAdminSettingsService.getComponentSettings(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatConfigName, {\n      'default-bundle-scope': RX_APPLICATION.settingsBundleId\n    });\n  }\n\n  private getAdditionalSettingsComponentSettings(): Observable<IAdminComponentSettings> {\n    return this.rxAdminSettingsService.getComponentSettings(\n      RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatAdditionalSettingsName,\n      {\n        'default-bundle-scope': RX_APPLICATION.settingsBundleId\n      }\n    );\n  }\n\n  private getValueFromAdditionalSetting(settingName: string): string {\n    return get(\n      find(this.additionalSettingsComponentSettingsValues, {\n        settingName\n      }),\n      'settingValue',\n      null\n    );\n  }\n\n  private getValueFromVirtualSetting(settingName: string): string {\n    return get(\n      find(this.virtualChatComponentSettingsValues, {\n        settingName\n      }),\n      'settingValue',\n      null\n    );\n  }\n\n  onTestConnection(): void {\n    const formValue = this.virtualChatConfigurationForm.getRawValue();\n\n    this.rxCognitiveServiceService\n      .testConnection({\n        resourceType: RX_VIRTUAL_CHAT_CONFIGURATION.pingLiveChatServiceCommand,\n        remedyMidTierUrl: formValue.virtualChatUrl,\n        arAdministratorUser: formValue.username,\n        arAdministratorPassword: formValue.password,\n        arSystemServerUrl: formValue.systemServerUrl\n      })\n      .pipe(\n        catchError((error: HttpErrorResponse) => {\n          this.connectionTestStatus = ConnectionTestStatus.Failed;\n\n          return throwError(error);\n        })\n      )\n      .subscribe(() => {\n        this.connectionTestStatus = ConnectionTestStatus.Passed;\n      });\n  }\n\n  isSaveButtonDisabled(): boolean {\n    return (\n      this.virtualChatConfigurationForm.pristine ||\n      this.virtualChatConfigurationForm.invalid ||\n      this.connectionTestStatus !== ConnectionTestStatus.Passed\n    );\n  }\n\n  private setVirtualSettingValue(settingName: string, value: string): void {\n    find(this.virtualChatComponentSettingsValues, {\n      settingName\n    }).settingValue = value;\n  }\n\n  saveVirtualChatConfig(): void {\n    let adminSetting$: Observable<any>;\n    const formValue = this.virtualChatConfigurationForm.getRawValue();\n\n    this.setVirtualSettingValue(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChat.settingNames.url, formValue.virtualChatUrl);\n    this.setVirtualSettingValue(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChat.settingNames.userName, formValue.username);\n    this.setVirtualSettingValue(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChat.settingNames.password, formValue.password);\n    this.setVirtualSettingValue(\n      RX_VIRTUAL_CHAT_CONFIGURATION.virtualChat.settingNames.arServerUrl,\n      formValue.systemServerUrl\n    );\n\n    if (this.isNewVirtualChatSetting) {\n      adminSetting$ = this.rxAdminSettingsService\n        .createComponentSettings(\n          RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatConfigName,\n          this.virtualChatComponentSettingsValues\n        )\n        .pipe(\n          switchMap(() => this.getVirtualChatComponentSettings()),\n          tap((response) => {\n            this.isNewVirtualChatSetting = false;\n            this.virtualChatComponentSettingsValues = response.values;\n          })\n        );\n    } else {\n      adminSetting$ = this.rxAdminSettingsService.updateComponentSettings(\n        `${RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatConfigName}/${this.virtualChatComponentSettingsValues[0].ownerKeyValue1}`,\n        this.virtualChatComponentSettingsValues\n      );\n    }\n\n    this.busy = adminSetting$.subscribe(() => {\n      this.rxNotificationService.addSuccessMessage(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatConfigurationSaved);\n      this.connectionTestStatus = ConnectionTestStatus.Invalid;\n      this.virtualChatConfigurationForm.markAsPristine();\n      this.rxLiveAgentSettingsService.getAvailableTopics();\n    });\n  }\n\n  private setAdditionalSettingValue(settingName: string, value: string): void {\n    find(this.additionalSettingsComponentSettingsValues, {\n      settingName\n    }).settingValue = value;\n  }\n\n  saveAdditionalSettings(): void {\n    let adminSetting$: Observable<any>;\n    const formValue = this.virtualChatAdditionalSettingsForm.getRawValue();\n\n    this.setAdditionalSettingValue(\n      RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatAdditionalSetting.settingNames.adminKey,\n      formValue.administratorKey\n    );\n    this.setAdditionalSettingValue(\n      RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatAdditionalSetting.settingNames.company,\n      formValue.company\n    );\n\n    if (this.isNewVirtualChatAdditionalSetting) {\n      adminSetting$ = this.rxAdminSettingsService\n        .createComponentSettings(\n          RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatAdditionalSettingsName,\n          this.additionalSettingsComponentSettingsValues\n        )\n        .pipe(\n          switchMap(() => this.getAdditionalSettingsComponentSettings()),\n          tap((response) => {\n            this.isNewVirtualChatAdditionalSetting = false;\n            this.additionalSettingsComponentSettingsValues = response.values;\n          })\n        );\n    } else {\n      adminSetting$ = this.rxAdminSettingsService.updateComponentSettings(\n        `${RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatAdditionalSettingsName}/${this.additionalSettingsComponentSettingsValues[0].ownerKeyValue1}`,\n        this.additionalSettingsComponentSettingsValues\n      );\n    }\n\n    this.busy = adminSetting$.subscribe(() => {\n      this.virtualChatAdditionalSettingsForm.markAsPristine();\n      this.rxNotificationService.addSuccessMessage(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatConfigurationSaved);\n\n      this.rxLiveAgentSettingsService.getAvailableTopics().subscribe((topics) => {\n        if (isEmpty(topics)) {\n          this.rxNotificationService.addWarningMessage(RX_VIRTUAL_CHAT_CONFIGURATION.virtualChatVerifyAdministratorKey);\n        }\n      });\n    });\n  }\n}\n","<rx-admin-settings\n  header=\"{{ 'com.bmc.arsys.rx.client.admin.virtual-chat-configuration.header.title' | translate }}\"\n  [busy]=\"busy\"\n>\n  <adapt-accordion multiselect=\"true\" class=\"pb-4\">\n    <form [formGroup]=\"virtualChatConfigurationForm\">\n      <adapt-accordion-tab title=\"Authentication\" isOpen=\"true\" rx-id=\"authentication\">\n        <adapt-rx-textfield\n          rx-id=\"virtual-chat-url\"\n          label=\"{{\n            'com.bmc.arsys.rx.client.admin.tone-analysis-testing.bmc-remedy-virtual-chat-api-endpoint-url.label'\n              | translate\n          }}\"\n          formControlName=\"virtualChatUrl\"\n          maxlength=\"254\"\n          required=\"true\"\n          class=\"d-block form-group\"\n        >\n        </adapt-rx-textfield>\n        <adapt-rx-textfield\n          rx-id=\"administrator-user\"\n          label=\"{{ 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.ar-administrator-user.label' | translate }}\"\n          formControlName=\"username\"\n          maxlength=\"254\"\n          required=\"true\"\n          class=\"d-block form-group\"\n        >\n        </adapt-rx-textfield>\n        <adapt-rx-textfield\n          rx-id=\"administrator-password\"\n          label=\"{{\n            'com.bmc.arsys.rx.client.admin.tone-analysis-testing.ar-administrator-password.label' | translate\n          }}\"\n          formControlName=\"password\"\n          maxlength=\"254\"\n          required=\"true\"\n          [isPassword]=\"true\"\n          class=\"d-block form-group\"\n        >\n        </adapt-rx-textfield>\n        <adapt-rx-textfield\n          rx-id=\"system-server-url\"\n          label=\"{{\n            'com.bmc.arsys.rx.client.admin.tone-analysis-testing.ar-system-server-api-endpoint-url.label' | translate\n          }}\"\n          formControlName=\"systemServerUrl\"\n          maxlength=\"254\"\n          required=\"true\"\n          class=\"d-block form-group\"\n        >\n        </adapt-rx-textfield>\n\n        <div class=\"d-flex justify-content-start\">\n          <rx-connection-tester\n            buttonType=\"secondary\"\n            [status]=\"connectionTestStatus\"\n            (testConnection)=\"onTestConnection()\"\n            rx-id=\"virtual-chat-configuration-test-button\"\n          ></rx-connection-tester>\n          <button\n            adapt-button\n            class=\"ml-4 mr-2\"\n            btn-type=\"primary\"\n            type=\"button\"\n            rx-id=\"save-button\"\n            [disabled]=\"isSaveButtonDisabled()\"\n            (click)=\"saveVirtualChatConfig()\"\n          >\n            {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n          </button>\n        </div>\n      </adapt-accordion-tab>\n    </form>\n\n    <form [formGroup]=\"virtualChatAdditionalSettingsForm\">\n      <adapt-accordion-tab title=\"Additional settings\" rx-id=\"additional-settings\" class=\"d-block\">\n        <adapt-rx-textfield\n          rx-id=\"administrator-key\"\n          label=\"{{ 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.administrator-key.label' | translate }}\"\n          formControlName=\"administratorKey\"\n          class=\"d-block form-group\"\n          [tooltip]=\"{\n            iconName: 'question_circle_o',\n            content: 'com.bmc.arsys.rx.client.admin.virtual-chat-configuration.administrator-key.tooltip' | translate,\n            placement: 'right',\n            popoverMode: true\n          }\"\n        >\n        </adapt-rx-textfield>\n        <adapt-rx-textfield rx-id=\"company\" label=\"Company\" formControlName=\"company\" class=\"d-block form-group\">\n        </adapt-rx-textfield>\n\n        <div class=\"d-flex justify-content-start\">\n          <button\n            adapt-button\n            class=\"mr-2\"\n            btn-type=\"primary\"\n            type=\"button\"\n            rx-id=\"additional-settings-save-button\"\n            [disabled]=\"virtualChatAdditionalSettingsForm.pristine || virtualChatAdditionalSettingsForm.invalid\"\n            (click)=\"saveAdditionalSettings()\"\n          >\n            {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n          </button>\n        </div>\n      </adapt-accordion-tab>\n    </form>\n  </adapt-accordion>\n</rx-admin-settings>\n"]}