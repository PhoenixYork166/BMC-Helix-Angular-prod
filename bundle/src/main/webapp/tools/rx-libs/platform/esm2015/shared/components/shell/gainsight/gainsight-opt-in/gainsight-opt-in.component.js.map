{"version":3,"file":"gainsight-opt-in.component.js","sourceRoot":"","sources":["../../../../../../../../../libs/platform/shared/components/shell/gainsight/gainsight-opt-in/gainsight-opt-in.component.ts","../../../../../../../../../libs/platform/shared/components/shell/gainsight/gainsight-opt-in/gainsight-opt-in.component.html"],"names":[],"mappings":"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","sourcesContent":["import { ChangeDetectionStrategy, Component, OnDestroy } from '@angular/core';\nimport { ActiveModalRef, AdaptAgreementState } from '@bmc-ux/adapt-angular';\nimport { RxGainsightUserPreferencesService } from '../gainsight-user-preferences.service';\nimport { catchError, filter, map, shareReplay, switchMap, take, tap } from 'rxjs/operators';\nimport { IGainsightUserPreferences } from '../gainsight.types';\nimport { RxNotificationService } from '@helix/platform/shared/api';\nimport { TranslateService } from '@ngx-translate/core';\nimport { BehaviorSubject, combineLatest, of, throwError } from 'rxjs';\n\n@Component({\n  selector: 'rx-gainsight-opt-in',\n  templateUrl: './gainsight-opt-in.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GainsightOptInComponent implements OnDestroy {\n  isQueryInProgress = true;\n  isSaveButtonDisabled = true;\n  private accountPerformance: boolean;\n\n  private isSaveInProgressSubject = new BehaviorSubject<boolean>(false);\n\n  private gainsightUserPreferences$ = this.rxGainsightUserPreferencesService.getGainsightUserPreferences().pipe(\n    take(1),\n    catchError(() => {\n      this.cancel();\n\n      this.rxNotificationService.addWarningMessage(\n        this.translateService.instant('com.bmc.arsys.rx.client.gainsight.user-profile-not-created.message')\n      );\n\n      return of(null);\n    }),\n    shareReplay(1)\n  );\n\n  state$ = this.gainsightUserPreferences$.pipe(\n    tap(() => {\n      this.isQueryInProgress = false;\n    }),\n    filter((gainsightUserPreferences) => Boolean(gainsightUserPreferences)),\n    map((gainsightUserPreferences: IGainsightUserPreferences) => ({\n      accountPerformance: gainsightUserPreferences.trackUsage != false,\n      accountMarketing: false\n    }))\n  );\n\n  vm$ = combineLatest([this.state$, this.isSaveInProgressSubject]).pipe(\n    map(([state, isSaveInProgress]) => ({\n      state,\n      isSaveInProgress\n    }))\n  );\n\n  constructor(\n    private activeModalRef: ActiveModalRef,\n    private rxGainsightUserPreferencesService: RxGainsightUserPreferencesService,\n    private translateService: TranslateService,\n    private rxNotificationService: RxNotificationService\n  ) {}\n\n  handleStateChange(state: AdaptAgreementState): void {\n    this.isSaveButtonDisabled = false;\n    this.accountPerformance = state.accountPerformance;\n  }\n\n  cancel(): void {\n    this.activeModalRef.dismiss();\n  }\n\n  save(): void {\n    this.isSaveInProgressSubject.next(true);\n\n    this.gainsightUserPreferences$\n      .pipe(\n        take(1),\n        map((gainsightUserPreferences: IGainsightUserPreferences) => ({\n          ...gainsightUserPreferences,\n          trackUsage: this.accountPerformance\n        })),\n        switchMap((gainsightUserPreferences: IGainsightUserPreferences) =>\n          this.rxGainsightUserPreferencesService.saveGainsightUserPreferences(gainsightUserPreferences)\n        ),\n        catchError((error) => {\n          this.isSaveInProgressSubject.next(false);\n\n          return throwError(error);\n        })\n      )\n      .subscribe(\n        () => {\n          this.rxNotificationService.addSuccessMessage(\n            this.translateService.instant('com.bmc.arsys.rx.client.gainsight.user-preferences-saved.success.message')\n          );\n\n          this.isSaveInProgressSubject.next(false);\n          this.activeModalRef.close();\n        },\n        () =>\n          this.rxNotificationService.addErrorMessage(\n            this.translateService.instant('com.bmc.arsys.rx.client.gainsight.user-profile-not-updated.message')\n          )\n      );\n  }\n\n  ngOnDestroy(): void {\n    this.isSaveInProgressSubject.complete();\n  }\n}\n","<rx-line-loader\n  *ngIf=\"isQueryInProgress\"\n  [loaderMessage]=\"'com.bmc.arsys.rx.client.common.loading-data' | translate\"\n></rx-line-loader>\n\n<ng-container class=\"p-0\" *ngIf=\"vm$ | async as vm\">\n  <div [hidden]=\"isQueryInProgress\" class=\"modal-body\">\n    <adapt-agreement-card\n      (stateChange)=\"handleStateChange($event)\"\n      [showShadow]=\"false\"\n      [showMarketingSection]=\"false\"\n      [state]=\"vm.state\"\n      rx-id=\"gainsight-agreement\"\n    >\n    </adapt-agreement-card>\n  </div>\n\n  <div class=\"modal-footer\">\n    <button\n      type=\"button\"\n      class=\"btn btn-primary\"\n      (click)=\"save()\"\n      rx-id=\"save-button\"\n      [disabled]=\"isSaveButtonDisabled || vm.isSaveInProgress\"\n      [adaptInlineLoader]=\"vm.isSaveInProgress\"\n    >\n      {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n    </button>\n\n    <button type=\"button\" class=\"btn btn-secondary\" (click)=\"cancel()\" rx-id=\"cancel-button\">\n      {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n    </button>\n  </div>\n</ng-container>\n"]}