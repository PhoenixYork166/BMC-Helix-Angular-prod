{"version":3,"file":"user-availability.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/shared/components/user-availability/user-availability.component.ts","../../../../../../../libs/platform/shared/components/user-availability/user-availability.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component } from '@angular/core';\nimport { RxCurrentUserService, RxNotificationService } from '@helix/platform/shared/api';\nimport { ActiveModalRef } from '@bmc-ux/adapt-angular';\nimport {\n  RecordInstance,\n  RX_RECORD_DEFINITION,\n  RxRecordInstanceDataPageService,\n  RxRecordInstanceService,\n  RxRecordInstanceUpdateService\n} from '@helix/platform/record/api';\nimport { RX_USER_AVAILABILITY } from './user-availability.constants';\nimport { finalize, switchMap, tap } from 'rxjs/operators';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'rx-user-availability',\n  templateUrl: './user-availability.component.html'\n})\nexport class RxUserAvailabilityComponent {\n  isUserAvailableForAssignment = this.rxCurrentUserService.isAvailableForAssignment();\n  isSaveInProgress = false;\n\n  constructor(\n    private rxCurrentUserService: RxCurrentUserService,\n    private activeModalRef: ActiveModalRef,\n    private rxRecordInstanceDataPageService: RxRecordInstanceDataPageService,\n    private rxRecordInstanceService: RxRecordInstanceService,\n    private rxRecordInstanceUpdateService: RxRecordInstanceUpdateService,\n    private rxNotificationService: RxNotificationService,\n    private translateService: TranslateService\n  ) {}\n\n  updateAssignmentAvailability(): void {\n    this.isSaveInProgress = true;\n\n    this.rxRecordInstanceDataPageService\n      .post({\n        params: {\n          recorddefinition: RX_USER_AVAILABILITY.ctmPeople.recordDefinitionName,\n          queryExpression:\n            \"('\" +\n            RX_USER_AVAILABILITY.ctmPeople.fieldIds.loginName +\n            '\\' = \"' +\n            this.rxCurrentUserService.getName() +\n            '\")',\n          propertySelection: [RX_RECORD_DEFINITION.coreFieldIds.id]\n        }\n      })\n      .pipe(\n        switchMap((dataPageResult) =>\n          this.rxRecordInstanceService.get(\n            RX_USER_AVAILABILITY.ctmPeople.recordDefinitionName,\n            dataPageResult.data[0][RX_RECORD_DEFINITION.coreFieldIds.id]\n          )\n        ),\n        tap((recordInstance: RecordInstance) =>\n          recordInstance.setFieldValue(\n            RX_USER_AVAILABILITY.ctmPeople.fieldIds.assignmentAvailability,\n            this.isUserAvailableForAssignment ? '0' : '1'\n          )\n        ),\n        switchMap((recordInstance: RecordInstance) => this.rxRecordInstanceUpdateService.execute(recordInstance)),\n        finalize(() => (this.isSaveInProgress = false))\n      )\n      .subscribe(() => {\n        this.rxCurrentUserService.setAssignmentAvailability(this.isUserAvailableForAssignment);\n        this.activeModalRef.close();\n\n        this.rxNotificationService.addSuccessMessage(\n          this.translateService.instant(\n            'com.bmc.arsys.rx.client.shell.my-availability-dialog.available-for-assignment-saved.message'\n          )\n        );\n      });\n  }\n\n  cancel(): void {\n    this.activeModalRef.close();\n  }\n}\n","<div class=\"modal-body\">\n  <form name=\"userAvailabilityForm\" novalidate #userAvailabilityForm=\"ngForm\">\n    <adapt-rx-checkbox\n      class=\"d-block form-group\"\n      rx-id=\"user-availability\"\n      name=\"userAvailability\"\n      [(ngModel)]=\"isUserAvailableForAssignment\"\n      label=\"{{ 'com.bmc.arsys.rx.client.shell.my-availability-dialog.available-for-assignment.label' | translate }}\"\n    ></adapt-rx-checkbox>\n  </form>\n</div>\n\n<div class=\"modal-footer\">\n  <button\n    type=\"button\"\n    class=\"btn btn-primary btn-sm\"\n    [disabled]=\"this.isSaveInProgress || !userAvailabilityForm.dirty\"\n    (click)=\"updateAssignmentAvailability()\"\n    rx-id=\"save-button\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.apply.label' | translate }}\n  </button>\n  <button type=\"button\" class=\"btn btn-secondary btn-sm\" (click)=\"cancel()\" rx-id=\"cancel-button\">\n    {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n  </button>\n</div>\n"]}