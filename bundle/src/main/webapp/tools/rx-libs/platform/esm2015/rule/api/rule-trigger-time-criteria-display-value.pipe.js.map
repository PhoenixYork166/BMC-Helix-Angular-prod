{"version":3,"file":"rule-trigger-time-criteria-display-value.pipe.js","sourceRoot":"","sources":["../../../../../../libs/platform/rule/api/rule-trigger-time-criteria-display-value.pipe.ts"],"names":[],"mappings":"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","sourcesContent":["import { Pipe, PipeTransform } from '@angular/core';\nimport moment from 'moment-es6';\nimport { chain, compact, sortBy, startCase, toLower } from 'lodash';\nimport { RX_RULE_DEFINITION } from './rule-definition.constant';\nimport { IIntervalTimeCriteria, IScheduleTimeCriteria } from './rule-definition.types';\n\n@Pipe({\n  name: 'rxRuleTriggerTimeCriteriaDisplayValue'\n})\nexport class RxRuleTriggerTimeCriteriaDisplayValuePipe implements PipeTransform {\n  transform(ruleTriggerTimeCriteria: IIntervalTimeCriteria | IScheduleTimeCriteria): string {\n    let displayValue;\n\n    switch (ruleTriggerTimeCriteria.resourceType) {\n      case RX_RULE_DEFINITION.ruleElementResourceTypes.intervalTime:\n        displayValue = this.buildIntervalTimeDisplayValue(ruleTriggerTimeCriteria as IIntervalTimeCriteria);\n        break;\n      case RX_RULE_DEFINITION.ruleElementResourceTypes.scheduleTime:\n        displayValue = this.buildScheduleTimeDisplayValue(ruleTriggerTimeCriteria as IScheduleTimeCriteria);\n        break;\n      default:\n        displayValue = '';\n    }\n\n    return displayValue;\n  }\n\n  private buildIntervalTimeDisplayValue(intervalTimeCriteria: IIntervalTimeCriteria): string {\n    const displayValueParts = [];\n\n    function buildDisplayValuePart(value: number, singularUnit: string, pluralUnit: string): string {\n      return value ? `${value} ${value > 1 ? pluralUnit : singularUnit}` : '';\n    }\n\n    displayValueParts.push(buildDisplayValuePart(intervalTimeCriteria.days, 'day', 'days'));\n    displayValueParts.push(buildDisplayValuePart(intervalTimeCriteria.hours, 'hour', 'hours'));\n    displayValueParts.push(buildDisplayValuePart(intervalTimeCriteria.minutes, 'minute', 'minutes'));\n\n    return `Every ${compact(displayValueParts).join(', ')}`;\n  }\n\n  private buildScheduleTimeDisplayValue(scheduleTimeCriteria: IScheduleTimeCriteria): string {\n    const weekDayOrderIds = {\n      Monday: 1,\n      Tuesday: 2,\n      Wednesday: 3,\n      Thursday: 4,\n      Friday: 5,\n      Saturday: 6,\n      Sunday: 7\n    };\n\n    function enumerateValues(values: (string | number)[]): string {\n      const trailingValue = values.length > 1 ? ` and ${values.pop()}` : '';\n\n      return `${values.join(', ')}${trailingValue}`;\n    }\n\n    const formattedWeekDays = chain(scheduleTimeCriteria.weekDays)\n      .map(toLower)\n      .map(startCase)\n      .sortBy((weekDay) => weekDayOrderIds[weekDay])\n      .value();\n\n    const formattedTime = sortBy(scheduleTimeCriteria.hours).map((hour) =>\n      moment(`${hour}:${scheduleTimeCriteria.minute}`, ['H:mm'], 'en').format('h:mmA')\n    );\n\n    const monthDaysPart = scheduleTimeCriteria.monthDays?.length\n      ? `On dates ${enumerateValues(sortBy(scheduleTimeCriteria.monthDays))} of every month`\n      : '';\n\n    const weekDaysPart = scheduleTimeCriteria.weekDays?.length\n      ? `${monthDaysPart ? ', and every ' : 'Every '}${enumerateValues(formattedWeekDays)}`\n      : '';\n\n    const timePart = ` at ${enumerateValues(formattedTime)}`;\n\n    return `${monthDaysPart}${weekDaysPart}${timePart}`;\n  }\n}\n"]}