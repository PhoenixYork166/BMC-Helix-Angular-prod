{"version":3,"file":"innovation-studio-shell.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/shared/components/shell/innovation-studio-shell.component.ts","../../../../../../../libs/platform/shared/components/shell/shell.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, TemplateRef, ViewChild } from '@angular/core';\nimport {\n  AdaptDockedPanelService,\n  AdaptModalService,\n  AdaptNavigationComponent,\n  AdaptNavigationService,\n  NavigationAction\n} from '@bmc-ux/adapt-angular';\nimport {\n  DevelopmentMode,\n  IUserOverlayGroupDescriptorChildren,\n  RX_APPLICATION,\n  RX_OVERLAY,\n  RxOverlayService,\n  RxPreviousStateService,\n  RxSystemConfigurationService\n} from '@helix/platform/shared/api';\nimport { IRxShellConfig, IRxShellMenuItem } from '@helix/platform/view/api';\nimport { includes } from 'lodash';\nimport { noop, Observable, of } from 'rxjs';\nimport { DevelopmentModeSelectorComponent } from './development-mode-selector/development-mode-selector.component';\nimport { FeedbackDialogComponent } from './feedback-dialog/feedback-dialog.component';\nimport { ShellBase } from './shell-base.class';\nimport { GainsightOptInComponent } from './gainsight/gainsight-opt-in/gainsight-opt-in.component';\nimport { RxModalService } from '@helix/platform/ui-kit';\n\n@Component({\n  selector: 'rx-innovation-studio-shell',\n  templateUrl: './shell.component.html',\n  styleUrls: ['./shell.component.scss']\n})\nexport class RxInnovationStudioShellComponent extends ShellBase {\n  @ViewChild('adaptNavigation', { static: true })\n  protected adaptNavigation: AdaptNavigationComponent;\n\n  @ViewChild('userMessagesPopover', { static: true })\n  protected userMessagesPopover: TemplateRef<any>;\n\n  protected flattenedMenuItems = [\n    {\n      name: this.translateService.instant('com.bmc.arsys.rx.innovation-studio.workspace.page.label'),\n      id: 0,\n      action: () => {\n        this.router.navigate([RX_APPLICATION.innovationStudioBundleId, 'workspace']);\n      }\n    },\n    {\n      name: this.translateService.instant('com.bmc.arsys.rx.client.common.administration.label'),\n      id: 1,\n      action: () => {\n        this.router.navigate([RX_APPLICATION.innovationStudioBundleId, 'settings']);\n      }\n    }\n  ];\n\n  private npsSurveyBaseUrl = 'NPS-Survey-Base-URL';\n\n  currentOverlayContext: IUserOverlayGroupDescriptorChildren = this.rxOverlayService.getCurrentOverlayContext();\n\n  constructor(\n    protected injector: Injector,\n    private adaptDockedPanelService: AdaptDockedPanelService,\n    private adaptModalService: AdaptModalService,\n    protected rxSystemConfigurationService: RxSystemConfigurationService,\n    private rxOverlayService: RxOverlayService,\n    private rxPreviousStateService: RxPreviousStateService,\n    private rxModalService: RxModalService\n  ) {\n    super(injector);\n  }\n\n  protected getActiveNavigationMenuItem(): IRxShellMenuItem {\n    const url = this.router.url;\n\n    if (includes(url, `${RX_APPLICATION.innovationStudioBundleId}/workspace`)) {\n      return this.flattenedMenuItems[0];\n    } else if (includes(url, `${RX_APPLICATION.innovationStudioBundleId}/settings`)) {\n      return this.flattenedMenuItems[1];\n    }\n  }\n\n  protected getUserMenuItems(): Observable<IRxShellMenuItem[]> {\n    const userMenu: IRxShellMenuItem[] = [];\n    const currentOverlayContext = this.rxOverlayService.getCurrentOverlayContext();\n\n    if (this.isEligibleForFeedback()) {\n      userMenu.push({\n        name: this.translateService.instant('com.bmc.arsys.rx.client.shell.provide-feedback.label'),\n        className: 'd-icon-heart',\n        id: 1,\n        action: () => {\n          this.openFeedback();\n        }\n      });\n    }\n\n    if (this.rxFeatureService.isFeatureEnabled('DRD21-11744')) {\n      userMenu.push({\n        name: this.translateService.instant('com.bmc.arsys.rx.client.shell.analytics.label'),\n        id: 0,\n        className: 'd-icon-app_chart_bar',\n        action: () => {\n          this.openGainsightPreferences();\n        }\n      });\n    }\n\n    return of(userMenu);\n  }\n\n  private isEligibleForFeedback(): boolean {\n    return (\n      this.currentOverlayContext.overlayGroupId !== RX_OVERLAY.overlayGroupIds.base &&\n      !this.currentOverlayContext.isShared\n    );\n  }\n\n  private openFeedback(): void {\n    let bundleDescriptorVersion: string;\n    this.applicationDescriptor$.subscribe((applicationDescriptor) => {\n      bundleDescriptorVersion = applicationDescriptor.version;\n    });\n    this.rxSystemConfigurationService.getConfiguration(this.npsSurveyBaseUrl).subscribe((feedbackUrl) => {\n      this.adaptDockedPanelService.open({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.shell.provide-feedback.label'),\n        content: FeedbackDialogComponent,\n        size: 'md',\n        data: { feedbackUrl, bundleDescriptorVersion }\n      });\n    });\n  }\n\n  openGainsightPreferences(): void {\n    this.adaptModalService\n      .open({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.shell.analytics.label'),\n        content: GainsightOptInComponent,\n        size: 'sm'\n      })\n      .catch(noop);\n  }\n\n  protected getNavigationMenuItems(): Observable<IRxShellMenuItem[]> {\n    return of(this.flattenedMenuItems);\n  }\n\n  protected getNavigationActionItems(): Observable<NavigationAction[]> {\n    const currentDevelopmentMode = this.rxOverlayService.getDevelopmentMode();\n\n    return of([\n      {\n        name: this.translateService.instant('com.bmc.arsys.rx.client.shell.development-mode.title'),\n        className: 'd-icon-field_custom',\n        tooltip: this.translateService.instant(\n          currentDevelopmentMode === DevelopmentMode.Base\n            ? 'com.bmc.arsys.rx.client.shell.development-mode.base.tooltip'\n            : 'com.bmc.arsys.rx.client.shell.development-mode.best-practice.tooltip'\n        ),\n        action: () => {\n          this.adaptModalService\n            .open({\n              title: this.translateService.instant('com.bmc.arsys.rx.client.shell.development-mode.title'),\n              content: DevelopmentModeSelectorComponent,\n              size: 'sm',\n              data: { developmentMode: currentDevelopmentMode }\n            })\n            .then(\n              (developmentMode) => {\n                this.rxOverlayService.setDevelopmentMode(developmentMode);\n\n                this.router.navigate([RX_APPLICATION.innovationStudioBundleId, 'workspace']).then(() => {\n                  window.location.reload();\n                });\n              },\n              () => {}\n            );\n        }\n      }\n    ]);\n  }\n\n  protected getShellConfig(): Observable<IRxShellConfig> {\n    return of({ allowAppSwitching: true } as IRxShellConfig);\n  }\n}\n","<ng-template #userMessagesPopover>\n  <rx-user-messages></rx-user-messages>\n</ng-template>\n\n<adapt-navigation\n  #adaptNavigation\n  [class.invisible]=\"!isShellInitialized\"\n  [metadata]=\"brandingInfo$ | async\"\n  [menu]=\"(navigationMenuItems$ | async) || []\"\n  [actions]=\"navigationActionItems$ | async\"\n  [profile]=\"userProfileMenu$ | async\"\n></adapt-navigation>\n\n<adapt-alert\n  *ngIf=\"hasBanner$ | async\"\n  [config]=\"{\n    title: 'Note:',\n    type: 'page',\n    variant: 'info',\n    content: ''\n  }\"\n  (onClose)=\"closeBanner()\"\n>\n  <span class=\"alert-content\">\n    <span>\n      {{ alertText }}\n    </span>\n\n    <a href=\"#\" class=\"alert-link\" (click)=\"openGainsightPreferences(); $event.preventDefault()\">\n      {{ alertLinkText }}\n    </a>\n  </span>\n</adapt-alert>\n\n<div [class.invisible]=\"!isShellInitialized\" class=\"busy-indicator position-relative\">\n  <rx-busy-indicator\n    [options]=\"{\n      busy: busySubscription,\n      loaderType: 'lineLoader',\n      delay: 250,\n      backdrop: false,\n      message: null\n    }\"\n  >\n  </rx-busy-indicator>\n</div>\n\n<div\n  [class.invisible]=\"!isShellInitialized\"\n  class=\"outlet-content\"\n  [ngClass]=\"{\n    'has-banner': hasBanner$ | async\n  }\"\n>\n  <router-outlet></router-outlet>\n</div>\n"]}