{"version":3,"file":"search-filters.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/admin/components/search-filters/search-filters.component.ts","../../../../../../../libs/platform/admin/components/search-filters/search-filters.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ViewChild, TemplateRef, ChangeDetectionStrategy } from '@angular/core';\nimport { BaseViewComponent } from '@helix/platform/view/runtime';\nimport { AdaptDockedPanelService } from '@bmc-ux/adapt-angular';\nimport { DataCellTemplateParams } from '@bmc-ux/adapt-table';\nimport { ISearchFilter } from './search-filter.interface';\n\nimport {\n  IRecordGridActionButton,\n  IRecordGridColumn,\n  IRecordGridConfig,\n  RecordGridComponent,\n  RecordGridFilterMode,\n  RowSelectionMode\n} from '@helix/platform/view/components';\n\nimport { Observable, of } from 'rxjs';\nimport { IRecordDefinition, RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { RxSearchFiltersService } from './search-filters.service';\nimport { IRowDataItem } from '@helix/platform/view/api';\nimport { SearchFiltersEditorComponent } from './search-filters-editor/search-filters-editor.component';\nimport { RxModalService, RX_MODAL } from '@helix/platform/ui-kit';\nimport { RxNotificationService } from '@helix/platform/shared/api';\nimport { TranslateService } from '@ngx-translate/core';\nimport { noop } from 'lodash';\n\n@Component({\n  selector: 'rx-search-filters',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  templateUrl: './search-filters.component.html'\n})\nexport class RxSearchFiltersComponent extends BaseViewComponent implements OnInit {\n  constructor(\n    private rxModalService: RxModalService,\n    private rxNotificationService: RxNotificationService,\n    private adaptDockedPanelService: AdaptDockedPanelService,\n    private rxSearchFiltersService: RxSearchFiltersService,\n    private translateService: TranslateService\n  ) {\n    super();\n  }\n\n  @ViewChild(RecordGridComponent, { static: true })\n  grid: RecordGridComponent;\n\n  @ViewChild('tagsTemplate', { static: true })\n  tagsTemplate: TemplateRef<DataCellTemplateParams>;\n\n  public recordGridConfig$: Observable<IRecordGridConfig>;\n  public searchFilters: ISearchFilter[] = [];\n\n  ngOnInit() {\n    this.initializeRecordGrid();\n  }\n\n  private initializeRecordGrid(): void {\n    const gridColumns: IRecordGridColumn[] = [\n      {\n        fieldId: 'id',\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.search-filters.grid.column.id.title'),\n        visible: false\n      },\n      {\n        fieldId: 'name',\n        title: this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.search-filters.grid.column.search-filter-name.title'\n        ),\n        clickable: true,\n        actions: [\n          {\n            name: (previousActionResult: any, rowDataItem: IRowDataItem) => {\n              this.openEditor(rowDataItem);\n            }\n          }\n        ]\n      },\n      {\n        fieldId: 'tagsOperator',\n        title: this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.search-filters.grid.column.relationship.title'\n        )\n      },\n      {\n        fieldId: 'tags',\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.search-filters.grid.column.tags.title'),\n        cellTemplate: this.tagsTemplate\n      }\n    ];\n\n    const gridRecordDefinition: IRecordDefinition = {\n      fieldDefinitions: [\n        {\n          id: 'id',\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: 'name',\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: 'tagsOperator',\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: 'tags',\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        }\n      ]\n    };\n\n    const actionButtons: IRecordGridActionButton[] = [\n      {\n        label: this.translateService.instant('com.bmc.arsys.rx.client.common.delete.label'),\n        style: 'tertiary',\n        iconCls: 'trash',\n        actions: [{ name: () => this.deleteSearchFilters() }]\n      }\n    ];\n\n    this.recordGridConfig$ = of({\n      columns: gridColumns,\n      emptyStateLabelText: this.translateService.instant(\n        'com.bmc.arsys.rx.client.admin.search-filters.grid.empty-state.label'\n      ),\n      enableRowSelection: RowSelectionMode.Multiple,\n      enableFiltering: false,\n      recordIdField: 'id',\n      styles: 'flex-fill',\n      useExternalFiltering: false,\n      getRecordDefinition: () => of(gridRecordDefinition),\n      getData: () => this.rxSearchFiltersService.getSearchFilters(),\n      actionButtons,\n      filterMode: RecordGridFilterMode.Basic\n    });\n  }\n\n  private deleteSearchFilters(): void {\n    const searchFilterIds = this.grid.api.getSelectedRows().map((row) => row.id as string);\n\n    this.rxModalService\n      .confirm({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n        modalStyle: RX_MODAL.modalStyles.warning,\n        message: this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.search-filters.delete-confirmation.message'\n        )\n      })\n      .then((result: boolean) => {\n        if (result) {\n          this.rxSearchFiltersService.deleteSearchFilters(searchFilterIds).subscribe(() => {\n            this.rxNotificationService.addSuccessMessage(\n              this.translateService.instant('com.bmc.arsys.rx.client.admin.search-filters.delete-success.message')\n            );\n            this.grid.api.refresh().subscribe();\n          });\n        }\n      });\n  }\n\n  openEditor(data?: IRowDataItem): void {\n    this.adaptDockedPanelService\n      .open({\n        title: this.translateService.instant(\n          data\n            ? 'com.bmc.arsys.rx.client.admin.search-filters-editor.edit.title'\n            : 'com.bmc.arsys.rx.client.admin.search-filters-editor.new.title'\n        ),\n        content: SearchFiltersEditorComponent,\n        data: data\n      })\n      .then(() => {\n        this.grid.api.refresh().subscribe();\n      })\n      .catch(noop);\n  }\n}\n","<rx-admin-settings header=\"{{ 'com.bmc.arsys.rx.client.admin.search-filters.header.label' | translate }}\">\n  <div>\n    <button adapt-button type=\"button\" btn-type=\"tertiary\" (click)=\"openEditor()\">\n      <span class=\"d-icon-plus_circle\"></span>\n      {{ 'com.bmc.arsys.rx.client.admin.search-filters.new-search-filter.button.label' | translate }}\n    </button>\n  </div>\n\n  <rx-record-grid class=\"mt-2 h-100\" [config]=\"recordGridConfig$\"></rx-record-grid>\n</rx-admin-settings>\n\n<ng-template #tagsTemplate let-dataItem=\"dataItem\">\n  <div class=\"d-flex flex-row flex-wrap\">\n    <ng-container *ngFor=\"let tag of dataItem.tags\">\n      <adapt-tag [type]=\"'active'\" [removable]=\"false\">\n        {{ tag | truncate: 10 }}\n      </adapt-tag>\n    </ng-container>\n  </div>\n</ng-template>\n"]}