{"version":3,"file":"role-editor.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/role-permissions/role-editor/role-editor.component.ts","../../../../../../../../libs/platform/admin/components/role-permissions/role-editor/role-editor.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { AbstractControl, NgForm, ValidationErrors } from '@angular/forms';\nimport { DismissReasons, DockedPanelContext, RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport {\n  IBundleDescriptor,\n  IDataPageResult,\n  IRole,\n  RxGlobalCacheService,\n  RxGroupDataPageService,\n  RxNotificationService\n} from '@helix/platform/shared/api';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { TranslateService } from '@ngx-translate/core';\nimport { find, map as _map } from 'lodash';\nimport { Observable, OperatorFunction, ReplaySubject, Subscription, throwError } from 'rxjs';\nimport { catchError, distinctUntilChanged, map, takeUntil } from 'rxjs/operators';\nimport { RX_ROLE_PERMISSIONS } from '../role-permissions.constant';\nimport { RxRolePermissionsService } from '../role-permissions.service';\n\n@Component({\n  selector: 'rx-role-editor',\n  templateUrl: './role-editor.component.html'\n})\nexport class RoleEditorComponent extends RxModalClass implements OnInit, OnDestroy {\n  role: IRole;\n\n  @ViewChild('roleEditorForm', { read: NgForm, static: true })\n  roleEditorForm: NgForm;\n  applicationOptions: RxSelectOption[];\n  busy: Subscription;\n  groupList: string[];\n  isEditMode = false;\n  isSaveInProgress = false;\n  isSaveButtonDisabled = true;\n  selectedApplication: RxSelectOption;\n  maxRoleId = RX_ROLE_PERMISSIONS.maxRoleId;\n  minRoleId = RX_ROLE_PERMISSIONS.minRoleId;\n  oldRoleName: string;\n  validDefinitionNameRegex = RX_RECORD_DEFINITION.validDefinitionNameRegex;\n  private destroyed$: ReplaySubject<boolean> = new ReplaySubject(1);\n  validatorFn = this.roleNameValidator.bind(this);\n\n  constructor(\n    private rxGlobalCacheService: RxGlobalCacheService,\n    private rxGroupDataPageService: RxGroupDataPageService,\n    private rxRolePermissionsService: RxRolePermissionsService,\n    private rxNotificationService: RxNotificationService,\n    private dockedPanelContext: DockedPanelContext,\n    private translateService: TranslateService,\n    protected injector: Injector\n  ) {\n    super(dockedPanelContext, injector);\n  }\n\n  testSearch: OperatorFunction<string, string[]> = (text$: Observable<string>) =>\n    text$.pipe(\n      distinctUntilChanged(),\n      map((term) => this.groupList.filter((v) => v.toLowerCase().indexOf(term.toLowerCase()) > -1).slice(0, 10))\n    );\n\n  productionSearch: OperatorFunction<string, string[]> = (text$: Observable<string>) =>\n    text$.pipe(\n      distinctUntilChanged(),\n      map((term) => this.groupList.filter((v) => v.toLowerCase().indexOf(term.toLowerCase()) > -1).slice(0, 10))\n    );\n\n  ngOnInit(): void {\n    super.ngOnInit();\n\n    this.getApplicationList();\n    this.getGroupList();\n    this.role = this.dockedPanelContext.getData().role;\n    this.isEditMode = Boolean(this.role.roleName);\n    this.isSaveButtonDisabled = !this.roleEditorForm.valid;\n\n    this.roleEditorForm.valueChanges.pipe(distinctUntilChanged(), takeUntil(this.destroyed$)).subscribe((value) => {\n      this.isSaveButtonDisabled = !this.roleEditorForm.valid || this.roleEditorForm.pristine;\n    });\n\n    if (this.isEditMode) {\n      let selectedApplication = find(this.applicationOptions, { value: this.role.applicationName });\n\n      if (!selectedApplication) {\n        selectedApplication = {\n          displayValue: this.role.applicationName,\n          value: this.role.applicationName\n        };\n\n        this.applicationOptions.push(selectedApplication);\n      }\n\n      this.selectedApplication = [selectedApplication];\n      this.oldRoleName = this.role.roleName;\n    }\n  }\n\n  isDirty(): boolean {\n    return this.roleEditorForm.dirty;\n  }\n\n  optionFormatter(option: RxSelectOption): string {\n    return option.displayValue;\n  }\n\n  save(): void {\n    this.isSaveInProgress = true;\n    this.isSaveButtonDisabled = true;\n\n    if (!this.isEditMode) {\n      this.role.applicationName = this.selectedApplication[0].value;\n    }\n\n    const saveRole$ = this.isEditMode\n      ? this.rxRolePermissionsService.update(this.role, this.oldRoleName)\n      : this.rxRolePermissionsService.create(this.role);\n\n    saveRole$\n      .pipe(\n        catchError((error) => {\n          this.isSaveInProgress = false;\n          this.isSaveButtonDisabled = false;\n\n          return throwError(error);\n        })\n      )\n      .subscribe((response) => {\n        this.rxNotificationService.addSuccessMessage(\n          this.translateService.instant('com.bmc.arsys.rx.client.admin.role-permissions.role-saved.message')\n        );\n        this.isSaveInProgress = false;\n        this.isSaveButtonDisabled = false;\n        this.dockedPanelContext.close(saveRole$);\n      });\n  }\n\n  getGroupList() {\n    const startIndex = 0;\n    const pageSize = -1;\n    const queryParams = {\n      propertySelection: ['groupName', 'groupId'].join(','),\n      sortBy: 'groupName'\n    };\n\n    this.rxGroupDataPageService\n      .get({\n        params: { startIndex, pageSize, ...queryParams }\n      })\n      .pipe(\n        map((groupDataPage: IDataPageResult) => {\n          this.groupList = _map(groupDataPage.data, 'groupName');\n        })\n      )\n      .subscribe();\n  }\n\n  getApplicationList() {\n    this.rxGlobalCacheService.getBundleDescriptors().subscribe((bundleDescriptors: IBundleDescriptor[]) => {\n      this.applicationOptions = bundleDescriptors\n        .sort((bundleDescriptor: IBundleDescriptor, bundleDescriptorToCompare: IBundleDescriptor) =>\n          bundleDescriptor.friendlyName.localeCompare(bundleDescriptorToCompare.friendlyName)\n        )\n        .map((bundleDescriptor: IBundleDescriptor) => ({\n          displayValue: bundleDescriptor.friendlyName,\n          value: bundleDescriptor.id\n        }));\n    });\n  }\n\n  closeModal(): void {\n    this.dockedPanelContext.dismiss(DismissReasons.CLOSE_BTN);\n  }\n\n  roleNameValidator(control: AbstractControl): ValidationErrors | null {\n    return control.value && !RX_RECORD_DEFINITION.validDefinitionNameRegex.test(control.value)\n      ? {\n          invalidRoleName: {\n            message: this.translateService.instant(\n              'com.bmc.arsys.rx.client.admin.role-permissions.role-name-validation.message'\n            )\n          }\n        }\n      : null;\n  }\n\n  ngOnDestroy(): void {\n    this.destroyed$.next(true);\n    this.destroyed$.complete();\n  }\n}\n","<div class=\"dp-body\">\n  <h4 class=\"m-0 mb-3\">{{ 'com.bmc.arsys.rx.client.admin.role-permissions.general-information.label' | translate }}</h4>\n  <form #roleEditorForm=\"ngForm\">\n    <adapt-rx-select\n      class=\"form-group d-block\"\n      label=\"{{ 'com.bmc.arsys.rx.client.common.application-or-library.label' | translate }}\"\n      rx-id=\"application-name\"\n      [(ngModel)]=\"selectedApplication\"\n      [options]=\"applicationOptions\"\n      [optionFormatter]=\"optionFormatter\"\n      name=\"application\"\n      required=\"true\"\n      [readonly]=\"isEditMode\"\n    >\n    </adapt-rx-select>\n\n    <adapt-rx-textfield\n      rx-id=\"role-name\"\n      class=\"form-group d-block\"\n      label=\"{{ 'com.bmc.arsys.rx.client.admin.role-permissions.role-name.label' | translate }}\"\n      name=\"roleName\"\n      required=\"true\"\n      [(ngModel)]=\"role.roleName\"\n      [rxCustomValidators]=\"validatorFn\"\n    >\n    </adapt-rx-textfield>\n\n    <adapt-rx-counter\n      rx-id=\"role-id\"\n      class=\"form-group d-block\"\n      required=\"true\"\n      label=\"{{ 'com.bmc.arsys.rx.client.admin.role-permissions.role-id.label' | translate }}\"\n      name=\"roleId\"\n      adaptIntegerNumber\n      [max]=\"maxRoleId\"\n      [min]=\"minRoleId\"\n      [adaptMax]=\"maxRoleId\"\n      [adaptMin]=\"minRoleId\"\n      [(ngModel)]=\"role.roleID\"\n    ></adapt-rx-counter>\n\n    <div class=\"d-row\">\n      <h4 class=\"form-group\">{{ 'com.bmc.arsys.rx.client.admin.role-permissions.group-mapping.label' | translate }}</h4>\n    </div>\n\n    <adapt-rx-typeahead\n      rx-id=\"test\"\n      class=\"form-group d-block\"\n      [(ngModel)]=\"role.test\"\n      name=\"test\"\n      [typeahead]=\"testSearch\"\n      label=\"Test\"\n      placeholder=\"Enter test group name\"\n    ></adapt-rx-typeahead>\n\n    <adapt-rx-typeahead\n      rx-id=\"production\"\n      class=\"form-group d-block\"\n      [(ngModel)]=\"role.production\"\n      name=\"production\"\n      [typeahead]=\"productionSearch\"\n      label=\"Production\"\n      placeholder=\"Enter production group name\"\n    ></adapt-rx-typeahead>\n\n    <adapt-rx-textfield\n      rx-id=\"datatag\"\n      class=\"form-group d-block\"\n      label=\"{{ 'com.bmc.arsys.rx.client.admin.role-permissions.datatag.label' | translate }}\"\n      name=\"datatag\"\n      placeholder=\"Enter datatag\"\n      [(ngModel)]=\"role.datatag\"\n    ></adapt-rx-textfield>\n  </form>\n</div>\n<div class=\"dp-footer\">\n  <button\n    adapt-button\n    btn-type=\"primary\"\n    type=\"button\"\n    rx-id=\"save-button\"\n    class=\"mr-2\"\n    (click)=\"save()\"\n    [disabled]=\"isSaveButtonDisabled\"\n    [adaptInlineLoader]=\"isSaveInProgress\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n  <button adapt-button btn-type=\"secondary\" type=\"button\" rx-id=\"cancel-button\" (click)=\"closeModal()\">Cancel</button>\n</div>\n"]}