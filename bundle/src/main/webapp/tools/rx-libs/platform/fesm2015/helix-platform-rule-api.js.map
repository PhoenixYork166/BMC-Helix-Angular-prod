{"version":3,"file":"helix-platform-rule-api.js","sources":["../../../../libs/platform/rule/api/rule-definition-data-page.service.ts","../../../../libs/platform/rule/api/rule-definition.constant.ts","../../../../libs/platform/rule/api/rule-trigger-event.pipe.ts","../../../../libs/platform/rule/api/rule-trigger-time-criteria-display-value.pipe.ts","../../../../libs/platform/rule/api/rule-pipes.module.ts","../../../../libs/platform/rule/api/rule-definition.service.ts","../../../../libs/platform/rule/api/helix-platform-rule-api.ts"],"sourcesContent":["import { DataPage } from '@helix/platform/shared/api';\r\nimport { Injectable, Injector } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RxRuleDefinitionDataPageService extends DataPage {\r\n  constructor(private injector: Injector) {\r\n    super(injector, 'com.bmc.arsys.rx.application.rule.datapage.RuleDefinitionDataPageQuery');\r\n  }\r\n}\r\n","export const RX_RULE_DEFINITION = {\r\n  ruleElementResourceTypes: {\r\n    scheduleTime: 'com.bmc.arsys.rx.services.rule.domain.ScheduleTime',\r\n    intervalTime: 'com.bmc.arsys.rx.services.rule.domain.IntervalTime'\r\n  },\r\n\r\n  actionTypeNames: {\r\n    connector: 'connector'\r\n  },\r\n\r\n  timerTypes: {\r\n    interval: 'Interval',\r\n    schedule: 'Schedule'\r\n  }\r\n};\r\n","import { Pipe, PipeTransform } from '@angular/core';\r\nimport { RX_RULE_DEFINITION } from './rule-definition.constant';\r\nimport { ITriggerEvent } from './rule-definition.types';\r\n\r\n@Pipe({\r\n  name: 'rxRuleTriggerEventPipe'\r\n})\r\nexport class RxRuleTriggerEventPipe implements PipeTransform {\r\n  transform(triggerEvent: ITriggerEvent): string {\r\n    let result = '';\r\n\r\n    if (triggerEvent && triggerEvent.timeCriteria) {\r\n      if (triggerEvent.timeCriteria.resourceType === RX_RULE_DEFINITION.ruleElementResourceTypes.scheduleTime) {\r\n        result = RX_RULE_DEFINITION.timerTypes.schedule;\r\n      } else if (triggerEvent.timeCriteria.resourceType === RX_RULE_DEFINITION.ruleElementResourceTypes.intervalTime) {\r\n        result = RX_RULE_DEFINITION.timerTypes.interval;\r\n      }\r\n    } else if (triggerEvent && triggerEvent.eventTypes) {\r\n      result = triggerEvent.eventTypes.join(', ');\r\n    } else if (triggerEvent && triggerEvent.eventTypeDisplayName) {\r\n      result = triggerEvent.eventTypeDisplayName;\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n","import { Pipe, PipeTransform } from '@angular/core';\nimport moment from 'moment-es6';\nimport { chain, compact, sortBy, startCase, toLower } from 'lodash';\nimport { RX_RULE_DEFINITION } from './rule-definition.constant';\nimport { IIntervalTimeCriteria, IScheduleTimeCriteria } from './rule-definition.types';\n\n@Pipe({\n  name: 'rxRuleTriggerTimeCriteriaDisplayValue'\n})\nexport class RxRuleTriggerTimeCriteriaDisplayValuePipe implements PipeTransform {\n  transform(ruleTriggerTimeCriteria: IIntervalTimeCriteria | IScheduleTimeCriteria): string {\n    let displayValue;\n\n    switch (ruleTriggerTimeCriteria.resourceType) {\n      case RX_RULE_DEFINITION.ruleElementResourceTypes.intervalTime:\n        displayValue = this.buildIntervalTimeDisplayValue(ruleTriggerTimeCriteria as IIntervalTimeCriteria);\n        break;\n      case RX_RULE_DEFINITION.ruleElementResourceTypes.scheduleTime:\n        displayValue = this.buildScheduleTimeDisplayValue(ruleTriggerTimeCriteria as IScheduleTimeCriteria);\n        break;\n      default:\n        displayValue = '';\n    }\n\n    return displayValue;\n  }\n\n  private buildIntervalTimeDisplayValue(intervalTimeCriteria: IIntervalTimeCriteria): string {\n    const displayValueParts = [];\n\n    function buildDisplayValuePart(value: number, singularUnit: string, pluralUnit: string): string {\n      return value ? `${value} ${value > 1 ? pluralUnit : singularUnit}` : '';\n    }\n\n    displayValueParts.push(buildDisplayValuePart(intervalTimeCriteria.days, 'day', 'days'));\n    displayValueParts.push(buildDisplayValuePart(intervalTimeCriteria.hours, 'hour', 'hours'));\n    displayValueParts.push(buildDisplayValuePart(intervalTimeCriteria.minutes, 'minute', 'minutes'));\n\n    return `Every ${compact(displayValueParts).join(', ')}`;\n  }\n\n  private buildScheduleTimeDisplayValue(scheduleTimeCriteria: IScheduleTimeCriteria): string {\n    const weekDayOrderIds = {\n      Monday: 1,\n      Tuesday: 2,\n      Wednesday: 3,\n      Thursday: 4,\n      Friday: 5,\n      Saturday: 6,\n      Sunday: 7\n    };\n\n    function enumerateValues(values: (string | number)[]): string {\n      const trailingValue = values.length > 1 ? ` and ${values.pop()}` : '';\n\n      return `${values.join(', ')}${trailingValue}`;\n    }\n\n    const formattedWeekDays = chain(scheduleTimeCriteria.weekDays)\n      .map(toLower)\n      .map(startCase)\n      .sortBy((weekDay) => weekDayOrderIds[weekDay])\n      .value();\n\n    const formattedTime = sortBy(scheduleTimeCriteria.hours).map((hour) =>\n      moment(`${hour}:${scheduleTimeCriteria.minute}`, ['H:mm'], 'en').format('h:mmA')\n    );\n\n    const monthDaysPart = scheduleTimeCriteria.monthDays?.length\n      ? `On dates ${enumerateValues(sortBy(scheduleTimeCriteria.monthDays))} of every month`\n      : '';\n\n    const weekDaysPart = scheduleTimeCriteria.weekDays?.length\n      ? `${monthDaysPart ? ', and every ' : 'Every '}${enumerateValues(formattedWeekDays)}`\n      : '';\n\n    const timePart = ` at ${enumerateValues(formattedTime)}`;\n\n    return `${monthDaysPart}${weekDaysPart}${timePart}`;\n  }\n}\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { RxRuleTriggerEventPipe } from './rule-trigger-event.pipe';\r\nimport { RxRuleTriggerTimeCriteriaDisplayValuePipe } from './rule-trigger-time-criteria-display-value.pipe';\r\n\r\n@NgModule({\r\n  imports: [CommonModule],\r\n  declarations: [RxRuleTriggerEventPipe, RxRuleTriggerTimeCriteriaDisplayValuePipe],\r\n  exports: [RxRuleTriggerEventPipe, RxRuleTriggerTimeCriteriaDisplayValuePipe]\r\n})\r\nexport class RxRulePipesModule {}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { ICommand, RxCommandFactoryService } from '@helix/platform/shared/api';\r\nimport { RxGuidService } from '@helix/platform/utils';\r\nimport { IRuleDefinition } from './rule-definition.types';\r\n\r\nexport const renameRuleDefinitionCommand = 'com.bmc.arsys.rx.application.rule.command.RenameRuleDefinitionCommand';\r\nexport const revertRuleCustomizationResourceType =\r\n  'com.bmc.arsys.rx.application.rule.command.RevertRuleDefinitionCommand';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RxRuleDefinitionService {\r\n  private renameCommand: ICommand;\r\n  private revertCustomizationCommand: ICommand;\r\n\r\n  constructor(\r\n    private httpClient: HttpClient,\r\n    private rxGuidService: RxGuidService,\r\n    private rxCommandFactoryService: RxCommandFactoryService\r\n  ) {\r\n    this.renameCommand = rxCommandFactoryService.forResourceType(renameRuleDefinitionCommand);\r\n    this.revertCustomizationCommand = rxCommandFactoryService.forResourceType(revertRuleCustomizationResourceType);\r\n  }\r\n\r\n  get(ruleDefinitionName: string): Observable<IRuleDefinition> {\r\n    return this.httpClient.get<IRuleDefinition>(this.getUrl(ruleDefinitionName));\r\n  }\r\n\r\n  rename(oldRuleDefinitionName: string, newRuleDefinitionName: string): Observable<any> {\r\n    return this.renameCommand.execute({\r\n      name: oldRuleDefinitionName,\r\n      newName: newRuleDefinitionName\r\n    });\r\n  }\r\n\r\n  revertCustomization(ruleDefinitionName: string): Observable<any> {\r\n    return this.revertCustomizationCommand.execute({ ruleDefinitionName });\r\n  }\r\n\r\n  update(ruleDefinition: IRuleDefinition): Observable<any> {\r\n    return this.httpClient.put(this.getUrl(ruleDefinition.name), ruleDefinition);\r\n  }\r\n\r\n  private getUrl(ruleDefinitionName: string): string {\r\n    return `/api/rx/application/rule/ruledefinition/${encodeURIComponent(ruleDefinitionName)}`;\r\n  }\r\n}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}