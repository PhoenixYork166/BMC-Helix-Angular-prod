{"version":3,"file":"url-change-tracker.js","sourceRoot":"","sources":["../../../../../../libs/adapt-radar/src/lib/common/url-change-tracker.ts"],"names":[],"mappings":"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","sourcesContent":["import {Injectable, NgZone, OnDestroy} from '@angular/core';\nimport {Subject} from 'rxjs';\nimport {AdaptRadarURLChangedEventData} from '../adapt-radar.model';\n\ninterface MsToTimeFormat {\n  timeInSeconds: number;\n  fullTime: string;\n}\n\n/**\n * Service used to track url changes\n */\n@Injectable({providedIn: 'root'})\nexport class AdaptRadarURLChangeTracker implements OnDestroy {\n  private _urlChange$: Subject<AdaptRadarURLChangedEventData>;\n  private _previousLocation: Location = {...location};\n  private _startTime: number = performance.now();\n  private _endTime: number;\n\n  private _urlChangeCallbackBind: () => void = this._urlChangeCallback.bind(this);\n\n  constructor(private _ngZone: NgZone) {\n  }\n\n  urlChange(): Subject<AdaptRadarURLChangedEventData> {\n    if (this._urlChange$) {\n      return this._urlChange$;\n    } else {\n      this._urlChange$ = new Subject<AdaptRadarURLChangedEventData>();\n    }\n\n    this._ngZone.runOutsideAngular(() => {\n      document.addEventListener('click', this._urlChangeCallbackBind, true);\n    });\n\n    return this._urlChange$;\n  }\n\n  unsubscribeFromURLChange(): void {\n    document.removeEventListener('click', this._urlChangeCallbackBind);\n    this._urlChange$ = null;\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribeFromURLChange();\n  }\n\n  private _msToTime(duration: number): MsToTimeFormat {\n    const milliseconds = Math.floor((duration % 1000) / 100);\n    const seconds = Math.floor((duration / 1000) % 60);\n    const minutes = Math.floor((duration / (1000 * 60)) % 60);\n    const hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\n\n    return {\n      timeInSeconds: seconds,\n      fullTime: `${(hours < 10) ? '0' + hours : hours}:${(minutes < 10) ? '0' + minutes : minutes}:${(seconds < 10) ? '0' + seconds : seconds}.${milliseconds}`,\n    };\n  }\n\n  private _urlChangeCallback(): void {\n    if (this._previousLocation.href !== location.href) {\n      this._endTime = performance.now();\n\n      const locationCopy = {...location};\n      const timeOnPage = this._endTime - this._startTime;\n      const msToTime = this._msToTime(timeOnPage);\n\n      this._urlChange$.next({\n        PreviousLocation: {...this._previousLocation},\n        CurrentLocation: locationCopy,\n        PageTitle: document.title,\n        TimeOnPageInMilliseconds: timeOnPage,\n        TimeOnPageInSeconds: msToTime?.timeInSeconds,\n        TimeOnPage: msToTime?.fullTime\n      });\n\n      this._previousLocation = locationCopy;\n      this._startTime = performance.now();\n    }\n  }\n}\n"]}