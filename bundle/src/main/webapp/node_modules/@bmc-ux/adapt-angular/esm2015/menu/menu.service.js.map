{"version":3,"file":"menu.service.js","sourceRoot":"","sources":["../../../../../libs/adapt-angular/src/menu/menu.service.ts"],"names":[],"mappings":"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","sourcesContent":["import {ElementRef, Injectable, Renderer2, ChangeDetectorRef} from '@angular/core';\nimport {MenuConfig, MenuTextsModel} from './models/menu-config';\nimport {isDefined} from '../common/utilities';\n\nimport {BehaviorSubject} from 'rxjs';\nimport {CascadeItem, MenuItem} from './models/menu-item';\n\n@Injectable()\nexport class MenuInnerService {\n  item: MenuItem;\n\n  id: string;\n  isMobile: boolean;\n  currentActiveId: string;\n  // TODO: Refactor this if possible\n  /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\n  currentActiveCascadeItem: any;\n  appendToBody: boolean;\n  mobileDefaultTexts: MenuTextsModel = {};\n\n  menuElementRef: BehaviorSubject<ElementRef> = new BehaviorSubject<ElementRef>(null);\n\n\n  private _documentListenerFunc: () => void;\n  private _openedMenu: CascadeItem;\n\n  get cascadeChain(): CascadeItem {\n    return this._openedMenu;\n  }\n\n  constructor(private _renderer: Renderer2,\n              private _changeDetectorRef: ChangeDetectorRef) {\n  }\n\n  init(config: MenuConfig): void {\n    this.item = config.cascadeItem;\n    this.id = config.id;\n    this.isMobile = config.isMobile;\n    this.mobileDefaultTexts = config.mobileViewTexts;\n    this.appendToBody = config.appendToBody;\n\n    this._attachCascade(config.id);\n\n    // add parent element\n    if (this.item.items) {\n      this.item.items.forEach((item) => {\n        this._addParent(item, this.item);\n      });\n    }\n  }\n\n  // TODO: Refactor this if possible\n  /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\n  addCascadeItem(parentNode: any, componentRef: any, anchor: any): void {\n    if (!this._openedMenu.id) {\n      return;\n    }\n\n    this._openedMenu.subMenuItems.push({\n      parentNode,\n      componentRef,\n      anchor\n    });\n\n    this.currentActiveCascadeItem = componentRef.instance._elemRef.nativeElement;\n\n    if (!isDefined(this._documentListenerFunc)) {\n      this._documentListenerFunc = this._renderer.listen('document', 'click', this.closeFromClick.bind(this));\n    }\n  }\n\n  detachCascade(): void {\n    this._openedMenu.subMenuItems.forEach((item) => {\n      this._destroy(item);\n    });\n\n    this._openedMenu.subMenuItems = [];\n\n    if (this._documentListenerFunc) {\n      this._documentListenerFunc();\n      this._documentListenerFunc = null;\n    }\n  }\n\n  destroyCascadeItems(level: number): void {\n    this._openedMenu.subMenuItems.forEach((item, index) => {\n      if (index > level) {\n        this._destroy(item);\n      }\n    });\n\n    this._openedMenu.subMenuItems.length = level + 1;\n    this.currentActiveCascadeItem = this._openedMenu.subMenuItems[level]?.componentRef.instance._elemRef.nativeElement;\n  }\n\n  closeFromClick(e: Event): void {\n    if (!this.getCascadeLength()) {\n      return;\n    }\n\n    const clickMenu: boolean = this.cascadeChain.subMenuItems.some((item) => {\n      return item.componentRef ? item.componentRef.instance.isEventFrom(e) : false;\n    });\n\n    const clickTarget: boolean = this.cascadeChain.subMenuItems.some((item) => {\n      return item.anchor ? item.anchor.isEventFrom(e) : false;\n    });\n\n    if (!clickMenu && !clickTarget) {\n      this.detachCascade();\n      // need to run manually change detection to cover use-case\n      // when parent component implements OnPush strategy\n      this._changeDetectorRef.detectChanges();\n    }\n  }\n\n  getCascadeLength(): number {\n    return this.cascadeChain ? this.cascadeChain.subMenuItems.length : 0;\n  }\n\n  // TODO: Refactor this if possible\n  /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\n  private _attachCascade(id: any): void {\n    if (this._openedMenu && this._openedMenu.subMenuItems) {\n      this.detachCascade();\n    }\n\n    this._openedMenu = {\n      id,\n      subMenuItems: []\n    };\n  }\n\n  // TODO: Refactor this if possible\n  /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\n  private _destroy(item: any): void {\n    item.componentRef.destroy();\n    item.parentNode.expanded = false;\n  }\n\n  // TODO: Refactor this if possible\n  /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\n  private _addParent(menuItem: any, parent: any): void {\n    menuItem.parent = parent;\n\n    if (menuItem.items) {\n      menuItem.items.forEach((item) => {\n        this._addParent(item, menuItem);\n      });\n    }\n  }\n}\n"]}