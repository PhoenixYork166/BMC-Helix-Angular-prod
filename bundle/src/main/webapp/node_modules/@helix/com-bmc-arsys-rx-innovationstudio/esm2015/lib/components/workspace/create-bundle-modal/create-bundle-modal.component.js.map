{"version":3,"file":"create-bundle-modal.component.js","sourceRoot":"","sources":["../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/workspace/create-bundle-modal/create-bundle-modal.component.ts","../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/workspace/create-bundle-modal/create-bundle-modal.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component } from '@angular/core';\nimport { ActiveModalRef } from '@bmc-ux/adapt-angular';\nimport { throwError } from 'rxjs';\nimport { RX_BUNDLE, Tooltip } from '@helix/platform/shared/api';\nimport { catchError } from 'rxjs/operators';\nimport { isEmpty, last } from 'lodash';\nimport { ProgressIndicatorStatus } from '@helix/platform/ui-kit';\nimport { TranslateService } from '@ngx-translate/core';\nimport { AxBundleDeploymentService, IDeploymentStatus } from '../../../services/bundle-deployment';\n\n@Component({\n  selector: 'ax-create-bundle-modal',\n  templateUrl: './create-bundle-modal.component.html',\n  styleUrls: ['./create-bundle-modal.component.scss']\n})\nexport class CreateBundleModalComponent {\n  bundleId = '';\n  bundleCreationStatus = '';\n  bundleCreationFinishedMessage = '';\n  bundleName = '';\n  bundleShortName = '';\n  deploymentStatus = ProgressIndicatorStatus;\n  groupId = '';\n\n  type: string =\n    this.context.getData().type === RX_BUNDLE.bundleTypes.application\n      ? this.translateService.instant('com.bmc.arsys.rx.client.common.application.label')\n      : this.translateService.instant('com.bmc.arsys.rx.client.common.library.label');\n\n  bundleNameTooltip = new Tooltip(\n    this.translateService.instant('com.bmc.arsys.rx.innovation-studio.create-bundle.name.tooltip', {\n      bundleType: this.type.toLowerCase()\n    })\n  );\n\n  bundleShortNameTooltip = new Tooltip(\n    this.translateService.instant('com.bmc.arsys.rx.innovation-studio.create-bundle.short-name.tooltip', {\n      bundleType: this.type.toLowerCase()\n    })\n  );\n\n  groupIdTooltip = new Tooltip(\n    this.translateService.instant('com.bmc.arsys.rx.innovation-studio.create-bundle.group-id.tooltip', {\n      bundleType: this.type.toLowerCase()\n    })\n  );\n\n  constructor(\n    public context: ActiveModalRef,\n    private translateService: TranslateService,\n    private axBundleDeploymentService: AxBundleDeploymentService\n  ) {}\n\n  create(): void {\n    this.bundleCreationStatus = ProgressIndicatorStatus.InProgress;\n\n    this.axBundleDeploymentService\n      .create({\n        id: this.bundleId,\n        name: this.bundleShortName,\n        friendlyName: this.bundleName,\n        developerId: this.groupId,\n        isApplication: this.context.getData().type === RX_BUNDLE.bundleTypes.application\n      })\n      .pipe(\n        catchError((error) => {\n          this.bundleCreationStatus = ProgressIndicatorStatus.Failed;\n\n          this.bundleCreationFinishedMessage = this.translateService.instant(\n            'com.bmc.arsys.rx.innovation-studio.create-bundle.failure.message',\n            { bundleType: this.type }\n          );\n\n          return throwError(error);\n        })\n      )\n      .subscribe((response) => {\n        this.axBundleDeploymentService\n          .pollDeploymentStatus(last(response.headers.get('location').split('/')))\n          .subscribe((deploymentStatus: IDeploymentStatus) => {\n            if (deploymentStatus.isFinished) {\n              this.bundleCreationStatus = ProgressIndicatorStatus.Finished;\n\n              this.bundleCreationFinishedMessage = this.translateService.instant(\n                'com.bmc.arsys.rx.innovation-studio.workspace.bundle.create.successful.label',\n                { bundleType: this.type }\n              );\n            } else if (deploymentStatus.errorMessage) {\n              this.bundleCreationStatus = ProgressIndicatorStatus.Failed;\n              this.bundleCreationFinishedMessage = deploymentStatus.errorMessage;\n            }\n          });\n      });\n  }\n\n  close(bundleId: string): void {\n    if (!isEmpty(bundleId) && this.bundleCreationStatus === ProgressIndicatorStatus.Finished) {\n      this.context.close({ bundleId });\n    } else {\n      this.context.close();\n    }\n  }\n\n  dismiss(): void {\n    this.context.dismiss();\n  }\n\n  setBundleId(): void {\n    this.bundleId = `${this.groupId}.${this.bundleShortName}`;\n  }\n}\n","<div class=\"modal-header\">\n  <h5 class=\"modal-title\">\n    {{\n      'com.bmc.arsys.rx.innovation-studio.workspace.bundle.new.label'\n        | translate: { bundleType: this.type.toLowerCase() }\n    }}\n  </h5>\n  <button\n    class=\"close dp-close\"\n    data-dismiss=\"modal\"\n    type=\"button\"\n    rx-id=\"x-button\"\n    [disabled]=\"bundleCreationStatus === deploymentStatus.InProgress\"\n    (click)=\"dismiss()\"\n  ></button>\n</div>\n<div class=\"modal-body\">\n  <form #createBundleForm=\"ngForm\">\n    <adapt-rx-textfield\n      rx-id=\"bundle-name\"\n      label=\"{{\n        'com.bmc.arsys.rx.innovation-studio.workspace.bundle.name.label' | translate: { bundleType: this.type }\n      }}\"\n      [(ngModel)]=\"bundleName\"\n      maxlength=\"254\"\n      required=\"true\"\n      class=\"d-block form-group\"\n      name=\"bundleName\"\n      [tooltip]=\"bundleNameTooltip\"\n      [autofocus]=\"true\"\n      [disabled]=\"\n        bundleCreationStatus === deploymentStatus.InProgress || bundleCreationStatus === deploymentStatus.Finished\n      \"\n    >\n    </adapt-rx-textfield>\n    <adapt-rx-textfield\n      rx-id=\"bundle-short-name\"\n      label=\"{{\n        'com.bmc.arsys.rx.innovation-studio.workspace.bundle.short-name.label' | translate: { bundleType: this.type }\n      }}\"\n      [(ngModel)]=\"bundleShortName\"\n      required=\"true\"\n      class=\"d-block form-group\"\n      name=\"bundleShortName\"\n      pattern=\"^([a-zA-Z0-9]+|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])$\"\n      (ngModelChange)=\"setBundleId()\"\n      [tooltip]=\"bundleShortNameTooltip\"\n      [disabled]=\"\n        bundleCreationStatus === deploymentStatus.InProgress || bundleCreationStatus === deploymentStatus.Finished\n      \"\n    >\n    </adapt-rx-textfield>\n    <adapt-rx-textfield\n      rx-id=\"group-id\"\n      label=\"{{ 'com.bmc.arsys.rx.innovation-studio.workspace.groupId.label' | translate }}\"\n      [(ngModel)]=\"groupId\"\n      pattern=\"[a-zA-Z][a-zA-Z0-9_]*(\\.[a-zA-Z0-9_]+)*\"\n      required=\"true\"\n      class=\"d-block form-group\"\n      name=\"groupId\"\n      (ngModelChange)=\"setBundleId()\"\n      [tooltip]=\"groupIdTooltip\"\n      [disabled]=\"\n        bundleCreationStatus === deploymentStatus.InProgress || bundleCreationStatus === deploymentStatus.Finished\n      \"\n    >\n    </adapt-rx-textfield>\n    <adapt-rx-textfield\n      rx-id=\"id\"\n      label=\"{{\n        'com.bmc.arsys.rx.innovation-studio.workspace.bundle.id.label' | translate: { bundleType: this.type }\n      }}\"\n      [(ngModel)]=\"bundleId\"\n      class=\"d-block form-group\"\n      name=\"bundleId\"\n      [disabled]=\"true\"\n    >\n    </adapt-rx-textfield>\n  </form>\n  <div *ngIf=\"bundleCreationStatus === deploymentStatus.InProgress\" class=\"progress\" rx-id=\"progress-bar\">\n    <div\n      class=\"progress-bar progress-bar-intermediate\"\n      role=\"progressbar\"\n      style=\"width: 100%\"\n      aria-valuenow=\"100\"\n      aria-valuemin=\"0\"\n      aria-valuemax=\"100\"\n    ></div>\n  </div>\n  <p\n    *ngIf=\"bundleCreationStatus === deploymentStatus.Finished\"\n    class=\"d-icon-left-check_adapt\"\n    rx-id=\"operation-succeeded-message\"\n  >\n    {{ bundleCreationFinishedMessage }}\n  </p>\n  <p\n    *ngIf=\"bundleCreationStatus === deploymentStatus.Failed\"\n    class=\"d-icon-left-exclamation_triangle\"\n    rx-id=\"operation-failed-message\"\n  >\n    {{ bundleCreationFinishedMessage }}\n  </p>\n</div>\n\n<div class=\"modal-footer d-flex w-100\">\n  <button\n    *ngIf=\"bundleCreationStatus !== deploymentStatus.Finished\"\n    adapt-button\n    type=\"button\"\n    btn-type=\"primary\"\n    (click)=\"create()\"\n    [disabled]=\"\n      bundleCreationStatus === deploymentStatus.InProgress || createBundleForm.pristine || createBundleForm.invalid\n    \"\n    rx-id=\"create-button\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.create.label' | translate }}\n  </button>\n\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"secondary\"\n    (click)=\"close(bundleId)\"\n    [disabled]=\"bundleCreationStatus === deploymentStatus.InProgress\"\n    rx-id=\"close-button\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.close.label' | translate }}\n  </button>\n</div>\n"]}