{"version":3,"file":"join-criteria-expression-configurator.js","sourceRoot":"","sources":["../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/create-join-record/join-criteria-expression-configurator.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injector } from '@angular/core';\nimport { IRecordDefinition, RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport {\n  ExpressionOperatorGroup,\n  ExpressionOperatorRowsByGroup,\n  IDataDictionary,\n  IExpressionConfigurator,\n  IExpressionConfiguratorDefaultPropertyConfig,\n  RxDefinitionNameService,\n  RxExpressionConfigurator\n} from '@helix/platform/shared/api';\nimport { TranslateService } from '@ngx-translate/core';\nimport { chain } from 'lodash';\nimport { combineLatest, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nexport class JoinCriteriaExpressionConfigurator extends RxExpressionConfigurator implements IExpressionConfigurator {\n  private translateService = this.injector.get(TranslateService);\n  private rxDefinitionNameService = this.injector.get(RxDefinitionNameService);\n\n  constructor(\n    private primaryRecordDefinition$: Observable<IRecordDefinition>,\n    private secondaryRecordDefinition$: Observable<IRecordDefinition>,\n    private injector: Injector\n  ) {\n    super();\n  }\n\n  commonDataDictionary$: Observable<IDataDictionary> = combineLatest([\n    this.primaryRecordDefinition$,\n    this.secondaryRecordDefinition$\n  ]).pipe(\n    map(([primaryRecordDefinition, secondaryRecordDefinition]) => {\n      if (primaryRecordDefinition && secondaryRecordDefinition) {\n        const records = [\n          {\n            recordDefinitionName: this.rxDefinitionNameService.getDisplayName(primaryRecordDefinition.name),\n            label: `(${this.translateService.instant(\n              'com.bmc.arsys.rx.innovation-studio.join-record-wizard.join-criteria.primary.label'\n            )})`,\n            type: RX_RECORD_DEFINITION.sourceRecordTypes.primary,\n            fieldDefinitions: primaryRecordDefinition.fieldDefinitions\n          },\n          {\n            recordDefinitionName: this.rxDefinitionNameService.getDisplayName(secondaryRecordDefinition.name),\n            label: `(${this.translateService.instant(\n              'com.bmc.arsys.rx.innovation-studio.join-record-wizard.join-criteria.secondary.label'\n            )})`,\n            type: RX_RECORD_DEFINITION.sourceRecordTypes.secondary,\n            fieldDefinitions: secondaryRecordDefinition.fieldDefinitions\n          }\n        ];\n\n        return records.map((record) => ({\n          label: `${record.recordDefinitionName} ${record.label}`,\n          expanded: true,\n          children: chain(record.fieldDefinitions)\n            .reject({ resourceType: RX_RECORD_DEFINITION.dataTypes.attachment.resourceType })\n            .map((fieldDefinition) => ({\n              label: `${record.recordDefinitionName}.${fieldDefinition.name}`,\n              icon: 'd-icon-field_text',\n              expression: `\\${${record.recordDefinitionName}.${record.type}.${fieldDefinition.name}}`\n            }))\n            .sortBy((item) => item.label.toLocaleLowerCase())\n            .value()\n        }));\n      } else {\n        return [];\n      }\n    })\n  );\n\n  getDefaultConfig(): IExpressionConfiguratorDefaultPropertyConfig {\n    return {\n      ...super.getDefaultConfig(),\n      operators: ExpressionOperatorRowsByGroup.get(ExpressionOperatorGroup.AllServer)\n    };\n  }\n}\n"]}