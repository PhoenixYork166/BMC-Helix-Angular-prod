{"version":3,"file":"data-source-step.component.js","sourceRoot":"","sources":["../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/external-record-wizard/data-source-step/data-source-step.component.ts","../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/external-record-wizard/data-source-step/data-source-step.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, ComponentFactoryResolver, OnDestroy, OnInit } from '@angular/core';\nimport { FormControl, Validators } from '@angular/forms';\nimport { RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { ReplaySubject } from 'rxjs';\nimport { distinctUntilChanged, map, takeUntil } from 'rxjs/operators';\nimport { isEqual } from 'lodash';\nimport { RxWizardModalComponent } from '@helix/platform/shared/components';\nimport { DocumentSelectionStepComponent } from '../document-selection-step/document-selection-step.component';\nimport { RxExternalDataService } from '../../../services/external-data/external-data.service';\nimport { FieldSelectionStepComponent } from '../field-selection-step/field-selection-step.component';\nimport { FieldTreeSelectionStepComponent } from '../field-tree-selection-step/field-tree-selection-step.component';\nimport { OperationSelectionStepComponent } from '../operation-selection-step/operation-selection-step.component';\nimport { RecordIdFieldsStepComponent } from '../record-id-fields-step/record-id-fields-step.component';\nimport { TableSelectionStepComponent } from '../table-selection-step/table-selection-step.component';\nimport { WebApiSelectionStepComponent } from '../web-api-selection-step/web-api-selection-step.component';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'ax-data-source-step',\n  templateUrl: 'data-source-step.component.html',\n  styleUrls: ['./data-source-step.component.scss']\n})\nexport class DataSourceStepComponent implements OnDestroy, OnInit {\n  private destroyed$ = new ReplaySubject<boolean>(1);\n\n  dataSourceTypeLabel: string;\n  dataSourceTypeFormControl = new FormControl([], Validators.required);\n  dataSourceTypes: RxSelectOption[] = [];\n  dataSourceNameLabel: string;\n  dataSourceNameFormControl = new FormControl([], Validators.required);\n  dataSourceNames: RxSelectOption[] = [];\n\n  constructor(\n    private componentFactoryResolver: ComponentFactoryResolver,\n    private rxExternalDataService: RxExternalDataService,\n    private rxWizardModalComponent: RxWizardModalComponent,\n    private translateService: TranslateService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceNameLabel = this.translateService.instant(\n      'com.bmc.arsys.rx.innovation-studio.external-record-wizard.data-source.data-source-name.label'\n    );\n    this.dataSourceTypeLabel = this.translateService.instant(\n      'com.bmc.arsys.rx.innovation-studio.external-record-wizard.data-source.data-source-type.label'\n    );\n\n    this.rxWizardModalComponent.api.disableNextButton();\n\n    this.rxExternalDataService\n      .getDataSourceTypes()\n      .subscribe(\n        (availableDataSourceTypes: string[]) =>\n          (this.dataSourceTypes = availableDataSourceTypes.filter(\n            (type) => type !== RX_RECORD_DEFINITION.externalRecordDefinitionTypes.custom\n          ))\n      );\n\n    this.dataSourceTypeFormControl.valueChanges\n      .pipe(takeUntil(this.destroyed$))\n      .subscribe((selectedDataSourceTypes: RxSelectOption[]) => {\n        const dataSourceType = selectedDataSourceTypes[0];\n\n        if (dataSourceType === RX_RECORD_DEFINITION.externalRecordDefinitionDataSourceTypes.webApi) {\n          this.rxWizardModalComponent.api.removeNextSteps(1);\n\n          this.rxWizardModalComponent.api.addStep({\n            id: 'web-api-selection',\n            name: this.translateService.instant(\n              'com.bmc.arsys.rx.innovation-studio.external-record-wizard.web-api-selection.title'\n            ),\n            componentFactory: this.componentFactoryResolver.resolveComponentFactory(WebApiSelectionStepComponent)\n          });\n\n          this.rxWizardModalComponent.api.addStep({\n            id: 'document-selection',\n            name: this.translateService.instant(\n              'com.bmc.arsys.rx.innovation-studio.external-record-wizard.document-selection.title'\n            ),\n            componentFactory: this.componentFactoryResolver.resolveComponentFactory(DocumentSelectionStepComponent)\n          });\n\n          this.rxWizardModalComponent.api.addStep({\n            id: 'field-tree-selection',\n            name: this.translateService.instant(\n              'com.bmc.arsys.rx.innovation-studio.external-record-wizard.field-tree-selection.title'\n            ),\n            componentFactory: this.componentFactoryResolver.resolveComponentFactory(FieldTreeSelectionStepComponent)\n          });\n\n          this.rxWizardModalComponent.api.addStep({\n            id: 'operation-selection',\n            name: this.translateService.instant(\n              'com.bmc.arsys.rx.innovation-studio.external-record-wizard.operation-selection.title'\n            ),\n            componentFactory: this.componentFactoryResolver.resolveComponentFactory(OperationSelectionStepComponent)\n          });\n        } else {\n          this.rxWizardModalComponent.api.removeNextSteps(1);\n\n          this.rxWizardModalComponent.api.addStep({\n            id: 'table-selection',\n            name: this.translateService.instant(\n              'com.bmc.arsys.rx.innovation-studio.external-record-wizard.table-selection.title'\n            ),\n            componentFactory: this.componentFactoryResolver.resolveComponentFactory(TableSelectionStepComponent)\n          });\n\n          this.rxWizardModalComponent.api.addStep({\n            id: 'record-id-fields',\n            name: this.translateService.instant(\n              'com.bmc.arsys.rx.innovation-studio.external-record-wizard.record-id-fields.title'\n            ),\n            componentFactory: this.componentFactoryResolver.resolveComponentFactory(RecordIdFieldsStepComponent)\n          });\n\n          this.rxWizardModalComponent.api.addStep({\n            id: 'field-selection',\n            name: this.translateService.instant(\n              'com.bmc.arsys.rx.innovation-studio.external-record-wizard.field-selection.title'\n            ),\n            componentFactory: this.componentFactoryResolver.resolveComponentFactory(FieldSelectionStepComponent)\n          });\n        }\n\n        this.rxWizardModalComponent.api.updateContext({ dataSourceType });\n\n        if (this.dataSourceNameFormControl.value.length) {\n          this.dataSourceNames = [];\n          this.dataSourceNameFormControl.setValue([]);\n        }\n\n        this.rxExternalDataService\n          .getDataSourceNames(dataSourceType)\n          .subscribe((availableDataSourceNames: string[]) => (this.dataSourceNames = availableDataSourceNames));\n      });\n\n    this.dataSourceNameFormControl.valueChanges\n      .pipe(takeUntil(this.destroyed$))\n      .subscribe((selectedDataSourceNames: RxSelectOption[]) => {\n        this.rxWizardModalComponent.api.updateContext({\n          dataSourceName: selectedDataSourceNames[0]\n        });\n      });\n\n    this.rxWizardModalComponent.context$\n      .pipe(\n        takeUntil(this.destroyed$),\n        map(({ dataSourceType, dataSourceName }) => ({ dataSourceType, dataSourceName })),\n        distinctUntilChanged(isEqual)\n      )\n      .subscribe(({ dataSourceType, dataSourceName }) => {\n        if (dataSourceType && dataSourceName) {\n          this.rxWizardModalComponent.api.enableNextButton();\n        } else {\n          this.rxWizardModalComponent.api.disableNextButton();\n        }\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroyed$.next(true);\n    this.destroyed$.complete();\n  }\n}\n","<div class=\"d-flex flex-column control-width\">\n  <adapt-rx-select\n    [label]=\"dataSourceTypeLabel\"\n    [options]=\"dataSourceTypes\"\n    [required]=\"true\"\n    [formControl]=\"dataSourceTypeFormControl\"\n    class=\"form-group\"\n  ></adapt-rx-select>\n  <adapt-rx-select\n    [label]=\"dataSourceNameLabel\"\n    [options]=\"dataSourceNames\"\n    [required]=\"true\"\n    [formControl]=\"dataSourceNameFormControl\"\n    class=\"form-group\"\n  ></adapt-rx-select>\n</div>\n"]}