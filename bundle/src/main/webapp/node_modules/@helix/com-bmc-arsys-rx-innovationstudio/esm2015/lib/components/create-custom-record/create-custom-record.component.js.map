{"version":3,"file":"create-custom-record.component.js","sourceRoot":"","sources":["../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/create-custom-record/create-custom-record.component.ts","../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/create-custom-record/create-custom-record.component.html"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,iBAAiB,CAAC;AACzC,OAAO,EAAE,WAAW,EAAa,UAAU,EAAE,MAAM,gBAAgB,CAAC;AACpE,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AACpD,OAAO,EAAE,cAAc,EAAE,MAAM,uBAAuB,CAAC;AACvD,OAAO,EAAE,YAAY,EAAE,MAAM,wBAAwB,CAAC;AACtD,OAAO,EAAE,yBAAyB,EAAE,oBAAoB,EAAE,MAAM,4BAA4B,CAAC;AAC7F,OAAO,EAAE,uBAAuB,EAAE,oBAAoB,EAAE,cAAc,EAAE,MAAM,4BAA4B,CAAC;AAC3G,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAErD,OAAO,EAAE,qBAAqB,EAAE,MAAM,oDAAoD,CAAC;;;;;;;;;;AAM3F,MAAM,OAAO,2BAA4B,SAAQ,YAAY;IAK3D,YACY,QAAkB,EACpB,WAAwB,EACxB,cAA8B,EAC9B,qBAA4C,EAC5C,yBAAoD,EACpD,uBAAgD,EAChD,aAAmC,EACnC,MAAc;QAEtB,KAAK,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;QATtB,aAAQ,GAAR,QAAQ,CAAU;QACpB,gBAAW,GAAX,WAAW,CAAa;QACxB,mBAAc,GAAd,cAAc,CAAgB;QAC9B,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,4BAAuB,GAAvB,uBAAuB,CAAyB;QAChD,kBAAa,GAAb,aAAa,CAAsB;QACnC,WAAM,GAAN,MAAM,CAAQ;QAItB,IAAI,CAAC,QAAQ,EAAE,CAAC;QAEhB,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC,qBAAqB;aACrD,kBAAkB,CAAC,oBAAoB,CAAC,6BAA6B,CAAC,MAAM,CAAC;aAC7E,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,CAAC;IACzB,CAAC;IAED,MAAM;QACJ,MAAM,2BAA2B,GAAG,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC;QAEtE,MAAM,oBAAoB,GAAG,IAAI,CAAC,uBAAuB,CAAC,iBAAiB,CACzE,IAAI,CAAC,aAAa,CAAC,QAAQ,EAC3B,2BAA2B,CAAC,IAAI,CACjC,CAAC;QAEF,MAAM,sBAAsB,GAAG;YAC7B,IAAI,EAAE,oBAAoB;YAC1B,cAAc,EAAE,2BAA2B,CAAC,cAAc,CAAC,CAAC,CAAC;YAC7D,YAAY,EAAE,oBAAoB,CAAC,qBAAqB,CAAC,QAAQ,CAAC,oBAAoB;YACtF,gBAAgB,EAAE;gBAChB;oBACE,YAAY,EAAE,oBAAoB,CAAC,aAAa,CAAC,SAAS;oBAC1D,IAAI,EAAE,YAAY;oBAClB,EAAE,EAAE,CAAC;oBACL,WAAW,EAAE,oBAAoB,CAAC,YAAY,CAAC,MAAM;iBACtD;gBACD;oBACE,YAAY,EAAE,oBAAoB,CAAC,aAAa,CAAC,SAAS;oBAC1D,IAAI,EAAE,IAAI;oBACV,EAAE,EAAE,GAAG;oBACP,WAAW,EAAE,oBAAoB,CAAC,YAAY,CAAC,MAAM;iBACtD;gBACD;oBACE,YAAY,EAAE,oBAAoB,CAAC,aAAa,CAAC,SAAS;oBAC1D,IAAI,EAAE,kBAAkB;oBACxB,EAAE,EAAE,GAAG;oBACP,WAAW,EAAE,oBAAoB,CAAC,YAAY,CAAC,QAAQ;iBACxD;aACF;SACF,CAAC;QAEF,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;QAE1B,IAAI,CAAC,yBAAyB;aAC3B,MAAM,CAAC,sBAAsB,CAAC;aAC9B,IAAI,CACH,QAAQ,CAAC,GAAG,EAAE;YACZ,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QAC3B,CAAC,CAAC,CACH;aACA,SAAS,CAAC,GAAG,EAAE;YACd,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,cAAc,CAAC,wBAAwB,EAAE,QAAQ,EAAE,MAAM,EAAE,oBAAoB,CAAC,CAAC,CAAC;QAC1G,CAAC,CAAC,CAAC;IACP,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAEO,QAAQ;QACd,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC;YACnD,IAAI,EAAE,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;YAC3D,cAAc,EAAE,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;SACtE,CAAC,CAAC;IACL,CAAC;;2IAjFU,2BAA2B;+HAA3B,2BAA2B,sFCfxC,4vDA4DA;2FD7Ca,2BAA2B;kBAJvC,SAAS;mBAAC;oBACT,QAAQ,EAAE,yBAAyB;oBACnC,WAAW,EAAE,uCAAuC;iBACrD","sourcesContent":["import { Router } from '@angular/router';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Component, Injector } from '@angular/core';\nimport { ActiveModalRef } from '@bmc-ux/adapt-angular';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { RxRecordDefinitionService, RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { RxDefinitionNameService, RxBundleCacheService, RX_APPLICATION } from '@helix/platform/shared/api';\nimport { finalize, startWith } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\nimport { RxExternalDataService } from '../../services/external-data/external-data.service';\n\n@Component({\n  selector: 'ax-create-custom-record',\n  templateUrl: './create-custom-record.component.html'\n})\nexport class CreateCustomRecordComponent extends RxModalClass {\n  createCustomRecordForm: FormGroup;\n\n  customDataSourceNames$: Observable<string[]>;\n\n  constructor(\n    protected injector: Injector,\n    private formBuilder: FormBuilder,\n    private activeModalRef: ActiveModalRef,\n    private rxExternalDataService: RxExternalDataService,\n    private rxRecordDefinitionService: RxRecordDefinitionService,\n    private rxDefinitionNameService: RxDefinitionNameService,\n    private rxBundleCache: RxBundleCacheService,\n    private router: Router\n  ) {\n    super(activeModalRef, injector);\n\n    this.initForm();\n\n    this.customDataSourceNames$ = this.rxExternalDataService\n      .getDataSourceNames(RX_RECORD_DEFINITION.externalRecordDefinitionTypes.custom)\n      .pipe(startWith([]));\n  }\n\n  submit(): void {\n    const createCustomRecordFormValue = this.createCustomRecordForm.value;\n\n    const recordDefinitionName = this.rxDefinitionNameService.getDefinitionName(\n      this.rxBundleCache.bundleId,\n      createCustomRecordFormValue.name\n    );\n\n    const customRecordDefinition = {\n      name: recordDefinitionName,\n      dataSourceName: createCustomRecordFormValue.dataSourceName[0],\n      resourceType: RX_RECORD_DEFINITION.recordDefinitionTypes.external.recordDefinitionType,\n      fieldDefinitions: [\n        {\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character,\n          name: 'Display ID',\n          id: 1,\n          fieldOption: RX_RECORD_DEFINITION.fieldOptions.system\n        },\n        {\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character,\n          name: 'ID',\n          id: 379,\n          fieldOption: RX_RECORD_DEFINITION.fieldOptions.system\n        },\n        {\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character,\n          name: 'Data Provider ID',\n          id: 380,\n          fieldOption: RX_RECORD_DEFINITION.fieldOptions.required\n        }\n      ]\n    };\n\n    this.allowDismiss = false;\n\n    this.rxRecordDefinitionService\n      .create(customRecordDefinition)\n      .pipe(\n        finalize(() => {\n          this.allowDismiss = true;\n        })\n      )\n      .subscribe(() => {\n        this.router.navigate([RX_APPLICATION.innovationStudioBundleId, 'record', 'edit', recordDefinitionName]);\n      });\n  }\n\n  cancel() {\n    this.dismissDialog();\n  }\n\n  private initForm(): void {\n    this.createCustomRecordForm = this.formBuilder.group({\n      name: this.formBuilder.control(null, [Validators.required]),\n      dataSourceName: this.formBuilder.control(null, [Validators.required])\n    });\n  }\n}\n","<div class=\"modal-header\">\n  <h5 class=\"modal-title\">\n    {{ 'com.bmc.arsys.rx.innovation-studio.create-custom-record-modal.title' | translate }}\n  </h5>\n  <button\n    class=\"close close-inverse\"\n    data-dismiss=\"modal\"\n    type=\"button\"\n    rx-id=\"x-button\"\n    [disabled]=\"!allowDismiss\"\n    (click)=\"cancel()\"\n  ></button>\n</div>\n\n<div class=\"modal-body\">\n  <form [formGroup]=\"createCustomRecordForm\">\n    <adapt-rx-textfield\n      autofocus\n      rx-id=\"name\"\n      class=\"d-block form-group\"\n      name=\"name\"\n      formControlName=\"name\"\n      label=\"{{ 'com.bmc.arsys.rx.client.common.name.label' | translate }}\"\n    ></adapt-rx-textfield>\n    <adapt-rx-select\n      rx-id=\"data-source-name\"\n      class=\"form-group\"\n      label=\"{{ 'com.bmc.arsys.rx.innovation-studio.create-custom-record-modal.data-source-name.label' | translate }}\"\n      name=\"dataSourceName\"\n      formControlName=\"dataSourceName\"\n      [disabled]=\"!allowDismiss\"\n      [options]=\"customDataSourceNames$ | async\"\n    ></adapt-rx-select>\n  </form>\n</div>\n\n<div class=\"modal-footer d-flex w-100\">\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"primary\"\n    [adaptInlineLoader]=\"!allowDismiss\"\n    [disabled]=\"createCustomRecordForm.pristine || createCustomRecordForm.invalid || !allowDismiss\"\n    (click)=\"submit()\"\n    rx-id=\"create-button\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.create.label' | translate }}\n  </button>\n\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"secondary\"\n    [disabled]=\"!allowDismiss\"\n    (click)=\"cancel()\"\n    rx-id=\"cancel-button\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n  </button>\n</div>\n"]}