{"version":3,"file":"record-definitions-step.component.js","sourceRoot":"","sources":["../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/join-record-wizard/record-definitions-step/record-definitions-step.component.ts","../../../../../../../../libs/com-bmc-arsys-rx-innovationstudio/src/lib/components/join-record-wizard/record-definitions-step/record-definitions-step.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { FormControl, Validators } from '@angular/forms';\nimport { RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport {\n  IDefinitionPickerComponentOptions,\n  RxDefinitionPickerScope,\n  RxDefinitionPickerType,\n  RxWizardModalComponent\n} from '@helix/platform/shared/components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { head } from 'lodash';\nimport { ReplaySubject } from 'rxjs';\nimport { takeUntil, withLatestFrom } from 'rxjs/operators';\nimport { IJoinRecordWizardContext } from '../join-record-wizard.types';\n\n@Component({\n  selector: 'ax-record-definitions-step',\n  templateUrl: './record-definitions-step.component.html',\n  styleUrls: ['./record-definitions-step.component.scss']\n})\nexport class RecordDefinitionsStepComponent implements OnInit, OnDestroy {\n  private destroyed$ = new ReplaySubject<boolean>(1);\n\n  private definitionPickerConfig: IDefinitionPickerComponentOptions = {\n    label: '',\n    definitionType: RxDefinitionPickerType.Record,\n    availableDefinitionPickerStates: {\n      definitionButtonsGroups: [RxDefinitionPickerScope.Bundle, RxDefinitionPickerScope.All],\n      search: RxDefinitionPickerScope.All\n    },\n    required: true\n  };\n\n  primaryDefinitionPickerConfig = {\n    ...this.definitionPickerConfig,\n    label: this.translateService.instant(\n      'com.bmc.arsys.rx.innovation-studio.join-record-wizard.record-definitions.primary-record.label'\n    )\n  };\n\n  secondaryDefinitionPickerConfig = {\n    ...this.definitionPickerConfig,\n    label: this.translateService.instant(\n      'com.bmc.arsys.rx.innovation-studio.join-record-wizard.record-definitions.secondary-record.label'\n    )\n  };\n\n  joinTypes: RxSelectOption[] = [RX_RECORD_DEFINITION.joinTypes.inner, RX_RECORD_DEFINITION.joinTypes.outer];\n\n  primaryRecordDefinitionNameFormControl = new FormControl('', Validators.required);\n  secondaryRecordDefinitionNameFormControl = new FormControl('', Validators.required);\n  joinTypeFormControl = new FormControl([], Validators.required);\n\n  constructor(private translateService: TranslateService, private rxWizardModalComponent: RxWizardModalComponent) {}\n\n  optionFormatter(selectOption: RxSelectOption): string {\n    return selectOption.displayName;\n  }\n\n  ngOnInit() {\n    this.rxWizardModalComponent.api.disableFinishButton();\n    this.rxWizardModalComponent.api.disableNextButton();\n\n    this.primaryRecordDefinitionNameFormControl.valueChanges\n      .pipe(withLatestFrom(this.rxWizardModalComponent.context$), takeUntil(this.destroyed$))\n      .subscribe(([primaryRecordDefinitionName, context]) => {\n        const newContext: IJoinRecordWizardContext = { primaryRecordDefinitionName };\n\n        if (primaryRecordDefinitionName !== context.primaryRecordDefinitionName) {\n          newContext.joinCriteria = null;\n          newContext.selectedFields = null;\n        }\n\n        this.rxWizardModalComponent.api.updateContext(newContext);\n      });\n\n    this.secondaryRecordDefinitionNameFormControl.valueChanges\n      .pipe(withLatestFrom(this.rxWizardModalComponent.context$), takeUntil(this.destroyed$))\n      .subscribe(([secondaryRecordDefinitionName, context]) => {\n        const newContext: IJoinRecordWizardContext = { secondaryRecordDefinitionName };\n\n        if (secondaryRecordDefinitionName !== context.primaryRecordDefinitionName) {\n          newContext.joinCriteria = null;\n          newContext.selectedFields = null;\n        }\n\n        this.rxWizardModalComponent.api.updateContext(newContext);\n      });\n\n    this.joinTypeFormControl.valueChanges.pipe(takeUntil(this.destroyed$)).subscribe((joinType: RxSelectOption[]) => {\n      this.rxWizardModalComponent.api.updateContext({\n        joinType: head(joinType).value\n      });\n    });\n\n    this.rxWizardModalComponent.context$\n      .pipe(takeUntil(this.destroyed$))\n      .subscribe((context: IJoinRecordWizardContext) => {\n        if (context.primaryRecordDefinitionName && context.secondaryRecordDefinitionName && context.joinType) {\n          this.rxWizardModalComponent.api.enableNextButton();\n        } else {\n          this.rxWizardModalComponent.api.disableNextButton();\n        }\n      });\n  }\n\n  ngOnDestroy() {\n    this.destroyed$.next();\n    this.destroyed$.complete();\n  }\n}\n","<div class=\"d-flex flex-column control-width\">\n  <rx-definition-picker\n    [options]=\"primaryDefinitionPickerConfig\"\n    [formControl]=\"primaryRecordDefinitionNameFormControl\"\n    class=\"form-group\"\n  ></rx-definition-picker>\n\n  <rx-definition-picker\n    [options]=\"secondaryDefinitionPickerConfig\"\n    [formControl]=\"secondaryRecordDefinitionNameFormControl\"\n    class=\"form-group\"\n  ></rx-definition-picker>\n\n  <adapt-rx-select\n    [required]=\"true\"\n    [label]=\"'com.bmc.arsys.rx.innovation-studio.join-record-wizard.record-definitions.type.label' | translate\"\n    [options]=\"joinTypes\"\n    [optionFormatter]=\"optionFormatter\"\n    [formControl]=\"joinTypeFormControl\"\n  ></adapt-rx-select>\n</div>\n"]}