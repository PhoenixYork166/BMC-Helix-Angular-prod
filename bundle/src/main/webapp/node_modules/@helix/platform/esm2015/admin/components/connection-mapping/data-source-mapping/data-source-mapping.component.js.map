{"version":3,"file":"data-source-mapping.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/connection-mapping/data-source-mapping/data-source-mapping.component.ts","../../../../../../../../libs/platform/admin/components/connection-mapping/data-source-mapping/data-source-mapping.component.html"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAU,MAAM,eAAe,CAAC;AAElD,OAAO,EAAE,+BAA+B,EAAE,MAAM,4BAA4B,CAAC;AAE7E,OAAO,EAAE,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,QAAQ,CAAC;AAC7C,OAAO,EAAE,QAAQ,EAA4B,MAAM,MAAM,CAAC;AAC1D,OAAO,EAAE,qBAAqB,EAAE,MAAM,uCAAuC,CAAC;;;;;;;;AAM9E,MAAM,OAAO,+BAA+B;IAO1C,YAAoB,+BAAgE;QAAhE,oCAA+B,GAA/B,+BAA+B,CAAiC;QANpF,6BAAwB,GAAqB,EAAE,CAAC;IAMuC,CAAC;IAExF,QAAQ;QACN,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,yBAAyB,CAAC;YACzC,gBAAgB,EAAE,qBAAqB,CAAC,YAAY,CAAC,oBAAoB;YACzE,eAAe,EAAE,IAAI,qBAAqB,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,YAAY;YACpF,iBAAiB,EAAE,MAAM,CAAC,qBAAqB,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE;SAC5E,CAAC,CAAC,SAAS,CAAC,CAAC,QAAQ,EAAE,EAAE;YACxB,IAAI,CAAC,wBAAwB,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,qBAAqB,CAAC,YAAY,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;QACjH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,eAAe,CAAC,WAA2B;QACzC,OAAO,WAAW,CAAC,qBAAqB,CAAC,YAAY,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;IAChF,CAAC;IAEO,yBAAyB,CAAC,MAAuB;QACvD,OAAO,IAAI,CAAC,+BAA+B,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;IAC/D,CAAC;IAED,mBAAmB,CAAC,mBAAmC;QACrD,MAAM,aAAa,GAAG,GAAG,CAAC,mBAAmB,EAAE,KAAK,qBAAqB,CAAC,YAAY,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC,CAAC;QAE/G,IAAI,aAAa,EAAE;YACjB,QAAQ,CAAC;gBACP,iBAAiB,EAAE,IAAI,CAAC,yBAAyB,CAAC;oBAChD,gBAAgB,EAAE,qBAAqB,CAAC,UAAU,CAAC,oBAAoB;oBACvE,iBAAiB,EAAE,MAAM,CAAC,qBAAqB,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE;iBAC1E,CAAC;gBACF,sBAAsB,EAAE,IAAI,CAAC,yBAAyB,CAAC;oBACrD,gBAAgB,EAAE,qBAAqB,CAAC,YAAY,CAAC,oBAAoB;oBACzE,iBAAiB,EAAE,MAAM,CAAC,qBAAqB,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE;oBAC3E,eAAe,EACb,MAAM,qBAAqB,CAAC,YAAY,CAAC,MAAM,CAAC,aAAa,MAAM,aAAa,QAAQ;wBACxF,IAAI,qBAAqB,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,MAAM,qBAAqB,CAAC,UAAU,CAAC,UAAU,KAAK;iBAChH,CAAC;aACH,CAAC,CAAC,SAAS,CAAC,CAAC,MAAM,EAAE,EAAE;gBACtB,IAAI,CAAC,iBAAiB,GAAG,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC;gBACvD,IAAI,CAAC,sBAAsB,GAAG,MAAM,CAAC,sBAAsB,CAAC,IAAI,CAAC;YACnE,CAAC,CAAC,CAAC;SACJ;IACH,CAAC;;4HAhDU,+BAA+B;gHAA/B,+BAA+B,oECZ5C,qsBAqBA;2FDTa,+BAA+B;kBAJ3C,SAAS;mBAAC;oBACT,QAAQ,EAAE,8BAA8B;oBACxC,WAAW,EAAE,sCAAsC;iBACpD","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { RxRecordInstanceDataPageService } from '@helix/platform/record/api';\nimport { IDataPageParams, IDataPageResult, IPlainObject } from '@helix/platform/shared/api';\nimport { get, uniqBy, values } from 'lodash';\nimport { forkJoin, Observable, Subscription } from 'rxjs';\nimport { RX_CONNECTION_MAPPING } from '../common/connection-mapping.constant';\n\n@Component({\n  selector: 'rx-admin-data-source-mapping',\n  templateUrl: './data-source-mapping.component.html'\n})\nexport class DataSourceMappingAdminComponent implements OnInit {\n  applicationSelectOptions: RxSelectOption[] = [];\n  selectedApplication: RxSelectOption;\n  applicationMappingList: IPlainObject[];\n  configurationList: IPlainObject[];\n  busy: Subscription;\n\n  constructor(private rxRecordInstanceDataPageService: RxRecordInstanceDataPageService) {}\n\n  ngOnInit() {\n    this.busy = this.getRecordInstanceDataPage({\n      recorddefinition: RX_CONNECTION_MAPPING.aliasMapping.recordDefinitionName,\n      queryExpression: `'${RX_CONNECTION_MAPPING.aliasMapping.fields.aliasType}'!=\"email\"`,\n      propertySelection: values(RX_CONNECTION_MAPPING.aliasMapping.fields).join()\n    }).subscribe((response) => {\n      this.applicationSelectOptions = uniqBy(response.data, RX_CONNECTION_MAPPING.aliasMapping.fields.applicationId);\n    });\n  }\n\n  optionFormatter(application: RxSelectOption): string {\n    return application[RX_CONNECTION_MAPPING.aliasMapping.fields.applicationName];\n  }\n\n  private getRecordInstanceDataPage(params: IDataPageParams): Observable<IDataPageResult> {\n    return this.rxRecordInstanceDataPageService.post({ params });\n  }\n\n  onApplicationChange(selectedApplication: RxSelectOption): void {\n    const applicationId = get(selectedApplication, `0.${RX_CONNECTION_MAPPING.aliasMapping.fields.applicationId}`);\n\n    if (applicationId) {\n      forkJoin({\n        configurationList: this.getRecordInstanceDataPage({\n          recorddefinition: RX_CONNECTION_MAPPING.dataSource.recordDefinitionName,\n          propertySelection: values(RX_CONNECTION_MAPPING.dataSource.fields).join()\n        }),\n        applicationMappingList: this.getRecordInstanceDataPage({\n          recorddefinition: RX_CONNECTION_MAPPING.aliasMapping.recordDefinitionName,\n          propertySelection: values(RX_CONNECTION_MAPPING.aliasMapping.fields).join(),\n          queryExpression:\n            `(('${RX_CONNECTION_MAPPING.aliasMapping.fields.applicationId}'=\"${applicationId}\" AND ` +\n            `'${RX_CONNECTION_MAPPING.aliasMapping.fields.aliasType}'=\"${RX_CONNECTION_MAPPING.aliasTypes.dataSource}\"))`\n        })\n      }).subscribe((result) => {\n        this.configurationList = result.configurationList.data;\n        this.applicationMappingList = result.applicationMappingList.data;\n      });\n    }\n  }\n}\n","<rx-admin-settings header=\"Data source mapping\" [busy]=\"busy\">\n  <div class=\"row\">\n    <adapt-rx-select\n      class=\"col-md-6 form-group\"\n      rx-id=\"data-source-application\"\n      label=\"Application\"\n      [ngModel]=\"selectedApplication\"\n      [options]=\"applicationSelectOptions\"\n      [optionFormatter]=\"optionFormatter\"\n      (ngModelChange)=\"onApplicationChange($event)\"\n    ></adapt-rx-select>\n  </div>\n\n  <rx-connection-mapping\n    *ngFor=\"let applicationMapping of applicationMappingList\"\n    [configurations]=\"configurationList\"\n    [aliasMapping]=\"applicationMapping\"\n    aliasType=\"dataSource\"\n  >\n  </rx-connection-mapping>\n</rx-admin-settings>\n"]}