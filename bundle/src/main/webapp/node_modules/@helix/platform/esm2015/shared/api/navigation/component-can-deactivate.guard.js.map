{"version":3,"file":"component-can-deactivate.guard.js","sourceRoot":"","sources":["../../../../../../../libs/platform/shared/api/navigation/component-can-deactivate.guard.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAC3C,OAAO,EAAiB,aAAa,EAAE,MAAM,EAAE,MAAM,iBAAiB,CAAC;AAEvE,OAAO,EAAE,MAAM,EAAE,MAAM,gBAAgB,CAAC;AACxC,OAAO,EAAE,cAAc,EAAE,sBAAsB,EAAE,MAAM,wBAAwB,CAAC;;;;AAKhF,MAAM,OAAO,6BAA6B;IAIxC,YACU,MAAc,EACd,cAA8B,EAC9B,sBAA8C;QAF9C,WAAM,GAAN,MAAM,CAAQ;QACd,mBAAc,GAAd,cAAc,CAAgB;QAC9B,2BAAsB,GAAtB,sBAAsB,CAAwB;QALhD,cAAS,GAAG,IAAI,CAAC;QAOvB,MAAM,CAAC,gBAAgB,CAAC,cAAc,EAAE,CAAC,KAAK,EAAE,EAAE;;YAChD,IACE,IAAI,CAAC,SAAS;gBACd,CAAC,CAAA,MAAA,IAAI,CAAC,aAAa,0CAAE,aAAa,EAAE,MAAK,KAAK;oBAC5C,IAAI,CAAC,cAAc,CAAC,qBAAqB,EAAE;oBAC3C,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,CAAC,EACxC;gBACA,KAAK,CAAC,WAAW,GAAG,IAAI,CAAC;aAC1B;QACH,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,YAAY,aAAa,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;IAC5G,CAAC;IAED,aAAa,CAAC,SAAmC;;QAC/C,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,qBAAqB,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,CAAC,EAAE;YAC5G,OAAO,IAAI,CAAC,sBAAsB,CAAC,qBAAqB,EAAE,CAAC;SAC5D;aAAM,IAAI,IAAI,CAAC,SAAS,IAAI,CAAA,MAAA,IAAI,CAAC,aAAa,0CAAE,aAAa,EAAE,MAAK,KAAK,EAAE;YAC1E,OAAO,IAAI,CAAC,aAAa,CAAC,mBAAmB,EAAE,CAAC;SACjD;aAAM;YACL,OAAO,IAAI,CAAC;SACb;IACH,CAAC;IAED,gBAAgB,CAAC,SAAkC;QACjD,IAAI,CAAC,aAAa,GAAG,SAAS,CAAC;IACjC,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;IACxB,CAAC;IAED,OAAO;QACL,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;IACzB,CAAC;;0HA3CU,6BAA6B;8HAA7B,6BAA6B,cAF5B,MAAM;2FAEP,6BAA6B;kBAHzC,UAAU;mBAAC;oBACV,UAAU,EAAE,MAAM;iBACnB","sourcesContent":["import { IComponentCanDeactivate } from './component-can-deactivate.interface';\nimport { Injectable } from '@angular/core';\nimport { CanDeactivate, NavigationEnd, Router } from '@angular/router';\nimport { Observable } from 'rxjs';\nimport { filter } from 'rxjs/operators';\nimport { RxModalService, RxUtilityModalsService } from '@helix/platform/ui-kit';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RxComponentCanDeactivateGuard implements CanDeactivate<IComponentCanDeactivate> {\n  pageComponent: IComponentCanDeactivate | undefined;\n  private isEnabled = true;\n\n  constructor(\n    private router: Router,\n    private rxModalService: RxModalService,\n    private rxUtilityModalsService: RxUtilityModalsService\n  ) {\n    window.addEventListener('beforeunload', (event) => {\n      if (\n        this.isEnabled &&\n        (this.pageComponent?.canDeactivate() === false ||\n          this.rxModalService.isAnyDockedPanelDirty() ||\n          this.rxModalService.isAnyModalDirty())\n      ) {\n        event.returnValue = true;\n      }\n    });\n\n    this.router.events.pipe(filter((event) => event instanceof NavigationEnd)).subscribe(() => this.enable());\n  }\n\n  canDeactivate(component?: IComponentCanDeactivate): Observable<boolean> | Promise<boolean> | boolean {\n    if (this.isEnabled && (this.rxModalService.isAnyDockedPanelDirty() || this.rxModalService.isAnyModalDirty())) {\n      return this.rxUtilityModalsService.confirmUnsavedChanges();\n    } else if (this.isEnabled && this.pageComponent?.canDeactivate() === false) {\n      return this.pageComponent.confirmDeactivation();\n    } else {\n      return true;\n    }\n  }\n\n  setPageComponent(component: IComponentCanDeactivate) {\n    this.pageComponent = component;\n  }\n\n  enable(): void {\n    this.isEnabled = true;\n  }\n\n  disable(): void {\n    this.isEnabled = false;\n  }\n}\n"]}