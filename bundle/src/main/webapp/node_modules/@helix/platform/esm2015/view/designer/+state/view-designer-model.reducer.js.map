{"version":3,"file":"view-designer-model.reducer.js","sourceRoot":"","sources":["../../../../../../../libs/platform/view/designer/+state/view-designer-model.reducer.ts"],"names":[],"mappings":"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","sourcesContent":["import { cloneDeep, last, omit } from 'lodash';\nimport { createReducer, on } from '@ngrx/store';\n\nimport { RX_VIEW_DEFINITION } from '@helix/platform/view/api';\nimport * as ViewDesignerActions from './view-designer.actions';\nimport * as ViewComponentActions from './view-component.actions';\nimport { IViewDesignModelState } from '../interfaces/view-design-model-state.interface';\nimport { IViewComponentDesignModel } from '../interfaces/view-component-design-model.interface';\nimport { IViewDesignModel } from '../interfaces/view-design-model.interface';\nimport {\n  addChildComponent,\n  findParentComponentModel,\n  isComponentContainsChild,\n  removeChildComponent\n} from '../core/layout-helpers';\nimport { IInitializeComponentModelActionPayload } from './view-component.types';\n\nexport function getInitialState(): IViewDesignModelState {\n  return {\n    viewDesignModel: null,\n    viewComponentDesignModels: {}\n  };\n}\n\nfunction initializeComponentModel(newState: IViewDesignModelState, payload: IInitializeComponentModelActionPayload) {\n  newState.viewComponentDesignModels = {\n    ...newState.viewComponentDesignModels,\n    [payload.componentModel.guid]: payload.componentModel\n  };\n\n  // update parent layout\n  if (payload.componentModel.parentGuid === newState.viewDesignModel.guid) {\n    newState.viewDesignModel = addChildComponent(\n      newState.viewDesignModel,\n      payload.componentModel.guid,\n      payload.outletName,\n      payload.insertIndex,\n      payload.columnIndex,\n      payload.columnSpan\n    ) as IViewDesignModel;\n  } else {\n    const parentComponentModel = newState.viewComponentDesignModels[payload.componentModel.parentGuid];\n\n    if (parentComponentModel) {\n      const newParentComponentModel = addChildComponent(\n        parentComponentModel,\n        payload.componentModel.guid,\n        payload.outletName,\n        payload.insertIndex,\n        payload.columnIndex,\n        payload.columnSpan\n      );\n\n      newState.viewComponentDesignModels[newParentComponentModel.guid] =\n        newParentComponentModel as IViewComponentDesignModel;\n    }\n  }\n}\n\nexport const reducer = createReducer<IViewDesignModelState>(\n  getInitialState(),\n\n  on(ViewDesignerActions.initViewDesigner, getInitialState),\n\n  on(ViewDesignerActions.destroyViewDesigner, getInitialState),\n\n  on(ViewComponentActions.initializeComponentModels, (state, { payload }) => {\n    const newState = {\n      ...state\n    };\n\n    payload.forEach((data) => initializeComponentModel(newState, data));\n\n    return newState;\n  }),\n\n  on(ViewComponentActions.initializeDataComponentModels, (state, { payload }) => {\n    const newState = {\n      ...state,\n      viewComponentDesignModels: {\n        ...state.viewComponentDesignModels\n      }\n    };\n\n    payload.forEach((item) => {\n      const parentComponentModel = newState.viewComponentDesignModels[item.componentModel.parentGuid];\n\n      if (parentComponentModel) {\n        // add new component model\n        newState.viewComponentDesignModels[item.componentModel.guid] = item.componentModel;\n\n        // update parent to contain child reference\n        const newParentComponentModel = {\n          ...parentComponentModel,\n          childDataComponentGuids: [...(parentComponentModel.childDataComponentGuids || []), item.componentModel.guid]\n        };\n\n        newState.viewComponentDesignModels[newParentComponentModel.guid] =\n          newParentComponentModel as IViewComponentDesignModel;\n      }\n    });\n\n    return newState;\n  }),\n\n  on(ViewComponentActions.moveComponent, (state, payload) => {\n    const newState = {\n      ...state\n    };\n\n    // remove component from old parent layout\n    if (isComponentContainsChild(payload.guid, state.viewDesignModel)) {\n      newState.viewDesignModel = removeChildComponent(payload.guid, newState.viewDesignModel) as IViewDesignModel;\n    } else {\n      let oldParentComponentModel = findParentComponentModel(payload.guid, newState.viewComponentDesignModels);\n\n      oldParentComponentModel = removeChildComponent(\n        payload.guid,\n        oldParentComponentModel\n      ) as IViewComponentDesignModel;\n\n      newState.viewComponentDesignModels = {\n        ...newState.viewComponentDesignModels,\n        [oldParentComponentModel.guid]: oldParentComponentModel\n      };\n    }\n\n    // add component to new parent layout\n    if (payload.parentGuid === newState.viewDesignModel.guid) {\n      newState.viewDesignModel = addChildComponent(\n        newState.viewDesignModel,\n        payload.guid,\n        payload.outletName,\n        payload.insertIndex,\n        payload.columnIndex\n      ) as IViewDesignModel;\n    } else {\n      let newParentComponentModel = newState.viewComponentDesignModels[payload.parentGuid];\n\n      newParentComponentModel = addChildComponent(\n        newParentComponentModel,\n        payload.guid,\n        payload.outletName,\n        payload.insertIndex,\n        payload.columnIndex\n      ) as IViewComponentDesignModel;\n\n      newState.viewComponentDesignModels = {\n        ...newState.viewComponentDesignModels,\n        [newParentComponentModel.guid]: newParentComponentModel\n      };\n    }\n\n    // updating parentGuid for moved component\n    newState.viewComponentDesignModels = {\n      ...newState.viewComponentDesignModels,\n\n      [payload.guid]: {\n        ...newState.viewComponentDesignModels[payload.guid],\n        parentGuid: payload.parentGuid\n      }\n    };\n\n    return newState;\n  }),\n\n  on(ViewComponentActions.componentsRemoved, (state, { guids }) => {\n    const newState: IViewDesignModelState = {\n      ...state,\n      viewComponentDesignModels: omit(state.viewComponentDesignModels, guids)\n    };\n\n    guids.forEach((guid) => {\n      if (isComponentContainsChild(guid, state.viewDesignModel)) {\n        newState.viewDesignModel = removeChildComponent(guid, newState.viewDesignModel) as IViewDesignModel;\n      } else {\n        let oldParentComponentModel = findParentComponentModel(guid, state.viewComponentDesignModels);\n\n        if (oldParentComponentModel && newState.viewComponentDesignModels[oldParentComponentModel.guid]) {\n          oldParentComponentModel = removeChildComponent(\n            guid,\n            newState.viewComponentDesignModels[oldParentComponentModel.guid]\n          ) as IViewComponentDesignModel;\n\n          newState.viewComponentDesignModels = {\n            ...newState.viewComponentDesignModels,\n            [oldParentComponentModel.guid]: oldParentComponentModel\n          };\n        }\n      }\n    });\n\n    return newState;\n  }),\n\n  on(ViewComponentActions.setComponentLayout, (state, { guid, cols }) => {\n    const componentModel = state.viewComponentDesignModels[guid];\n\n    const defaultOutlet = componentModel.layout.outlets.find(\n      (item) => item.name === RX_VIEW_DEFINITION.defaultOutletName\n    );\n\n    const existingColumns = cloneDeep(defaultOutlet.columns);\n    const removedColumns = existingColumns.splice(cols.length);\n\n    cols.forEach((colSpan, i) => {\n      if (existingColumns[i]) {\n        existingColumns[i].span = colSpan;\n      } else {\n        existingColumns[i] = {\n          span: colSpan,\n          children: []\n        };\n      }\n    });\n\n    const removedColumnChildComponents: string[] = removedColumns.reduce((guids, col) => {\n      guids.push(...col.children);\n\n      return guids;\n    }, []);\n\n    if (removedColumnChildComponents.length) {\n      const lastExistingCol = last(existingColumns);\n\n      lastExistingCol.children = lastExistingCol.children.concat(removedColumnChildComponents);\n    }\n\n    return {\n      ...state,\n      viewComponentDesignModels: {\n        ...state.viewComponentDesignModels,\n        [guid]: {\n          ...componentModel,\n          layout: {\n            ...componentModel.layout,\n            outlets: componentModel.layout.outlets.map((outlet) => ({\n              ...outlet,\n              columns: existingColumns\n            }))\n          }\n        }\n      }\n    };\n  }),\n\n  on(ViewDesignerActions.setViewModel, (state, { payload }) => {\n    return {\n      ...state,\n      viewDesignModel: payload\n    };\n  }),\n\n  on(ViewDesignerActions.updateViewModel, (state, { payload }) => {\n    return {\n      ...state,\n      viewDesignModel: {\n        ...state.viewDesignModel,\n        ...payload\n      }\n    };\n  }),\n\n  on(ViewDesignerActions.viewDefinitionSaveSuccess, (state) => {\n    if (state.viewDesignModel.isAngularJsView) {\n      return {\n        ...state,\n        viewDesignModel: {\n          ...state.viewDesignModel,\n          isAngularJsView: false\n        }\n      };\n    } else {\n      return state;\n    }\n  }),\n\n  on(ViewComponentActions.setComponentData, (state, { payload }) => {\n    return {\n      ...state,\n      viewComponentDesignModels: {\n        ...state.viewComponentDesignModels,\n        ...payload.reduce((res, { guid, data }) => {\n          res[guid] = {\n            ...state.viewComponentDesignModels[guid],\n            propertiesByName: data\n          };\n\n          return res;\n        }, {})\n      }\n    };\n  }),\n\n  on(ViewComponentActions.updateComponentModel, (state, { payload }) => {\n    return {\n      ...state,\n      viewComponentDesignModels: {\n        ...state.viewComponentDesignModels,\n        ...payload\n          .filter((payload) => state.viewComponentDesignModels[payload.guid])\n          .reduce((res, { guid, partialModel }) => {\n            res[guid] = {\n              ...state.viewComponentDesignModels[guid],\n              ...partialModel,\n              propertiesByName: {\n                ...state.viewComponentDesignModels[guid].propertiesByName,\n                ...partialModel.propertiesByName\n              }\n            };\n\n            return res;\n          }, {})\n      }\n    };\n  })\n);\n\nexport function viewDesignerModelReducer(state, action) {\n  return reducer(state, action);\n}\n"]}