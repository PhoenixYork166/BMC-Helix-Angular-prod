{"version":3,"file":"webhook-callback-configuration.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/admin/components/webhook-callback-configuration/webhook-callback-configuration.component.ts","../../../../../../../libs/platform/admin/components/webhook-callback-configuration/webhook-callback-configuration.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\nimport { FormBuilder } from '@angular/forms';\nimport { RX_RECORD_DEFINITION, RxRecordInstanceService } from '@helix/platform/record/api';\nimport { RxNotificationService } from '@helix/platform/shared/api';\nimport { RX_MODAL, RxModalService } from '@helix/platform/ui-kit';\nimport { IRowDataItem } from '@helix/platform/view/api';\nimport {\n  IRecordGridColumn,\n  IRecordGridConfig,\n  RecordGridComponent,\n  RowSelectionMode\n} from '@helix/platform/view/components';\nimport { map, noop } from 'lodash';\nimport { forkJoin, Observable, of } from 'rxjs';\nimport { WebhookCallbackConfigurationEditorComponent } from './webhook-callback-configuration-editor/webhook-callback-configuration-editor.component';\nimport { RX_WEBHOOK_CALLBACK_CONFIGURATION } from './webhook-callback-configuration.constant';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'rx-admin-webhook-callback-configuration',\n  templateUrl: './webhook-callback-configuration.component.html'\n})\nexport class WebhookCallbackConfigurationAdminComponent implements OnInit {\n  gridConfig: Observable<IRecordGridConfig>;\n\n  @ViewChild('grid', { static: true })\n  grid: RecordGridComponent;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private rxModalService: RxModalService,\n    private rxNotificationService: RxNotificationService,\n    private rxRecordInstanceService: RxRecordInstanceService,\n    private translateService: TranslateService\n  ) {}\n\n  ngOnInit(): void {\n    this.gridConfig = of({\n      actionButtons: [\n        {\n          label: this.translateService.instant('com.bmc.arsys.rx.client.common.delete.label'),\n          style: 'tertiary',\n          icon: 'trash',\n          actions: [\n            {\n              name: () => this.deleteConfigurations()\n            }\n          ]\n        }\n      ],\n      recordDefinitionName: RX_WEBHOOK_CALLBACK_CONFIGURATION.recordDefinition.name,\n      enableRowSelection: RowSelectionMode.Multiple,\n      columns: this.getColumns(),\n      styles: 'flex-fill'\n    });\n  }\n\n  private editConfiguration(selectedRecord: IRowDataItem): void {\n    this.openDockedPanel(true, selectedRecord[RX_RECORD_DEFINITION.coreFieldIds.id]);\n  }\n\n  createConfiguration(): void {\n    this.openDockedPanel(false);\n  }\n\n  private deleteConfigurations(): void {\n    this.rxModalService\n      .confirm({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n        modalStyle: RX_MODAL.modalStyles.warning,\n        message: this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.webhook-callback-configuration.delete-confirmation.message'\n        )\n      })\n      .then((result: boolean) => {\n        if (result) {\n          const deleteRequests$: Observable<any>[] = [];\n\n          map(this.grid.api.getSelectedRows(), (record) => {\n            deleteRequests$.push(\n              this.rxRecordInstanceService.delete(\n                RX_WEBHOOK_CALLBACK_CONFIGURATION.recordDefinition.name,\n                record[RX_RECORD_DEFINITION.coreFieldIds.id]\n              )\n            );\n          });\n\n          forkJoin(deleteRequests$).subscribe(() => {\n            this.rxNotificationService.addSuccessMessage(\n              this.translateService.instant(\n                'com.bmc.arsys.rx.client.admin.webhook-callback-configuration.configurations-deleted.message'\n              )\n            );\n            this.grid.api.refresh().subscribe();\n          });\n        }\n      });\n  }\n\n  private getColumns(): IRecordGridColumn[] {\n    return [\n      {\n        index: 0,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.common.name.label'),\n        fieldId: String(RX_WEBHOOK_CALLBACK_CONFIGURATION.recordDefinition.fieldIds.name),\n        clickable: true,\n        actions: [\n          {\n            name: (previousAction: any, selectedRow: IRowDataItem) => {\n              this.editConfiguration(selectedRow);\n            }\n          }\n        ]\n      },\n      {\n        index: 1,\n        title: this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.webhook-callback-configuration.application.label'\n        ),\n        fieldId: String(RX_WEBHOOK_CALLBACK_CONFIGURATION.recordDefinition.fieldIds.processor)\n      },\n      {\n        index: 2,\n        title: this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.webhook-callback-configuration.created-date.label'\n        ),\n        fieldId: String(RX_RECORD_DEFINITION.coreFieldIds.createdDate)\n      }\n    ];\n  }\n\n  private openDockedPanel(isEditMode: boolean, recordId?: boolean): Promise<any> {\n    return this.rxModalService\n      .openDockedPanel({\n        title: this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.webhook-callback-configuration.header.title'\n        ),\n        content: WebhookCallbackConfigurationEditorComponent,\n        data: {\n          isEditMode,\n          recordId\n        }\n      })\n      .then(() => {\n        this.grid.api.refresh().subscribe();\n      })\n      .catch(noop);\n  }\n}\n","<rx-admin-settings\n  header=\"{{ 'com.bmc.arsys.rx.client.admin.webhook-callback-configuration.header.title' | translate }}\"\n>\n  <button\n    type=\"button\"\n    adapt-button\n    btn-type=\"tertiary\"\n    class=\"d-icon-plus_circle align-self-start\"\n    rx-id=\"new-configuration-button\"\n    (click)=\"this.createConfiguration()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.new.label' | translate }}\n  </button>\n\n  <rx-record-grid #grid [config]=\"gridConfig\"></rx-record-grid>\n</rx-admin-settings>\n"]}