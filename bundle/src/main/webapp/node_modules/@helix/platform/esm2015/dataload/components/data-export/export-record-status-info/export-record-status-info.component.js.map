{"version":3,"file":"export-record-status-info.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/dataload/components/data-export/export-record-status-info/export-record-status-info.component.ts","../../../../../../../../libs/platform/dataload/components/data-export/export-record-status-info/export-record-status-info.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { IExportedDataStatusInfo } from '../data-export.types';\nimport { RX_RECORD_DEFINITION, RxRecordInstanceDataPageService } from '@helix/platform/record/api';\nimport { map } from 'rxjs/operators';\nimport { IDataPageResult } from '@helix/platform/shared/api';\nimport { get, map as _map } from 'lodash';\nimport { ColumnConfig } from '@bmc-ux/adapt-table';\nimport { DatePipe } from '@angular/common';\nimport { RxJsonParserService } from '@helix/platform/utils';\nimport { ActiveModalRef } from '@bmc-ux/adapt-angular';\nimport { DL_DATA_EXPORT } from '../data-export.constant';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'dl-export-record-status-info',\n  templateUrl: './export-record-status-info.component.html',\n  styleUrls: ['./export-record-status-info.component.scss']\n})\nexport class ExportRecordStatusInfoComponent {\n  processStartInfo: string;\n  exportConfiguredNotProcessedMsg: string;\n\n  statusData$: Observable<IExportedDataStatusInfo[]> = this.rxRecordInstanceDataPageService\n    .post({\n      params: {\n        [RX_RECORD_DEFINITION.coreFieldIds.id]: this.activeModalRef.getData().dataRecordId,\n        recorddefinition: DL_DATA_EXPORT.recordDefinitionName\n      }\n    })\n    .pipe(\n      map((dataPage: IDataPageResult) => {\n        if (dataPage.data[0][RX_RECORD_DEFINITION.coreFieldIds.status] === DL_DATA_EXPORT.dataStatuses.processing) {\n          this.processStartInfo = `${this.rxTranslateService.instant(\n            'com.bmc.arsys.rx.client.dataload.process-started.message'\n          )} ${this.datePipe.transform(dataPage.data[0][RX_RECORD_DEFINITION.coreFieldIds.modifiedDate], 'medium')}`;\n        }\n\n        const dataExportProgressStatus = get(\n          this.rxJsonParserService.tryParseJson<[]>(dataPage.data[0][DL_DATA_EXPORT.fields.message], []),\n          'dataExportProgressStatus'\n        );\n\n        if (dataExportProgressStatus) {\n          return _map(dataExportProgressStatus, (statusInfo: IExportedDataStatusInfo) => ({\n            ...statusInfo,\n            updateTime: this.datePipe.transform(statusInfo.updateTime, 'medium')\n          }));\n        } else {\n          this.exportConfiguredNotProcessedMsg = dataPage.data[0][DL_DATA_EXPORT.fields.message];\n\n          return [];\n        }\n      })\n    );\n\n  columns: ColumnConfig[] = [\n    {\n      field: 'updateTime',\n      header: this.rxTranslateService.instant(\n        'com.bmc.arsys.rx.client.dataload.status-info-grid.column.updated-date.title'\n      ),\n      sortable: false,\n      width: '20%'\n    },\n    {\n      field: 'status',\n      header: this.rxTranslateService.instant('com.bmc.arsys.rx.client.common.status.label'),\n      width: '20%'\n    },\n    {\n      field: 'message',\n      header: this.rxTranslateService.instant('com.bmc.arsys.rx.client.common.message.label'),\n      width: '80%'\n    }\n  ];\n\n  constructor(\n    private datePipe: DatePipe,\n    private rxTranslateService: TranslateService,\n    private rxJsonParserService: RxJsonParserService,\n    private activeModalRef: ActiveModalRef,\n    private rxRecordInstanceDataPageService: RxRecordInstanceDataPageService\n  ) {}\n\n  close(): void {\n    this.activeModalRef.close();\n  }\n}\n","<ng-template #loaderTemplate>\n  <rx-line-loader></rx-line-loader>\n</ng-template>\n\n<div *ngIf=\"statusData$ | async as statusData; else loaderTemplate\">\n  <div class=\"data-status-info\">\n    <div *ngIf=\"exportConfiguredNotProcessedMsg\">\n      {{ exportConfiguredNotProcessedMsg }}\n    </div>\n\n    <adapt-alert\n      *ngIf=\"processStartInfo\"\n      [config]=\"{\n        content: processStartInfo,\n        type: 'inline',\n        variant: 'warning'\n      }\"\n    ></adapt-alert>\n\n    <adapt-table\n      [hidden]=\"exportConfiguredNotProcessedMsg\"\n      rx-id=\"exported-status-info-grid\"\n      [columns]=\"columns\"\n      [bordered]=\"true\"\n      [value]=\"statusData\"\n      [wrapCellText]=\"true\"\n    >\n    </adapt-table>\n  </div>\n</div>\n\n<div class=\"modal-footer\">\n  <button (click)=\"close()\" adapt-button btn-type=\"secondary\" rx-id=\"close-button\" type=\"button\">\n    {{ 'com.bmc.arsys.rx.client.common.close.label' | translate }}\n  </button>\n</div>\n"]}