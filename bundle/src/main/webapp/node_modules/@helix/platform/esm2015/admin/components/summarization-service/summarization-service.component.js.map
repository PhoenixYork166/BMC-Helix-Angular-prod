{"version":3,"file":"summarization-service.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/admin/components/summarization-service/summarization-service.component.ts","../../../../../../../libs/platform/admin/components/summarization-service/summarization-service.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport { BaseViewComponent } from '@helix/platform/view/runtime';\nimport { TranslateService } from '@ngx-translate/core';\nimport { catchError, takeUntil } from 'rxjs/operators';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { ConnectionTestStatus } from '@helix/platform/ui-kit';\nimport { throwError } from 'rxjs';\nimport {\n  RxCommandFactoryService,\n  RxCurrentUserService,\n  RxNotificationService,\n  RxSystemConfigurationService\n} from '@helix/platform/shared/api';\nimport { RX_SUMMARIZATION_SERVICE } from './summarization-service.constant';\n\n@Component({\n  selector: 'rx-admin-summarization-service',\n  templateUrl: './summarization-service.component.html',\n  styleUrls: ['./summarization-service.component.scss']\n})\nexport class SummarizationServiceAdminComponent extends BaseViewComponent implements OnInit {\n  summarizationServiceForm: FormGroup;\n  connectionTestStatus: ConnectionTestStatus = ConnectionTestStatus.Invalid;\n  private isSaveInProgress = false;\n  isAdministrator: boolean = this.rxCurrentUserService.isAdministrator();\n\n  constructor(\n    private translateService: TranslateService,\n    private rxCommandFactoryService: RxCommandFactoryService,\n    private rxSystemConfigurationService: RxSystemConfigurationService,\n    private rxNotificationService: RxNotificationService,\n    private rxCurrentUserService: RxCurrentUserService\n  ) {\n    super();\n  }\n\n  ngOnInit(): void {\n    this.notifyPropertyChanged('api', {\n      isDirty: () => this.summarizationServiceForm.dirty\n    });\n\n    this.summarizationServiceForm = new FormGroup({\n      endpoint: new FormControl(''),\n      username: new FormControl(''),\n      password: new FormControl('')\n    });\n\n    this.rxSystemConfigurationService\n      .getConfiguration(RX_SUMMARIZATION_SERVICE.connections.summarizationServiceEndpointConfiguration)\n      .subscribe((result) => {\n        const summarizationConfiguration = JSON.parse(result.value as string)[\n          RX_SUMMARIZATION_SERVICE.summarizationRepository\n        ];\n\n        this.summarizationServiceForm.get('endpoint').setValue(summarizationConfiguration.endpoint);\n        this.summarizationServiceForm.get('username').setValue(summarizationConfiguration.username);\n        this.summarizationServiceForm.get('password').setValue(summarizationConfiguration.username);\n      });\n\n    this.summarizationServiceForm.valueChanges\n      .pipe(takeUntil(this.destroyed$))\n      .subscribe((value) => this.resetConnectionTest());\n  }\n\n  private resetConnectionTest(): void {\n    this.connectionTestStatus =\n      this.summarizationServiceForm.valid && this.summarizationServiceForm.dirty\n        ? ConnectionTestStatus.Unknown\n        : ConnectionTestStatus.Invalid;\n  }\n\n  onTestConnection(): void {\n    this.rxCommandFactoryService\n      .forResourceType('com.bmc.arsys.rx.application.cognitive.command.PingSummarizationServiceCommand')\n      .execute(this.summarizationServiceForm.value)\n      .pipe(\n        catchError((error: HttpErrorResponse) => {\n          this.connectionTestStatus = ConnectionTestStatus.Failed;\n\n          return throwError(error);\n        })\n      )\n      .subscribe(() => {\n        this.connectionTestStatus = ConnectionTestStatus.Passed;\n      });\n  }\n\n  save(): void {\n    this.isSaveInProgress = true;\n\n    this.rxSystemConfigurationService\n      .setConfiguration(RX_SUMMARIZATION_SERVICE.connections.summarizationServiceEndpointConfiguration, {\n        [RX_SUMMARIZATION_SERVICE.summarizationRepository]: this.summarizationServiceForm.value\n      })\n      .subscribe(\n        (response) => {\n          this.isSaveInProgress = false;\n          this.summarizationServiceForm.markAsPristine();\n          this.resetConnectionTest();\n\n          this.rxNotificationService.addSuccessMessage(\n            this.translateService.instant('com.bmc.arsys.rx.client.admin.summarization-service.saved.message')\n          );\n        },\n        (error) => {\n          this.isSaveInProgress = false;\n        }\n      );\n  }\n\n  isSaveButtonDisabled(): boolean {\n    return (\n      this.summarizationServiceForm.pristine ||\n      this.summarizationServiceForm.invalid ||\n      this.connectionTestStatus !== ConnectionTestStatus.Passed ||\n      this.isSaveInProgress\n    );\n  }\n}\n","<rx-admin-settings header=\"{{ 'com.bmc.arsys.rx.client.admin.summarization-service.header.title' | translate }}\">\n  <form [formGroup]=\"summarizationServiceForm\">\n    <adapt-rx-textfield\n      name=\"endpoint\"\n      label=\"{{ 'com.bmc.arsys.rx.client.admin.summarization-service.api-endpoint-url.title' | translate }}\"\n      rx-id=\"api-endpoint-url\"\n      class=\"form-group d-block\"\n      formControlName=\"endpoint\"\n      required\n    >\n    </adapt-rx-textfield>\n    <adapt-rx-textfield\n      name=\"username\"\n      label=\"{{ 'com.bmc.arsys.rx.client.common.user-name.label' | translate }}\"\n      rx-id=\"user-name\"\n      class=\"form-group d-block\"\n      formControlName=\"username\"\n      required\n    >\n    </adapt-rx-textfield>\n    <adapt-rx-textfield\n      name=\"password\"\n      label=\"{{ 'com.bmc.arsys.rx.client.common.password.label' | translate }}\"\n      rx-id=\"password\"\n      [isPassword]=\"true\"\n      class=\"form-group d-block\"\n      formControlName=\"password\"\n      required\n    >\n    </adapt-rx-textfield>\n    <div class=\"d-flex\" *ngIf=\"isAdministrator\">\n      <rx-connection-tester\n        [status]=\"connectionTestStatus\"\n        buttonType=\"secondary\"\n        rx-id=\"test-connection-button\"\n        (testConnection)=\"onTestConnection()\"\n      >\n      </rx-connection-tester>\n      <button\n        adapt-button\n        type=\"button\"\n        rx-id=\"save-button\"\n        btn-type=\"primary\"\n        class=\"ml-4\"\n        [disabled]=\"isSaveButtonDisabled()\"\n        (click)=\"save()\"\n      >\n        {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n      </button>\n    </div>\n  </form>\n</rx-admin-settings>\n"]}