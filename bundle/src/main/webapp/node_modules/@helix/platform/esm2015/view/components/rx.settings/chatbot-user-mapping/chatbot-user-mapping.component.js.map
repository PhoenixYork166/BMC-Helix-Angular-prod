{"version":3,"file":"chatbot-user-mapping.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/view/components/rx.settings/chatbot-user-mapping/chatbot-user-mapping.component.ts","../../../../../../../../libs/platform/view/components/rx.settings/chatbot-user-mapping/chatbot-user-mapping.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { RxCommandFactoryService, RxNotificationService } from '@helix/platform/shared/api';\nimport { BaseViewComponent } from '@helix/platform/view/runtime';\nimport { IRxChatbotUserMappingParameters } from './chatbot-user-mapping.interface';\nimport { catchError, take } from 'rxjs/operators';\nimport { RX_CHATBOT_USER_MAPPING } from './chatbot-user-mapping.constant';\nimport { TranslateService } from '@ngx-translate/core';\nimport { throwError } from 'rxjs';\n\n@Component({\n  // This is for retro compatibility to reuse the same view \"com.bmc.arsys.rx.settings:BMCCloudVerification\".\n  // tslint:disable-next-line:component-selector\n  selector: 'com-bmc-arsys-rx-user-mapping',\n  templateUrl: './chatbot-user-mapping.component.html',\n  styleUrls: ['./chatbot-user-mapping.component.scss']\n})\nexport class ChatbotUserMappingComponent extends BaseViewComponent implements OnInit {\n  private encryptedChatUserAndChatId: string = null;\n  private chatbotProvider: string = null;\n\n  isMappingInProgress = false;\n  message = '';\n  mappingStatus = '';\n\n  constructor(\n    private translateService: TranslateService,\n    private rxCommandFactoryService: RxCommandFactoryService,\n    private rxNotificationService: RxNotificationService\n  ) {\n    super();\n  }\n\n  ngOnInit() {\n    this.isMappingInProgress = false;\n\n    this.config.pipe(take(1)).subscribe((config: IRxChatbotUserMappingParameters) => {\n      this.encryptedChatUserAndChatId = config.encryptedChatUserAndChatId;\n      this.chatbotProvider = config.chatbotProvider;\n\n      if (!this.encryptedChatUserAndChatId) {\n        this.mappingStatus = RX_CHATBOT_USER_MAPPING.mappingStatus.missingParameters;\n\n        this.rxNotificationService.addErrorMessage(\n          this.translateService.instant(RX_CHATBOT_USER_MAPPING.messages.missingParameters)\n        );\n      } else {\n        this.mappingStatus = RX_CHATBOT_USER_MAPPING.mappingStatus.pending;\n      }\n\n      this.updateMessage();\n    });\n  }\n\n  isMappingButtonVisible(): boolean {\n    return this.mappingStatus === RX_CHATBOT_USER_MAPPING.mappingStatus.pending;\n  }\n\n  mapUser(): void {\n    this.isMappingInProgress = true;\n    this.mappingStatus = RX_CHATBOT_USER_MAPPING.mappingStatus.inProgress;\n    this.updateMessage();\n\n    const commandPayload: IRxChatbotUserMappingParameters = {\n      encryptedChatUserAndChatId: this.encryptedChatUserAndChatId,\n      chatbotProvider: this.chatbotProvider\n    };\n\n    this.rxCommandFactoryService\n      .forResourceType(RX_CHATBOT_USER_MAPPING.commands.createUserMapping)\n      .execute(commandPayload)\n      .pipe(\n        catchError((error) => {\n          this.mappingStatus = RX_CHATBOT_USER_MAPPING.mappingStatus.failed;\n          this.updateMessage();\n          this.isMappingInProgress = false;\n\n          return throwError(error);\n        })\n      )\n      .subscribe(() => {\n        this.mappingStatus = RX_CHATBOT_USER_MAPPING.mappingStatus.success;\n        this.updateMessage();\n        this.isMappingInProgress = false;\n      });\n  }\n\n  private updateMessage(): void {\n    this.message = this.translateService.instant(RX_CHATBOT_USER_MAPPING.messages[this.mappingStatus]);\n  }\n}\n","<div class=\"text-center mt-1 container\">\n  <div>\n    <span class=\"text-logo\">{{ 'com.bmc.arsys.rx.settings.title' | translate }}</span>\n  </div>\n  <div class=\"mt-4\">{{ message }}</div>\n  <div>\n    <button\n      rx-id=\"verify-bmc-cloud-account\"\n      class=\"mt-4\"\n      adapt-button\n      btn-type=\"primary\"\n      size=\"large\"\n      type=\"button\"\n      [disabled]=\"isMappingInProgress\"\n      (click)=\"mapUser()\"\n      [hidden]=\"!isMappingButtonVisible()\"\n    >\n      {{ 'com.bmc.arsys.rx.settings.verify-cloud-account' | translate }}\n    </button>\n  </div>\n</div>\n"]}