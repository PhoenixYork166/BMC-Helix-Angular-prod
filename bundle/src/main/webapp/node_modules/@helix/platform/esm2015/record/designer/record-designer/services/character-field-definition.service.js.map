{"version":3,"file":"character-field-definition.service.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/record/designer/record-designer/services/character-field-definition.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { RxBaseFieldDefinitionService } from './base-field-definition.service';\nimport { Injectable, Injector } from '@angular/core';\nimport { IFormBuilderConfig } from '@helix/platform/shared/api';\nimport { IRecordDefinitionModel, IRecordFieldDefinitionModel } from '../../record-designer.types';\nimport {\n  CounterFormControlComponent,\n  ICounterFormControlOptions,\n  IDefinitionPickerComponentOptions,\n  ISelectFormControlOptions,\n  ISwitcherFormControlOptions,\n  ITextFormControlOptions,\n  RxDefinitionPickerComponent,\n  RxDefinitionPickerType,\n  SelectFormControlComponent,\n  SwitchFormControlComponent,\n  TextFormControlComponent\n} from '@helix/platform/shared/components';\nimport { inRange, size } from 'lodash';\nimport { IValidationIssue, ValidationIssueType } from '@helix/platform/ui-kit';\nimport { RxNumberUtilsService } from '@helix/platform/utils';\nimport { Tooltip } from '@helix/platform/shared/api';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RxCharacterFieldDefinitionService extends RxBaseFieldDefinitionService {\n  resourceType = RX_RECORD_DEFINITION.dataTypes.character.resourceType;\n\n  constructor(injector: Injector, private rxNumberUtilsService: RxNumberUtilsService) {\n    super(injector);\n  }\n\n  getFieldInspectorConfig(\n    fieldModel: IRecordFieldDefinitionModel,\n    definitionModel: IRecordDefinitionModel,\n    isReadOnly: boolean\n  ): IFormBuilderConfig {\n    const inspectorConfig = super.getFieldInspectorConfig(fieldModel, definitionModel, isReadOnly);\n\n    if (this.rxFieldDefinitionInspectorHelperService.isStoreEncryptedVisible(fieldModel, definitionModel)) {\n      inspectorConfig[1].controls.push({\n        name: 'shouldPersistEncrypted',\n        component: SwitchFormControlComponent,\n        isDisabled: isReadOnly || !this.rxFieldDefinitionInspectorHelperService.isStoreEncryptedEditable(fieldModel),\n        options: {\n          label: this.translateService.instant(\n            'com.bmc.arsys.rx.client.record-designer.field-properties.store-encrypted.label'\n          )\n        } as ISwitcherFormControlOptions\n      });\n    }\n\n    if (this.rxFieldDefinitionInspectorHelperService.isStoreHashedVisible(fieldModel, definitionModel)) {\n      inspectorConfig[1].controls.push({\n        name: 'shouldPersistHashed',\n        component: SwitchFormControlComponent,\n        isDisabled:\n          isReadOnly ||\n          !this.rxFieldDefinitionInspectorHelperService.isStoreHashedEditable(fieldModel, definitionModel),\n        options: {\n          label: this.translateService.instant(\n            'com.bmc.arsys.rx.client.record-designer.field-properties.store-hashed.label'\n          )\n        } as ISwitcherFormControlOptions\n      });\n    }\n\n    inspectorConfig[1].controls = inspectorConfig[1].controls.concat([\n      {\n        name: 'namedListDefinition',\n        component: RxDefinitionPickerComponent,\n        isDisabled:\n          isReadOnly || !this.rxFieldDefinitionInspectorHelperService.isNamedListEditable(fieldModel, definitionModel),\n        options: {\n          definitionType: RxDefinitionPickerType.NamedList,\n          label: this.translateService.instant('com.bmc.arsys.rx.client.definition-type.named-list.label')\n        } as IDefinitionPickerComponentOptions\n      },\n      {\n        name: 'maxLength',\n        component: CounterFormControlComponent,\n        isDisabled:\n          isReadOnly || !this.rxFieldDefinitionInspectorHelperService.isLengthEditable(fieldModel, definitionModel),\n        options: {\n          label: this.translateService.instant('com.bmc.arsys.rx.client.common.length.label'),\n          tooltip:\n            fieldModel.id === RX_RECORD_DEFINITION.coreFieldIds.displayId &&\n            !this.rxRecordDefinitionService.isJoinRecord(definitionModel) &&\n            !fieldModel.isNewField\n              ? this.translateService.instant(\n                  'com.bmc.arsys.rx.client.record-designer.field-properties.display-id.length.tooltip'\n                )\n              : undefined,\n          allowIntegerOnly: true,\n          minValue: 0\n        } as ICounterFormControlOptions\n      },\n      {\n        name: 'defaultValue',\n        component: TextFormControlComponent,\n        isDisabled:\n          isReadOnly ||\n          !this.rxFieldDefinitionInspectorHelperService.isDefaultValueEditable(fieldModel, definitionModel),\n        options: {\n          label: this.translateService.instant('com.bmc.arsys.rx.client.common.default-value.label'),\n          tooltip:\n            fieldModel.id === RX_RECORD_DEFINITION.coreFieldIds.displayId &&\n            !this.rxRecordDefinitionService.isJoinRecord(definitionModel) &&\n            !fieldModel.isNewField\n              ? new Tooltip(\n                  this.translateService.instant(\n                    'com.bmc.arsys.rx.client.record-designer.field-properties.display-id.default-value.tooltip'\n                  )\n                )\n              : undefined,\n          allowIntegerOnly: true\n        } as ITextFormControlOptions\n      },\n      {\n        name: 'pattern',\n        component: SelectFormControlComponent,\n        isDisabled: isReadOnly || !this.rxFieldDefinitionInspectorHelperService.isFieldEditable(fieldModel),\n        options: {\n          label: this.translateService.instant(\n            'com.bmc.arsys.rx.client.record-designer.field-properties.pattern.label'\n          ),\n          emptyOption: true,\n          options: [\n            {\n              name: this.translateService.instant(\n                'com.bmc.arsys.rx.client.record-designer.field-properties.pattern.options.alphabetical.label'\n              ),\n              id: '$ALPHA$'\n            },\n            {\n              name: this.translateService.instant(\n                'com.bmc.arsys.rx.client.record-designer.field-properties.pattern.options.alphanumeric.label'\n              ),\n              id: '$ALNUM$'\n            },\n            {\n              name: this.translateService.instant(\n                'com.bmc.arsys.rx.client.record-designer.field-properties.pattern.options.lowercase.label'\n              ),\n              id: '$LOWER$'\n            },\n            {\n              name: this.translateService.instant(\n                'com.bmc.arsys.rx.client.record-designer.field-properties.pattern.options.named-list.label'\n              ),\n              id: '$NAMEDLIST$'\n            },\n            {\n              name: this.translateService.instant(\n                'com.bmc.arsys.rx.client.record-designer.field-properties.pattern.options.numeric.label'\n              ),\n              id: '$DIGIT$'\n            },\n            {\n              name: this.translateService.instant(\n                'com.bmc.arsys.rx.client.record-designer.field-properties.pattern.options.uppercase.label'\n              ),\n              id: '$UPPER$'\n            }\n          ]\n        } as ISelectFormControlOptions\n      }\n    ]);\n\n    return inspectorConfig;\n  }\n\n  validate(fieldModel: IRecordFieldDefinitionModel, definitionModel: IRecordDefinitionModel): IValidationIssue[] {\n    const validationIssues = super.validate(fieldModel, definitionModel);\n\n    if (this.rxNumberUtilsService.isFiniteOrNumberString(fieldModel.maxLength) && Number(fieldModel.maxLength) < 0) {\n      validationIssues.push({\n        type: ValidationIssueType.Error,\n        description: this.translateService.instant(\n          'com.bmc.arsys.rx.client.designer.validation.invalid-min-length-error.message'\n        ),\n        data: {\n          propertyName: 'maxLength',\n          guid: fieldModel.guid\n        }\n      });\n    }\n\n    if (\n      fieldModel.id === RX_RECORD_DEFINITION.coreFieldIds.displayId &&\n      (this.rxRecordDefinitionService.isRegularRecord(definitionModel) ||\n        this.rxRecordDefinitionService.isExternalRecord(definitionModel))\n    ) {\n      if (!(fieldModel.maxLength === 1 || inRange(fieldModel.maxLength, 5, 16))) {\n        validationIssues.push({\n          type: ValidationIssueType.Error,\n          description: this.translateService.instant(\n            'com.bmc.arsys.rx.client.record-designer.validation.invalid-max-length.message'\n          ),\n          data: {\n            propertyName: 'maxLength',\n            guid: fieldModel.guid\n          }\n        });\n      }\n\n      if (\n        (fieldModel.maxLength !== 1 && fieldModel.maxLength <= size(fieldModel.defaultValue)) ||\n        (fieldModel.maxLength === 1 && size(fieldModel.defaultValue) >= 15)\n      ) {\n        validationIssues.push({\n          type: ValidationIssueType.Error,\n          description: this.translateService.instant(\n            'com.bmc.arsys.rx.client.record-designer.validation.invalid-display-id-range.message'\n          ),\n          data: {\n            propertyName: 'maxLength',\n            guid: fieldModel.guid\n          }\n        });\n      }\n    }\n\n    return validationIssues;\n  }\n}\n"]}