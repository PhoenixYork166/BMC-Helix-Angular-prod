{"version":3,"file":"shell-design.model.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/view/shell-designer-page/components/shell/shell-design.model.ts"],"names":[],"mappings":"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","sourcesContent":["import { IFormControlBuilderConfig } from '@helix/platform/shared/api';\nimport { IViewDesignerComponentModel, RX_SHELL } from '@helix/platform/view/api';\nimport {\n  IViewComponentDesignValidationIssue,\n  IViewDesignerInspectorConfig,\n  ViewDesignerComponentModel\n} from '@helix/platform/view/designer';\nimport { combineLatest, Observable } from 'rxjs';\nimport { distinctUntilChanged, map } from 'rxjs/operators';\nimport { omit } from 'lodash';\nimport { SwitchFormControlComponent } from '@helix/platform/shared/components';\nimport {\n  IShellDesignProperties,\n  IShellGlobalSearchRecord,\n  IShellMenuItem,\n  IShellProperties\n} from './shell-design.types';\nimport { RxShellGlobalSearchRecordsControlComponent } from './controls/shell-global-search-records-control/shell-global-search-records-control.component';\nimport { RxShellMenuItemsControlComponent } from './controls/shell-menu-items-control/shell-menu-items-control.component';\n\nexport class RxShellDesignModel\n  extends ViewDesignerComponentModel<IShellDesignProperties>\n  implements IViewDesignerComponentModel<IShellDesignProperties> {\n  allowAppSwitching$ = this.sandbox.getComponentPropertyValue('allowAppSwitching');\n  globalSearchEnabled$ = this.sandbox.getComponentPropertyValue('globalSearchEnabled');\n  menuItems$ = this.sandbox.getChildComponentsTree();\n\n  private childMenuItemsCount$ = this.sandbox\n    .getChildComponentGuids((component) => component.type === RX_SHELL.navBar.menuItem, true)\n    .pipe(\n      map((items: string[]) => items.length),\n      distinctUntilChanged()\n    );\n\n  static getInitialProperties(initialProperties?: IShellProperties): IShellDesignProperties {\n    const result: IShellDesignProperties = {\n      allowAppSwitching: true,\n      globalSearchDisabled: true,\n      globalSearchRecords: [],\n      ...initialProperties,\n\n      // removing custom search state if definition saved in old designer\n      // as custom state not supported anymore\n      globalSearchUseDefault: true,\n      globalSearchCustomSearchState: null\n    };\n\n    // additional inverted design field\n    result.globalSearchEnabled = !result.globalSearchDisabled;\n\n    return result;\n  }\n\n  rxInit(): void {\n    this.sandbox.getComponentPropertyValue('globalSearchDisabled').subscribe((globalSearchDisabled) => {\n      this.sandbox.updateInspectorConfig(this.getInspector(globalSearchDisabled));\n    });\n\n    this.globalSearchEnabled$.subscribe((globalSearchEnabled) => {\n      this.sandbox.updateComponentProperties({ globalSearchDisabled: !globalSearchEnabled });\n    });\n\n    combineLatest([\n      this.sandbox.getComponentPropertyValue('globalSearchRecords'),\n      this.sandbox.getComponentPropertyValue('globalSearchDisabled'),\n      this.childMenuItemsCount$\n    ]).subscribe(([globalSearchRecords, globalSearchDisabled, childMenuItemsCount]) => {\n      this.sandbox.setValidationIssues(this.validate(globalSearchRecords, globalSearchDisabled, childMenuItemsCount));\n    });\n  }\n\n  getPropertiesByName(props: IShellDesignProperties): IShellProperties {\n    return omit(props, 'globalSearchEnabled');\n  }\n\n  public removeMenuItem(guid: string): void {\n    this.sandbox.removeComponents([guid]);\n  }\n\n  public selectMenuItem(guid: string): void {\n    this.sandbox.selectComponent(guid);\n  }\n\n  private validate(\n    globalSearchRecords: IShellGlobalSearchRecord[],\n    globalSearchDisabled: boolean,\n    childMenuItemsCount: number\n  ): IViewComponentDesignValidationIssue[] {\n    const validationIssues: IViewComponentDesignValidationIssue[] = [];\n\n    if (childMenuItemsCount === 0) {\n      validationIssues.push(this.sandbox.createError('Please add at least one menu item.'));\n    }\n\n    if (!globalSearchDisabled && globalSearchRecords.length === 0) {\n      validationIssues.push(\n        this.sandbox.createError(\n          'Please include at least one record in the global search results view.',\n          'globalSearchRecords'\n        )\n      );\n    }\n\n    return validationIssues;\n  }\n\n  private getInspector(globalSearchDisabled: boolean): IViewDesignerInspectorConfig {\n    const globalSearchSectionItems: IFormControlBuilderConfig[] = [\n      {\n        name: 'globalSearchEnabled',\n        component: SwitchFormControlComponent,\n        options: {\n          label: 'Enable global search'\n        }\n      }\n    ];\n\n    if (!globalSearchDisabled) {\n      globalSearchSectionItems.push({\n        name: 'globalSearchRecords',\n        component: RxShellGlobalSearchRecordsControlComponent\n      });\n    }\n\n    return {\n      inspectorSectionConfigs: [\n        {\n          label: 'General',\n          controls: [\n            {\n              name: 'allowAppSwitching',\n              component: SwitchFormControlComponent,\n              options: {\n                label: 'Enable application launcher'\n              }\n            }\n          ]\n        },\n        {\n          label: 'Global search',\n          controls: globalSearchSectionItems\n        },\n        {\n          label: 'Menu items',\n          controls: [\n            {\n              component: RxShellMenuItemsControlComponent,\n              options: {\n                model: this\n              }\n            }\n          ]\n        }\n      ]\n    };\n  }\n}\n"]}