{"version":3,"file":"select-form-control.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/shared/components/form-controls/select-form-control/select-form-control.component.ts","../../../../../../../../libs/platform/shared/components/form-controls/select-form-control/select-form-control.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Renderer2,\n  SimpleChanges,\n  TemplateRef,\n  ViewChild\n} from '@angular/core';\nimport { FormControl, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { ReplaySubject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { IFormControlComponent } from '@helix/platform/shared/api';\nimport { ValueAccessor } from '../../form-builder/value-accessor';\nimport { ISelectFormControlOptions, ISelectOption } from './select-form-control.interfaces';\nimport { head, isUndefined, map, filter, includes, castArray, isNil } from 'lodash';\nimport { AdaptRxControlLabelTooltip, AdaptRxSelectComponent, RxSelectOption } from '@bmc-ux/adapt-angular';\n\n@Component({\n  selector: 'rx-select-form-control',\n  templateUrl: './select-form-control.component.html',\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: SelectFormControlComponent,\n      multi: true\n    }\n  ]\n})\nexport class SelectFormControlComponent\n  extends ValueAccessor<string | string[]>\n  implements IFormControlComponent, OnInit, OnChanges, OnDestroy\n{\n  @Input()\n  options: ISelectFormControlOptions;\n\n  @Input()\n  appendToBody = false;\n\n  @Input()\n  formControl: FormControl;\n\n  @ViewChild('adaptSelectComponent', { static: true })\n  adaptSelectComponent: AdaptRxSelectComponent;\n\n  @ViewChild('popoverContent', { static: true })\n  popoverContent: TemplateRef<{}>;\n\n  adaptSelectValue: ISelectOption[] = [];\n  selectOptions: ISelectOption[];\n  tooltip: AdaptRxControlLabelTooltip;\n\n  private destroyed$: ReplaySubject<boolean> = new ReplaySubject(1);\n  private isSortAlphabetically;\n\n  constructor(private renderer: Renderer2) {\n    super();\n  }\n\n  writeValue(value: string | string[]): void {\n    super.writeValue(value);\n\n    this.adaptSelectValue = this.getAdaptSelectValue(value);\n  }\n\n  focus(): void {\n    const el = this.renderer.selectRootElement(this.adaptSelectComponent.selectButtonRef.nativeElement, true);\n\n    el.focus();\n    el.click();\n  }\n\n  sortAlphabetically(items: ISelectOption[]): ISelectOption[] {\n    return items.sort((itemA, itemB) => itemA.name.localeCompare(itemB.name));\n  }\n\n  ngOnInit(): void {\n    if (this.formControl) {\n      const adaptControl = this.adaptSelectComponent.ngControl.control;\n\n      adaptControl.statusChanges.pipe(takeUntil(this.destroyed$)).subscribe(() => {\n        if (adaptControl.hasError('required') && !this.formControl.hasError('required')) {\n          Object.assign(adaptControl.errors, this.formControl.errors);\n          this.formControl.setErrors(adaptControl.errors, { emitEvent: false });\n        }\n      });\n\n      this.formControl.statusChanges.pipe(takeUntil(this.destroyed$)).subscribe(() => {\n        if (this.formControl.invalid) {\n          adaptControl.setErrors(this.formControl.errors, { emitEvent: false });\n        }\n      });\n    }\n\n    this.isSortAlphabetically = isUndefined(this.options.sortAlphabetically) || this.options.sortAlphabetically;\n\n    this.selectOptions = this.isSortAlphabetically\n      ? this.sortAlphabetically(this.options.options)\n      : this.options.options;\n\n    this.tooltip = this.options.tooltip\n      ? {\n          iconName: this.options.tooltip.iconName,\n          content: this.popoverContent,\n          placement: this.options.tooltip.placement,\n          popoverMode: this.options.tooltip.popoverMode\n        }\n      : null;\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (changes.options) {\n      this.selectOptions = this.isSortAlphabetically\n        ? this.sortAlphabetically(changes.options.currentValue.options)\n        : changes.options.currentValue.options;\n\n      // ADAPT select value must be updated if options are changed, this logic can be eliminated if ADAPT #4116 issue will be resolved.\n      this.adaptSelectValue = this.getAdaptSelectValue(this.value);\n    }\n  }\n\n  optionFormatter(option: ISelectOption): string {\n    return option.name;\n  }\n\n  onSelectionChange(value: RxSelectOption[]): void {\n    let selectValue = map(value, 'id');\n\n    selectValue = this.options.multiple ? selectValue : head(selectValue);\n\n    if (this.options.beforeValueChange) {\n      this.options.beforeValueChange(this.value, selectValue).then((allowValueChange) => {\n        if (allowValueChange) {\n          this.value = selectValue;\n          this.adaptSelectValue = this.getAdaptSelectValue(selectValue);\n        } else {\n          this.adaptSelectComponent.writeValue(this.adaptSelectValue);\n        }\n      });\n    } else {\n      this.value = selectValue;\n    }\n  }\n\n  ngOnDestroy() {\n    this.destroyed$.next(true);\n    this.destroyed$.complete();\n  }\n\n  // We have to convert value for ADAPT select, e.g:\n  // - \"foo\" -> [{id: \"foo\", name: \"Foo\"}] or,\n  // - [\"foo\", \"bar\"] => [{id: \"foo\", name: \"Foo\"}, {id: \"bar\", name: \"Bar\"}].\n  // This logic can be eliminated if #4116 issue will be resolved.\n  private getAdaptSelectValue(value: string | string[]): RxSelectOption[] {\n    return this.options?.options && !isNil(value)\n      ? filter(this.options.options, (option) => includes(castArray(value), option.id))\n      : [];\n  }\n}\n","<adapt-rx-select\n  #adaptSelectComponent\n  [options]=\"selectOptions\"\n  [required]=\"options.required\"\n  [emptyOption]=\"options.emptyOption\"\n  [multiple]=\"options.multiple\"\n  [selectAllButton]=\"options.multiple && !options.hideSelectAllButton\"\n  [deselectAllButton]=\"options.multiple && !options.hideDeselectAllButton\"\n  [enableFilter]=\"options.enableFilter\"\n  [ngModel]=\"adaptSelectValue\"\n  (ngModelChange)=\"onSelectionChange($event)\"\n  [tooltip]=\"tooltip\"\n  [label]=\"options.label\"\n  [disabled]=\"isDisabled\"\n  [optionFormatter]=\"optionFormatter\"\n  [appendToBody]=\"appendToBody\"\n  class=\"d-block m-0\"\n>\n</adapt-rx-select>\n\n<ng-template #popoverContent>\n  <span [innerHtml]=\"options.tooltip.content\"></span>\n</ng-template>\n"]}