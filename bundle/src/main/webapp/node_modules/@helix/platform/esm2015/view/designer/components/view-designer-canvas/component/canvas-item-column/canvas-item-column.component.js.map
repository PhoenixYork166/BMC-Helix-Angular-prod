{"version":3,"file":"canvas-item-column.component.js","sourceRoot":"","sources":["../../../../../../../../../../libs/platform/view/designer/components/view-designer-canvas/component/canvas-item-column/canvas-item-column.component.ts","../../../../../../../../../../libs/platform/view/designer/components/view-designer-canvas/component/canvas-item-column/canvas-item-column.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport { IViewComponentDragData } from '../../interfaces/view-designer-canvas.interfaces';\nimport { IViewDesignerCanvasColumn, IViewDesignerCanvasLayout } from '../../interfaces/view-designer-canvas.interfaces';\nimport { CdkDrag, CdkDragDrop, CdkDragEnter, CdkDragStart, CdkDropList } from '@angular/cdk/drag-drop';\nimport { isString, throttle } from 'lodash';\nimport { asapScheduler } from 'rxjs';\nimport { ViewDesignerCanvasService } from '../../view-designer-canvas.service';\nimport { CanvasOutletHelperService } from '../canvas-outlet/canvas-outlet-helper.service';\nimport { DropListOrientation } from '@angular/cdk/drag-drop';\n\n@Component({\n  selector: 'rx-canvas-item-column',\n  templateUrl: './canvas-item-column.component.html',\n  styleUrls: ['./canvas-item-column.component.scss']\n})\nexport class CanvasItemColumnComponent implements OnInit {\n  @Input()\n  isReadOnly: boolean;\n\n  @Input()\n  colIndex: number;\n\n  @Input()\n  column: IViewDesignerCanvasColumn;\n\n  @Input()\n  layout: IViewDesignerCanvasLayout;\n\n  @Output()\n  dropListDropped = new EventEmitter<CdkDragDrop<{ columnIndex: number }>>();\n\n  dropListEnterPredicateBind = throttle(this.dropListEnterPredicate.bind(this), 200);\n\n  dropListOrientation: DropListOrientation;\n\n  constructor(\n    private viewDesignerCanvasService: ViewDesignerCanvasService,\n    private canvasOutletHelperService: CanvasOutletHelperService\n  ) {}\n\n  ngOnInit(): void {\n    this.dropListOrientation = this.canvasOutletHelperService.dropListOrientation;\n  }\n\n  getViewComponentDragData(layout: IViewDesignerCanvasLayout): IViewComponentDragData {\n    return {\n      draggedViewComponentGuid: layout.guid,\n      draggedViewComponentDescriptor: layout.descriptor,\n      draggedViewComponentParents: this.layout.viewComponentWithParents\n    };\n  }\n\n  onDragEntered(event: CdkDragEnter) {\n    this.enforceDragToSelf(event.container);\n  }\n\n  onDragStarted(event: CdkDragStart) {\n    this.enforceDragToSelf(event.source.dropContainer);\n  }\n\n  remove(event: Event, layout: IViewDesignerCanvasLayout): void {\n    event.stopPropagation();\n\n    this.viewDesignerCanvasService.removeComponent(layout.guid);\n  }\n\n  onSelectComponent(event: Event, layout: IViewDesignerCanvasLayout): void {\n    event.stopPropagation();\n\n    this.viewDesignerCanvasService.selectComponent(layout.guid);\n  }\n\n  trackByFn(index: number, item: IViewDesignerCanvasLayout): string {\n    return item.guid;\n  }\n\n  dropListEnterPredicate(event: CdkDrag<IViewComponentDragData>): boolean {\n    return this.canvasOutletHelperService.canBeDropped({\n      ...event.data,\n      dropTargetViewComponentWithParents: this.layout.viewComponentWithParents || []\n    });\n  }\n\n  // todo remove after\n  // https://github.com/angular/components/issues/16671\n  // will be fixed\n  private enforceDragToSelf(dropList: CdkDropList) {\n    let siblings = dropList.connectedTo as CdkDropList[];\n\n    siblings = siblings.reduce((result, item) => {\n      if (isString(item)) {\n        const listInstance = CdkDropList['_dropLists'].find((list) => list.id === item);\n\n        if (listInstance) {\n          result.push(listInstance);\n        }\n      }\n\n      return result;\n    }, []);\n\n    const dropListRef = dropList._dropListRef;\n\n    asapScheduler.schedule(() => {\n      dropListRef.connectedTo(siblings.map((list) => list._dropListRef));\n    });\n  }\n}\n","<div\n  cdkDropList\n  [cdkDropListOrientation]=\"dropListOrientation\"\n  [cdkDropListConnectedTo]=\"column.dndListIds\"\n  (cdkDropListDropped)=\"dropListDropped.next($event)\"\n  [cdkDropListEnterPredicate]=\"dropListEnterPredicateBind\"\n  [cdkDropListData]=\"{ columnIndex: colIndex }\"\n  [id]=\"column.listId\"\n>\n  <!-- mw-100 class is used for DnD to restrict component width, see DRD21-5845 for more details -->\n  <div\n    class=\"canvas-item-wrapper mw-100 canvas-{{ layout.descriptor.type }}\"\n    cdkDrag\n    [cdkDragData]=\"getViewComponentDragData(layout)\"\n    [cdkDragDisabled]=\"isReadOnly || layout.descriptor.options?.static\"\n    (cdkDragEntered)=\"onDragEntered($event)\"\n    (cdkDragStarted)=\"onDragStarted($event)\"\n    *ngFor=\"let layout of column.children; let last = last; trackBy: trackByFn\"\n  >\n    <div class=\"canvas-item\" [class.active]=\"layout.isSelected$ | async\" (click)=\"onSelectComponent($event, layout)\">\n      <div class=\"canvas-item-header\" [hidden]=\"!(layout.isSelected$ | async)\" cdkDragHandle>\n        <span class=\"icon d-icon-dots mr-1\"></span>\n        <span class=\"label\">{{ layout.label }}</span>\n\n        <button\n          (click)=\"remove($event, layout)\"\n          *ngIf=\"!isReadOnly && !layout.descriptor.options?.static\"\n          class=\"remove-button btn btn-sm btn-link d-icon-cross_adapt p-0 px-1\"\n          type=\"button\"\n          aria-label=\"Close\"\n        ></button>\n      </div>\n\n      <rx-canvas-item [layout]=\"layout\" [isReadOnly]=\"isReadOnly\"></rx-canvas-item>\n    </div>\n  </div>\n</div>\n"]}