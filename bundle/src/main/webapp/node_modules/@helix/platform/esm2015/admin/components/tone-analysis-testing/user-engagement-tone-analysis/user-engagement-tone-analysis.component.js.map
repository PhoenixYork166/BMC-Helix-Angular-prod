{"version":3,"file":"user-engagement-tone-analysis.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/tone-analysis-testing/user-engagement-tone-analysis/user-engagement-tone-analysis.component.ts","../../../../../../../../libs/platform/admin/components/tone-analysis-testing/user-engagement-tone-analysis/user-engagement-tone-analysis.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\nimport { NgForm } from '@angular/forms';\nimport { RxSelectOption } from '@bmc-ux/adapt-angular';\nimport { RxCommandFactoryService } from '@helix/platform/shared/api';\nimport { compact, isNil, map, toNumber } from 'lodash';\nimport { RX_TONE_ANALYSIS_TESTING } from '../tone-analysis-testing.constant';\nimport { IUtterancesTone } from '../tone-analysis-testing.interfaces';\nimport { RxSystemConfigurationService } from '@helix/platform/shared/api';\nimport { finalize } from 'rxjs/operators';\n\n@Component({\n  selector: 'rx-user-engagement-tone-analysis',\n  templateUrl: './user-engagement-tone-analysis.component.html',\n  styleUrls: ['./user-engagement-tone-analysis.component.scss']\n})\nexport class UserEngagementToneAnalysisComponent implements OnInit {\n  languageOptions: RxSelectOption[] = RX_TONE_ANALYSIS_TESTING.languageOptions;\n  language: RxSelectOption;\n  utterances: string;\n  toneScoreThreshold: number;\n  defaultToneScoreThreshold = 0.5;\n  utteranceTonesData: IUtterancesTone;\n\n  @ViewChild('userEngagementToneAnalysisForm', { static: true, read: NgForm })\n  userEngagementToneAnalysisForm: NgForm;\n\n  constructor(\n    private rxCommandFactoryService: RxCommandFactoryService,\n    private rxSystemConfigurationService: RxSystemConfigurationService\n  ) {}\n\n  ngOnInit(): void {\n    this.rxSystemConfigurationService\n      .getConfiguration(RX_TONE_ANALYSIS_TESTING.systemSettingKeys.toneScoreThreshold)\n      .pipe(finalize(() => this.reset()))\n      .subscribe((data) => {\n        this.defaultToneScoreThreshold = data.value ? toNumber(data.value) : 0.5;\n      });\n  }\n\n  clearUtterances(): void {\n    this.utterances = null;\n  }\n\n  setDefaultThreshold(): void {\n    this.toneScoreThreshold = this.defaultToneScoreThreshold;\n  }\n\n  optionFormatter(option: RxSelectOption): string {\n    return option.name;\n  }\n\n  analyzeTone(): void {\n    const utterances = map(compact(this.utterances.split('\\n')), (utterance) => {\n      return {\n        text: utterance\n      };\n    });\n\n    this.rxCommandFactoryService\n      .forResourceType(RX_TONE_ANALYSIS_TESTING.userEngagementResourceType)\n      .execute({\n        resourceType: RX_TONE_ANALYSIS_TESTING.userEngagementResourceType,\n        language: this.language.id,\n        utterances: utterances,\n        toneScoreThreshold: this.toneScoreThreshold\n      })\n      .subscribe((response) => {\n        this.utteranceTonesData = response;\n      });\n  }\n\n  reset(): void {\n    this.toneScoreThreshold = this.defaultToneScoreThreshold;\n    this.language = [RX_TONE_ANALYSIS_TESTING.languageOptions[0]];\n    this.utterances = null;\n    this.utteranceTonesData = null;\n    this.userEngagementToneAnalysisForm.form.markAsPristine();\n  }\n\n  isAnalyzeToneButtonDisabled(): boolean {\n    return this.userEngagementToneAnalysisForm.pristine || this.userEngagementToneAnalysisForm.invalid;\n  }\n\n  isResetButtonDisabled(): boolean {\n    return this.userEngagementToneAnalysisForm.pristine && isNil(this.utterances);\n  }\n}\n","<form #userEngagementToneAnalysisForm=\"ngForm\">\n  <div class=\"row form-group\">\n    <div class=\"col-md-3\">\n      <adapt-rx-select\n        rx-id=\"language\"\n        name=\"language\"\n        [(ngModel)]=\"language\"\n        [options]=\"languageOptions\"\n        label=\"{{ 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.language.label' | translate }}\"\n        [optionFormatter]=\"optionFormatter\"\n      ></adapt-rx-select>\n    </div>\n  </div>\n\n  <div class=\"row\">\n    <div class=\"col-md-6\">\n      <button\n        rx-id=\"clear-button\"\n        type=\"button\"\n        adapt-button\n        btn-type=\"tertiary\"\n        class=\"p-0 float-right\"\n        (click)=\"clearUtterances()\"\n      >\n        {{ 'com.bmc.arsys.rx.client.common.clear.label' | translate }}\n      </button>\n\n      <adapt-rx-textarea\n        rx-id=\"utterances\"\n        name=\"utterances\"\n        [(ngModel)]=\"utterances\"\n        label=\"{{ 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.utterances.label' | translate }}\"\n        placeholder=\"{{ 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.utterances.placeholder' | translate }}\"\n        [rows]=\"16\"\n        required\n        [tooltip]=\"{\n          iconName: 'question_circle_o',\n          content: 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.utterances.tooltip' | translate,\n          placement: 'right',\n          popoverMode: true\n        }\"\n      ></adapt-rx-textarea>\n\n      <div class=\"form-group pt-3\">\n        <button type=\"button\" adapt-button btn-type=\"tertiary\" class=\"p-0 float-right\" (click)=\"setDefaultThreshold()\">\n          {{ 'com.bmc.arsys.rx.client.admin.set-to-default.label' | translate }}\n        </button>\n\n        <adapt-rx-counter\n          rx-id=\"tone-score-threshold\"\n          name=\"toneScoreThreshold\"\n          [(ngModel)]=\"toneScoreThreshold\"\n          label=\"{{ 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.tone-score-threshold.label' | translate }}\"\n          [max]=\"1.0\"\n          [min]=\"0.5\"\n          [step]=\"0.1\"\n          [size]=\"'small'\"\n          [tooltip]=\"{\n            iconName: 'question_circle_o',\n            content: 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.tone-score-threshold.tooltip' | translate,\n            placement: 'right',\n            popoverMode: true\n          }\"\n        >\n        </adapt-rx-counter>\n      </div>\n\n      <div class=\"my-4\">\n        <button\n          class=\"mr-2 d-icon-left-check_adapt\"\n          adapt-button\n          btn-type=\"primary\"\n          type=\"button\"\n          rx-id=\"analyze-tone-button\"\n          (click)=\"analyzeTone()\"\n          [disabled]=\"isAnalyzeToneButtonDisabled()\"\n        >\n          {{ 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.analyze-tone.label' | translate }}\n        </button>\n\n        <button\n          [disabled]=\"true\"\n          class=\"mr-2 d-icon-left-undo\"\n          adapt-button\n          btn-type=\"secondary\"\n          type=\"button\"\n          rx-id=\"reset-button\"\n          (click)=\"reset()\"\n          [disabled]=\"isResetButtonDisabled()\"\n        >\n          {{ 'com.bmc.arsys.rx.client.common.reset.label' | translate }}\n        </button>\n      </div>\n    </div>\n\n    <div class=\"col-md-6 mb-4\">\n      <div rx-id=\"utterance-tone\" name=\"utteranceTones\">\n        <adapt-rx-control-label\n          label=\"{{ 'com.bmc.arsys.rx.client.admin.tone-analysis-testing.utterances-tone.label' | translate }}\"\n        ></adapt-rx-control-label>\n        <div class=\"sentences-tones form-control\">\n          <div class=\"sentences-tone\" *ngFor=\"let sentenceTone of utteranceTonesData?.utterancesTone\">\n            <div class=\"sentence\">{{ sentenceTone.text }}</div>\n            <div>\n              <adapt-badge variant=\"info\" class=\"mr-1\" *ngFor=\"let score of sentenceTone?.scores\">\n                <b>{{ score.toneName }}</b> ({{ score.score }})</adapt-badge\n              >\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</form>\n"]}