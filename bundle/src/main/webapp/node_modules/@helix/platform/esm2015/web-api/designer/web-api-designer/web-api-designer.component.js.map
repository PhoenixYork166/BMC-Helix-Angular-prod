{"version":3,"file":"web-api-designer.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/web-api/designer/web-api-designer/web-api-designer.component.ts","../../../../../../../libs/platform/web-api/designer/web-api-designer/web-api-designer.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport { BehaviorSubject, combineLatest, Observable, ReplaySubject } from 'rxjs';\nimport { distinctUntilChanged, map } from 'rxjs/operators';\nimport { TranslateService } from '@ngx-translate/core';\nimport { filter as _filter } from 'lodash';\nimport {\n  IFormBuilderEvent,\n  IPlainObject,\n  RxBundleCacheService,\n  RxDefinitionNameService,\n  RxGlobalCacheService,\n  RxOverlayService,\n} from '@helix/platform/shared/api';\nimport {\n  IBreadcrumbItem,\n  IValidationIssue,\n  IValidationIssueSection,\n  ValidationIssueType\n} from '@helix/platform/ui-kit';\nimport { IWebApiDefinition, RxWebApiDefinitionService } from '@helix/platform/web-api/api';\n\n@Component({\n  selector: 'rx-web-api-designer',\n  templateUrl: './web-api-designer.component.html',\n  styleUrls: ['./web-api-designer.component.scss']\n})\nexport class RxWebApiDesignerComponent implements OnInit {\n  @Input()\n  webApiDefinitionName: string;\n\n  @Output()\n  webApiDefinitionSaved: EventEmitter<string> = new EventEmitter();\n\n  @Output()\n  webApiDefinitionErrorLoading: EventEmitter<void> = new EventEmitter();\n\n  @Output()\n  closeDesigner: EventEmitter<void> = new EventEmitter<void>();\n\n  isDesignMode = true;\n\n  isExistingWebApi = false;\n\n  isCustomizationEnabled = true;\n\n  bundleFriendlyName$ = this.rxGlobalCacheService.getBundleFriendlyName(this.rxBundleCacheService.bundleId);\n\n  validationIssues$ = new BehaviorSubject<IValidationIssueSection[]>([]);\n\n  hasValidationErrors$: Observable<boolean> = this.validationIssues$.pipe(\n    map((validationIssues) =>\n      Boolean(\n        _filter(validationIssues, {\n          issues: [{ type: ValidationIssueType.Error }]\n        }).length\n      )\n    ),\n    distinctUntilChanged()\n  );\n\n  breadcrumbItems$: Observable<IBreadcrumbItem[]>;\n\n  webApiDefinition$ = new BehaviorSubject<IWebApiDefinition>(null);\n\n  isSaveButtonDisabled$: Observable<boolean>;\n\n  isSavingInProgress$ = new BehaviorSubject<boolean>(false);\n\n  private bundleId = this.rxBundleCacheService.bundleId;\n\n  private isBundleEditable = this.rxOverlayService.isBundleEditable(this.bundleId);\n\n  private destroyed$ = new ReplaySubject<boolean>(1);\n\n  constructor(\n    private rxGlobalCacheService: RxGlobalCacheService,\n    private rxBundleCacheService: RxBundleCacheService,\n    private rxWebApiDefinitionService: RxWebApiDefinitionService,\n    private rxDefinitionNameService: RxDefinitionNameService,\n    private translateService: TranslateService,\n    private rxOverlayService: RxOverlayService\n  ) {}\n\n  ngOnInit(): void {\n    if (this.webApiDefinitionName) {\n\n    } else {\n\n    }\n\n    this.breadcrumbItems$ = this.webApiDefinition$.pipe(\n      map((webApiDefinition) => {\n        const definitionName = this.rxDefinitionNameService.getDisplayName(webApiDefinition?.name);\n\n        return [\n          {\n            label: definitionName || `<${this.translateService.instant('com.bmc.arsys.rx.client.web-api-designer.new-web-api.label')}>`,\n            data: {}\n          }\n        ];\n      })\n    );\n\n    this.isSaveButtonDisabled$ = combineLatest([\n      this.validationIssues$,\n      this.isSavingInProgress$\n    ]).pipe(\n      map(([[validationIssueSection], isSavingInProgress]) =>\n        Boolean(validationIssueSection?.issues) || !this.isBundleEditable || isSavingInProgress\n      )\n    );\n  }\n\n  canDeactivate(): boolean {\n    return true;\n  }\n\n  toggleDesignMode(): void {\n    this.isDesignMode = !this.isDesignMode;\n  }\n\n  onCorrectIssue(validationIssue: IValidationIssue): void {\n\n  }\n\n  validate(value: IPlainObject): IValidationIssueSection[] {\n    const validationIssues: IValidationIssue[] = [];\n\n    return validationIssues.length ? [{\n      title: this.translateService.instant('com.bmc.arsys.rx.client.web-api-designer.new-web-api.label'),\n      issues: validationIssues\n    }] : [];\n  }\n\n  onRevertCustomization(event: IFormBuilderEvent): void {\n\n  }\n\n  saveDefinition(): void {\n\n  }\n}\n","<rx-designer-header\n  [bundleName]=\"bundleFriendlyName$ | async\"\n  [breadcrumbItems]=\"breadcrumbItems$ | async\"\n  [isDesignMode]=\"isDesignMode\"\n  [isSaveButtonDisabled]=\"isSaveButtonDisabled$ | async\"\n  (toggleDesignMode)=\"toggleDesignMode()\"\n  (save)=\"saveDefinition()\"\n  (closeDesigner)=\"closeDesigner.emit()\"\n></rx-designer-header>\n\n<div class=\"rx-component-designer\" [hidden]=\"!isDesignMode\">\n  <adapt-sidebar position=\"right\" panelWidth=\"280px\" [openedId]=\"0\">\n    <adapt-sidebar-item\n      headerTitle=\"{{ 'com.bmc.arsys.rx.client.designer.validation-issues.label' | translate }}\"\n      tooltipText=\"{{ 'com.bmc.arsys.rx.client.designer.validation-issues.label' | translate }}\"\n      [iconClass]=\"\n        (hasValidationErrors$ | async) ? 'd-icon-exclamation_triangle text-danger' : 'd-icon-exclamation_triangle'\n      \"\n    >\n      <rx-validation-issues\n        [definitionTypeDisplayName]=\"'com.bmc.arsys.rx.client.common.web-api-definition.label' | translate\"\n        (correctIssue)=\"onCorrectIssue($event)\"\n        [issueSections]=\"validationIssues$ | async\"\n      ></rx-validation-issues>\n    </adapt-sidebar-item>\n  </adapt-sidebar>\n\n  <div class=\"main rx-designer-container h-100\">\n    <h3 class=\"mt-0\">\n      {{\n        isExistingWebApi\n          ? ('com.bmc.arsys.rx.client.web-api-designer.edit-web-api.title' | translate)\n          : ('com.bmc.arsys.rx.client.web-api-designer.new-web-api.label' | translate)\n      }}\n    </h3>\n\n    <h4 class=\"mt-0\">{{ 'com.bmc.arsys.rx.client.web-api-designer.collection-details.title' | translate }}</h4>\n  </div>\n</div>\n\n<adapt-code-viewer\n  *ngIf=\"!isDesignMode\"\n  [code]=\"webApiDefinition$ | async | json\"\n  [lang]=\"'javascript'\"\n  [hasToolbar]=\"false\"\n  [theme]=\"'light'\"\n  class=\"full-size\"\n></adapt-code-viewer>\n"]}