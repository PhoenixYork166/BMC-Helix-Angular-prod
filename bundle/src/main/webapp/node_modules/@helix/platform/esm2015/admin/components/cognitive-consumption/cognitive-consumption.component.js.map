{"version":3,"file":"cognitive-consumption.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/admin/components/cognitive-consumption/cognitive-consumption.component.ts","../../../../../../../libs/platform/admin/components/cognitive-consumption/cognitive-consumption.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, QueryList, ViewChildren } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { filter, find, includes, noop } from 'lodash';\nimport { AdaptModalService } from '@bmc-ux/adapt-angular';\nimport { ILicenseDataPageResult, RxCurrentUserService, RxLicenseDataPageService } from '@helix/platform/shared/api';\nimport { RX_COGNITIVE_CONSUMPTION } from './cognitive-consumption.constant';\nimport { ChartGroup, ICognitiveConsumptionSection } from './cognitive-consumption.types';\nimport { DownloadReportModalComponent } from './components/download-report-modal/download-report-modal.component';\nimport { CognitiveConsumptionGroupComponent } from './components/cognitive-consumption-group/cognitive-consumption-group.component';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'rx-admin-cognitive-consumption',\n  templateUrl: './cognitive-consumption.component.html'\n})\nexport class CognitiveConsumptionAdminComponent implements OnInit {\n  @ViewChildren(CognitiveConsumptionGroupComponent)\n  cognitiveConsumptionGroups: QueryList<CognitiveConsumptionGroupComponent>;\n\n  busy: Subscription;\n  isAdministrator: boolean;\n  sectionIds: string[];\n  sections: ICognitiveConsumptionSection[];\n\n  constructor(\n    private adaptModalService: AdaptModalService,\n    private rxLicenseDataPageService: RxLicenseDataPageService,\n    private rxCurrentUserService: RxCurrentUserService,\n    private translateService: TranslateService\n  ) {}\n\n  ngOnInit() {\n    this.isAdministrator = this.rxCurrentUserService.isAdministrator();\n\n    this.busy = this.rxLicenseDataPageService\n      .get({\n        params: {\n          startIndex: -1,\n          pageSize: 0,\n          propertySelection: ['name', 'serviceLicensedCount'].join(',')\n        }\n      })\n      .subscribe((result: ILicenseDataPageResult) => {\n        const isHelixCognitiveChatbotPerUserLicensed = find(result.data[0].serviceLicenseDescriptors, [\n          'name',\n          'HelixCognitiveChatbotPerUser'\n        ]).licensed;\n\n        this.sectionIds = [\n          isHelixCognitiveChatbotPerUserLicensed ? ChartGroup.ChatByUser : ChartGroup.Chat,\n          ChartGroup.Classify,\n          ChartGroup.Search\n        ];\n\n        this.sections = filter(RX_COGNITIVE_CONSUMPTION.sections, (section) => includes(this.sectionIds, section.id));\n      });\n  }\n\n  onDownloadClick(): void {\n    this.adaptModalService\n      .open({\n        title: this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.cognitive-consumption.download-csv-file.title'\n        ),\n        type: 'default',\n        size: 'sm',\n        content: DownloadReportModalComponent,\n        data: {\n          sectionIds: this.sectionIds\n        }\n      })\n      .catch(noop);\n  }\n\n  onRefreshClick(): void {\n    this.cognitiveConsumptionGroups.forEach((cognitiveConsumptionGroup) => {\n      cognitiveConsumptionGroup.generateCognitiveConsumptionGroup();\n    });\n  }\n}\n","<rx-admin-settings\n  header=\"{{ 'com.bmc.arsys.rx.client.admin.cognitive-consumption.header.title' | translate }}\"\n  [busy]=\"busy\"\n>\n  <div class=\"mb-4\">\n    <button\n      class=\"d-icon-refresh_adapt\"\n      adapt-button\n      btn-type=\"tertiary\"\n      type=\"button\"\n      rx-id=\"refresh-button\"\n      (click)=\"onRefreshClick()\"\n    >\n      {{ 'com.bmc.arsys.rx.client.common.refresh.label' | translate }}\n    </button>\n\n    <button\n      class=\"d-icon-download_csv\"\n      adapt-button\n      btn-type=\"tertiary\"\n      type=\"button\"\n      rx-id=\"download-button\"\n      (click)=\"onDownloadClick()\"\n    >\n      {{ 'com.bmc.arsys.rx.client.common.download.label' | translate }}\n    </button>\n  </div>\n\n  <div *ngFor=\"let section of sections\">\n    <h4 class=\"m-0 mb-4\">{{ section.title | translate }}</h4>\n\n    <rx-cognitive-consumption-group\n      *ngFor=\"let group of section.groups\"\n      [group]=\"group\"\n      [sectionId]=\"section.id\"\n      [isAdministrator]=\"isAdministrator\"\n    >\n    </rx-cognitive-consumption-group>\n  </div>\n</rx-admin-settings>\n"]}