{"version":3,"file":"approval-configuration-editor.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/approval-configuration/approval-configuration-editor/approval-configuration-editor.component.ts","../../../../../../../../libs/platform/admin/components/approval-configuration/approval-configuration-editor/approval-configuration-editor.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, ViewChild } from '@angular/core';\nimport { ActiveModalRef, AdaptTabsComponent, DismissReasons } from '@bmc-ux/adapt-angular';\nimport { RxNotificationService } from '@helix/platform/shared/api';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { TranslateService } from '@ngx-translate/core';\nimport { ApprovalFlowConfigurationComponent } from '../approval-flow-configuration/approval-flow-configuration.component';\nimport { RecordRegistrationComponent } from '../record-registration/record-registration.component';\nimport { SelfApprovalConfigurationComponent } from '../self-approval-configuration/self-approval-configuration.component';\n\n@Component({\n  selector: 'rx-approval-configuration-editor',\n  templateUrl: './approval-configuration-editor.component.html',\n  styleUrls: ['./approval-configuration-editor.component.scss']\n})\nexport class ApprovalConfigurationEditorComponent extends RxModalClass {\n  activatedTabs = [true, false, false];\n  selectedRecordDefinition = this.activeModalRef.getData().selectedRecordDefinition;\n  editMode = this.activeModalRef.getData().editMode;\n\n  @ViewChild(ApprovalFlowConfigurationComponent)\n  approvalFlowConfigurationComponent: ApprovalFlowConfigurationComponent;\n\n  @ViewChild(RecordRegistrationComponent)\n  recordRegistrationComponent: RecordRegistrationComponent;\n\n  @ViewChild(SelfApprovalConfigurationComponent)\n  selfApprovalConfigurationComponent: SelfApprovalConfigurationComponent;\n\n  @ViewChild('tabSetComponent')\n  tabSetComponent: AdaptTabsComponent;\n\n  constructor(\n    private translateService: TranslateService,\n    private rxNotificationService: RxNotificationService,\n    private activeModalRef: ActiveModalRef,\n    protected injector: Injector\n  ) {\n    super(activeModalRef, injector);\n  }\n\n  isDirty(): boolean {\n    return (\n      this.recordRegistrationComponent?.isFormDirty() ||\n      this.approvalFlowConfigurationComponent?.isDirty() ||\n      this.selfApprovalConfigurationComponent?.isDirty()\n    );\n  }\n\n  onRecordRegistered(registeredRecordDefinitionName: string): void {\n    this.editMode = true;\n    this.selectedRecordDefinition = registeredRecordDefinitionName;\n  }\n\n  isSaveButtonDisabled(): boolean {\n    if (this.editMode) {\n      return !this.recordRegistrationComponent?.canSave() && !this.approvalFlowConfigurationComponent?.canSave();\n    } else {\n      return !this.recordRegistrationComponent?.canSave();\n    }\n  }\n\n  saveApprovalConfiguration(): void {\n    if (this.recordRegistrationComponent?.isFormDirty() && this.recordRegistrationComponent?.isFormValid()) {\n      this.recordRegistrationComponent.save();\n    } else if (this.recordRegistrationComponent?.isFormDirty() && !this.recordRegistrationComponent?.isFormValid()) {\n      this.rxNotificationService.addWarningMessage(\n        this.translateService.instant('com.bmc.arsys.rx.client.approval.configuration.message.validation.error')\n      );\n\n      this.tabSetComponent.setActiveTab(0, true, null);\n    }\n\n    if (this.editMode && this.approvalFlowConfigurationComponent?.canSave()) {\n      this.approvalFlowConfigurationComponent?.markInvalidGroupsAndFlows();\n\n      if (this.approvalFlowConfigurationComponent?.areFlowGroupsValid()) {\n        this.approvalFlowConfigurationComponent.saveFlowGroups();\n      } else if (this.approvalFlowConfigurationComponent?.hasFlowGroups()) {\n        this.rxNotificationService.addWarningMessage(\n          this.translateService.instant('com.bmc.arsys.rx.client.approval.configuration.message.validation.error')\n        );\n\n        this.tabSetComponent.setActiveTab(2, true, null);\n      }\n    }\n  }\n\n  closeModal(): void {\n    this.activeModalRef.dismiss(DismissReasons.CLOSE_BTN);\n  }\n}\n","<div class=\"designer-modal-body d-flex mh-100 flex-column\">\n  <adapt-tabset [fullHeight]=\"true\" #tabSetComponent (tab-active-changed)=\"activatedTabs[$event.index] = true\">\n    <adapt-tab-panel\n      adapt-tab-title=\"{{ 'com.bmc.arsys.rx.client.approval.configuration.tab.registration' | translate }}\"\n    >\n      <rx-record-registration\n        [registeredRecordDefinitionName]=\"selectedRecordDefinition\"\n        [isEditMode]=\"editMode\"\n        (recordRegistered)=\"onRecordRegistered($event)\"\n      ></rx-record-registration>\n    </adapt-tab-panel>\n\n    <adapt-tab-panel\n      adapt-tab-title=\"{{ 'com.bmc.arsys.rx.client.approval.configuration.tab.selfApproval' | translate }}\"\n      [disabled]=\"!editMode\"\n    >\n      <rx-self-approval-configuration\n        [registeredRecordDefinitionName]=\"selectedRecordDefinition\"\n        *ngIf=\"editMode && activatedTabs[1]\"\n      >\n      </rx-self-approval-configuration>\n    </adapt-tab-panel>\n\n    <adapt-tab-panel\n      adapt-tab-title=\"{{ 'com.bmc.arsys.rx.client.approval.configuration.tab.approvalFlows' | translate }}\"\n      [disabled]=\"!editMode\"\n    >\n      <rx-approval-flow-configuration\n        [registeredRecordDefinitionName]=\"selectedRecordDefinition\"\n        *ngIf=\"editMode && activatedTabs[2]\"\n      ></rx-approval-flow-configuration>\n    </adapt-tab-panel>\n  </adapt-tabset>\n</div>\n\n<div class=\"modal-footer\">\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"primary\"\n    rx-id=\"save-button\"\n    [disabled]=\"isSaveButtonDisabled()\"\n    (click)=\"saveApprovalConfiguration()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n  <button adapt-button type=\"button\" btn-type=\"secondary\" rx-id=\"close-button\" (click)=\"closeModal()\">\n    {{ 'com.bmc.arsys.rx.client.common.close.label' | translate }}\n  </button>\n</div>\n"]}