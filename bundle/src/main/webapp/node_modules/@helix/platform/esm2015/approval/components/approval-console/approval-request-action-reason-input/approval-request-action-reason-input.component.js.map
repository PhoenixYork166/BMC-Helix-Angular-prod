{"version":3,"file":"approval-request-action-reason-input.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/approval/components/approval-console/approval-request-action-reason-input/approval-request-action-reason-input.component.ts","../../../../../../../../libs/platform/approval/components/approval-console/approval-request-action-reason-input/approval-request-action-reason-input.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, OnInit } from '@angular/core';\nimport { ApprovalCommandType, IApprovalCommand, IApprovalRequest, IRequestConfig } from '../approval-console.types';\nimport { ActiveModalRef, DismissReasons } from '@bmc-ux/adapt-angular';\nimport { map, some, trim } from 'lodash';\nimport { RX_APPROVAL_CONSOLE } from '../approval-console.constant';\nimport { RxApprovalConsoleService } from '../approval-console.service';\nimport { RxNotificationService } from '@helix/platform/shared/api';\nimport { TranslateService } from '@ngx-translate/core';\nimport { finalize } from 'rxjs/operators';\nimport { RxModalClass } from '@helix/platform/ui-kit';\n\n@Component({\n  selector: 'rx-approval-request-action-reason-input',\n  templateUrl: './approval-request-action-reason-input.component.html'\n})\nexport class ApprovalRequestActionReasonInputComponent extends RxModalClass implements OnInit {\n  currentRequestIndex = 0;\n  shouldApplySameReasonToAll: boolean;\n  requests: IRequestConfig[] = [];\n  title = this.activeModalRef.getData().modalTitle;\n  private commandType: ApprovalCommandType = this.activeModalRef.getData().commandType;\n\n  constructor(\n    private activeModalRef: ActiveModalRef,\n    private rxNotificationService: RxNotificationService,\n    private translateService: TranslateService,\n    private rxApprovalConsoleService: RxApprovalConsoleService,\n    protected injector: Injector\n  ) {\n    super(activeModalRef, injector);\n  }\n\n  isDirty(): boolean {\n    return some(this.requests, (request) => request.reason);\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n\n    this.requests = map(this.activeModalRef.getData().selectedRequests, (request: IApprovalRequest) => ({\n      requestId: request[RX_APPROVAL_CONSOLE.approvalRequestsGrid.fields.request],\n      requestSignatureInstanceId: request[RX_APPROVAL_CONSOLE.approvalRequestsGrid.fields.signatureInstanceID],\n      reason: null,\n      isReasonRequired:\n        request.justificationRequired === 'TO_APPROVE_OR_REJECT' ||\n        (this.commandType === ApprovalCommandType.Approved && request.justificationRequired === 'TO_APPROVE') ||\n        (this.commandType === ApprovalCommandType.Rejected && request.justificationRequired === 'TO_REJECT')\n    }));\n  }\n\n  isSaveButtonDisabled(): boolean {\n    return (\n      !this.allowDismiss ||\n      (some(this.requests, (request) => request.isReasonRequired && this.isReasonEmpty(request.reason)) &&\n        !this.shouldApplySameReasonToAll)\n    );\n  }\n\n  goToPreviousRequest(): void {\n    this.currentRequestIndex--;\n  }\n\n  goToNextRequest(): void {\n    this.currentRequestIndex++;\n  }\n\n  saveRequests(): void {\n    this.allowDismiss = false;\n    const commonReason = this.requests[this.currentRequestIndex].reason;\n\n    const commands: IApprovalCommand[] = [\n      ...map(this.requests, (request: IRequestConfig) => ({\n        justificationOrReason: this.shouldApplySameReasonToAll ? commonReason : request.reason,\n        ...this.rxApprovalConsoleService.getCommandPayload(this.commandType, request.requestSignatureInstanceId)\n      }))\n    ];\n\n    this.rxApprovalConsoleService\n      .rejectRequest(commands)\n      .pipe(\n        finalize(() => {\n          this.allowDismiss = true;\n        })\n      )\n      .subscribe(() => {\n        this.rxNotificationService.addSuccessMessage(\n          this.translateService.instant(\n            this.commandType === ApprovalCommandType.Rejected\n              ? 'com.bmc.arsys.rx.client.approval.console.request.rejected.message'\n              : 'com.bmc.arsys.rx.client.approval.console.request.approved.message'\n          )\n        );\n\n        this.activeModalRef.close(true);\n      });\n  }\n\n  cancel(): void {\n    this.activeModalRef.dismiss(DismissReasons.CLOSE_BTN);\n  }\n\n  isReasonEmpty(reason: string): boolean {\n    return !trim(reason);\n  }\n}\n","<div class=\"modal-header\">\n  <h5 class=\"modal-title\">\n    {{ title }}\n  </h5>\n\n  <button\n    class=\"close dp-close\"\n    type=\"button\"\n    rx-id=\"x-button\"\n    [disabled]=\"!allowDismiss\"\n    (click)=\"cancel()\"\n  ></button>\n</div>\n\n<div class=\"modal-body\">\n  <adapt-rx-textfield\n    class=\"form-group d-block\"\n    label=\"{{ 'com.bmc.arsys.rx.client.approval.configuration.grid.column.requestId' | translate }}\"\n    [(ngModel)]=\"requests[currentRequestIndex].requestId\"\n    [readonly]=\"true\"\n    rx-id=\"request-id\"\n  >\n  </adapt-rx-textfield>\n\n  <adapt-rx-textarea\n    label=\"{{ 'com.bmc.arsys.rx.client.approval.justification-reason.label' | translate }}\"\n    class=\"d-block form-group\"\n    [(ngModel)]=\"requests[currentRequestIndex].reason\"\n    [required]=\"requests[currentRequestIndex].isReasonRequired\"\n    rx-id=\"justification-reason\"\n    rows=\"2\"\n    [autofocus]=\"true\"\n  ></adapt-rx-textarea>\n\n  <adapt-rx-switch\n    class=\"d-block mb-2\"\n    [(ngModel)]=\"shouldApplySameReasonToAll\"\n    [disabled]=\"isReasonEmpty(requests[currentRequestIndex].reason)\"\n    rx-id=\"all-request-reason\"\n    label=\"{{ 'com.bmc.arsys.rx.client.approval.console.apply-common-justification-reason.label' | translate }}\"\n  ></adapt-rx-switch>\n\n  <div class=\"text-warning\" *ngIf=\"shouldApplySameReasonToAll\">\n    {{ 'com.bmc.arsys.rx.client.approval.console.overwrite-justification-reason.warning' | translate }}\n  </div>\n</div>\n\n<div class=\"modal-footer\">\n  <button\n    type=\"button\"\n    adapt-button\n    class=\"mr-2\"\n    btn-type=\"secondary\"\n    rx-id=\"previous-button\"\n    [disabled]=\"currentRequestIndex === 0 || shouldApplySameReasonToAll\"\n    (click)=\"goToPreviousRequest()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.previous-step.label' | translate }}\n  </button>\n\n  <button\n    type=\"button\"\n    adapt-button\n    class=\"mr-auto\"\n    btn-type=\"secondary\"\n    rx-id=\"next-button\"\n    [disabled]=\"currentRequestIndex === requests.length - 1 || shouldApplySameReasonToAll\"\n    (click)=\"goToNextRequest()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.next-step.label' | translate }}\n  </button>\n\n  <button\n    type=\"button\"\n    adapt-button\n    class=\"mr-2\"\n    btn-type=\"primary\"\n    rx-id=\"save-button\"\n    [disabled]=\"isSaveButtonDisabled()\"\n    [adaptInlineLoader]=\"!allowDismiss\"\n    (click)=\"saveRequests()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"secondary\"\n    rx-id=\"cancel-button\"\n    (click)=\"cancel()\"\n    [disabled]=\"!allowDismiss\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n  </button>\n</div>\n"]}