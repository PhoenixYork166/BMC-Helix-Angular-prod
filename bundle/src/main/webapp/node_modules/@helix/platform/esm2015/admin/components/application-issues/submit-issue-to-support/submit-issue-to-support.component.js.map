{"version":3,"file":"submit-issue-to-support.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/admin/components/application-issues/submit-issue-to-support/submit-issue-to-support.component.ts","../../../../../../../../libs/platform/admin/components/application-issues/submit-issue-to-support/submit-issue-to-support.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { ActiveModalRef } from '@bmc-ux/adapt-angular';\nimport { RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { RxCommandFactoryService, RxNotificationService } from '@helix/platform/shared/api';\nimport { RX_MODAL, RxModalClass, RxModalService } from '@helix/platform/ui-kit';\nimport { RxStringService } from '@helix/platform/utils';\nimport { IRowDataItem } from '@helix/platform/view/api';\nimport { TranslateService } from '@ngx-translate/core';\nimport { map } from 'lodash';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { RX_ISSUES } from '../application-issues.constant';\nimport { RxApplicationIssuesService } from '../application-issues.service';\nimport { IIssueSeverity, IIssuesResource } from '../application-issues.types';\n\n@Component({\n  selector: 'rx-submit-issue-to-support',\n  templateUrl: './submit-issue-to-support.component.html'\n})\nexport class SubmitIssueToSupportComponent extends RxModalClass implements OnInit {\n  message: string;\n  issues: IRowDataItem[];\n  issueSeverityOptions: IIssueSeverity[] = [\n    {\n      name: this.translateService.instant(\n        'com.bmc.arsys.rx.client.admin.application-issues.submit-issue-to-support.severity-critical.message'\n      ),\n      id: 1\n    },\n    {\n      name: this.translateService.instant(\n        'com.bmc.arsys.rx.client.admin.application-issues.submit-issue-to-support.severity-high.message'\n      ),\n      id: 2\n    },\n    {\n      name: this.translateService.instant(\n        'com.bmc.arsys.rx.client.admin.application-issues.submit-issue-to-support.severity-medium.message'\n      ),\n      id: 3\n    },\n    {\n      name: this.translateService.instant(\n        'com.bmc.arsys.rx.client.admin.application-issues.submit-issue-to-support.severity-low.message'\n      ),\n      id: 4\n    }\n  ];\n  submitIssueForm: FormGroup;\n  supportCentralUrl: string;\n\n  constructor(\n    private activeModalRef: ActiveModalRef,\n    private formBuilder: FormBuilder,\n    private rxApplicationIssuesService: RxApplicationIssuesService,\n    private rxCommandFactoryService: RxCommandFactoryService,\n    private rxModalService: RxModalService,\n    private rxNotificationService: RxNotificationService,\n    private rxStringService: RxStringService,\n    private translateService: TranslateService,\n    protected injector: Injector\n  ) {\n    super(activeModalRef, injector);\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n\n    this.submitIssueForm = this.formBuilder.group({\n      description: [],\n      severity: []\n    });\n\n    this.issues = this.activeModalRef.getData().issues;\n\n    this.rxApplicationIssuesService.getIssuesResource().subscribe((issues: IIssuesResource) => {\n      const { errorReportingValue } = issues;\n\n      this.supportCentralUrl = errorReportingValue.supportCentralUrl;\n    });\n\n    this.message = this.translateService.instant(\n      'com.bmc.arsys.rx.client.admin.application-issues.reported-issues.title',\n      { numberOfIssues: this.issues.length }\n    );\n  }\n\n  isDirty(): boolean {\n    return this.submitIssueForm.dirty;\n  }\n\n  initSearchQuery(): void {\n    if (this.issues.length >= 1) {\n      const errorMessage = this.issues[0][RX_ISSUES.issuesRecordFieldIds.errorMessage];\n      const errorNumber = this.issues[0][RX_ISSUES.issuesRecordFieldIds.errorNumber];\n      const applicationName = this.issues[0][RX_ISSUES.issuesRecordFieldIds.applicationName];\n      const searchQuery = `?fromproduct=helixplatform#q=${errorMessage}%20OR%20${errorNumber}&t=All&sort=relevancy&f:@bmcproductname=[${applicationName}]`;\n\n      window.open(this.supportCentralUrl + searchQuery);\n    }\n  }\n\n  submit(): void {\n    this.rxCommandFactoryService\n      .forResourceType('com.bmc.arsys.rx.application.support.command.CreateSupportCaseCommand')\n      .execute({\n        description: this.submitIssueForm.get('description').value,\n        recordIds: map(this.issues, RX_RECORD_DEFINITION.coreFieldIds.id),\n        severity: this.submitIssueForm.get('severity').value[0].id\n      })\n      .pipe(\n        catchError((error) => {\n          if (error.error[0].messageNumber === RX_ISSUES.linkExpiredError.code) {\n            this.rxNotificationService.addErrorMessage(RX_ISSUES.linkExpiredError.message);\n          }\n\n          return throwError(error);\n        })\n      )\n      .subscribe(() => {\n        this.rxNotificationService.addSuccessMessage(\n          this.translateService.instant(RX_ISSUES.notificationMessages.caseSubmitted)\n        );\n        this.activeModalRef.close('cancel');\n      });\n  }\n\n  optionFormatter(severity: IIssueSeverity): string {\n    return severity.name;\n  }\n\n  cancel(): void {\n    if (this.submitIssueForm.get('description')) {\n      this.rxModalService\n        .confirm({\n          title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n          modalStyle: RX_MODAL.modalStyles.warning,\n          message: this.translateService.instant(\n            'com.bmc.arsys.rx.client.admin.application-issues.submit-issue-to-support.cancel-submission.message'\n          )\n        })\n        .then((data) => {\n          if (data) this.activeModalRef.close();\n        });\n    } else {\n      this.activeModalRef.close();\n    }\n  }\n}\n","<div class=\"modal-body pt-0\">\n  <div class=\"row bg-info\" *ngIf=\"supportCentralUrl\">\n    <button\n      adapt-button\n      rx-id=\"knowledge-articles-button\"\n      type=\"button\"\n      class=\"btn btn-secondary m-2\"\n      size=\"xtra-small\"\n      (click)=\"initSearchQuery()\"\n    >\n      <span class=\"d-icon-lightbulb_o p-2\" aria-hidden=\"true\"></span>\n      {{\n        'com.bmc.arsys.rx.client.admin.application-issues.submit-issue-to-support.knowledge-articles.title' | translate\n      }}\n    </button>\n    <span class=\"mt-3 text-default-inverse\" rx-id=\"message\">{{\n      'com.bmc.arsys.rx.client.admin.application-issues.submit-issue-to-support.search-knowledge-articles.message'\n        | translate\n    }}</span>\n  </div>\n  <div class=\"row mt-2\">\n    <div class=\"col-md-12\">\n      <p rx-id=\"message\">{{ message }}</p>\n    </div>\n  </div>\n  <form [formGroup]=\"submitIssueForm\">\n    <div class=\"row\">\n      <div class=\"col-12\">\n        <adapt-rx-textarea\n          rx-id=\"description\"\n          formControlName=\"description\"\n          label=\"Description\"\n          placeholder=\"Enter Issue Description\"\n          rows=\"7\"\n          required\n        ></adapt-rx-textarea>\n      </div>\n    </div>\n\n    <div class=\"row mt-4 mb-4\">\n      <div class=\"col-4\">\n        <adapt-rx-select\n          rx-id=\"severity\"\n          formControlName=\"severity\"\n          [options]=\"issueSeverityOptions\"\n          [optionFormatter]=\"optionFormatter\"\n          label=\"Severity\"\n          required\n        ></adapt-rx-select>\n      </div>\n    </div>\n  </form>\n</div>\n<div class=\"modal-footer\">\n  <button\n    adapt-button\n    btn-type=\"primary\"\n    class=\"mr-2\"\n    rx-id=\"submit-case-button\"\n    [disabled]=\"submitIssueForm.invalid\"\n    (click)=\"submit()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.admin.application-issues.submit-issue-to-support.submit-case.label' | translate }}\n  </button>\n  <button rx-id=\"cancel-button\" adapt-button btn-type=\"secondary\" class=\"mr-2\" (click)=\"cancel()\">\n    {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n  </button>\n</div>\n"]}