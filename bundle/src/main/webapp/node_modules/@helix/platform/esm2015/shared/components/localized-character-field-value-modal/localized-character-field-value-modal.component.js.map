{"version":3,"file":"localized-character-field-value-modal.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/shared/components/localized-character-field-value-modal/localized-character-field-value-modal.component.ts","../../../../../../../libs/platform/shared/components/localized-character-field-value-modal/localized-character-field-value-modal.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, OnInit, ViewChild } from '@angular/core';\nimport { IFieldDefinition, RX_RECORD_DEFINITION, RxLocaleService } from '@helix/platform/record/api';\nimport { ActiveModalRef, DismissReasons } from '@bmc-ux/adapt-angular';\nimport { flow, mapValues, reject } from 'lodash';\nimport { IPlainObject, RxLocalizationService } from '@helix/platform/shared/api';\nimport { ILocalizedCharacterFieldLocale } from './localized-character-field-value-modal.interface';\nimport { Subscription } from 'rxjs';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { NgForm } from '@angular/forms';\n\n@Component({\n  selector: 'rx-localized-character-field-value-modal',\n  templateUrl: './localized-character-field-value-modal.component.html',\n  styleUrls: ['./localized-character-field-value-modal.component.scss']\n})\nexport class LocalizedCharacterFieldValueModalComponent extends RxModalClass implements OnInit {\n  @ViewChild('localeForm')\n  localeForm: NgForm;\n\n  defaultLocale: ILocalizedCharacterFieldLocale;\n  currentLocale: ILocalizedCharacterFieldLocale;\n  gridLocales: ILocalizedCharacterFieldLocale[];\n  maxLength: number;\n  isCurrentLocaleSupported = true;\n  getLocalesSubscription: Subscription;\n  valueByLocale: IPlainObject;\n  data: IPlainObject = this.activeModalRef.getData();\n  locales: ILocalizedCharacterFieldLocale[];\n  isReadOnly = this.data.isReadOnly;\n\n  private fieldDefinition: IFieldDefinition;\n  private currentLocaleCode: string;\n\n  constructor(\n    private activeModalRef: ActiveModalRef,\n    private rxLocaleService: RxLocaleService,\n    private rxLocalizationService: RxLocalizationService,\n    protected injector: Injector\n  ) {\n    super(activeModalRef, injector);\n  }\n\n  isDirty(): boolean {\n    return this.localeForm.dirty;\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n    this.init();\n  }\n\n  init(): void {\n    this.currentLocaleCode = this.rxLocalizationService.currentLocale;\n\n    this.valueByLocale = this.data.valueByLocale || {};\n    this.fieldDefinition = this.data.fieldDefinition || {};\n    this.maxLength = this.fieldDefinition.maxLength || null;\n\n    this.getLocalesSubscription = this.rxLocaleService.getLocales().subscribe(({ data }: any) => {\n      const browserLocale = {\n        name: 'Browser - Locale',\n        code: this.currentLocaleCode,\n        value: this.valueByLocale[this.currentLocaleCode]\n      };\n\n      this.locales = data.map((locale) => {\n        const localeCode = locale[RX_RECORD_DEFINITION.supportedSystemLocales.codeFieldId];\n\n        return {\n          name: locale[RX_RECORD_DEFINITION.supportedSystemLocales.nameFieldId],\n          code: localeCode,\n          value: this.valueByLocale[localeCode] || null\n        };\n      });\n\n      this.defaultLocale = {\n        name: 'English - United States',\n        code: 'en-US',\n        value: this.valueByLocale['en-US']\n      };\n\n      this.currentLocale = this.locales.find((locale) => {\n        return locale.code.toLowerCase() === this.currentLocaleCode.toLowerCase();\n      });\n\n      if (!this.currentLocale || this.currentLocale.code === this.defaultLocale.code) {\n        this.currentLocale = browserLocale;\n        this.isCurrentLocaleSupported = false;\n      }\n\n      this.gridLocales = flow(\n        (locales) => reject(locales, { code: this.defaultLocale.code }),\n        (locales) =>\n          reject(locales, (locale) => {\n            return !this.data.hideCurrentLocale && locale.code === this.currentLocale.code;\n          })\n      )(this.locales);\n    });\n  }\n\n  ok(): void {\n    if (this.isCurrentLocaleSupported) {\n      this.valueByLocale[this.currentLocale.code] = this.currentLocale.value;\n    }\n\n    this.activeModalRef.close({\n      currentLocaleValue:\n        (this.currentLocale.code === this.defaultLocale.code && this.valueByLocale[this.defaultLocale.code]) ||\n        this.valueByLocale[this.currentLocale.code] ||\n        this.valueByLocale[this.currentLocale.code.split('-')[0]] ||\n        this.valueByLocale[this.defaultLocale.code],\n      valueByLocale: mapValues(this.valueByLocale, (value) => value || null)\n    });\n  }\n\n  close(): void {\n    this.activeModalRef.dismiss(DismissReasons.CLOSE_BTN);\n  }\n}\n","<div class=\"modal-body\">\n  <form name=\"localeForm\" novalidate #localeForm=\"ngForm\">\n    <rx-busy-indicator [options]=\"{ busy: getLocalesSubscription }\"></rx-busy-indicator>\n\n    <div class=\"flex-container row\" *ngIf=\"!data.hideCurrentLocale && currentLocale\">\n      <div class=\"col-4\">\n        <adapt-rx-control-label\n          label=\"{{\n            'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.current-locale.label' | translate\n          }}\"\n        >\n        </adapt-rx-control-label>\n        <div class=\"rx-locale-name\" rx-id=\"current-locale-name\">{{ currentLocale?.name }}</div>\n      </div>\n\n      <div class=\"col-2\">\n        <adapt-rx-control-label\n          label=\"{{\n            'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.code.label' | translate\n          }}\"\n        >\n        </adapt-rx-control-label>\n        <div class=\"rx-locale-name\" rx-id=\"current-locale-code\">{{ currentLocale?.code }}</div>\n      </div>\n\n      <div class=\"col-6\">\n        <adapt-rx-control-label\n          label=\"{{\n            'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.value.label' | translate\n          }}\"\n          [tooltip]=\"{\n            iconName: 'question_circle_o',\n            content:\n              'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.value-for-current-locale.tooltip'\n              | translate,\n            placement: 'auto',\n            popoverMode: true\n          }\"\n        >\n        </adapt-rx-control-label>\n\n        <adapt-rx-textfield\n          name=\"current-locale\"\n          rx-id=\"current-locale-value\"\n          [disabled]=\"!isCurrentLocaleSupported || isReadOnly\"\n          [maxlength]=\"maxLength\"\n          [(ngModel)]=\"currentLocale.value\"\n          [ariaLabel]=\"\n            'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.value-for-current-locale.label'\n              | translate\n          \"\n        >\n        </adapt-rx-textfield>\n      </div>\n    </div>\n\n    <div class=\"flex-container\">\n      <div class=\"row\">\n        <div class=\"col-4\">\n          <adapt-rx-control-label\n            label=\"{{\n              'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.default-locale.label'\n                | translate\n            }}\"\n          >\n          </adapt-rx-control-label>\n          <div class=\"rx-locale-name\" rx-id=\"default-locale-name\">{{ defaultLocale?.name }}</div>\n        </div>\n\n        <div class=\"col-2\">\n          <adapt-rx-control-label\n            label=\"{{\n              'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.code.label' | translate\n            }}\"\n          >\n          </adapt-rx-control-label>\n\n          <div class=\"rx-locale-name\" rx-id=\"default-locale-code\">{{ defaultLocale?.code }}</div>\n        </div>\n\n        <div class=\"col-6\">\n          <adapt-rx-control-label\n            label=\"{{\n              'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.value.label' | translate\n            }}\"\n          >\n          </adapt-rx-control-label>\n\n          <adapt-rx-textfield\n            name=\"default-locale\"\n            rx-id=\"default-locale-value\"\n            [maxlength]=\"maxLength\"\n            [(ngModel)]=\"valueByLocale[defaultLocale?.code]\"\n            [disabled]=\"isReadOnly\"\n            [ariaLabel]=\"\n              'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.value-for-default-locale.label'\n                | translate\n            \"\n          >\n          </adapt-rx-textfield>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"rx-locale-table container\" *ngIf=\"gridLocales?.length > 0\">\n      <div class=\"rx-locale-table-row row\">\n        <div class=\"rx-locale-table-cell pl-0 col-4\">\n          <h6>\n            {{ 'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.locale.label' | translate }}*\n          </h6>\n        </div>\n\n        <div class=\"rx-locale-table-cell pl-2 col-2\">\n          <h6>\n            {{ 'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.code.label' | translate }}\n          </h6>\n        </div>\n\n        <div class=\"rx-locale-table-cell col-6\">\n          <h6>\n            {{\n              'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.localized-value.label'\n                | translate\n            }}\n          </h6>\n        </div>\n      </div>\n\n      <div class=\"rx-locale-table-row row\" *ngFor=\"let locale of gridLocales\">\n        <div class=\"rx-locale-table-cell pl-0 col-4\">{{ locale.name }}</div>\n        <div class=\"rx-locale-table-cell pl-2 col-2\">{{ locale.code }}</div>\n        <div class=\"rx-locale-table-cell pr-0 col-6\">\n          <adapt-rx-textfield\n            name=\"localized-value {{ locale.code }}\"\n            [maxlength]=\"maxLength\"\n            [(ngModel)]=\"valueByLocale[locale.code]\"\n            [disabled]=\"isReadOnly\"\n            [ariaLabel]=\"\n              'com.bmc.arsys.rx.client.view-components.localized-character-field.dialog.localized-value-for.label'\n                | translate: { locale: locale.name }\n            \"\n          >\n          </adapt-rx-textfield>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n\n<div class=\"modal-footer\">\n  <button\n    *ngIf=\"!isReadOnly\"\n    adapt-button\n    btn-type=\"primary\"\n    type=\"button\"\n    rx-id=\"save-button\"\n    [disabled]=\"localeForm.pristine || localeForm.invalid\"\n    (click)=\"ok()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n\n  <button type=\"button\" adapt-button btn-type=\"secondary\" (click)=\"close()\" rx-id=\"cancel-button\">\n    {{ 'com.bmc.arsys.rx.client.common.close.label' | translate }}\n  </button>\n</div>\n"]}