{"version":3,"file":"button-bar.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/view/components/button-bar/runtime/button-bar.component.ts","../../../../../../../../libs/platform/view/components/button-bar/runtime/button-bar.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  NgZone,\n  OnDestroy,\n  OnInit,\n  QueryList,\n  Renderer2,\n  ViewChild,\n  ViewChildren\n} from '@angular/core';\nimport { RX_VIEW_DEFINITION } from '@helix/platform/view/api';\nimport { BaseViewComponent, IViewComponent, RuntimeViewCanvasItemComponent } from '@helix/platform/view/runtime';\nimport { get, isEmpty, isUndefined, last, throttle } from 'lodash';\nimport { merge, Observable, Subject, throwError } from 'rxjs';\nimport { IButtonBarChildComponentData, IButtonBarConfig } from './button-bar.types';\nimport { ResizeSensor } from 'css-element-queries';\nimport { map, takeUntil } from 'rxjs/operators';\nimport { RxButtonBarService } from '../button-bar.service';\n\n@Component({\n  selector: 'rx-button-bar',\n  templateUrl: './button-bar.component.html',\n  styleUrls: ['./button-bar.component.scss']\n})\nexport class ButtonBarComponent extends BaseViewComponent implements OnInit, OnDestroy, IViewComponent, AfterViewInit {\n  @ViewChildren('buttonItems', { read: ElementRef })\n  private buttonItemsQueryList: QueryList<ElementRef>;\n\n  @ViewChild('dropdownToggle', { read: ElementRef })\n  private dropdownToggleButton: ElementRef;\n\n  api = {\n    setProperty: this.setProperty.bind(this)\n  };\n\n  config: Observable<IButtonBarConfig>;\n  alignClass: string;\n  childLayouts: IButtonBarChildComponentData[] = null;\n  isDropdownVisible = false;\n\n  private resizeSensor: ResizeSensor;\n  private resize$ = new Subject();\n  private onResizeThrottled = throttle(this.onResize.bind(this), 100);\n\n  constructor(\n    private elementRef: ElementRef<HTMLElement>,\n    private runtimeCanvasItemComponent: RuntimeViewCanvasItemComponent,\n    private changeDetector: ChangeDetectorRef,\n    private ngZone: NgZone,\n    private rxButtonBarService: RxButtonBarService,\n    private renderer: Renderer2\n  ) {\n    super();\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n    this.notifyPropertyChanged('api', this.api);\n\n    this.config.pipe(takeUntil(this.destroyed$)).subscribe((config) => {\n      this.isHidden = Boolean(config.hidden);\n      this.alignClass = this.rxButtonBarService.getAlignClass(config.alignment);\n    });\n\n    this.childLayouts = get(\n      this.runtimeCanvasItemComponent.getChildren(RX_VIEW_DEFINITION.defaultOutletName),\n      '[0].children'\n    );\n  }\n\n  ngAfterViewInit(): void {\n    const el = this.renderer.selectRootElement(this.elementRef.nativeElement, true);\n\n    if (!isEmpty(this.childLayouts)) {\n      const buttonConfigs = this.childLayouts.map((layout) => layout.config);\n\n      this.ngZone.runOutsideAngular(() => {\n        this.resizeSensor = new ResizeSensor(el, (size) => {\n          this.ngZone.run(() => this.resize$.next(size));\n        });\n      });\n\n      merge(...buttonConfigs, this.resize$)\n        .pipe(\n          map((size: any) => size.width || el.offsetWidth),\n          takeUntil(this.destroyed$)\n        )\n        .subscribe((width: number) => this.onResizeThrottled(width));\n    }\n\n    this.onResize(el.offsetWidth);\n    this.changeDetector.detectChanges();\n  }\n\n  ngOnDestroy(): void {\n    super.ngOnDestroy();\n\n    if (this.resizeSensor) {\n      this.resizeSensor.detach();\n    }\n  }\n\n  onResize(containerWidth: number): void {\n    let totalButtonsWidth = 0;\n\n    const toggleButtonOffsetWidth = this.dropdownToggleButton\n      ? this.renderer.selectRootElement(this.dropdownToggleButton.nativeElement, true).offsetWidth\n      : 0;\n\n    this.buttonItemsQueryList.forEach((item: ElementRef, index: number) => {\n      totalButtonsWidth += this.renderer.selectRootElement(item.nativeElement, true).offsetWidth;\n\n      const containerFitsButton = Math.floor(containerWidth) >= Math.ceil(totalButtonsWidth) + toggleButtonOffsetWidth;\n\n      this.childLayouts[index].showInDropdown = !containerFitsButton;\n\n      if (\n        !isUndefined(this.childLayouts[index - 1]) &&\n        this.childLayouts.filter((button) => button.showInDropdown).length < 2\n      ) {\n        this.childLayouts[index - 1].showInDropdown = !containerFitsButton;\n      }\n    });\n\n    this.isDropdownVisible = isEmpty(this.childLayouts) ? false : last(this.childLayouts).showInDropdown;\n  }\n\n  trackByFn(index: number, item: IButtonBarChildComponentData): string {\n    return item.guid;\n  }\n\n  setProperty(propertyPath: string, propertyValue: any): void | Observable<never> {\n    if (propertyPath === 'hidden') {\n      this.isHidden = propertyValue;\n      this.notifyPropertyChanged(propertyPath, this.isHidden);\n    } else {\n      return throwError(`Button Bar: property ${propertyPath} is not settable.`);\n    }\n  }\n}\n","<div class=\"button-container\" [ngClass]=\"alignClass\" *ngIf=\"childLayouts && !isHidden\">\n  <div\n    *ngFor=\"let buttonLayout of childLayouts; trackBy: trackByFn\"\n    [ngClass]=\"{ 'nav-item--hidden': buttonLayout.showInDropdown }\"\n  >\n    <rx-runtime-view-canvas-item #buttonItems [layout]=\"buttonLayout\"></rx-runtime-view-canvas-item>\n  </div>\n\n  <div\n    *ngIf=\"isDropdownVisible\"\n    class=\"dropdown\"\n    adaptDropdown\n    [placement]=\"['bottom-right', 'bottom-left', 'bottom', 'top-right', 'top-left', 'top', 'auto']\"\n  >\n    <button\n      class=\"btn btn-secondary rx-toggle\"\n      [attr.id]=\"'rx-' + guid\"\n      type=\"button\"\n      adaptDropdownToggle\n      #dropdownToggle\n    ></button>\n    <div class=\"dropdown-menu\" [attr.aria-labelledby]=\"'rx-' + guid\" adaptDropdownMenu>\n      <ng-container *ngFor=\"let buttonLayout of childLayouts; trackBy: trackByFn\">\n        <rx-button-bar-dropdown-item-component\n          *ngIf=\"buttonLayout.showInDropdown\"\n          [config]=\"buttonLayout.config\"\n          [runtimeViewModelApi]=\"buttonLayout.runtimeViewModelApi\"\n          [guid]=\"buttonLayout.guid\"\n        ></rx-button-bar-dropdown-item-component>\n      </ng-container>\n    </div>\n  </div>\n</div>\n"]}