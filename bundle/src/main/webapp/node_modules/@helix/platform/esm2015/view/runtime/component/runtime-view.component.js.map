{"version":3,"file":"runtime-view.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/view/runtime/component/runtime-view.component.ts","../../../../../../../libs/platform/view/runtime/component/runtime-view.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  EventEmitter,\n  HostBinding,\n  HostListener,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Output,\n  SimpleChanges\n} from '@angular/core';\nimport { ReplaySubject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { RxRecordDefinitionCacheService } from '@helix/platform/record/api';\n\nimport { IRuntimeViewConfiguration } from '../interfaces/runtime-view-configuration.interface';\nimport { IRuntimeViewOutputParameter } from '../interfaces/runtime-view-output-parameter.interface';\nimport { RuntimeViewLayoutService } from '../layout/runtime-view-layout.service';\nimport { RuntimeViewModelApi } from '../runtime-view-model-api.class';\nimport { RuntimeViewModel } from '../runtime-view.model';\nimport { RxRuntimeViewRegistryService } from '../runtime-view-registry.service';\nimport { RxViewDefinitionCacheService, RxViewDefinitionService } from '@helix/platform/view/api';\nimport { RxAssociationDefinitionCacheService } from '@helix/platform/association/api';\nimport { RxProcessDefinitionCacheService } from '@helix/platform/process/api';\n\n@Component({\n  selector: 'rx-runtime-view',\n  templateUrl: './runtime-view.component.html',\n  styleUrls: ['./runtime-view.component.scss'],\n  providers: [RuntimeViewModel, RuntimeViewModelApi, RuntimeViewLayoutService]\n})\nexport class RuntimeViewComponent implements OnInit, OnChanges, OnDestroy {\n  private destroyed$ = new ReplaySubject<boolean>(1);\n\n  @Input() configuration: IRuntimeViewConfiguration;\n\n  @Output() save: EventEmitter<void> = new EventEmitter();\n  @Output() closeView: EventEmitter<IRuntimeViewOutputParameter> = new EventEmitter();\n  @Output() cancelView: EventEmitter<void> = new EventEmitter();\n  @Output() beforeLoad: EventEmitter<void> = new EventEmitter();\n  @Output() afterLoad: EventEmitter<void> = new EventEmitter();\n\n  @HostBinding('class') hostClass: string;\n  @HostBinding('attr.rx-view-definition-guid') viewDefinitionGuid: string;\n\n  @HostListener('focusin')\n  onTrigger() {\n    this.runtimeViewModel.isUserInteractionDetected = true;\n  }\n\n  constructor(\n    private runtimeViewModelApi: RuntimeViewModelApi,\n    private rxRecordDefinitionCacheService: RxRecordDefinitionCacheService,\n    public runtimeViewLayoutService: RuntimeViewLayoutService,\n    public runtimeViewModel: RuntimeViewModel,\n    private rxProcessDefinitionCacheService: RxProcessDefinitionCacheService,\n    private rxRuntimeViewRegistryService: RxRuntimeViewRegistryService,\n    private rxViewDefinitionCacheService: RxViewDefinitionCacheService,\n    private rxAssociationDefinitionCacheService: RxAssociationDefinitionCacheService,\n    private rxViewDefinitionService: RxViewDefinitionService\n  ) {\n    this.rxAssociationDefinitionCacheService.registerConsumer(this.destroyed$);\n    this.rxProcessDefinitionCacheService.registerConsumer(this.destroyed$);\n    this.rxRecordDefinitionCacheService.registerConsumer(this.destroyed$);\n    this.rxViewDefinitionCacheService.registerConsumer(this.destroyed$);\n  }\n\n  ngOnInit() {\n    this.init();\n\n    this.runtimeViewModel.cancel$.pipe(takeUntil(this.destroyed$)).subscribe(() => this.cancelView.emit());\n    this.runtimeViewModel.save$.pipe(takeUntil(this.destroyed$)).subscribe(() => this.save.emit());\n\n    this.runtimeViewModel.close$\n      .pipe(takeUntil(this.destroyed$))\n      .subscribe((viewOutputParams) => this.closeView.emit(viewOutputParams));\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    if (\n      changes.configuration.currentValue &&\n      changes.configuration.previousValue &&\n      changes.configuration.currentValue.viewDefinitionName !== changes.configuration.previousValue.viewDefinitionName\n    ) {\n      this.runtimeViewModelApi.clear();\n      this.runtimeViewLayoutService.clear();\n\n      this.configuration = changes.configuration.currentValue;\n\n      this.init();\n    }\n  }\n\n  ngOnDestroy() {\n    this.destroyed$.next(true);\n    this.destroyed$.complete();\n    this.rxRuntimeViewRegistryService.unregister(this.runtimeViewModel);\n  }\n\n  private init() {\n    this.beforeLoad.emit();\n\n    this.runtimeViewModel.init(this.configuration).subscribe({\n      complete: () => {\n        this.runtimeViewModelApi.init(this.runtimeViewModel);\n        this.runtimeViewLayoutService.init(this.runtimeViewModel, this.runtimeViewModelApi);\n        this.hostClass = this.runtimeViewModel.viewDefinition.styles || '';\n\n        if (this.rxViewDefinitionService.isPageView(this.runtimeViewModel.viewDefinition)) {\n          this.hostClass = this.hostClass + ' rx-page-view';\n        }\n\n        this.viewDefinitionGuid = this.runtimeViewModel.viewDefinition.guid;\n\n        this.runtimeViewModel.isUserInteractionDetected = false;\n\n        this.afterLoad.emit();\n      }\n    });\n\n    if (this.configuration.onRegisterApi) {\n      this.configuration.onRegisterApi(this.runtimeViewModel.api);\n    }\n\n    this.rxRuntimeViewRegistryService.register(this.runtimeViewModel);\n  }\n}\n","<rx-runtime-view-canvas\n  (componentPropertyChanged)=\"runtimeViewModel.onViewComponentPropertyChanged($event)\"\n  *ngIf=\"runtimeViewLayoutService.layout\"\n  [layout]=\"runtimeViewLayoutService.layout\"\n></rx-runtime-view-canvas>\n"]}