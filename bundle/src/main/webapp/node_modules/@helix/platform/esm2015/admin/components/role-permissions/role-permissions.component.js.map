{"version":3,"file":"role-permissions.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/admin/components/role-permissions/role-permissions.component.ts","../../../../../../../libs/platform/admin/components/role-permissions/role-permissions.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\nimport { IRecordDefinition, RecordInstance, RX_RECORD_DEFINITION } from '@helix/platform/record/api';\nimport { IDataPageResult, IRole, RxNotificationService, RxRoleDataPageService } from '@helix/platform/shared/api';\nimport { RX_MODAL, RxModalService } from '@helix/platform/ui-kit';\nimport { IRowDataItem } from '@helix/platform/view/api';\nimport {\n  IRecordGridActionButton,\n  IRecordGridColumn,\n  IRecordGridConfig,\n  IRecordGridDataPageParams,\n  RecordGridComponent,\n  RowSelectionMode\n} from '@helix/platform/view/components';\nimport { castArray, noop } from 'lodash';\nimport { Observable, of } from 'rxjs';\nimport { RoleEditorComponent } from './role-editor/role-editor.component';\nimport { RoleFields } from './role-permission.types';\nimport { RxRolePermissionsService } from './role-permissions.service';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'rx-admin-role-permissions',\n  templateUrl: './role-permissions.component.html'\n})\nexport class RolePermissionsAdminComponent implements OnInit {\n  recordGridConfig$: Observable<IRecordGridConfig>;\n\n  @ViewChild('rolesPermissionsRecordGrid', { static: false })\n  rolesPermissionsRecordGrid: RecordGridComponent;\n  currentRecordInstance: Observable<RecordInstance>;\n  isDirty = false;\n\n  constructor(\n    private rxRolePermissionsService: RxRolePermissionsService,\n    private rxNotificationService: RxNotificationService,\n    private rxModalService: RxModalService,\n    private rxRoleDataPage: RxRoleDataPageService,\n    private translateService: TranslateService\n  ) {}\n\n  ngOnInit(): void {\n    const gridColumns: IRecordGridColumn[] = [\n      {\n        index: 0,\n        fieldId: RoleFields.RoleId,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.role-permissions.role-id.label'),\n        filterable: false\n      },\n      {\n        index: 1,\n        fieldId: RoleFields.RoleName,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.role-permissions.role-name.label'),\n        filterable: true,\n        clickable: true,\n        actions: [\n          {\n            name: (previousActionResult: any, lastActionRow: IRowDataItem) => this.editRole(lastActionRow)\n          }\n        ]\n      },\n      {\n        index: 2,\n        fieldId: RoleFields.ApplicationName,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.application-issues.application-name.title'),\n        filterable: true\n      },\n      {\n        index: 3,\n        fieldId: RoleFields.Datatag,\n        title: this.translateService.instant('com.bmc.arsys.rx.client.admin.role-permissions.datatag.label'),\n        filterable: false\n      }\n    ];\n\n    const recordDefinition: IRecordDefinition = {\n      fieldDefinitions: [\n        {\n          id: RoleFields.RoleId,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: RoleFields.RoleName,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: RoleFields.ApplicationName,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        },\n        {\n          id: RoleFields.Datatag,\n          resourceType: RX_RECORD_DEFINITION.resourceTypes.character\n        }\n      ]\n    };\n\n    const actionButtons: IRecordGridActionButton[] = [\n      {\n        label: this.translateService.instant('com.bmc.arsys.rx.client.common.delete.label'),\n        style: 'tertiary',\n        icon: 'trash',\n        actions: [\n          {\n            name: () => {\n              this.rxModalService\n                .confirm({\n                  title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n                  modalStyle: RX_MODAL.modalStyles.warning,\n                  message: this.translateService.instant(\n                    'com.bmc.arsys.rx.client.admin.role-permissions.delete-confirmation.message'\n                  )\n                })\n                .then((result: boolean) => {\n                  if (result) {\n                    const selectedRecords = castArray(this.rolesPermissionsRecordGrid.api.getSelectedRows());\n\n                    const rolesToDelete = selectedRecords.map((record) => {\n                      return {\n                        applicationName: record[RoleFields.ApplicationName],\n                        name: record[RoleFields.RoleName]\n                      };\n                    });\n\n                    this.rxRolePermissionsService.delete(rolesToDelete).subscribe(() => {\n                      this.rxNotificationService.addSuccessMessage(\n                        this.translateService.instant(\n                          'com.bmc.arsys.rx.client.admin.role-permissions.roles-deleted.message'\n                        )\n                      );\n                      this.rolesPermissionsRecordGrid.api.refresh().subscribe();\n                    });\n                  }\n                });\n            }\n          }\n        ]\n      }\n    ];\n\n    this.recordGridConfig$ = of({\n      columns: gridColumns,\n      enableFiltering: true,\n      recordIdField: RoleFields.RoleId,\n      getRecordDefinition: () => of(recordDefinition),\n      enableRowSelection: RowSelectionMode.Multiple,\n      actionButtons: actionButtons,\n      getData: this.getData,\n      styles: 'flex-fill'\n    });\n  }\n\n  private getData = (queryParams: IRecordGridDataPageParams): Observable<IDataPageResult> => {\n    delete queryParams.searchText;\n\n    return this.rxRoleDataPage.get({\n      params: { ...queryParams }\n    });\n  };\n\n  openDockedPanel(title: string, role: IRole) {\n    this.rxModalService\n      .openDockedPanel({\n        title: title,\n        content: RoleEditorComponent,\n        size: 'lg',\n        data: {\n          role\n        }\n      })\n      .then((result) => {\n        if (result) {\n          this.rolesPermissionsRecordGrid.api.refresh().subscribe();\n        }\n      })\n      .catch(noop);\n  }\n\n  createRole() {\n    this.openDockedPanel(\n      this.translateService.instant('com.bmc.arsys.rx.client.admin.role-permissions.create-role.label'),\n      {\n        roleID: null,\n        roleName: '',\n        datatag: '',\n        test: '',\n        production: '',\n        applicationName: ''\n      }\n    );\n  }\n\n  private editRole(roleRow: IRowDataItem): void {\n    this.rxRolePermissionsService\n      .get({\n        applicationName: roleRow[RoleFields.ApplicationName],\n        name: roleRow[RoleFields.RoleName]\n      })\n      .subscribe((role: IRole) => {\n        this.openDockedPanel(\n          this.translateService.instant('com.bmc.arsys.rx.client.admin.role-permissions.edit-role.label'),\n          role\n        );\n      });\n  }\n}\n","<rx-admin-settings header=\"{{ 'com.bmc.arsys.rx.client.admin.role-permissions.header.title' | translate }}\">\n  <button\n    adapt-button\n    type=\"button\"\n    btn-type=\"tertiary\"\n    class=\"d-icon-plus_circle align-self-start btn btn-link\"\n    rx-id=\"new-button\"\n    (click)=\"createRole()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.new.label' | translate }}\n  </button>\n\n  <rx-record-grid rx-id=\"roles-permissions-grid\" #rolesPermissionsRecordGrid [config]=\"recordGridConfig$\">\n  </rx-record-grid>\n</rx-admin-settings>\n"]}