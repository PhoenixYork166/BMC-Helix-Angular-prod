{"version":3,"file":"record-grid-row-action-editor-modal.component.js","sourceRoot":"","sources":["../../../../../../../../../../../libs/platform/view/components/record-grid/design/editors/record-grid-row-action-editor-control/record-grid-row-action-editor-modal/record-grid-row-action-editor-modal.component.ts","../../../../../../../../../../../libs/platform/view/components/record-grid/design/editors/record-grid-row-action-editor-control/record-grid-row-action-editor-modal/record-grid-row-action-editor-modal.component.html"],"names":[],"mappings":"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","sourcesContent":["import {\n  AfterViewInit,\n  Component,\n  ElementRef,\n  Injector,\n  NgZone,\n  OnInit,\n  QueryList,\n  ViewChild,\n  ViewChildren\n} from '@angular/core';\nimport { ActiveModalRef, AdaptAccordionTabComponent, AdaptModalService, DismissReasons } from '@bmc-ux/adapt-angular';\nimport { ActionListControlComponent, getAvailableOnDevicesInspectorConfig } from '@helix/platform/view/designer';\nimport { IRowAction, IRowActionData } from '../record-grid-row-action-editor-widget.types';\nimport { cloneDeep, isEqual, omit } from 'lodash';\nimport {\n  IDefinitionPickerComponentOptions,\n  IExpressionEditorPropertyChange,\n  IExpressionFormControlOptions,\n  IIconPickerFormControlOptions,\n  ISelectFormControlOptions,\n  RxDefinitionPickerType,\n  RxExpressionEditorService\n} from '@helix/platform/shared/components';\nimport { IExpressionConfigurator, IPlainObject, Tooltip } from '@helix/platform/shared/api';\nimport { CdkDrag, CdkDropList, moveItemInArray } from '@angular/cdk/drag-drop';\nimport { CdkDragDrop } from '@angular/cdk/drag-drop/';\nimport { TranslateService } from '@ngx-translate/core';\nimport { map } from 'rxjs/operators';\nimport { IRecordDefinition, RxRecordDefinitionCacheService } from '@helix/platform/record/api';\nimport { of } from 'rxjs';\nimport { RxModalClass } from '@helix/platform/ui-kit';\nimport { NgForm } from '@angular/forms';\nimport { RxGuidService } from '@helix/platform/utils';\nimport { RX_AVAILABLE_ON_DEVICES_DEFAULT_VALUE } from '@helix/platform/view/api';\n\n@Component({\n  selector: 'rx-record-grid-row-action-editor-modal',\n  templateUrl: './record-grid-row-action-editor-modal.component.html',\n  styleUrls: ['./record-grid-row-action-editor-modal.component.scss']\n})\nexport class RecordGridRowActionEditorModalComponent extends RxModalClass implements OnInit, AfterViewInit {\n  @ViewChildren(AdaptAccordionTabComponent, { read: ElementRef })\n  private accordionTabEls: QueryList<ElementRef>;\n\n  @ViewChild('rowActionsForm', { static: true, read: NgForm })\n  rowActionsForm: NgForm;\n\n  expressionConfigurator: IExpressionConfigurator;\n  isReadOnly: boolean;\n  rowActions: IRowActionData[] = [];\n\n  selectFormControlOptions: ISelectFormControlOptions = {\n    label: this.translateService.instant(\n      'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.field-name.label'\n    ),\n    tooltip: new Tooltip(\n      this.translateService.instant(\n        'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.field-name.tooltip'\n      )\n    ),\n    options: [],\n    emptyOption: true\n  } as ISelectFormControlOptions;\n\n  availableOnDevicesFormControlOptions: ISelectFormControlOptions = getAvailableOnDevicesInspectorConfig().options;\n\n  recordDefinitionPickerOptions: IDefinitionPickerComponentOptions = {\n    label: this.translateService.instant(\n      'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.security-definition-name.label'\n    ),\n    tooltip: new Tooltip(\n      this.translateService.instant(\n        'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.security-definition-name.tooltip'\n      )\n    ),\n    definitionType: RxDefinitionPickerType.StandardDataRecord,\n    required: false\n  };\n\n  iconPickerOptions: IIconPickerFormControlOptions = {\n    label: this.translateService.instant('com.bmc.arsys.rx.client.view-components.record-grid-row-actions.icon.label'),\n    appendToBody: true,\n    required: false\n  };\n\n  @ViewChildren('draggableSelectedRowAction', { read: CdkDrag })\n  draggableSelectedRowAction: QueryList<CdkDrag<IRowActionData>>;\n\n  @ViewChild('selectedRowActionsDropList', { read: CdkDropList })\n  selectedRowActionsDropList: CdkDropList;\n\n  @ViewChildren(ActionListControlComponent)\n  actionListControlComponents: QueryList<ActionListControlComponent>;\n\n  expressionFormControlOptions: IExpressionFormControlOptions;\n\n  private activeActionIndex: number;\n  private rowActionIndex: number;\n\n  constructor(\n    public context: ActiveModalRef,\n    private adaptModalService: AdaptModalService,\n    private rxExpressionEditorService: RxExpressionEditorService,\n    private translateService: TranslateService,\n    private rxRecordDefinitionCacheService: RxRecordDefinitionCacheService,\n    private ngZone: NgZone,\n    private rxGuidService: RxGuidService,\n    protected injector: Injector\n  ) {\n    super(context, injector);\n  }\n\n  ngOnInit(): void {\n    super.ngOnInit();\n    const params = this.context.getData();\n\n    this.expressionConfigurator = params.expressionConfigurator;\n    this.rowActionIndex = params.rowActionIndex;\n    this.activeActionIndex = params.activeActionIndex;\n    this.isReadOnly = params.isReadOnly;\n\n    this.rowActions = cloneDeep(params.rowActions).map((rowAction, index) => {\n      this.setSecurityFieldDefinitions(rowAction);\n\n      return {\n        ...rowAction,\n        isOpen: index === this.rowActionIndex\n      };\n    });\n  }\n\n  ngAfterViewInit() {\n    this.openActiveAction();\n\n    if (this.rowActionIndex) {\n      this.accordionTabEls.toArray()[this.rowActionIndex].nativeElement.scrollIntoView({\n        block: 'nearest'\n      });\n    }\n  }\n\n  cancel(): void {\n    this.context.dismiss(DismissReasons.CLOSE_BTN);\n  }\n\n  trackByGuid(index: number, rowAction: IRowActionData): string {\n    return rowAction.guid;\n  }\n\n  addRowAction(): void {\n    this.markAsDirty();\n\n    this.rowActions.push({\n      guid: this.rxGuidService.generate(),\n      label: 'New row action' + (this.rowActions.length === 0 ? '' : ' ' + this.rowActions.length),\n      icon: '',\n      recordDefinitionName: null,\n      fieldId: null,\n      recordInstance: null,\n      disabled: null,\n      hidden: null,\n      actions: [],\n      isOpen: true,\n      securityFieldDefinitions$: of(this.getSelectFormControlOptions()),\n      ...RX_AVAILABLE_ON_DEVICES_DEFAULT_VALUE\n    });\n\n    setTimeout(() => {\n      this.accordionTabEls.last.nativeElement.scrollIntoView({\n        block: 'nearest'\n      });\n    });\n  }\n\n  removeRowAction(index: number, $event: MouseEvent): void {\n    $event.stopPropagation();\n    this.markAsDirty();\n    this.rowActions.splice(index, 1);\n  }\n\n  openExpressionEditor(event: IPlainObject, rowAction, propertyPath: string): void {\n    this.rxExpressionEditorService\n      .openEditor({\n        property: {\n          path: propertyPath,\n          value: rowAction[propertyPath],\n          label: this.getRowActionLabel(propertyPath)\n        },\n        isReadOnly: false,\n        expressionConfigurator: this.expressionConfigurator,\n        legend: [\n          {\n            label: this.translateService.instant('com.bmc.arsys.rx.client.expression-editor.legend.function.label'),\n            icon: 'd-icon-mathematical_function'\n          },\n          {\n            label: this.translateService.instant('com.bmc.arsys.rx.client.expression-editor.legend.keyword.label'),\n            icon: 'd-icon-dollar'\n          },\n          {\n            label: this.translateService.instant(\n              'com.bmc.arsys.rx.client.expression-editor.legend.view-component.label'\n            ),\n            icon: 'd-icon-file_o'\n          },\n          {\n            label: this.translateService.instant(\n              'com.bmc.arsys.rx.client.expression-editor.legend.view-component-property.label'\n            ),\n            icon: 'd-icon-file_o_gear'\n          },\n          {\n            label: this.translateService.instant(\n              'com.bmc.arsys.rx.client.expression-editor.legend.view-input-parameter.label'\n            ),\n            icon: 'd-icon-arrow_right_square_input'\n          }\n        ]\n      })\n      .subscribe((expression: IExpressionEditorPropertyChange) => {\n        this.markAsDirty();\n\n        rowAction[propertyPath] = expression.value;\n      });\n  }\n\n  getExpressionFormControlOptions(propertyPath: string): IExpressionFormControlOptions {\n    return {\n      label: this.getRowActionLabel(propertyPath),\n      tooltip:\n        propertyPath === 'recordInstance'\n          ? new Tooltip(\n              this.translateService.instant(\n                'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.recordInstance.tooltip'\n              )\n            )\n          : null,\n      dataDictionary$: this.context.getData().expressionConfigurator.getDataDictionary(propertyPath),\n      operators: this.context.getData().expressionConfigurator.getOperators(propertyPath)\n    };\n  }\n\n  saveActions(): void {\n    const rowActions: IRowAction[] = this.rowActions.map((rowAction) => ({\n      ...omit(rowAction, ['isOpen', 'securityFieldDefinitions$']),\n      action: 'rowAction'\n    }));\n\n    this.context.close(rowActions);\n  }\n\n  moveRowAction(fromIndex: number, toIndex: number): void {\n    moveItemInArray(this.rowActions, fromIndex, toIndex);\n    this.markAsDirty();\n  }\n\n  onDropInSelectedRowActionsContainer($event: CdkDragDrop<IRowActionData[], any>): void {\n    moveItemInArray(this.rowActions, $event.previousIndex, $event.currentIndex);\n    this.markAsDirty();\n  }\n\n  onRecordDefinitionChange(rowAction: IRowActionData): void {\n    this.markAsDirty();\n\n    rowAction.fieldId = null;\n\n    this.setSecurityFieldDefinitions(rowAction);\n  }\n\n  setSecurityFieldDefinitions(rowAction: IRowActionData): void {\n    rowAction.securityFieldDefinitions$ = rowAction.recordDefinitionName\n      ? this.rxRecordDefinitionCacheService\n          .getRecordDefinition(rowAction.recordDefinitionName)\n          .pipe(map((recordDefinition) => this.getSelectFormControlOptions(recordDefinition)))\n      : of(this.getSelectFormControlOptions());\n  }\n\n  private getRowActionLabel(key: string): string {\n    let rowActionLabel;\n\n    switch (key) {\n      case 'disabled':\n        rowActionLabel = 'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.disabled.label';\n        break;\n      case 'hidden':\n        rowActionLabel = 'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.hidden.label';\n        break;\n      case 'recordInstance':\n        rowActionLabel = 'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.recordInstance.label';\n        break;\n    }\n\n    return this.translateService.instant(rowActionLabel);\n  }\n\n  private getSelectFormControlOptions(recordDefinition: IRecordDefinition = null): ISelectFormControlOptions {\n    return {\n      ...this.selectFormControlOptions,\n      options: recordDefinition\n        ? recordDefinition.fieldDefinitions.map((definition) => ({\n            name: definition.name,\n            id: String(definition.id)\n          }))\n        : []\n    } as ISelectFormControlOptions;\n  }\n\n  private openActiveAction(): void {\n    if (this.activeActionIndex >= 0 && this.rowActionIndex >= 0) {\n      this.ngZone.runOutsideAngular(() => {\n        // timeout is required to let control set initial value\n        setTimeout(() => {\n          const listControl = this.actionListControlComponents.find((control) =>\n            isEqual(control.value, this.rowActions[this.rowActionIndex]?.actions)\n          );\n\n          if (listControl) {\n            listControl.focus({ actionIndex: this.activeActionIndex });\n          }\n        });\n      });\n    }\n  }\n\n  toggleOpen(expandAll: boolean): void {\n    this.rowActions.forEach((action) => (action.isOpen = expandAll));\n  }\n}\n","<div class=\"designer-modal-body modal-body d-flex mh-100\">\n  <div class=\"row flex-grow-1 w-100\">\n    <div class=\"d-flex flex-column mh-100 col\">\n      <div class=\"d-flex align-items-start justify-content-between\">\n        <button\n          *ngIf=\"!isReadOnly\"\n          class=\"mt-2 p-0\"\n          rx-id=\"add-button\"\n          adapt-button\n          type=\"button\"\n          btn-type=\"tertiary\"\n          (click)=\"addRowAction()\"\n        >\n          <span class=\"d-icon-left-plus_circle\"></span>\n\n          {{\n            'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.add-row-action.button.label' | translate\n          }}\n        </button>\n\n        <div *ngIf=\"rowActions.length\" class=\"btn-group\">\n          <button adapt-button btn-type=\"tertiary\" type=\"button\" rx-id=\"expand-all-button\" (click)=\"toggleOpen(true)\">\n            {{ 'com.bmc.arsys.rx.client.common.expand-all.label' | translate }}\n          </button>\n\n          <button\n            adapt-button\n            btn-type=\"tertiary\"\n            type=\"button\"\n            rx-id=\"collapse-all-button\"\n            (click)=\"toggleOpen(false)\"\n          >\n            {{ 'com.bmc.arsys.rx.client.common.collapse-all.label' | translate }}\n          </button>\n        </div>\n      </div>\n\n      <div\n        id=\"selectedRowActionsDropList\"\n        class=\"designer-modal-accordion-wrapper\"\n        cdkDropList\n        [cdkDropListData]=\"rowActions\"\n        (cdkDropListDropped)=\"onDropInSelectedRowActionsContainer($event)\"\n        #selectedRowActionsDropList=\"cdkDropList\"\n      >\n        <adapt-accordion [multiselect]=\"true\">\n          <form #rowActionsForm=\"ngForm\">\n            <div\n              *ngFor=\"\n                let rowAction of rowActions;\n                let index = index;\n                let first = first;\n                let last = last;\n                trackBy: trackByGuid\n              \"\n              class=\"designer-modal-accordion-content\"\n              cdkDrag\n              cdkDragLockAxis=\"y\"\n              [cdkDragData]=\"rowAction\"\n              [cdkDragDisabled]=\"isReadOnly\"\n              #draggableSelectedRowAction\n            >\n              <div *ngIf=\"!isReadOnly\" class=\"designer-modal-drag-handle d-icon-left-dots\" cdkDragHandle></div>\n\n              <adapt-accordion-tab\n                class=\"d-block\"\n                [isOpen]=\"rowAction.isOpen\"\n                (open)=\"rowAction.isOpen = true\"\n                (close)=\"rowAction.isOpen = false\"\n              >\n                <div class=\"card-title-text w-100\">\n                  <div class=\"designer-modal-card-title-content\">\n                    <div class=\"left-header-block\" [class.pl-0]=\"isReadOnly\">\n                      <div class=\"rx-ellipsis\" [title]=\"rowAction.label\" rx-id=\"card-title\">\n                        {{ rowAction.label }}\n                      </div>\n                    </div>\n\n                    <div *ngIf=\"!isReadOnly\" class=\"right-header-block\">\n                      <div class=\"designer-modal-card-title-index-buttons\">\n                        <button\n                          class=\"d-icon-left-triangle_down rx-button-unstyled\"\n                          type=\"button\"\n                          [disabled]=\"last\"\n                          (click)=\"$event.stopPropagation(); moveRowAction(index, index + 1)\"\n                          rx-id=\"move-down-button\"\n                        ></button>\n\n                        <button\n                          class=\"d-icon-left-triangle_up rx-button-unstyled\"\n                          type=\"button\"\n                          [disabled]=\"first\"\n                          (click)=\"$event.stopPropagation(); moveRowAction(index, index - 1)\"\n                          rx-id=\"move-up-button\"\n                        ></button>\n                      </div>\n\n                      <button\n                        class=\"d-icon-left-cross_adapt p-1 pr-4 ml-3\"\n                        adapt-button\n                        size=\"small\"\n                        type=\"button\"\n                        (click)=\"removeRowAction(index, $event)\"\n                        rx-id=\"remove-button\"\n                      >\n                        {{ 'com.bmc.arsys.rx.client.common.remove.label' | translate }}\n                      </button>\n                    </div>\n                  </div>\n                </div>\n\n                <div class=\"d-flex row\">\n                  <adapt-rx-textfield\n                    class=\"form-group d-block col-4\"\n                    label=\"{{\n                      'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.label-field.label' | translate\n                    }}\"\n                    [disabled]=\"isReadOnly\"\n                    [required]=\"true\"\n                    [name]=\"'label_' + rowAction.guid\"\n                    rx-id=\"label\"\n                    [(ngModel)]=\"rowAction.label\"\n                    (ngModelChange)=\"markAsDirty()\"\n                    rxNoWhitespace\n                  >\n                  </adapt-rx-textfield>\n\n                  <rx-icon-picker-form-control\n                    [disabled]=\"isReadOnly\"\n                    class=\"form-group d-block col-4 px-2\"\n                    [options]=\"iconPickerOptions\"\n                    [name]=\"'icon_' + rowAction.guid\"\n                    rx-id=\"icon\"\n                    [(ngModel)]=\"rowAction.icon\"\n                    (ngModelChange)=\"markAsDirty()\"\n                  ></rx-icon-picker-form-control>\n                </div>\n\n                <div class=\"d-flex row\">\n                  <rx-definition-picker\n                    [isDisabled]=\"isReadOnly\"\n                    [options]=\"recordDefinitionPickerOptions\"\n                    [(ngModel)]=\"rowAction.recordDefinitionName\"\n                    [name]=\"'recordDefinition_' + rowAction.guid\"\n                    rx-id=\"recordDefinition\"\n                    (ngModelChange)=\"onRecordDefinitionChange(rowAction)\"\n                    class=\"form-group d-block col-4\"\n                  >\n                  </rx-definition-picker>\n\n                  <rx-select-form-control\n                    [options]=\"(rowAction.securityFieldDefinitions$ | async) || selectFormControlOptions\"\n                    [(ngModel)]=\"rowAction.fieldId\"\n                    [name]=\"'fieldId_' + rowAction.guid\"\n                    rx-id=\"fieldId\"\n                    [disabled]=\"!rowAction.recordDefinitionName || isReadOnly\"\n                    [appendToBody]=\"true\"\n                    class=\"col-4 px-2\"\n                    (ngModelChange)=\"markAsDirty()\"\n                  >\n                  </rx-select-form-control>\n\n                  <rx-expression-form-control\n                    [disabled]=\"!rowAction.recordDefinitionName || isReadOnly\"\n                    [options]=\"getExpressionFormControlOptions('recordInstance')\"\n                    propertyPath=\"recordInstance\"\n                    [ngModel]=\"rowAction.recordInstance\"\n                    (events)=\"openExpressionEditor($event, rowAction, 'recordInstance')\"\n                    [name]=\"'recordInstance_' + rowAction.guid\"\n                    rx-id=\"recordInstance\"\n                    class=\"col-4\"\n                  >\n                  </rx-expression-form-control>\n                </div>\n\n                <div class=\"d-flex row\">\n                  <rx-expression-form-control\n                    [disabled]=\"isReadOnly\"\n                    [options]=\"getExpressionFormControlOptions('disabled')\"\n                    propertyPath=\"disabled\"\n                    [ngModel]=\"rowAction.disabled\"\n                    (events)=\"openExpressionEditor($event, rowAction, 'disabled')\"\n                    [name]=\"'disabled_' + rowAction.guid\"\n                    rx-id=\"disabled\"\n                    class=\"col-4\"\n                  >\n                  </rx-expression-form-control>\n\n                  <rx-expression-form-control\n                    [disabled]=\"isReadOnly\"\n                    [options]=\"getExpressionFormControlOptions('hidden')\"\n                    propertyPath=\"hidden\"\n                    [ngModel]=\"rowAction.hidden\"\n                    (events)=\"openExpressionEditor($event, rowAction, 'hidden')\"\n                    [name]=\"'hidden_' + rowAction.guid\"\n                    rx-id=\"hidden\"\n                    class=\"col-4\"\n                  >\n                  </rx-expression-form-control>\n\n                  <rx-select-form-control\n                    [options]=\"availableOnDevicesFormControlOptions\"\n                    [(ngModel)]=\"rowAction.availableOnDevices\"\n                    [name]=\"'availableOnDevices_' + rowAction.guid\"\n                    rx-id=\"availableOnDevices\"\n                    [disabled]=\"isReadOnly\"\n                    [appendToBody]=\"true\"\n                    class=\"col-4 px-2\"\n                    (ngModelChange)=\"markAsDirty()\"\n                    required\n                  >\n                  </rx-select-form-control>\n                </div>\n\n                <div class=\"d-flex row\">\n                  <rx-action-list-control\n                    class=\"d-inline-block col-4 mt-2\"\n                    [(ngModel)]=\"rowAction.actions\"\n                    (ngModelChange)=\"markAsDirty()\"\n                    [name]=\"'action_' + rowAction.guid\"\n                  ></rx-action-list-control>\n                </div>\n              </adapt-accordion-tab>\n            </div>\n          </form>\n        </adapt-accordion>\n      </div>\n\n      <div *ngIf=\"!rowActions.length\" class=\"d-flex justify-content-center h-100 align-items-center mt-2\">\n        <adapt-empty-state\n          class=\"w-100\"\n          label=\"{{\n            'com.bmc.arsys.rx.client.view-components.record-grid-row-actions.empty-state.message' | translate\n          }}\"\n          type=\"config\"\n        ></adapt-empty-state>\n      </div>\n    </div>\n  </div>\n</div>\n\n<div class=\"modal-footer\">\n  <button\n    *ngIf=\"!isReadOnly\"\n    adapt-button\n    btn-type=\"primary\"\n    type=\"button\"\n    rx-id=\"save-button\"\n    [disabled]=\"rowActionsForm.invalid || !isDirty()\"\n    (click)=\"saveActions()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n\n  <button adapt-button btn-type=\"secondary\" type=\"button\" rx-id=\"cancel-button\" (click)=\"cancel()\">\n    {{\n      isReadOnly\n        ? ('com.bmc.arsys.rx.client.common.close.label' | translate)\n        : ('com.bmc.arsys.rx.client.common.cancel.label' | translate)\n    }}\n  </button>\n</div>\n"]}