{"version":3,"file":"archive-associations-control.component.js","sourceRoot":"","sources":["../../../../../../../../libs/platform/record/designer/record-designer/archive-associations-control/archive-associations-control.component.ts","../../../../../../../../libs/platform/record/designer/record-designer/archive-associations-control/archive-associations-control.component.html"],"names":[],"mappings":"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","sourcesContent":["import { ChangeDetectionStrategy, Component, Input, OnChanges, OnInit, SimpleChanges } from '@angular/core';\nimport { NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { RxModalService } from '@helix/platform/ui-kit';\nimport { ValueAccessor } from '@helix/platform/shared/components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { filter as _filter, includes, noop, reject, some } from 'lodash';\nimport { ArchiveAssociationSelectorComponent } from './archive-association-selector.component';\nimport {\n  AssociationSelectionType,\n  IAssociationsToFollowForArchive,\n  IRecordAssociationDefinitionData,\n  RxRecordDefinitionCacheService\n} from '@helix/platform/record/api';\nimport { IArchiveAssociationControlOptions, IMissingArchiveAssociation } from './archive-associations-control.types';\nimport { IAssociationDefinition, RX_ASSOCIATION_DEFINITION } from '@helix/platform/association/api';\nimport { BehaviorSubject, combineLatest, forkJoin, Observable, of } from 'rxjs';\nimport { defaultIfEmpty, filter, map, shareReplay, switchMap, take } from 'rxjs/operators';\nimport { RX_APPLICATION, RxNotificationService } from '@helix/platform/shared/api';\nimport { MissingArchiveDefinitionsModalComponent } from './missing-archive-definitions-modal.component';\n\n@Component({\n  selector: 'rx-archive-associations',\n  templateUrl: './archive-associations-control.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: ArchiveAssociationsControlComponent,\n      multi: true\n    }\n  ]\n})\nexport class ArchiveAssociationsControlComponent\n  extends ValueAccessor<IAssociationsToFollowForArchive>\n  implements OnChanges, OnInit\n{\n  @Input()\n  options: IArchiveAssociationControlOptions;\n\n  private associationLabels = {\n    [AssociationSelectionType.Selected]: this.translateService.instant(\n      'com.bmc.arsys.rx.client.record-designer.definition-properties.archiving.selected-associations.label'\n    ),\n    [AssociationSelectionType.All]: this.translateService.instant('com.bmc.arsys.rx.client.common.all.label'),\n    [AssociationSelectionType.AllEnforced]: this.translateService.instant(\n      'com.bmc.arsys.rx.client.record-designer.definition-properties.archiving.all-enforced-associations.label'\n    ),\n    [AssociationSelectionType.FollowParent]: this.translateService.instant(\n      'com.bmc.arsys.rx.client.record-designer.definition-properties.archiving.follow-parent-associations.label'\n    )\n  };\n\n  private recordDefinitionNameSubject = new BehaviorSubject<string>(null);\n\n  private associationToFollowSubject = new BehaviorSubject<IAssociationsToFollowForArchive>({\n    specificAssociationNames: [],\n    selectionType: AssociationSelectionType.FollowParent\n  });\n\n  private associationDefinitions$: Observable<IAssociationDefinition[]> = this.recordDefinitionNameSubject.pipe(\n    switchMap((recordDefinitionName: string) =>\n      recordDefinitionName\n        ? this.rxRecordDefinitionCacheService.getRecordAssociationDefinitions(recordDefinitionName).pipe(\n            map(\n              (recordAssociationDefinitions: IRecordAssociationDefinitionData) =>\n                reject(recordAssociationDefinitions[recordDefinitionName] as IAssociationDefinition[], {\n                  cardinality: RX_ASSOCIATION_DEFINITION.cardinality.manyToMany\n                }).filter(\n                  (association: IAssociationDefinition) => association.nodeAId === recordDefinitionName\n                ) as IAssociationDefinition[]\n            )\n          )\n        : of([])\n    ),\n    shareReplay(1)\n  );\n\n  private validAssociations$: Observable<IAssociationDefinition[]> = this.associationDefinitions$.pipe(\n    map((associationDefinitions) => {\n      const selectedAssociationType = this.value.selectionType;\n\n      const selectedAssociations = associationDefinitions.filter((association) =>\n        includes(this.value.specificAssociationNames, association.name)\n      );\n\n      let validAssociations = [];\n\n      if (selectedAssociationType === AssociationSelectionType.Selected) {\n        validAssociations = selectedAssociations;\n      } else if (selectedAssociationType === AssociationSelectionType.All) {\n        validAssociations = associationDefinitions;\n      } else if (selectedAssociationType === AssociationSelectionType.AllEnforced) {\n        validAssociations = associationDefinitions\n          .filter((association) => association.nodeAModality === RX_ASSOCIATION_DEFINITION.modality.required)\n          .concat(selectedAssociations);\n      }\n\n      return validAssociations;\n    })\n  );\n\n  private missingAssociations$: Observable<IMissingArchiveAssociation[]> = this.validAssociations$.pipe(\n    switchMap((associations: IAssociationDefinition[]) =>\n      forkJoin(\n        associations.map((association) =>\n          this.rxRecordDefinitionCacheService.getRecordDefinition(association.nodeBId).pipe(\n            filter((definition) => !definition.archiveDescriptor?.isEnabled),\n            map(() => ({\n              name: association.name,\n              secondRecord: association.nodeBId,\n              url: `${window.location.origin}/helix/index.html#/${RX_APPLICATION.innovationStudioBundleId}/record/edit2/${association.nodeBId}`\n            }))\n          )\n        )\n      ).pipe(defaultIfEmpty([]))\n    )\n  );\n\n  associationLabel$: Observable<string> = combineLatest([\n    this.associationToFollowSubject,\n    this.associationDefinitions$\n  ]).pipe(\n    map(([associationToFollow, associationDefinitions]) => {\n      let selectedAssociationLabel;\n\n      if (associationToFollow.selectionType === AssociationSelectionType.AllEnforced) {\n        const selectedAssociations = _filter(associationDefinitions, (association) =>\n          includes(associationToFollow.specificAssociationNames, association.name)\n        );\n\n        if (\n          some(\n            selectedAssociations,\n            (association) => association.nodeAModality !== RX_ASSOCIATION_DEFINITION.modality.required\n          )\n        ) {\n          selectedAssociationLabel = `${this.associationLabels[AssociationSelectionType.AllEnforced]} + ${\n            this.associationLabels[AssociationSelectionType.Selected]\n          }`;\n        } else {\n          selectedAssociationLabel = this.associationLabels[AssociationSelectionType.AllEnforced];\n        }\n      } else {\n        selectedAssociationLabel = this.associationLabels[associationToFollow.selectionType];\n      }\n\n      return selectedAssociationLabel;\n    })\n  );\n\n  constructor(\n    private rxModalService: RxModalService,\n    private translateService: TranslateService,\n    private rxRecordDefinitionCacheService: RxRecordDefinitionCacheService,\n    private rxNotificationService: RxNotificationService\n  ) {\n    super();\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    const prevDefinitionName = changes.options.previousValue.definitionModel.lastUpdateTime\n      ? `${changes.options.previousValue.bundleId}:${changes.options.previousValue.definitionModel.name}`\n      : changes.options.previousValue.definitionModel.recordInheritanceSelector.inheritanceDescriptor?.inheritingFrom;\n\n    const currentDefinitionName = changes.options.currentValue.definitionModel.lastUpdateTime\n      ? `${changes.options.currentValue.bundleId}:${changes.options.currentValue.definitionModel.name}`\n      : changes.options.currentValue.definitionModel.recordInheritanceSelector.inheritanceDescriptor?.inheritingFrom;\n\n    if (currentDefinitionName !== prevDefinitionName) {\n      this.recordDefinitionNameSubject.next(currentDefinitionName);\n    }\n\n    if (!currentDefinitionName) {\n      this.value = {\n        specificAssociationNames: [],\n        selectionType: AssociationSelectionType.FollowParent\n      };\n\n      this.associationToFollowSubject.next(this.value);\n    }\n  }\n\n  ngOnInit(): void {\n    const definitionName = this.options.definitionModel.lastUpdateTime\n      ? `${this.options.bundleId}:${this.options.definitionModel.name}`\n      : this.options.definitionModel.recordInheritanceSelector.inheritanceDescriptor?.inheritingFrom;\n\n    this.recordDefinitionNameSubject.next(definitionName);\n    this.associationToFollowSubject.next(this.value);\n  }\n\n  openAssociationSelector(): void {\n    this.associationDefinitions$.pipe(take(1)).subscribe((associationDefinitions) => {\n      this.rxModalService\n        .openModal({\n          title: this.translateService.instant(\n            'com.bmc.arsys.rx.client.record-designer.definition-properties.archiving.associations-to-follow.label'\n          ),\n          data: {\n            associationDefinitions,\n            selectedAssociationsToFollow: this.value,\n            actualAssociationsToFollow: this.options.definitionModelFromDefinition.associationsToFollowForArchive,\n            isOverlayMode: this.options.isOverlayMode,\n            isReadOnly: this.options.isReadOnly\n          },\n          content: ArchiveAssociationSelectorComponent\n        })\n        .then((result: IAssociationsToFollowForArchive) => {\n          this.value = result;\n          this.associationToFollowSubject.next(this.value);\n        })\n        .catch(noop);\n    });\n  }\n\n  openMissingDefinitionsModal(): void {\n    this.missingAssociations$.pipe(take(1)).subscribe((missingAssociations) => {\n      if (missingAssociations.length) {\n        this.rxModalService\n          .openModal({\n            title: this.translateService.instant(\n              'com.bmc.arsys.rx.client.record-designer.definition-properties.archiving.missing-archive-definitions.label'\n            ),\n            data: {\n              missingAssociations\n            },\n            size: 'sm',\n            content: MissingArchiveDefinitionsModalComponent\n          })\n          .catch(noop);\n      } else {\n        this.rxNotificationService.addInfoMessage(\n          this.translateService.instant(\n            'com.bmc.arsys.rx.client.record-designer.definition-properties.archiving.no-missing-archive-definitions.message'\n          )\n        );\n      }\n    });\n  }\n}\n","<div class=\"d-inline-flex align-items-center mb-1\">\n  <button\n    class=\"d-icon-plus_circle p-0\"\n    adapt-button\n    type=\"button\"\n    btn-type=\"tertiary\"\n    rx-id=\"associations-to-follow-button\"\n    (click)=\"openAssociationSelector()\"\n  >\n    {{\n      'com.bmc.arsys.rx.client.record-designer.definition-properties.archiving.associations-to-follow.label' | translate\n    }}\n  </button>\n\n  <adapt-icon\n    name=\"question_circle_o\"\n    class=\"ml-2\"\n    placement=\"right\"\n    [adaptPopover]=\"\n      'com.bmc.arsys.rx.client.record-designer.definition-properties.archiving.associations-to-follow.tooltip'\n        | translate\n    \"\n  >\n  </adapt-icon>\n</div>\n\n<div class=\"border pl-2 p-1 form-group\">\n  <span class=\"d-icon-left-arrow_schema font-weight-bold\">\n    {{ associationLabel$ | async }}\n  </span>\n</div>\n\n<div class=\"d-inline-flex align-items-center\">\n  <adapt-icon name=\"exclamation_triangle\" class=\"text-warning-icon\"> </adapt-icon>\n\n  <adapt-button\n    btn-type=\"tertiary\"\n    rx-id=\"open-missing-definitions-button\"\n    (click)=\"openMissingDefinitionsModal()\"\n    class=\"p-0 pl-1\"\n  >\n    {{\n      'com.bmc.arsys.rx.client.record-designer.definition-properties.archiving.missing-archive-definitions.label'\n        | translate\n    }}\n  </adapt-button>\n</div>\n"]}