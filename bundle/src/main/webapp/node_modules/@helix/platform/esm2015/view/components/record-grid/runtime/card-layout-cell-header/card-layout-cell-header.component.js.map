{"version":3,"file":"card-layout-cell-header.component.js","sourceRoot":"","sources":["../../../../../../../../../libs/platform/view/components/record-grid/runtime/card-layout-cell-header/card-layout-cell-header.component.ts","../../../../../../../../../libs/platform/view/components/record-grid/runtime/card-layout-cell-header/card-layout-cell-header.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Input, HostBinding, TemplateRef, ViewChild, Output, EventEmitter } from '@angular/core';\nimport { AdaptModalService } from '@bmc-ux/adapt-angular';\nimport { ColumnConfig, AdaptTableComponent, SortOrder } from '@bmc-ux/adapt-table';\nimport { SortMeta } from 'primeng/api';\nimport { IPlainObject } from '@helix/platform/shared/api';\nimport { ISortButtonClass } from './sort-button-class.interface';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'rx-card-layout-cell-header',\n  templateUrl: './card-layout-cell-header.component.html',\n  styleUrls: ['card-layout-cell-header.component.scss']\n})\nexport class CardLayoutCellHeaderComponent {\n  @Input() title: string;\n  @Input() columns: ColumnConfig[];\n  @Input() adaptTable: AdaptTableComponent;\n  @Input() openDialog: (config: any) => Promise<any>;\n\n  @Output() sort = new EventEmitter<SortMeta[]>();\n\n  @ViewChild('cardLayoutSortModalTemplate') cardLayoutSortModalTemplate: TemplateRef<any>;\n\n  multiSortMeta: SortMeta[];\n\n  constructor(private modalService: AdaptModalService, private translateService: TranslateService) {}\n\n  onSortMenuItemClick(): void {\n    this.multiSortMeta = this.adaptTable.multiSortMeta || [];\n\n    this.openDialog({\n      title: this.translateService.instant(\n        'com.bmc.arsys.rx.client.view-components.record-grid.cards.sort-by.dialog.title'\n      ),\n      content: this.cardLayoutSortModalTemplate\n    }).catch(() => {});\n  }\n\n  getSortableColumns() {\n    return this.columns\n      .filter((column) => this.adaptTable.isSortableColumn(column))\n      .sort((column1, column2) => column1.header.localeCompare(column2.header));\n  }\n\n  onSortAscClick(column: ColumnConfig): void {\n    this.changeSort(column, SortOrder.Asc);\n  }\n\n  onSortDescClick(column: ColumnConfig): void {\n    this.changeSort(column, SortOrder.Desc);\n  }\n\n  changeSort(column: ColumnConfig, order: SortOrder): void {\n    const sortIndex = this.getColumnSortIndex(column);\n    const sort = this.multiSortMeta[sortIndex];\n\n    if (sort) {\n      if (sort.order === order) {\n        this.multiSortMeta.splice(sortIndex, 1);\n      } else {\n        sort.order = order;\n      }\n    } else {\n      this.multiSortMeta.push({\n        field: column.field,\n        order\n      });\n    }\n  }\n\n  getColumnSort(column: ColumnConfig): SortMeta {\n    return this.multiSortMeta[this.getColumnSortIndex(column)];\n  }\n\n  getColumnSortIndex(column: ColumnConfig): number {\n    return this.multiSortMeta.findIndex((sort) => sort.field === column.field);\n  }\n\n  hasColumnSortOrder(column: ColumnConfig, order: SortOrder): boolean {\n    const sort = this.getColumnSort(column);\n\n    return sort ? sort.order === order : false;\n  }\n\n  getSortAscBtnClass(column: ColumnConfig): IPlainObject {\n    return this.getSortBtnClass(column, SortOrder.Asc);\n  }\n\n  getSortDescBtnClass(column: ColumnConfig): IPlainObject {\n    return this.getSortBtnClass(column, SortOrder.Desc);\n  }\n\n  getSortBtnClass(column: ColumnConfig, order: SortOrder): ISortButtonClass {\n    const isActiveSortDesc = this.hasColumnSortOrder(column, order);\n\n    return { 'btn-success': isActiveSortDesc, 'btn-secondary': !isActiveSortDesc };\n  }\n\n  clearAllSorting(): void {\n    this.multiSortMeta = [];\n  }\n\n  applySorting(): void {\n    this.sort.emit(this.multiSortMeta);\n  }\n\n  getCurrentSortingSummary(): string {\n    const ordersTitles = {\n      [SortOrder.Asc]: this.translateService.instant(\n        'com.bmc.arsys.rx.client.view-components.record-grid.cards.sort-by.sort.ascending'\n      ),\n      [SortOrder.Desc]: this.translateService.instant(\n        'com.bmc.arsys.rx.client.view-components.record-grid.cards.sort-by.sort.descending'\n      )\n    };\n\n    return this.multiSortMeta\n      .map((sortMeta, index): string => {\n        const column = this.columns.find((c) => c.field === sortMeta.field);\n\n        return `${index + 1}. ${column.header} (${ordersTitles[sortMeta.order]})`;\n      })\n      .join('\\n');\n  }\n}\n","{{ title }}\n\n<div class=\"dropdown header-cell-menu-btn\" adaptDropdown [appendToBody]=\"true\" [restoreFocusAfterClose]=\"true\">\n  <button\n    id=\"card-column-menu-dropdown-toggle\"\n    class=\"d-icon-ellipsis adapt-table-sort-menu__kebab py-2 btn btn-link\"\n    type=\"button\"\n    adaptDropdownToggle\n    [showCaret]=\"false\"\n  ></button>\n\n  <div class=\"dropdown-menu\" aria-labelledby=\"card-column-menu-dropdown-toggle\" adaptDropdownMenu tabindex=\"0\">\n    <button class=\"dropdown-item\" type=\"button\" (click)=\"onSortMenuItemClick()\">\n      {{ 'com.bmc.arsys.rx.client.view-components.record-grid.card-column-menu.items.sort-by.label' | translate }}\n    </button>\n  </div>\n</div>\n\n<ng-template #cardLayoutSortModalTemplate let-close=\"close\" let-getData=\"getData\">\n  <div class=\"modal-body rx-record-grid-sort-by-dialog\">\n    <div class=\"rx-card-fields\">\n      <div class=\"rx-card-fields__headers\">\n        <div class=\"rx-card-fields__headers-field\">\n          {{\n            'com.bmc.arsys.rx.client.view-components.record-grid.cards.sort-by.dialog.field.column.title' | translate\n          }}\n        </div>\n        <div class=\"rx-card-fields__headers-order\">\n          {{\n            'com.bmc.arsys.rx.client.view-components.record-grid.cards.sort-by.dialog.order.column.title' | translate\n          }}\n        </div>\n      </div>\n      <div class=\"rx-card-field\" *ngFor=\"let column of getSortableColumns()\">\n        <div class=\"rx-card-field__name\">{{ column.header }}</div>\n        <div class=\"rx-card-field__order\">\n          <div class=\"btn-group\">\n            <button class=\"btn btn-xs\" [ngClass]=\"getSortDescBtnClass(column)\" (click)=\"onSortDescClick(column)\">\n              <span class=\"d-icon-arrow_down\"></span>\n            </button>\n            <button class=\"btn btn-xs\" [ngClass]=\"getSortAscBtnClass(column)\" (click)=\"onSortAscClick(column)\">\n              <span class=\"d-icon-arrow_up\"></span>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div>\n      <textarea\n        rows=\"4\"\n        disabled\n        class=\"form-control rx-sort-summary\"\n        title=\"summary\"\n        [value]=\"getCurrentSortingSummary()\"\n        [placeholder]=\"\n          'com.bmc.arsys.rx.client.view-components.record-grid.cards.sort-by.dialog.field.summary.empty.title'\n            | translate\n        \"\n      ></textarea>\n    </div>\n  </div>\n  <div class=\"modal-footer\">\n    <button class=\"btn btn-secondary btn-sm\" (click)=\"clearAllSorting()\">\n      {{\n        'com.bmc.arsys.rx.client.view-components.record-grid.cards.sort-by.dialog.clear-all.button.label' | translate\n      }}\n    </button>\n    <button class=\"btn btn-primary btn-sm\" (click)=\"applySorting(); close()\">\n      {{ 'com.bmc.arsys.rx.client.common.apply.label' | translate }}\n    </button>\n    <button class=\"btn btn-secondary btn-sm\" (click)=\"close()\">\n      {{ 'com.bmc.arsys.rx.client.common.cancel.label' | translate }}\n    </button>\n  </div>\n</ng-template>\n"]}