{"version":3,"file":"process-data-dictionary.service.js","sourceRoot":"","sources":["../../../../../../../libs/platform/process/api/data-dictionary/process-data-dictionary.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { combineLatest, Observable, ReplaySubject } from 'rxjs';\nimport { map, shareReplay, take } from 'rxjs/operators';\nimport { isEmpty, omit, reject } from 'lodash';\n\nimport { RxIdService, RxObjectUtilsService } from '@helix/platform/utils';\nimport {\n  IDataDictionary,\n  IDataDictionaryBranch,\n  RxDataDictionaryUtils,\n  RxDesignerCacheService,\n  RxGlobalCacheService\n} from '@helix/platform/shared/api';\n\nimport { IActivitiesDataDictionaryState } from './activities-data-dictionary-state.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RxProcessDataDictionaryService {\n  private commonActivities: IActivitiesDataDictionaryState = null;\n  private commonActivitiesSubject = new ReplaySubject<IActivitiesDataDictionaryState>(1);\n\n  commonActivities$ = this.commonActivitiesSubject.asObservable();\n\n  private commonActivitiesDataDictionaryStateClone$ = this.commonActivities$.pipe(\n    map((activitiesDataDictionaryState) =>\n      activitiesDataDictionaryState ? this.rxObjectUtilsService.cloneDeep(activitiesDataDictionaryState) : {}\n    ),\n    shareReplay(1)\n  );\n\n  commonDataDictionary$ = this.getCommonDataDictionary();\n\n  constructor(\n    private rxDataDictionaryUtils: RxDataDictionaryUtils,\n    private rxDesignerCacheService: RxDesignerCacheService,\n    private rxGlobalCacheService: RxGlobalCacheService,\n    private rxIdService: RxIdService,\n    private rxObjectUtilsService: RxObjectUtilsService,\n    private translateService: TranslateService\n  ) {}\n\n  clear(): void {\n    this.setCommonActivities(null);\n  }\n\n  getCommonDataDictionary(): Observable<IDataDictionary> {\n    return combineLatest([\n      this.commonActivitiesDataDictionaryStateClone$.pipe(\n        map((componentsDataDictionaryState) => Object.values(componentsDataDictionaryState))\n      )\n    ]).pipe(\n      map(([activitiesDataDictionaryBranches]) => {\n        return [\n          {\n            label: 'General',\n            children: [\n              {\n                label: this.translateService.instant('com.bmc.arsys.rx.client.designer.keywords.current-date.label'),\n                icon: 'd-icon-dollar',\n                expression: '$DATE$'\n              },\n              {\n                label: this.translateService.instant(\n                  'com.bmc.arsys.rx.client.designer.keywords.current-date-time.label'\n                ),\n                icon: 'd-icon-dollar',\n                expression: '$TIMESTAMP$'\n              },\n              {\n                label: this.translateService.instant(\n                  'com.bmc.arsys.rx.client.designer.keywords.current-group-ids.label'\n                ),\n                icon: 'd-icon-dollar',\n                expression: '$GROUPIDS$'\n              },\n              {\n                label: this.translateService.instant('com.bmc.arsys.rx.client.designer.keywords.current-groups.label'),\n                icon: 'd-icon-dollar',\n                expression: '$GROUPS$'\n              },\n              {\n                label: this.translateService.instant('com.bmc.arsys.rx.client.designer.keywords.current-roles.label'),\n                icon: 'd-icon-dollar',\n                expression: '$ROLES$'\n              },\n              {\n                label: this.translateService.instant(\n                  'com.bmc.arsys.rx.client.designer.keywords.current-server-urls.label'\n                ),\n                icon: 'd-icon-dollar',\n                expression: '$SERVERURL$'\n              },\n              {\n                label: this.translateService.instant('com.bmc.arsys.rx.client.designer.keywords.current-time.label'),\n                icon: 'd-icon-dollar',\n                expression: '$TIME$'\n              },\n              {\n                label: this.translateService.instant('com.bmc.arsys.rx.client.designer.keywords.current-user.label'),\n                icon: 'd-icon-dollar',\n                expression: '$USER$'\n              },\n              {\n                label: this.translateService.instant(\n                  'com.bmc.arsys.rx.client.designer.keywords.current-user-locale.label'\n                ),\n                icon: 'd-icon-dollar',\n                expression: '$LOCALE$'\n              },\n              {\n                label: this.translateService.instant(\n                  'com.bmc.arsys.rx.client.designer.keywords.current-week-day.label'\n                ),\n                icon: 'd-icon-dollar',\n                expression: '$WEEKDAY$'\n              },\n              {\n                label: this.translateService.instant('com.bmc.arsys.rx.client.designer.keywords.new-line.label'),\n                icon: 'd-icon-dollar',\n                expression: '$NEWLINE$'\n              },\n              {\n                label: this.translateService.instant(\n                  'com.bmc.arsys.rx.client.process-designer.keywords.process-correlation-id.label'\n                ),\n                icon: 'd-icon-dollar',\n                expression: '$PROCESSCORRELATIONID$'\n              },\n              {\n                label: 'NULL',\n                icon: 'd-icon-dollar',\n                expression: '$NULL$',\n                hidden: true\n              }\n            ]\n          },\n          {\n            label: 'Functions',\n            expanded: true,\n            children: reject(\n              this.rxDataDictionaryUtils.getFunctionDataDictionaryBranch(\n                this.rxDesignerCacheService.getFunctionDescriptorsSync()\n              ),\n              { label: 'Rule Qualification' }\n            )\n          },\n          {\n            label: 'Activities',\n            expanded: true,\n            children: activitiesDataDictionaryBranches\n          }\n        ];\n      })\n    );\n  }\n\n  setCommonActivitiesDataDictionaryBranch(\n    guid: string,\n    activityDataDictionaryBranch: Observable<IDataDictionaryBranch>\n  ): void {\n    activityDataDictionaryBranch.pipe(take(1)).subscribe((dataDictionaryBranch) => {\n      this.setCommonActivities(\n        isEmpty(dataDictionaryBranch)\n          ? omit(this.commonActivities, [guid])\n          : { ...this.commonActivities, [guid]: dataDictionaryBranch }\n      );\n    });\n  }\n\n  private setCommonActivities(state: IActivitiesDataDictionaryState): void {\n    this.commonActivities = state;\n\n    this.commonActivitiesSubject.next(this.commonActivities);\n  }\n}\n"]}