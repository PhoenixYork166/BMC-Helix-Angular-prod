{"version":3,"file":"shell.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/shared/components/shell/shell.component.ts","../../../../../../../libs/platform/shared/components/shell/shell.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, Injector, OnDestroy, OnInit, TemplateRef, ViewChild } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport {\n  AdaptModalService,\n  AdaptNavigationComponent,\n  AdaptNavigationService,\n  NavigationAction\n} from '@bmc-ux/adapt-angular';\nimport { RxNotificationService, RxSmartReportingService, RxUpgradeTrackerService } from '@helix/platform/shared/api';\nimport { RX_MODAL, RxModalService } from '@helix/platform/ui-kit';\nimport {\n  IRxShellConfig,\n  IRxShellMenuItem,\n  RX_SHELL,\n  RX_VIEW_ACTION,\n  RxShellService,\n  RxViewActionService\n} from '@helix/platform/view/api';\nimport { find, noop } from 'lodash';\nimport { Observable, Subscription } from 'rxjs';\nimport { map, shareReplay, switchMap, take, tap } from 'rxjs/operators';\nimport { RxUserPreferencesComponent } from '../user-preferences/user-preferences.component';\nimport { ShellBase } from './shell-base.class';\nimport { IRxShellUpgradeTrackerAction } from './shell-component.types';\nimport { RxUserAvailabilityComponent } from '../user-availability/user-availability.component';\nimport { RxApplicationContext } from './gainsight/gainsight.types';\nimport { GainsightOptInComponent } from './gainsight/gainsight-opt-in/gainsight-opt-in.component';\n\n@Component({\n  selector: 'rx-shell',\n  templateUrl: './shell.component.html',\n  styleUrls: ['./shell.component.scss']\n})\nexport class RxShellComponent extends ShellBase implements OnInit, OnDestroy {\n  @ViewChild('adaptNavigation', { static: true })\n  protected adaptNavigation: AdaptNavigationComponent;\n\n  @ViewChild('userMessagesPopover', { static: true })\n  protected userMessagesPopover: TemplateRef<any>;\n\n  private subscriptions: Subscription = new Subscription();\n\n  constructor(\n    private adaptModalService: AdaptModalService,\n    private route: ActivatedRoute,\n    private rxModalService: RxModalService,\n    private rxNotificationService: RxNotificationService,\n    private rxShellService: RxShellService,\n    private rxSmartReportingService: RxSmartReportingService,\n    private rxUpgradeTrackerService: RxUpgradeTrackerService,\n    private rxViewActionService: RxViewActionService,\n    protected injector: Injector,\n    private adaptNavigationService: AdaptNavigationService\n  ) {\n    super(injector);\n\n    this.rxShellService.resetMenuItemCount();\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.subscriptions.add(\n      this.rxShellService.navigateToSmartReporting$\n        .pipe(switchMap(() => this.rxSmartReportingService.openSmartReporting()))\n        .subscribe((isSmartReportingConfigured) => {\n          if (!isSmartReportingConfigured) {\n            this.rxNotificationService.addErrorMessage(\n              this.translateService.instant('com.bmc.arsys.rx.client.shell.smart-reporting-not-configured')\n            );\n          }\n        })\n    );\n\n    this.subscriptions.add(\n      this.rxShellService.navigateToView$.subscribe((menuItem: IRxShellMenuItem) => this.openView(menuItem))\n    );\n\n    this.subscriptions.add(this.rxShellService.openUserPreferences$.subscribe(() => this.openUserPreferences()));\n\n    this.subscriptions.add(\n      this.rxShellService.openGainsightPreferences$.subscribe(() => this.openGainsightPreferences())\n    );\n\n    this.subscriptions.add(this.rxShellService.openUserAvailability$.subscribe(() => this.openUserAvailability()));\n  }\n\n  private onNavigationCanceled(): void {\n    if (this.currentMenuItemId !== null) {\n      this.adaptNavigation.selectMenuItem(this.currentMenuItemId);\n    }\n  }\n\n  private openView(menuItem: IRxShellMenuItem): void {\n    this.rxViewActionService\n      .execute(RX_VIEW_ACTION.viewActionNames.openView, menuItem.openViewParams)\n      .pipe(take(1))\n      .subscribe({\n        error: () => {\n          this.onNavigationCanceled();\n        }\n      });\n  }\n\n  private openUserPreferences(): void {\n    this.adaptModalService\n      .open({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.shell.my-preferences.label'),\n        content: RxUserPreferencesComponent,\n        size: 'sm'\n      })\n      .then(() => {\n        this.rxModalService\n          .confirm({\n            title: this.translateService.instant('com.bmc.arsys.rx.client.common.warning.label'),\n            modalStyle: RX_MODAL.modalStyles.warning,\n            message: this.translateService.instant(\n              'com.bmc.arsys.rx.client.shell.user-preferences-dialog.signout.confirmation.message'\n            )\n          })\n          .then((isLogoutRequested: boolean) => {\n            if (isLogoutRequested) {\n              this.logout();\n            }\n          });\n      })\n      .catch(noop);\n  }\n\n  openGainsightPreferences(): void {\n    this.adaptModalService\n      .open({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.shell.analytics.label'),\n        content: GainsightOptInComponent,\n        size: 'sm'\n      })\n      .catch(noop);\n  }\n\n  private openUserAvailability(): void {\n    this.adaptModalService\n      .open({\n        title: this.translateService.instant('com.bmc.arsys.rx.client.shell.my-availability.label'),\n        content: RxUserAvailabilityComponent,\n        size: 'sm'\n      })\n      .catch(noop);\n  }\n\n  protected getNavigationActionItems(): Observable<NavigationAction[]> {\n    return this.shellConfig$.pipe(\n      map((shellConfig) => {\n        const actions = [];\n\n        shellConfig.navigationActions.forEach((item) => {\n          actions.push({\n            action: item.action,\n            className: item.className,\n            name: item.name,\n            tooltip: item.name,\n            hide: item.hide\n          });\n        });\n\n        if (!shellConfig.globalSearchDisabled) {\n          actions.push({\n            name: this.translateService.instant('com.bmc.arsys.rx.client.common.search.label'),\n            tooltip: this.translateService.instant('com.bmc.arsys.rx.client.common.search.label'),\n            className: 'd-icon-search',\n            route: `/${this.rxGlobalCacheService.applicationId}/search`\n          });\n        }\n\n        const showUpgradeTrackerAction: IRxShellUpgradeTrackerAction = {\n          action: () => {\n            this.rxUpgradeTrackerService.displayUpgradeNotification(true);\n          },\n          className: 'd-icon-clock_alert',\n          hide: !this.rxUpgradeTrackerService.isUpgradeInProgress,\n          name: ''\n        };\n\n        this.subscriptions.add(\n          this.rxUpgradeTrackerService.isUpgradeInProgress$.subscribe(() => {\n            showUpgradeTrackerAction.hide = !this.rxUpgradeTrackerService.isUpgradeInProgress;\n          })\n        );\n\n        actions.push(showUpgradeTrackerAction);\n\n        return actions;\n      })\n    );\n  }\n\n  protected getActiveNavigationMenuItem(): IRxShellMenuItem {\n    return find(\n      this.flattenedMenuItems,\n      (menuItem) =>\n        menuItem.hide !== true &&\n        menuItem.type === RX_SHELL.actions.navigateToView &&\n        decodeURIComponent(`/${this.rxGlobalCacheService.applicationId}/view/${menuItem.viewUrl}`) ===\n          decodeURIComponent(this.router.url)\n    );\n  }\n\n  protected getNavigationMenuItems(): Observable<IRxShellMenuItem[]> {\n    return this.shellConfig$.pipe(map((shellConfig) => shellConfig.navigationBarItems));\n  }\n\n  protected getUserMenuItems(): Observable<IRxShellMenuItem[]> {\n    return this.shellConfig$.pipe(map((shellConfig) => shellConfig.userMenu.subMenu));\n  }\n\n  ngOnDestroy() {\n    super.ngOnDestroy();\n\n    this.subscriptions.unsubscribe();\n  }\n\n  protected getShellConfig(): Observable<IRxShellConfig> {\n    return this.applicationDescriptor$.pipe(\n      switchMap((currentBundleDescriptor) => this.rxShellService.getShellConfig(currentBundleDescriptor.id)),\n      tap((shellConfig) => {\n        this.flattenedMenuItems = shellConfig.flattenedMenuItems;\n      }),\n      shareReplay(1)\n    );\n  }\n}\n","<ng-template #userMessagesPopover>\n  <rx-user-messages></rx-user-messages>\n</ng-template>\n\n<adapt-navigation\n  #adaptNavigation\n  [class.invisible]=\"!isShellInitialized\"\n  [metadata]=\"brandingInfo$ | async\"\n  [menu]=\"(navigationMenuItems$ | async) || []\"\n  [actions]=\"navigationActionItems$ | async\"\n  [profile]=\"userProfileMenu$ | async\"\n></adapt-navigation>\n\n<adapt-alert\n  *ngIf=\"hasBanner$ | async\"\n  [config]=\"{\n    title: 'Note:',\n    type: 'page',\n    variant: 'info',\n    content: ''\n  }\"\n  (onClose)=\"closeBanner()\"\n>\n  <span class=\"alert-content\">\n    <span>\n      {{ alertText }}\n    </span>\n\n    <a href=\"#\" class=\"alert-link\" (click)=\"openGainsightPreferences(); $event.preventDefault()\">\n      {{ alertLinkText }}\n    </a>\n  </span>\n</adapt-alert>\n\n<div [class.invisible]=\"!isShellInitialized\" class=\"busy-indicator position-relative\">\n  <rx-busy-indicator\n    [options]=\"{\n      busy: busySubscription,\n      loaderType: 'lineLoader',\n      delay: 250,\n      backdrop: false,\n      message: null\n    }\"\n  >\n  </rx-busy-indicator>\n</div>\n\n<div\n  [class.invisible]=\"!isShellInitialized\"\n  class=\"outlet-content\"\n  [ngClass]=\"{\n    'has-banner': hasBanner$ | async\n  }\"\n>\n  <router-outlet></router-outlet>\n</div>\n"]}