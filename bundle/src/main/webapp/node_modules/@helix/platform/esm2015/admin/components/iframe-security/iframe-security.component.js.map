{"version":3,"file":"iframe-security.component.js","sourceRoot":"","sources":["../../../../../../../libs/platform/admin/components/iframe-security/iframe-security.component.ts","../../../../../../../libs/platform/admin/components/iframe-security/iframe-security.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, HostBinding, OnInit, ViewChild } from '@angular/core';\nimport { NgModel } from '@angular/forms';\nimport { Subscription } from 'rxjs';\nimport { cloneDeep, map, some } from 'lodash';\nimport { IIframeSecurities } from './iframe-security.types';\nimport { ListBuilderTextsModel, RxListBuilderItem } from '@bmc-ux/adapt-angular';\nimport { RX_IFRAME_SECURITY } from './iframe-security.constant';\nimport { RxIframeSecurityService } from './iframe-security.service';\nimport { ISystemConfiguration, RxNotificationService } from '@helix/platform/shared/api';\nimport { RxUrlUtilsService } from '@helix/platform/utils';\nimport { BaseViewComponent } from '@helix/platform/view/runtime';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'rx-admin-iframe-security',\n  templateUrl: './iframe-security.component.html'\n})\nexport class IframeSecurityAdminComponent extends BaseViewComponent implements OnInit {\n  @HostBinding('class')\n  hostClass = 'd-block col-12 col-sm-12 col-md-10 col-lg-8 col-xl-6 p-0';\n\n  @ViewChild('iframeAllowedSitesListBuilder', { read: NgModel, static: true })\n  iframeAllowedSitesListBuilder: NgModel;\n\n  @ViewChild('trustedWebsitesListBuilder', { read: NgModel, static: true })\n  trustedWebsitesListBuilder: NgModel;\n\n  busy: Subscription;\n  sections = cloneDeep(RX_IFRAME_SECURITY.sections);\n\n  listBuilderTexts: ListBuilderTextsModel = {\n    searchPlaceholder: this.translateService.instant(\n      'com.bmc.arsys.rx.client.admin.iframe-security.filter-or-add-urls.label'\n    ),\n    notFound: this.translateService.instant('com.bmc.arsys.rx.client.admin.iframe-security.no-urls-added.label')\n  };\n\n  private counter = 0;\n\n  private invalidUrlMsg = this.translateService.instant('com.bmc.arsys.rx.client.admin.invalid-url.label');\n\n  private duplicateUrlMsg = this.translateService.instant(\n    'com.bmc.arsys.rx.client.designer.validation.duplicate-value.message'\n  );\n\n  constructor(\n    private rxIframeSecurityService: RxIframeSecurityService,\n    private rxNotificationService: RxNotificationService,\n    private rxUrlUtilsService: RxUrlUtilsService,\n    private translateService: TranslateService\n  ) {\n    super();\n  }\n\n  ngOnInit(): void {\n    this.notifyPropertyChanged('api', {\n      isDirty: () => this.isDirty()\n    });\n\n    this.busy = this.rxIframeSecurityService.getIframeSecurities().subscribe((result: IIframeSecurities) => {\n      const iframeAllowedSites: ISystemConfiguration = result.iframeAllowedSites;\n      const trustedWebsites: ISystemConfiguration = result.trustedWebsites;\n\n      if (iframeAllowedSites.value) {\n        this.sections.iframeAllowedSites.urls = map((iframeAllowedSites.value as string).split(' '), (url) => ({\n          id: this.generateId(),\n          name: url\n        }));\n      }\n\n      if (trustedWebsites.value) {\n        this.sections.trustedWebsites.urls = map((trustedWebsites.value as string).split(' '), (url) => ({\n          id: this.generateId(),\n          name: url\n        }));\n      }\n    });\n  }\n\n  generateId = (): number => {\n    return this.counter++;\n  };\n\n  iframeAllowedSitesValidation = (value: string, items: RxListBuilderItem[]): string => {\n    return this.itemValidation(value, items, false);\n  };\n\n  trustedWebsitesValidation = (value: string, items: RxListBuilderItem[]): string => {\n    return this.itemValidation(value, items);\n  };\n\n  isDirty(): boolean {\n    return this.iframeAllowedSitesListBuilder.dirty || this.trustedWebsitesListBuilder.dirty;\n  }\n\n  onSaveClick(): void {\n    const iframeAllowedSitesData: ISystemConfiguration = {\n      id: this.sections.iframeAllowedSites.name,\n      name: this.sections.iframeAllowedSites.name,\n      value: map(this.sections.iframeAllowedSites.urls, 'name').join(' ')\n    };\n\n    const trustedWebsitesData: ISystemConfiguration = {\n      id: this.sections.trustedWebsites.name,\n      name: this.sections.trustedWebsites.name,\n      value: map(this.sections.trustedWebsites.urls, 'name').join(' ')\n    };\n\n    this.rxIframeSecurityService.postIframeSecurities(iframeAllowedSitesData, trustedWebsitesData).subscribe(() => {\n      this.rxNotificationService.addSuccessMessage(\n        this.translateService.instant(\n          'com.bmc.arsys.rx.client.admin.iframe-security.iframe-security-information-saved.message'\n        )\n      );\n\n      this.iframeAllowedSitesListBuilder.control.markAsPristine();\n      this.trustedWebsitesListBuilder.control.markAsPristine();\n    });\n  }\n\n  private itemValidation(value: string, items: RxListBuilderItem[], isProtocolRequired = true): string {\n    let errorMessage: string = null;\n\n    if (some(items, { name: value })) {\n      errorMessage = this.duplicateUrlMsg;\n    } else if (!this.rxUrlUtilsService.isValidUrl(value, isProtocolRequired)) {\n      errorMessage = this.invalidUrlMsg;\n    }\n    \n    return errorMessage;\n  }\n}\n","<rx-admin-settings header=\"Iframe security\" [busy]=\"busy\">\n  <h4>{{ sections.iframeAllowedSites.title | translate }}</h4>\n\n  <adapt-rx-list-builder\n    class=\"d-block mb-4\"\n    name=\"iframeAllowedSitesListBuilder\"\n    [(ngModel)]=\"sections.iframeAllowedSites.urls\"\n    [label]=\"sections.iframeAllowedSites.infoMessage | translate\"\n    [texts]=\"listBuilderTexts\"\n    [itemValidation]=\"iframeAllowedSitesValidation\"\n    hideListAreaLabel=\"true\"\n    #iframeAllowedSitesListBuilder=\"ngModel\"\n  ></adapt-rx-list-builder>\n\n  <h4>{{ sections.trustedWebsites.title | translate }}</h4>\n\n  <adapt-rx-list-builder\n    class=\"d-block mb-4\"\n    name=\"trustedWebsitesListBuilder\"\n    [(ngModel)]=\"sections.trustedWebsites.urls\"\n    [label]=\"sections.trustedWebsites.infoMessage | translate\"\n    [texts]=\"listBuilderTexts\"\n    [itemValidation]=\"trustedWebsitesValidation\"\n    hideListAreaLabel=\"true\"\n    #trustedWebsitesListBuilder=\"ngModel\"\n  ></adapt-rx-list-builder>\n\n  <button\n    class=\"align-self-start\"\n    rx-id=\"save-button\"\n    adapt-button\n    btn-type=\"primary\"\n    size=\"small\"\n    type=\"button\"\n    [disabled]=\"!isDirty()\"\n    (click)=\"onSaveClick()\"\n  >\n    {{ 'com.bmc.arsys.rx.client.common.save.label' | translate }}\n  </button>\n</rx-admin-settings>\n"]}