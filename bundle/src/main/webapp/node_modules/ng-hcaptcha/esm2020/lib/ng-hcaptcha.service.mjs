import { Inject, Injectable } from "@angular/core";
import { Observable } from "rxjs";
import { loadHCaptcha } from "./hcaptcha-utils";
import { CAPTCHA_CONFIG } from "./ng-hcaptcha-config";
import * as i0 from "@angular/core";
export class NgHcaptchaService {
    constructor(captchaConfig) {
        this.captchaConfig = captchaConfig;
    }
    verify() {
        return new Observable((subscriber) => {
            loadHCaptcha(this.captchaConfig.languageCode).subscribe(() => {
                setTimeout((context) => {
                    // Create hCaptcha element
                    if (!this.hCaptchaElement) {
                        this.hCaptchaElement = document.createElement('div');
                        document.body.appendChild(this.hCaptchaElement);
                    }
                    // Render hCaptcha using the defined options
                    if (!this.hCaptchaWidgetId) {
                        // Configure hCaptcha
                        const options = {
                            sitekey: this.captchaConfig.siteKey,
                            size: 'invisible',
                            callback: (res) => {
                                subscriber.next(res);
                                subscriber.complete();
                                this.resetHcaptcha();
                            },
                            'expired-callback': (res) => {
                                subscriber.error(res);
                                this.resetHcaptcha();
                            },
                            'error-callback': (err) => {
                                subscriber.error(err);
                                this.resetHcaptcha();
                            },
                        };
                        this.hCaptchaWidgetId = window.hcaptcha.render(this.hCaptchaElement, options);
                    }
                    // Immediately execute hCaptcha
                    window.hcaptcha.execute(this.hCaptchaWidgetId);
                }, 50, this);
            });
        });
    }
    resetHcaptcha() {
        window.hcaptcha.remove(this.hCaptchaWidgetId);
        this.hCaptchaElement = null;
        this.hCaptchaWidgetId = null;
    }
}
NgHcaptchaService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.2.5", ngImport: i0, type: NgHcaptchaService, deps: [{ token: CAPTCHA_CONFIG }], target: i0.ɵɵFactoryTarget.Injectable });
NgHcaptchaService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.2.5", ngImport: i0, type: NgHcaptchaService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.2.5", ngImport: i0, type: NgHcaptchaService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [CAPTCHA_CONFIG]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctaGNhcHRjaGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWhjYXB0Y2hhL3NyYy9saWIvbmctaGNhcHRjaGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsVUFBVSxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzlDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNoRCxPQUFPLEVBQWlCLGNBQWMsRUFBRSxNQUFNLHNCQUFzQixDQUFDOztBQUtyRSxNQUFNLE9BQU8saUJBQWlCO0lBSzFCLFlBQTRDLGFBQTRCO1FBQTVCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO0lBQUksQ0FBQztJQUU3RSxNQUFNO1FBQ0YsT0FBTyxJQUFJLFVBQVUsQ0FBQyxDQUFDLFVBQTJCLEVBQUUsRUFBRTtZQUNsRCxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO2dCQUN6RCxVQUFVLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtvQkFDbkIsMEJBQTBCO29CQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRTt3QkFDdkIsSUFBSSxDQUFDLGVBQWUsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUNyRCxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7cUJBQ25EO29CQUVELDRDQUE0QztvQkFDNUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTt3QkFDeEIscUJBQXFCO3dCQUNyQixNQUFNLE9BQU8sR0FBRzs0QkFDWixPQUFPLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPOzRCQUNuQyxJQUFJLEVBQUUsV0FBVzs0QkFDakIsUUFBUSxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0NBQ2QsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztnQ0FDckIsVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dDQUN0QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7NEJBQ3pCLENBQUM7NEJBQ0Qsa0JBQWtCLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQ0FDeEIsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztnQ0FDdEIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDOzRCQUN6QixDQUFDOzRCQUNELGdCQUFnQixFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0NBQ3RCLFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0NBQ3RCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQzs0QkFDekIsQ0FBQzt5QkFDSixDQUFDO3dCQUNGLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLE9BQU8sQ0FBQyxDQUFDO3FCQUNqRjtvQkFFRCwrQkFBK0I7b0JBQy9CLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUNuRCxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ2pCLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU8sYUFBYTtRQUNqQixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztRQUM1QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO0lBQ2pDLENBQUM7OzhHQW5EUSxpQkFBaUIsa0JBS04sY0FBYztrSEFMekIsaUJBQWlCOzJGQUFqQixpQkFBaUI7a0JBRDdCLFVBQVU7OzBCQU1NLE1BQU07MkJBQUMsY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YnNjcmliZXIgfSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQgeyBsb2FkSENhcHRjaGEgfSBmcm9tIFwiLi9oY2FwdGNoYS11dGlsc1wiO1xyXG5pbXBvcnQgeyBDYXB0Y2hhQ29uZmlnLCBDQVBUQ0hBX0NPTkZJRyB9IGZyb20gXCIuL25nLWhjYXB0Y2hhLWNvbmZpZ1wiO1xyXG5cclxuZGVjbGFyZSBjb25zdCB3aW5kb3c6IGFueTtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIE5nSGNhcHRjaGFTZXJ2aWNlIHtcclxuXHJcbiAgICBwcml2YXRlIGhDYXB0Y2hhRWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcbiAgICBwcml2YXRlIGhDYXB0Y2hhV2lkZ2V0SWQ6IHN0cmluZztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihASW5qZWN0KENBUFRDSEFfQ09ORklHKSBwcml2YXRlIGNhcHRjaGFDb25maWc6IENhcHRjaGFDb25maWcpIHsgfVxyXG5cclxuICAgIHZlcmlmeSgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZSgoc3Vic2NyaWJlcjogU3Vic2NyaWJlcjxhbnk+KSA9PiB7XHJcbiAgICAgICAgICAgIGxvYWRIQ2FwdGNoYSh0aGlzLmNhcHRjaGFDb25maWcubGFuZ3VhZ2VDb2RlKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoY29udGV4dCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBoQ2FwdGNoYSBlbGVtZW50XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmhDYXB0Y2hhRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhDYXB0Y2hhRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuaENhcHRjaGFFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciBoQ2FwdGNoYSB1c2luZyB0aGUgZGVmaW5lZCBvcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmhDYXB0Y2hhV2lkZ2V0SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29uZmlndXJlIGhDYXB0Y2hhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXRla2V5OiB0aGlzLmNhcHRjaGFDb25maWcuc2l0ZUtleSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6ICdpbnZpc2libGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IChyZXMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLm5leHQocmVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldEhjYXB0Y2hhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2V4cGlyZWQtY2FsbGJhY2snOiAocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlci5lcnJvcihyZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZXRIY2FwdGNoYSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlcnJvci1jYWxsYmFjayc6IChlcnIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNldEhjYXB0Y2hhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhDYXB0Y2hhV2lkZ2V0SWQgPSB3aW5kb3cuaGNhcHRjaGEucmVuZGVyKHRoaXMuaENhcHRjaGFFbGVtZW50LCBvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEltbWVkaWF0ZWx5IGV4ZWN1dGUgaENhcHRjaGFcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaGNhcHRjaGEuZXhlY3V0ZSh0aGlzLmhDYXB0Y2hhV2lkZ2V0SWQpO1xyXG4gICAgICAgICAgICAgICAgfSwgNTAsIHRoaXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlc2V0SGNhcHRjaGEoKSB7XHJcbiAgICAgICAgd2luZG93LmhjYXB0Y2hhLnJlbW92ZSh0aGlzLmhDYXB0Y2hhV2lkZ2V0SWQpO1xyXG4gICAgICAgIHRoaXMuaENhcHRjaGFFbGVtZW50ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmhDYXB0Y2hhV2lkZ2V0SWQgPSBudWxsO1xyXG4gICAgfVxyXG5cclxufVxyXG4iXX0=